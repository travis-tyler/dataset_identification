[{"section_title": "Abstract", "text": "Abstract: The traditional fuzzy clustering algorithm and its extensions have been successfully applied in MR image segmentation for quantitative morphological analysis. However, the clustering results might be biased due to the variability of tissue intensities and anatomical structures. For example, clustering-based algorithms tend to over-segment white matter tissues of MR brain images. To solve this problem, we introduce a tissue probability map constrained clustering algorithm and apply it to serial MR brain image segmentation, i.e., a series of 3-D MR brain images of the same subject at different time points, for longitudinal study of human brains. The tissue probability maps consist of segmentation priors obtained from a population and reflect the probability of different tissue types. More accurate image segmentation can be achieved by using these segmentation priors in the clustering algorithm. Using the new serial image segmentation algorithm in the framework of the CLASSIC algorithm, which iteratively segments a series of images and estimates their longitudinal deformations, more accurate and robust longitudinal measures can be achieved. Experimental results using both simulated longitudinal MR brain data and the Alzheimer's Disease Neuroimaging Initiative (ADNI) data confirmed the advantages of the proposed algorithm in longitudinal follow up studies of MR brain imaging with subtle morphological changes for neurological disorders. "}, {"section_title": "Introduction", "text": "Image segmentation plays an important role in quantitative analysis of MR brain images of many medical imaging applications, such as automatic tissue labeling and quantification, morphometry, image registration, and image-guided surgery (1; 2; 3; 4; 5; 6; 7; 8). In image computing tasks such as analyzing the normal development, aging, neuro-degeneration, epilepsy, Alzheimer's Disease (AD), and other neurological diseases, it is important to conduct a follow up study and quantify the subtle longitudinal morphological changes of MR brain images for better understanding the morphological changes of human brains or earlier detection of diseases. In these studies, a series of 3-D images of the same subject are usually captured at different time points, and the focus is to quantitatively measure the morphological changes of the whole brain or a specific region (9; 10; 11) across with time. Therefore, not only spatial information needs to be effectively utilized to generate spatially smooth segmentation results (12; 13), but also longitudinal stability is critical, since the temporal changes in these applications are usually subtle and the true signal of morphological information might be overwhelmed by the measurement errors if we process the serial images individually. It is in this context that existing 3-D segmentation and registration algorithms may not be able to provide sufficient power for longitudinal image computing. In addition to the measurement errors, it is also a challenge when the presence of vascular or other pathologies changes signal characteristics, i.e., tissue contrast change, thereby rendering tissue segmentation unreliable. Therefore, in order to more accurately and robustly measure the temporal signal changes, it is important to accurately align longitudinally corresponding anatomical structures and measure these anatomical changes across different time points by using the temporal information provided in the 3-D image series.\nRecently, several 4-D image processing algorithms as well as joint segmentation and registration algorithms have been proposed in the literature (14; 15; 16; 17; 18; 19; 20; 21; 22) . Serial image processing aims at calculating the image series in the 4-D space wherein temporal deformations among images are estimated simultaneously (14; 15; 16) , while segmentation and registration can be combined together since image registration significantly benefits from segmentation and vice versa (17; 18; 19; 20; 21; 22) . In (17) , a unified registration-segmentation framework is proposed to first label the images based on the graph-cuts technique, incorporate the shape prior using a technique based on level-sets, and then run image registration on the watershed regions of the segmentation instead of voxels. In (18) , the detection of corresponding edges, an edge preserving denoising algorithm, is combined with the morphological registration via a nonrigid deformation for a pair of images with structural correspondence. Thus the joint procedure and combination of different image modalities makes segmentation significantly more robust. In (19) , a statistical model is proposed to combine the registration of an atlas with the segmentation of magnetic resonance images. The Expectation Maximization (EM) algorithm is utilized for image segmentation, and the new joint approach significantly outperforms similar methods which sequentially apply registration and segmentation. Wang et. al. (20) presented a novel variational formulation of the registration assisted image segmentation problem to simultaneously register and segment images. In (21) , authors show that accurate and robust results can be obtained through seeking a joint solution to the segmentation and registration processes. Both experiments on synthetic and real data sets using these joint segmentation and registration algorithms show more accurate and robust results can be obtained.\nBased on the idea of joint segmentation and registration for serial image computing, we have proposed the CLASSIC algorithm for longitudinal MR brain image analysis (22) . The algorithm incorporates an iterative serial image segmentation and registration strategy in order to improve the longitudinal stability for 3-D image series. It iteratively performs two steps: i) jointly segment a series of 3-D images using a 4-D image-adaptive clustering algorithm based on the current estimate of the longitudinal deformations in the image series, and ii) refine these longitudinal deformations using a 4-D elastic warping algorithm (14; 23) . The 4-D segmentation algorithm is based on an extension of the FANTASM algorithm (24) by using additional temporal constraints forcing temporally corresponding voxels being segmented with the same tissue type. After segmentation, the 4-D elastic warping algorithm is then applied to refine the longitudinal deformations among the image series to better estimate the longitudinal correspondence and segmentation iteratively. Experimental results on simulated and real longitudinal MR brain images showed both segmentation accuracy and longitudinal consistency.\nOur work in this paper is a departure from the earlier method described above (22) in that we use tissue probability map as an additional constraint in the fuzzy clustering algorithm (25) . Traditional clustering methods might be biased by the tissue population and intensity differences, as well as the spatial distribution of tissues or the anatomical structures since the size and intensities of different tissue classes vary greatly in different images and applications. For example, most clustering-based algorithms tend to over-segment white matter tissues of MR brain images. To solve this problem, we introduce a tissue probability map or segmentation prior constrained clustering algorithm and apply it to serial MR brain image segmentation. The tissue probability maps consist of the segmentation priors obtained from a population and reflect the probability of a voxel belonging to different tissue types. In this way, the clustering algorithm is not only driven by the image data but also constrained by the probability of different tissue types of each image location, thus the increased segmentation accuracy and robustness is obtained. We then apply the new segmentation algorithm in the framework of CLASSIC. For convenience, in the rest of this paper we refer the new algorithm as CLASSIC-II, and the method in (22) as CLASSIC-I (with no tissue probability constraint).\nExperiments are performed to segment both simulated and real longitudinal MR brain images. For the simulated images, first the statistical model-based deformable simulation (26) is used to simulate different subject images, and then longitudinal atrophies at the temporal lobe of each subject image are simulated using the atrophy simulation algorithm (27) . Because the underlying deformation and the global and local volumes are known, the correct classification rates are calculated to quantitatively evaluate the accuracy of the proposed algorithm. Both CLASSIC-I and II are compared, and the results show that by using the tissue probability map, more accurate segmentation results can be obtained. Specifically, the new algorithm overcomes the disadvantage of over-segmentation of white matter for clustering-based image segmentation. For real images, the longitudinal 3-D T1-SPGR MR images of the Alzheimer's Disease Neuroimaging Initiative (ADNI) are used in the experiments. In all the experiments, we focused on evaluating the performance of the algorithms in terms of obtaining temporallyconsistent segmentation, capturing global and local intensity/contrast changes, as well as estimating longitudinal deformations. The results on simulated datasets demonstrate that by using tissue probability maps in the clustering algorithm more accurate segmentation results can be obtained compared with CLASSIC-I where no tissue probability map constraint is applied.\nThe remainder of the paper is organized as follows. In Section 2, we introduce the tissue density map constrained CLASSIC algorithm in detail. Section 3 presents the experimental results, and Section 4 is the conclusion of this study."}, {"section_title": "Method", "text": ""}, {"section_title": "The Framework of the Algorithm", "text": "The algorithm incorporates an iterative serial image segmentation and registration strategy in order to improve the longitudinal stability for 3-D image series. It iteratively performs two steps (22):\n\u2022 Step 1: Given the current segmentation results, the algorithm refines the underlying longitudinal deformations among the serial images using the 4-D elastic image warping algorithm (14) . Notice that other registration algorithms that take an initial deformation field and refine the registration result based on the input segmented images in order to better match them, can also be easily embedded into this framework;\n\u2022 Step 2: Given a current estimate of the longitudinal deformations necessary to align serial 3-D images, the algorithm jointly segments the image series using the tissue probability map constrained 4-D clustering algorithm (described in Section 2.2). The major idea is that temporal consistent segmentation is achieved for longitudinally corresponding tissues, and the use of tissue probability map constraint improves the accuracy and robustness of the image segmentation.\nIn the first iteration, the initial segmentation of the serial images can be obtained by applying a 3-D image segmentation algorithm, AdpkMean (28) . Then the proposed 4-D segmentation is used from the second iteration. The algorithm stops when the difference between two consequent iterations is smaller than a prescribed threshold."}, {"section_title": "The Tissue Probability Map Constrained 4-D Clustering Algorithm", "text": ""}, {"section_title": "Tissue Probability Map Constrained 4D Fuzzy Clustering Algorithm", "text": "In traditional clustering-based segmentation (29; 30; 31) , since the size and intensities of different tissue classes vary greatly in different images and applications, the clustering results might be biased by the tissue population and intensity differences, as well as the spatial distribution of tissues or the anatomical structures. Herein, we propose to use the tissue probability map as an additional constraint of the clustering algorithm to overcome such disadvantages. Given a series of images I t , t \u2208 T, T = {t 1 , t 2 , ..., t Y } and the underlying longitudinal deformations F t1\u2192t , t = t 2 , ..., t Y , the goal of the 4-D segmentation is to classify the tissues into white matter (WM), gray matter (GM) and cerebrospinal fluid (CSF). The segmented images are denoted as I (seg) t , t \u2208 T . Since F t1\u2192t is the deformation from I t1 to I t , the corresponding point of a voxel i in image I t1 will be point F t1\u2192t (i) in image I t . For simplicity, we denote the point F t1\u2192t (i) in image I t as (t, i), thus x (t,i) indicates the intensity of point (t, i).\nFrom the segmentation results of the images of a population we can obtain the tissue probability map p (t,i),k and globally align it onto the space of the first image of the image series. The tissue probability map reflects the probability or segmentation prior of point (t, i) belonging to class k. This prior information can then be used as an additional constraint in the fuzzy clustering algorithm to reduce the effect of biased segmentation results. This new tissue probability map constrained 4-D clustering algorithm can be formulated by minimizing the following new objective function:\nwhere voxel x (t,i) (t \u2208 T, i \u2208 \u2126) is classified into different tissue types by finding the clustering centers c t,k , the kth clustering center of image I t , and \u00b5 (t,i),k , the fuzzy membership function of x (t,i) belonging to class k. \u2126 is the image domain of I t1 . K is the number of tissue types. The first term in Eq. (1) is the standard energy term for fuzzy clustering algorithm. The second term reflects the constraint of the tissue probability map and \u03b3 is the weight for the constraint. The third and the forth terms are the spatial segmentation consistency and the temporal segmentation consistency constraints along the longitudinal deformations, respectively. \u03b1 and \u03b2 are the weights for these two constraints.\u03bc\nalong the temporal deformation, and N 1 and N 2 are the normalization factors. T N is the size of the temporal neighborhood, and M k = {l : k = 1, ..., K, and l = k}. The fuzzy membership functions are subject to\nIt can be seen that the algorithm becomes the segmentation step in the CLASSIC-I (with no spatial adaptation for clustering centers) when \u03b3 = 0, it is similar to the Robust FCM algorithm (32) when \u03b3 = 0 and \u03b2 = 0, and it becomes the standard FCM algorithm when \u03b1 = 0, \u03b2 = 0, and \u03b3 = 0. Therefore, by setting properly the parameters \u03b1, \u03b2, and \u03b3, we can apply constraints on spatial smoothness, temporal consistency, and prior tissue knowledge on the 4-D clustering algorithm. Using Lagrange multipliers to enforce the constraint Eq.(2) in Eq. (1), and calculating its partial derivatives with respect to \u00b5 and c, we can get the equations to iteratively update them:\nwhere\n(t,i),k , and This serial image segmentation algorithm is used in Step 2 of the CLASSIC framework as described in Section 2.1."}, {"section_title": "Estimation of Tissue Probability Maps", "text": "In the previous section, we have introduced that the tissue probability map p (t,i),k can be used as a constraint in the 4-D segmentation algorithm. In this section, we explain how such segmentation prior is calculated in detail. A tissue probability map is calculated from the segmentation results of a population, i.e., all the S sample images captured from a population are first segmented using a 3-D segmentation algorithm (28) , and then all these segmented images are aligned onto the space of the template image I temp using (23). Denoting n temp (i, k) as the number of aligned sample images whose voxel i is segmented as tissue k, the segmentation prior of class k at voxel i is defined as,\nwhere \u2126 temp is the space of the template image, and\nWhen applying the segmentation prior onto a series of input images I t , t = t 1 , ..., t Y , we can transform the segmentation prior p temp i,k onto the space of the first image I t1 . Herein, the FSL FLIRT program is applied to align all the segmentation results on to the template image space, as well as to transfer the template image onto the first time point image using affine transformations. We denote the transformed prior in the first time point image domain as p (t,i),k , which is used in Eq.(1) as the tissue probability map. Figure 2 The template image (a) and three sample simulated subject images (b,c,d). Fig. 1 shows the tissue probability maps of different tissue types calculated from 150 normal adult MR brain images obtained from the ADNI dataset. This paper focuses on segmenting longitudinal adult human MR brain images, and its possible applications include calculating the subtle longitudinal morphological human brain changes for earlier detection of MCI and AD. In these applications, there are no obvious pathological phenotypes from single time-point MR image; however, the subtle longitudinal morphological changes can provide quantitative neuroimaging markers for earlier detection of neuro-degeneration diseases. Therefore, the selection of subjects for calculating the tissue probability maps should be considered carefully according to the applications. For example, it is ideal to match the age groups to generate the probability maps. In this paper, we selected the MR images from normal adults download from the ADNI. As a result, the subjects used to test the algorithm are also in the same age range. For further application, since the morphology is different for young kids, adults, and elder adults, we would suggest that different subject groups should be used for different studies."}, {"section_title": "Results", "text": "Two sets of experiments are carried out to evaluate the proposed 4-D image segmentation algorithm. First, we used simulated serial MR brain data where the ground truth of the segmentations is known, and then serial MR brain image data from the ADNI study (30 subjects, and there are at least three time points for each subject) were used for calculating the longitudinal measures."}, {"section_title": "Experiments on Simulated Longitudinal Data", "text": "The proposed algorithm is validated first on simulated images. The deformations of these simulated images are known in order to calculate the registration accuracy. The images are simulated as follows. First, a statistical model (26) is trained using the 3-D registration results obtained from 150 ADNI MR brain data, then the statistical simulation algorithm is used to simulate a number of new deformation fields (we simulated ten deformations) from a given template image. Then, the corresponding MR brain images can be generated by warping the segmented template image using these simulated fields. Serial images can then be simulated for each of these simulated subject images by using the atrophy simulation package (27) . Thus each simulated subject image consists of longitudinal atrophy in their serial images. Notice all these simulated images are the segmented images, and spatially correlated Gaussian noises are then added to them, where the mean intensity of WM, GM and CSF as 45, 85, and 110, respectively, and the standard deviation of the Gaussian noise is set to 15. In this way, the ground truth of the tissue types of these serial images and the longitudinal deformations of the serial images are known. Fig. 2 shows some examples of the simulated images. The first row gives the template image and three warped template images using the simulated deformation fields. It can be seen that using the statistical model-based deformation simulation (26) , various realistic anatomical shapes of MR brain images can be simulated. The second row gives the template segmentation image and the corresponding warped segmentation images using the simulated fields. Because our goal is to evaluate the accuracy of image segmentation, we will simulate the MR images from the segmentation images by adding noises, so that the ground truth is known. The longitudinal data are generated by first manually selecting a point within the temporal lobe and then simulating a gradual atrophy of a spherical region around that point across with time. For each subject image, five time point images are simulated, and Fig. 3 gives an example of the simulated serial images. It can be seen that atrophy on the left temporal lobe region is gradually introduced.\nAfter generating the simulated images, the proposed 4-D segmentation algorithm is evaluated with (CLASSIC-I) and without (CLASSIC-II) the tissue probability map constraints by segmenting these datasets. The global and local brain volumes and the correct classification rate (CCR) can be calculated for each segmentation result with respect to the ground truth to evaluate the performance of the proposed algorithm. Herein, we calculated the WM and GM volumes, as well as the CCR for all the images within the previously selected spherical regions, and Fig. 4(a) shows the mean and standard deviation of the volumes, and Fig. 4(b) gives the CCR for different subjects across different time points. It can be seen that in terms of local brain tissue volume (GM + WM) measures, similar average and standard deviation measures of the ten simulated serial images were obtained for both methods, however in terms of CCR, the CLASSIC with tissue probability map constraint is better: it yields higher CCR values. These results indicate that since the white matter and gray matter are combined together in the volumetric measure, there might be some difference in the segmentation results for different tissues. In fact, if calculating the WM and GM volumes separately (see Fig. 5 ), we can see more accurate measures of different tissue volumes by using the tissue probability map in the 4-D clustering algorithm. In summary, the experiments using the simulated serial images indicate more accurate segmentation by applying the tissue probability map constraints in the 4-D fuzzy clustering algorithm. There are three important parameters in this proposed algorithm, namely \u03b1, \u03b2 and \u03b3. \u03b1 is the weighting factor for spatial smoothness constraint, \u03b2 is the parameter for temporal constraint, and \u03b3 is the weight for the prior knowledge. We adopted a method to gradually tune these parameters one by one. First, \u03b2 and \u03b3 were set to zero and a proper \u03b1 was selected by calculating the CCR using simulated images, and then \u03b2 was determined followed by \u03b3. Finally the parameters we used in the experiments are \u03b1 = 150, \u03b2 = 170, \u03b3 = 60. These (a) (b) Figure 5 The volumes of GM (a) and WM (b) are plotted for one series of images. It can be seen that although the total volumes are similar, by the volumes of different tissue types are slightly different. Thus by using the tissue probability map as an additional constraint, CLASSIC-II overcomes the problem for over-segmentation of white matter and improves the accuracy for gray matter and white matter parameters are also applied to the real longitudinal images in the following experiments."}, {"section_title": "Experiments on Longitudinal Images of Alzheimer's Disease", "text": "We also applied the proposed algorithm to ADNI (www.loni.ucla.edu) data. The primary goal of ADNI has been to test whether serial magnetic resonance imaging (MRI), positron emission tomography (PET), other biological markers, and clinical and neuropsychological assessment can be combined to measure the progression of mild cognitive impairment (MCI) and early Alzheimer's disease (AD). In this preliminary experiment, we applied the algorithm to 30 ADNI datasets (MCI), and the goal is to evaluate the performance of the algorithm on real data. For all the original MR brain data, the FSL BET skull stripping program has been used to remove the skulls, and some manual corrections were conducted for larger skulls that have not been removed. Then the proposed 4-D segmentation algorithm was used to segment these serial images. Fig. 6 shows an example of the segmentation results of a subject in the ADNI dataset using CLASSIC-II. It can be seen that the segmentation results are temporally stable while still maintaining the anatomical details and differences across different time points. In order to quantitatively analyze the segmentation results, we used a temporal consistency (TC) factor to calculate the temporal consistency of the segmentation results. Suppose x seg (t,i) is the segmentation result (label) of voxel x (t,i) , the segmentation results of voxel x (t,i) across different time points can be denoted as x seg (t1,i) , x eg (t2,i) ,...,x seg (tY ,i) . Denote L i as the number of label changes of the corresponding voxels across different times, the segmentation is temporally consistent if L i is small, and vice versa. Therefore, the TC of segmentation results of the image series can be measured by Figure 7 The temporal consistency of the whole brain of different subjects using different segmentation algorithms. The results indicate that because of the use of the temporal deformations of the serial images, the segmentation of longitudinally corresponding tissues is more stable using the proposed algorithm. where \u2126 \u2032 is the voxel set of the region of interest, and S(\u2126 \u2032 ) is the number of voxels in \u2126 \u2032 . Both the TC values obtained from a 3-D segmentation, FAST (33) , and CLASSIC-II are calculated and shown in Fig. 7 . Notice that the longitudinal deformations among the serials images are needed in order to calculate the TC values. For the 3-D segmentation results, we applied two kinds of registration to get them, namely the FSL FLIRT affine registration (33) and the 3-D hierarchical volumetric image registration (23) . For CLASSIC-II, both the longitudinal deformations and the 4-D segmentation results can be obtained simultaneously. It can be seen from Fig. 7 that the TC values for 4-D algorithm are much higher than those of 3-D, indicating that longitudinally stable segmentation and alignment of serial images is achieved. It can be seen that the proposed algorithm yields relative stable temporal morphological measures as compared to the previous algorithms. We also calculated the local tissue volumes within the spherical regions of temporal lobe of all the subjects, and Fig. 8 shows some examples of the local gray matter and white matter volumes obtained by using, CLASSIC-I, CLASSIC-II and FAST, respectively. Since the ground-truth for real subjects is not known, it is hard to compare the accuracy of different methods, so the purpose for this comparison is to plot the volumetric measures of these three methods, and we showed that compared to CLASSIC-I, CLASSIC-II yields similar volume measures with FAST, and moreover the longitudinal changes obtained are more consistent. Thus we can see a relatively steady volume decrease for the left temporal lobe using CLASSIC-I and CLASSIC-II, while those obtained from FAST is comparatively bumpy. In addition, it can be seen that the CLASSIC-II results overcome the disadvantages of over-segmentation for white matter tissue."}, {"section_title": "Gray matter volumes by different algorithms", "text": "It is worth noting that the traditional quantitative image computing algorithms first segments the images and then performs image registration, and the registration results rely on the segmentation of individual image, and hence there is no mechanism to refine the segmentation and registration results. The proposed method iteratively registers and segments the serial images. In this way, the registration algorithm could have better ability to refine the results and converge to acceptable or better registration results. The underlying assumption is that the majority of the image voxels is registered and segmented correctly during the first iteration, and thus the initializations of the registration in the following iterations are close to the solution in order to make sure the iterative procedure is stable. Therefore, it is important to investigate how this iterative procedure converges. In order to test this we performed the algorithm for real MR brain image series and calculated the TC values of the segmentation results obtained from different iterations. Fig. 9 shows the results of a series of images. It can be seen that initially the TC value for such image series is 78.8% (this is based on the FAST 3-D segmentation and affine transformation), and after one iteration the TC values increased to 85.3%, and the TC values tend to be quite stable for the following iterations. Therefore, the proposed iterative procedure converges very fast, and we performed only two iterations in all the experiments."}, {"section_title": "Conclusion", "text": "This paper proposed a tissue probability map constrained 4-D image segmentation algorithm for longitudinal image analysis. The algorithm iteratively estimates the longitudinal deformations among the image series that reflect the underlying structural changes across time and jointly segments the serial images. By using the tissue probability map as an additional constraint in the clustering algorithm, more accurate and robust segmentation results can be obtained for serial images. Experiments with simulated MR brain images and the ADNI data have confirmed the advantages of this algorithm."}, {"section_title": "Acknoledgement", "text": "This research is partially funded by NIH G08LM008937 under STC Wong. Dr. Shen is supported by EB006733, EB008374, EB009634, and MH088520."}]