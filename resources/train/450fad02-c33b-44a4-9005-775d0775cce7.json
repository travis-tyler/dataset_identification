[{"section_title": "1", "text": ", has evolved independently in numerous groups of animals despite its stringent energetic demands and potential developmental costs [2] [3] [4] . The cognitive buffer hypothesis posits that the repeated evolution of relatively large brains was driven primarily by the adaptive benefits of being able to mount quick, flexible behavioural responses to frequent or unexpected environmental change 5, 6 . In line with this view, comparative studies have shown that more highly encephalized birds have greater potential for behavioural innovation 7, 8 , lower mortality rates 9, 10 and a greater capacity to thrive in human-altered environments 11, 12 . In addition, highly encephalized birds have been shown to preferentially occupy environments with more variable climates 13, 14 , where biotic and abiotic conditions change considerably within and across years.\nAlthough these findings are consistent with the cognitive buffer hypothesis, questions remain regarding its validity as a general explanation for the evolution of cognition. In particular, it is currently unclear whether the observed link between survival and encephalization is specifically driven by an enhanced ability to cope with environmental change, or driven instead by other adaptive benefits. In addition, a direction of causality in the relationship between encephalization and environmental variation has not yet been established. Specifically, the cognitive buffer hypothesis predicts that relatively large brains evolved in situ as a result of selection for coping with environmental variation 5 . However, large brains could have also evolved elsewhere and may have subsequently facilitated the colonization of variable habitats, as suggested by recent reports that anthropogenic introductions of highly encephalized vertebrates to new habitats tend to have higher success rates [15] [16] [17] . Here, we leverage the power of modern evolutionary analyses, broad-scale comparative datasets and citizen science to clarify these fundamental issues regarding the role of ecological variation in the evolution of cognition. We begin by applying current state-of-the-art demographic analyses to test directly the mechanistic assumption that enhanced encephalization improves survival in variable habitats. We then apply models of correlated trait evolution to formally assess the direction of causality in the observed correlation between the occupancy of variable habitats and high encephalization in birds."}, {"section_title": "Results", "text": "Estimating cognitive ability. In line with prior large-scale comparative studies on the evolution of cognition, we use relative brain size as a proxy for cognitive ability 1 . This metric acknowledges that absolute brain size increases naturally in larger species, and estimates instead a species' cognitive ability as the extent to which its brain is larger (or smaller) than expected for its body size. The relative brain sizes used in our analyses were computed as residuals from a phylogenetic generalized least squares (PGLS) regression of ln brain on ln body size (slope = 0.59 \u00b1 0.00 s.d.; intercept = \u2212 2.48 \u00b1 0.05 s.d.; \u03bb = 0.87 \u00b1 0.01 s.d.), including the 2,062 bird species for which brain size is currently available (see Methods and Supplementary Data 2). While such a proxy for cognition is clearly indirect, we note that there is a growing body of experimental and correlative evidence linking relative brain size with cognitive ability [18] [19] [20] , and more specifically with behavioural innovation 21, 22 . Does greater cognition improve survival in more variable environments? One way to evaluate directly whether enhanced cognition increases survival in more variable environments is to test explicitly whether the interaction between encephalization and environmental variability has a significant effect on population dynamics. If behavioural flexibility facilitates coping with unexpected ecological challenges, then we predict that population dynamics in highly encephalized species should be buffered from environmental extremes and should therefore be less affected by increased environmental variability as compared with those of small-brained species.\nWe tested this prediction in a sample of North American land birds for which brain size is known and time series data are sufficient to properly estimate year-to-year variation in breeding population numbers 23 (N = 126 species; Supplementary Data 1). Demographic data for this analysis were obtained from the North American Breeding Bird Survey (BBS) 24 , a yearly standardized assessment of breeding bird abundances conducted since 1966 at thousands of The cognitive buffer hypothesis posits that environmental variability can be a major driver of the evolution of cognition because an enhanced ability to produce flexible behavioural responses facilitates coping with the unexpected. Although comparative evidence supports different aspects of this hypothesis, a direct connection between cognition and the ability to survive a variable and unpredictable environment has yet to be demonstrated. Here, we use complementary demographic and evolutionary analyses to show that among birds, the mechanistic premise of this hypothesis is well supported but the implied direction of causality is not. Specifically, we show that although population dynamics are more stable and less affected by environmental variation in birds with larger relative brain sizes, the evolution of larger brains often pre-dated and facilitated the colonization of variable habitats rather than the other way around. Our findings highlight the importance of investigating the timeline of evolutionary events when interpreting patterns of phylogenetic correlation.\n. The hierarchical models implemented here estimate yearly fluctuations in abundance while accounting for long-term population trends, route-to-route variation in abundance and imperfect detection by observers ( Fig. 1 ; see Methods). By explicitly separating the sources of error in reported bird counts, these models allow us to estimate the extent to which year-to-year fluctuations in true population size are a product of ecologically relevant processes such as the mortality induced by environmental extremes (also known as 'process error' or \u03c3 \u03b3 ; Fig. 1 ). Species-specific abundance-weighted averages of the process error, \u03c3 \u03b3 (see Methods), were subsequently used to test the hypothesis that population stability is less affected by environmental variability in larger-brained species. To better align our metrics with the narrative of this hypothesis, the dependent variable in these downstream analyses was the negative of \u03c3 \u03b3 , hereafter 'population stability' , such that higher stability scores reflect cases with less pronounced year-to-year fluctuation in population size.\nWe used PGLS regression models estimated across a sample of 1,000 tree topologies from ref. 27 to investigate the potential effects of environmental variability and encephalization on population stability. Environmental predictors for these models included the mean, within-year variance and predictability of temperature, precipitation and net primary productivity (see Methods). Predictability was estimated through Colwell's P, an index that captures variation among years in the onset, intensity and duration of periodic phenomena 28 . Given the strong spatial covariance that is typically observed among environmental parameters 29 , all environmental variables were first extracted globally at a spatial resolution of 0.5 \u00d7 0.5\u00b0 and subsequently reduced to composite variables at the same resolution using principal component analysis (PCA ; Table 1 ; Supplementary Fig. 1a,b ; Methods). As environmental correlations are often region-specific 30 , the PCA for this regional analysis included only map cells located within our North American study region. The first principal component recovered from this analysis showed a clear latitudinal trend, where lower scores occurred primarily in northern, more seasonal climates with colder and less predictable temperatures, and high scores occurred in southwestern sites with hotter temperatures and more variable, unpredictable precipitation patterns (Supplementary Fig. 1a ). The second component of the North American environmental PCA captured differences in mean precipitation as well as in mean, variance and predictability of net primary productivity. In this case, higher scores indicated wetter environments with higher, but more seasonal and unpredictable, productivity including those found along the Pacific coast of the northern USA and Canada, boreal forests, and much of the eastern USA. Low scores for PC2 were found in southwestern deserts and in the far north ( Supplementary Fig. 1b) .\nWhen characterizing the typical habitats of each species in our sample, we considered both spatial distribution and geographic variation in abundance. We first calculated mean environmental components for every North American BCR (PC1 BCRi and PC2 BCRi ). Then, we estimated species-specific habitat values, hereafter H1 and H2, by computing the weighted averages of PC1 BCR and PC2 BCR , where weights were proportional to the relative abundance of the species in each BCR. Correlation between H1 and H2 was high (r = \u2212 0.56; Supplementary Fig. 1c ), so we excluded the latter from our list of predictors to prevent possible multicollinearity and unnecessary variance inflation. The decision to keep H1 rather than H2 was based on the fact that H1 most directly captures the measures of variability that are relevant for testing the mechanism behind the cognitive buffer hypothesis. We note that both high and low values of H1 reflect increasingly variable and unpredictable conditions. Specifically, low H1 scores indicate variable temperatures, whereas high scores indicate variable precipitation. Thus, to explore the general effects of environmental variability on population dynamics, we included H1 as a quadratic term (H1 2 ) in our models of population "}, {"section_title": "Articles", "text": "NATure ecOlOgy & evOluTiON stability. As H1 is centred at zero, this quadratic term captures the potential effects of both variable temperatures and variable precipitation, and is therefore labelled 'environmental variability' hereafter. We also took into account the possibility that population stability is influenced by a variety of life history and ecological traits. First, we accounted for potential relationships between relative population variability and population size 31 by including log-transformed mean abundance as a covariate in our models. Additionally, we considered that environmental variability could affect population dynamics through interactions with traits other than brain size. For example, we considered that lifespan could be a predictor of population stability because longer-lived species tend to exhibit higher adult survival 32 , and we included an interaction with environmental variability (H1 2 ) because highly unpredictable conditions may prevent individuals from realizing their maximum lifespan potential. Similarly, we considered the fact that species with higher annual reproductive output may experience more intense year-to-year population oscillations 33 and that this effect could potentially be amplified in more variable habitats. Additionally, we explored the possibility that variable conditions have weaker effects on the population dynamics of large-bodied species because those species tend to be more resilient to periods of resource scarcity 34 . The same may be true for cooperative breeders-which seem to be able to buffer the effects of harsh years through helping at the nest 35 -for species with generalist habits-which are typically able to exploit a wider variety of environmental conditions 36 -and for migrants-which typically avoid the harshest conditions of their breeding grounds by temporarily leaving the area 29 . Further details on how these traits were defined and quantified can be found in the Methods. All of our data on population stability, brain size, ecology and life history are available in Supplementary Data 1.\nOur demographic analysis revealed that a number of ecological traits are significantly associated with population variability (adjusted R 2 for PGLS model = 0.22; Table 2 ). We found that while populations of resident species are less stable in increasingly variable environments, migratory species maintain relatively stable populations across all types of environment (P < < 0.001; Fig. 2a) . Similarly, long-lived species were found to exhibit more stable dynamics than short-lived ones in only the most mild, predictable environments (P < < 0.001; Fig. 2b ), indicating that the potential benefits of long life spans may diminish when conditions are uncertain. Consistent with the idea that cognitive ability improves survival in variable environments, we found a significant interaction between encephalization and H1 2 . Specifically, while species with high encephalization were found to maintain relatively stable populations in both stable and variable environments, those with low encephalization showed a significant decline in population stability as environmental variability increased (P < < 0.001; Fig. 2c ). Our findings are qualitatively similar when phylogenetic relationships are estimated from a consensus tree rather than across a sample of tree topologies (Supplementary Table 1) .\nAlthough these initial results support the basic mechanistic premise of the cognitive buffer hypothesis, the hierarchical models described above do not account for the fact that variation in population size can be driven not only by exogenous (environmental) factors, but also by internal, or density-dependent factors. In the context of hierarchical modelling, density-dependent processes can be investigated by modelling an explicit demographic process that assumes that true population sizes oscillate around a demographic equilibrium value that does not change over time 37 (for example, the Gompertz function 38 ). This assumption is nevertheless clearly violated whenever populations undergo long-term changes in mean abundance, as is the case in many North American land birds 39 and nearly 80% of the species in our dataset. As models with density dependence are known to perform poorly in such species 40 , we explored the effects of density dependence exclusively on the subset of species that did not show any evidence of long-term changes in mean abundance in our initial set of demographic analyses. Given the relatively small number of species in this category (N = 27), these confirmatory analyses could not meaningfully explore the entire set of initial predictors and were therefore focused on evaluating only the potential effects of relative brain size, H1 2 and their interaction. These more narrowly defined analyses indicate that accounting for density dependence does not change our main finding. That is, the interaction between relative brain size and environmental variability is significant in PGLS models based on the consensus tree (relative brain size \u00d7 H1 Table 1 ). Traits in b and c were analysed as continuous variables but, for visualization purposes, the fitted lines depicted here predict population stability trends for species at the 5th, 25th, 50th, 75th and 95th percentiles of each focal trait while holding all other predictors at their mean value and setting migratory status as resident."}, {"section_title": "NATure ecOlOgy & evOluTiON", "text": "observed in the latter case highlights the greater effect of phylogenetic uncertainty and the generally low statistical power of comparative tests that are based on only a small number of species.\nDid larger brains evolve in more variable environments? Our demographic analyses lend support to the underlying mechanistic premise of the cognitive buffer hypothesis, which is that higher encephalization can improve survival, specifically when environmental conditions are increasingly unstable. However, to evaluate the extent to which this mechanism provides a general explanation for the evolution of cognition in birds, it is critical to explore the direction of causality in the correlation between an enhanced potential for cognition and the occupancy of variable environments. A clear understanding of the sequence of evolutionary events is particularly necessary in this context because the adaptive benefits invoked by the cognitive buffer hypothesis may just as well promote the evolution of cognition in variable habitats, or facilitate instead the secondary colonization of variable habitats by already highly encephalized species 41 . We evaluated the support for these two non-mutually exclusive evolutionary scenarios by using reversible-jump Markov chain Monte Carlo (rjMCMC) to estimate models of correlated trait evolution 42 fitted to an exhaustive global sample of non-migratory birds for which brain size is known (N = 1,288 species; Supplementary Data 2). These models allow inference into potential evolutionary timelines by assessing the likelihood that rates of evolutionary transitions between states of a binary trait (for example, moderate to large encephalization) are dependent on the state of a second binary trait (for example, stable versus variable environmental habitats). In the context of the cognitive buffer hypothesis, these models allow us to test whether the transition from small to large brains is indeed more likely in variable than in stable environments (that is, whether variable environments tend to pre-date large brains). Similarly, these models allow us to evaluate the likelihood of alternative, yet nonmutually exclusive, timelines such as the 'colonization advantage' scenario, which predicts that the transition from stable to variable environments should be more likely in large-than in small-brained species.\nAs in our demographic analysis, environmental variables were first extracted for the relevant study region (here, the entire globe) and subsequently reduced to composite variables through PCA (Supplementary Table 2 ). The first component of this global PCA, hereafter 'temperature variability' , captured a gradient of increasing exposure to colder, more seasonally variable and less predictable temperatures (Supplementary Fig. 1d ). The second component, hereafter 'xeric variability' , captured a gradient of increasing exposure to drier and less productive environments with more unpredictable precipitation (Supplementary Fig. 1e ). Species-specific habitats were characterized in this case by computing the mean values of local temperature and xeric variability across entire breeding distributions (see Methods).\nBecause transition rate analyses require discrete trait states, we explored a reasonable range of thresholds for classifying species as having either small or large encephalization, and as being exposed to highly variable or fairly stable environments (30th, 50th, 75th and 90th percentile; see Methods). Encephalization categorizations were based on whether a species' relative brain size was above or below the predefined threshold. Similarly, exposure to environmental variability was considered high for a given species if either or both environmental principal component scores belonged in a percentile above the predefined threshold. Considering information from both principal components when characterizing exposure to environmental variability allowed us to maintain consistency with our demographic analyses (see Table 1 ) and to explore the general effects of environmental variability rather than the specific effects of temperature or precipitation variation.\nOur models of correlated trait evolution do not support the main prediction of the cognitive buffer hypothesis under any combination of thresholds. Specifically, the evolution of larger relative brain sizes was generally found to be equally likely for species occurring in stable environments and in harsher, more variable ones (that is, there was no support for a difference in transition rate from moderate to large encephalization between environment types; Bayes factor (BF) < 3; Fig. 3d ,f; Supplementary Table 3) . Furthermore, under certain classification criteria, we even find evidence that advanced encephalization could be more likely to evolve in stable than in highly variable habitats (for example, highly variable environments: >50th percentile; large encephalization: > 50th percentile; BF = 3.15; Fig. 3a ,c; Supplementary Table 3) . Collectively, these results indicate that while environmental variability can theoretically select for enhanced cognition, it is in fact unlikely to have driven many of the major transitions towards large brains in birds.\nIn stark contrast, we found that the evidence of an improved colonization ability of variable habitats in highly encephalized avian lineages is both general and strong (Fig. 3b,c ,e,f; Supplementary Table 3 ). Such colonization advantage seems to be specifically linked to an improved ability to deal with environmental variability, because we did not find support for a difference in transition rate from variable to stable habitats between species with small and large encephalization values (Supplementary Table 3 ). Additionally, our results indicate that even moderate enhancements in cognitive ability and/or moderate increases in environmental variability can help accrue such advantages: when thresholds for classification are too conservative (for example, variable environments: > 90th percentile; large encephalization: > 75th percentile), differences in transition rates from stable to variable environments are no longer detectable between very large-and moderately large-brained species.\ncognitive buffer hypothesis, which is that bigger than expected brains improve survival when environmental change is frequent and unexpected. Despite this finding, our transition rate analyses strongly indicate that the general timeline of evolutionary events suggested by the cognitive buffer hypothesis is not broadly supported across the avian phylogeny. Specifically, our results unambiguously indicate that evolutionary transitions towards occupancy of more variable habitats did not generally precede the evolution of enhanced encephalization in birds. Ancestral state reconstructions facilitate the visualization of this result (Fig. 4) : several of the most highly encephalized clades in the bird phylogeny (for example, parrots, bowerbirds and hornbills) evolved big brains without any apparent exposure to particularly harsh or variable habitats throughout their evolutionary history (Fig. 4b,c,e) . Furthermore, even in clades that currently occupy variable habitats (for example, corvids or woodpeckers), it is unclear that exposure to relatively high ecological variability preceded the evolution of larger brains (Fig. 4d,f) . Why then do we see today a correlation between variable habitats and encephalization? Our analyses suggest that this correlation results from either the preferential colonization of variable and unpredictable habitats by highly encephalized species, or the preferential persistence of these highly encephalized species in habitats that underwent major environmental change and became more variable.\nOne possible reason for this pattern is that highly encephalized birds have lower risk of extirpation during the early stages of colonization (that is, when abundances are low 43 ) because of their enhanced ability to withstand environmental change. Similar links between cognition and range expansion have been made in studies documenting the success of highly encephalized species in colonizing new habitats 16, 17, 41 , and are the basis of our current understanding of the process of human expansion out of Africa 8, 44 . Overall, our results suggest that even though environmental variability can be a viable agent of selection in the evolution of cognition (as also concluded by refs 14, 45 ), this particular mechanism is unlikely to have driven many of the most striking cases of encephalization among birds. It is nevertheless possible that other types of ecological variability not included in this study can explain such transitions. For example, although many parrots and hornbills tend to occupy habitats with fairly stable climates, these species must typically cope with high levels of variation in the location and timing of fruiting trees (a similar situation is likely to occur in other species with complex feeding ecologies 45 ). While we acknowledge that a broad interpretation of 'variability' can increase the scope and generality of the cognitive buffer hypothesis 5 , we note that overgeneralization may lead to the inadvertent mischaracterization of very different types of selection (for example, problem solving, long-term memory, or spatial awareness) as different but equivalent forms of a single process. Supplementary Fig. 3 ). Positive values indicate support for a particular hypothesis (see Methods). Horizontal red lines in these panels mark the maximum proportion of steps in which the rjMCMC chain can visit a rate difference of 0 while still supporting a scenario in which the two rates of interest differ (that is, BF = 3). Thus, we see positive support for difference in transition rates in a, b and e but not in d. c,f, The full transition matrices summarizing estimated rates of transition between stable (grey) and variable (black outlined) environments or between moderate (purple) and big (pink) relative brain size. Arrow widths are proportional to estimated rates, single asterisks indicate positive support for a difference between rates (BF > 3) and double asterisks indicate strong support for a difference between rates (BF > 12).\nA perhaps more fruitful approach would therefore be to explore the possibility that there is no single primary driver in the evolution of relatively large brains, and that this process is instead driven by the combined effects of both the constraints 2-4 and the various potential adaptive benefits of increased processing capacity, including the ability to respond more quickly to new challenges 46, 47 , navigate more complex social interactions 48, 49 , process more intricate sensory information 50 , and cope with greater spatial and/or temporal variability 15, 22 . As data on these different processes become more readily available, we are confident that future comparative studies will be able to disentangle the relative extent to which these different forces have shaped the evolution of cognition on different taxonomic scales. In the meantime, we hope that the realization that variation in brain size was more likely to shape the distribution of bird species across the globe rather than the other way around can help inform more immediate research agendas.\nand scaled) through PCA. Separate analyses were conducted to reduce the dimensionality of environmental data in the demographic and correlated trait evolution sections to account for the fact that environmental correlations are often region-specific 30 . In the demographic analyses, the environmental PCA was based only on North American data, including all cell values north of the US-Mexico border (that is, only the geographic region where breeding bird survey data are available). In the correlated trait evolution analyses, the environmental PCA included all global terrestrial habitats, excluding Antarctica. Both environmental PCAs recovered similar components (see main text, Table 1 and Supplementary  Table 2 for details). In the demographic analysis, the average score for each principal component was initially computed for every BCR and these regional averages were subsequently used to characterize species-typical habitats. Specifically, variables H1 and H2 were computed as weighted averages of the corresponding environmental components (PC1 and PC2), where weights were determined by the species' relative abundance in each conservation region. Speciestypical environmental values for the global analysis of correlated trait evolution were estimated directly by averaging all local (0.5 \u00d7 0.5\u00b0 cell) PCA scores across the species' entire breeding distribution.\nBird population data. Abundance data for our population dynamics analyses were collected between 1966 and 2014 by the North American BBS (available through www.pwrc.usgs.gov/bbs/; downloaded 28 August 2015) 24 . The BBS is coordinated by the US Geological Survey (USGS) and the Canadian Wildlife Service and conducted annually by trained volunteers during the height of the breeding season. Participants travel along 24.5-mile roadside routes, conducting 3-min point count surveys at 0.5-mile intervals-recording every bird seen or heard within a 0.25-mile radius. Each BBS survey route was assigned to a single BCR based on route starting coordinates 23 . BCR maps were provided by the USGS Patuxent Wildlife Research Center (www.pwcr.usgs.gov; downloaded 15 September 2015). Only surveys fulfilling BBS quality criteria (that is, runtype = 1) were included in our analyses.\nQuantification of population dynamics. We characterized the temporal dynamics of bird populations within BCRs across North America using hierarchical Bayesian models following ref. 25 . The log of abundance, x j,i,t , for a given species at survey route j within BCR i in year t is modelled as:\nwhere S i is the average abundance within BCR i, \u03b2 i is the temporal trend in abundance within BCR i and \u03b7 is the first-year observer effect where I(j,t) is 1 if the survey at year t is an observer's first record at route j and 0 otherwise. Year effects, \u03b3 i,t , and route-observer effects, \u03c9 i,j , are modelled as BCR specific random effects, whereas \u03b5 i,j,t was modelled as a general random effect of count overdispersion. Given the potential for differences in observer ability, a separate value of \u03c9 is given to each unique route-observer combination. To account for imperfect detection during surveys, the observed count on route j within BCR i during year t is assumed to have a Poisson distribution with mean x j,i,t . Abundances are allowed to vary among survey routes within a BCR, but all routes are assumed to follow the same relative temporal trend (\u03b2 i ) and to undergo the same yearly fluctuations around this trend (\u03b3 i,t ). The variance of route-observer effects within a BCR, \u03c3 \u03c9 2 i , is drawn from a global hyperdistribution. To conform with the assumption of normality of residuals in general linear models, we use the negative of the standard deviation in annual fluctuations (\u2212 1 \u00d7 sqrt( \u03c3 \u03b3 2 i )) as our dependent variable in subsequent analyses of population stability. The sign inversion is simply done to facilitate interpretation of our results, such that higher values reflect more stable populations.\nAs hierarchical models tend to underestimate the magnitude of annual fluctuations when the number of missing survey years is high 56 , we estimated trends for a period when survey data is relatively consistent, namely from 1985 onwards. In addition, we improved data quality by including only route-observer combinations with 10 or more years of survey data and estimating only parameters for BCRs with at least 20 years of survey data and a minimum of 14 survey routes 39 . Model parameters were estimated with MCMC analysis using package 'rjags' 57 . Four independent chains were run for each model, each of which included a burn-in of 25,000 steps, an additional chain length of 25,000 steps and a thinning interval of 10. Priors for S i , \u03b2 i and \u03b7 were normal distributions with mean of 0 and variance of 10 6 . Prior distributions for variances were inverse gamma distributions with scale and shape equal to 0.001. Our assessment of chain convergence was done through the 'coda' package in R 58 and included both a visual inspection of the traces of posterior estimates and an estimation of potential scale reduction factors (PSRF) via Gelman and Rubin's convergence diagnostic 59 . Only estimates obtained from BCRs in which PSRF values were under 1.1 for all parameters (that is, chains with proper convergence) were included in our subsequent analyses of population stability. We considered positive support for temporal trends when the 95% credible interval of \u03b2 i did not include zero.\nHierarchical models with density dependence were also fitted to all species that did not exhibit evidence of linear trends in our initial analysis (n = 27).\nSpecifically, we re-estimated population stability for these species using a discrete time, stochastic Gompertz model following ref. 38 . These models estimate density-dependent population change at the route level while allowing random environmentally driven fluctuations and accounting for observer error in reported abundances. The log of abundance at time t, log(x t ), is modelled here as a function of log(x t\u22121 ):\nwhere a is the intrinsic rate of increase and b is the strength of density dependence. Values of b were allowed to range from \u2212 1 (strong) to 1 (no density dependence) 37 . Relative annual fluctuations, E t , have a normal distribution with mean zero and variance \u03c3 2 E . Similarly, the log of observed counts in year t is assumed to have a distribution with mean of log(x t ) and a variance of \u03c4 2 . To conform with the assumption of normality of residuals in general linear models, we used the negative log of the estimated year-to-year variance (that is, \u2212 1 \u00d7 log(\u03c3 2 E )), as our dependent variable in subsequent analyses of population stability. As above, the sign inversion here is simply done to facilitate interpretation of our results, such that higher values reflect more stable populations. Data quality checks for hierarchical models with density dependence included estimating only models for routes with at least 20 years of survey data from 1985 onwards and no more than three consecutive years of missing data. Parameters were estimated using MCMC analysis with four independent chains, each ran with a burn-in period of 100,000 steps, an additional chain length of 50,000 steps and a thinning interval of 10 steps. Priors for a were drawn from a non-informative uniform distribution from 0 to 10 6 , for b from a uniform distribution from \u2212 1 to 1, and for \u03c3 2 E and \u03c4 2 from an inverse gamma distribution with scale and shape equal to 0.001. As with our linear trend models, chain convergence diagnostics were performed through visual inspection and the Gelman and Rubin convergence diagnostic 59 . Data for downstream analyses of population stability only included estimates for routes that reached proper convergence.\nFor both linear trend and density-dependence hierarchical models, we excluded species that typically pose clear challenges to detection, such as aquatic (families Gaviidae, Podicipedidae, Pelecanidae, Phalacrocoracidae, Anhingidae, Anatidae, Rallidae, Ardeidae, Threskiornithidae and Ciconiidae), nocturnal (families Tytonidae, Strigidae and Caprimulgidae) and primarily aerial species (families Apodidae and Hirundinidae). For all other species, we summarized regional measures of population stability into a single species-specific value by computing density-weighted averages across BCRs (linear trend models) or routes (density-dependence models). Thus, our measures of population variability account for differences in population dynamics across a species' range 60 , but place greater importance on the population dynamics that occur in regions or sites where the species is better represented.\nEstimating correlates of population stability. Data on longevity and annual reproductive output were obtained from ref. 51 (the latter was calculated as the product of clutch size and clutches per year). Social systems were classified as either cooperative or non-cooperative breeding based on ref. 61 . Habitat generalism was measured as the number of different BCRs in which a species was reported throughout the BBS dataset. Migratory status was determined from range maps by BirdLife International (birdlife.org; downloaded 18 March 2016). Specifically, a species was considered resident if there was complete overlap between winter and breeding portions of its range, and considered migratory otherwise.\nTo test the effects of putative predictor variables on population stability scores we used PGLS regression models estimated with the 'geiger' 62 and 'nlme' 63 packages in R"}, {"section_title": "Discussion", "text": "Our demographic analysis broadly supports the notion that enhanced cognition can lead to more stable population dynamics. Furthermore, the significant interaction between H1 2 and encephalization is consistent with the idea that these benefits can be generally accrued under different types of environmental variability and unpredictability (see Table 1 ). We therefore conclude that there is general support for the proposed mechanism underlying the "}, {"section_title": "Methods", "text": "Quantification of relative brain size. Our estimates of relative brain size were based on body size data from ref. 51 and brain size data either from published accounts (N = 1,949 species; cited in Supplementary Data 2) or measured directly from museum specimens (N = 113 species). Our total brain dataset includes several species that are not used in either our demographic or correlated trait evolution analyses. Specifically, pelagic species (orders Sphenisciformes, Suliformes, Procellariiformes and Phaethontiformes; families Pelecanidae, Laridae, Stercorariidae and Alcidae) were initially included when computing encephalization values but were subsequently excluded from downstream analyses because land surface temperature and precipitation values are unlikely to be indicative of the actual conditions experienced by species that spend most of their time at sea. All brain size measurements from museum specimens were obtained following the procedures outlined in refs 3, 52 . Briefly, the foraminae of the cranial nerves are sealed with masking tape and lead shot is poured into the foramen magnum. To prevent the formation of lacunae, the skull is lightly tapped throughout this procedure. Once the shot has risen to the foramen magnum, the contents are decanted into modified syringes or graduated cylinders to determine volume. This method is highly repeatable and provides an accurate estimate of brain size in birds 52, 53 . Brain sizes that were originally reported as volumes in the literature were converted to mass by multiplying millilitres by the average density of fresh brain tissue (1.036 g ml To account for phylogenetic uncertainty, the log-log regression of brain size on body size was independently run on 1,000 randomly selected tree topologies with the Hackett backbone in ref. 27 (www.birdtree.org; downloaded 14 July 2016). The encephalization values used in all of our downstream analyses were computed as the median residuals for each species across these 1,000 models.\nCharacterization of environmental variability. The environmental variables we consider here include the mean, within-year variance and predictability of temperature, precipitation and net primary productivity. Monthly raster maps of temperature and precipitation values were obtained for years 1900-2005 from ecoClimate.org (provided at 1\u00b0 resolution, resampled to 0.5\u00b0 resolution; downloaded 25 July 2016) 54 . Monthly net primary productivity data for years 2000-2016 were obtained from the MODIS dataset downloaded from NASA Earth Observations (provided at 0.5\u00b0 resolution; http://neo.sci.gsfc.nasa.gov; accessed 18 March 2016). Predictability was measured as Colwell's P 28 , an information-theory-based index that captures variation in the onset, intensity and duration of periodic phenomena and ranges from 0 (completely unpredictable) to 1 (completely predictable).\nAs environmental variables tend to be strongly correlated 29 , we reduced the original set of environmental predictors (transformed when required 55 , centred "}, {"section_title": "64", "text": ". All regression models (including the one used to estimate relative brain sizes) were computed using Pagel's \u03bb transformation. To account for uncertainty in phylogenetic relationships, every regression model reported here was independently run with 1,000 different tree topologies from ref. 27 . Model fit was assessed through adjusted R 2 (ref."}, {"section_title": "65", "text": "). In the main text we report the average estimated coefficient for each parameter and the proportion of trees in which such estimates were significant (that is, the f statistic). Body size, longevity, annual reproductive output and estimated mean abundance were log-transformed prior to analysis. Our fully parameterized models included all main effects as well as interactions between longevity, annual reproductive output, habitat generalism, body size, relative brain size, sociality and migration with H1 2 . Models were subsequently reduced by iteratively removing, one at a time, terms with the highest P value (removing interactions prior to main effects) and assessing whether removal led to a significant improvement of Akaike information criterion (AIC) values (that is, \u0394 AIC > 2). We also computed variance inflation factors (VIF) for all of our reduced models to confirm low potential for multicollinearity (all VIF values were < 2).\nEstimating evolutionary rates of transition between character states. We investigated the potential timeline of evolution of encephalization and climactic niche in birds using models of correlated trait evolution 42 , implemented through the discrete function of BayesTraits v2 on a global sample of species (Supplementary Data 2). Pelagic and migratory species were excluded from these analyses, resulting in a total sample of 1,288 resident terrestrial species. BayesTraits estimates the eight possible transition rates between potential character states NATure ecOlOgy & evOluTiON (see Fig. 3c or f) , assuming that simultaneous transitions in both brain size and environment are so unlikely that they can be ignored 42 . As both brain size and environmental variability are continuous variables, we explored a number of different cutoff values to convert them into binary traits suitable for this kind of analysis. Specifically, we classified species as having large encephalization values when they occurred above the 30th, 50th, 75th and 90th percentile of brain size distribution. While a 30th percentile cutoff for encephalization may seem too permissive at first glance, we note that this was the minimum possible threshold at which all 'large-brained' species had a positive brain residual (that is, bigger brain than expected from body size) and the number of observed transitions between different states was sufficient for the proper estimation of transition rates 66 . We note that the skewed distribution towards more highly encephalized species in our sample is due to the effects of phylogenetic correction in the estimation of relative brain size, as well as to the subsampling of species from our much larger global brain dataset. Exposure to environmental variability was classified as high for species above the 50th, 75th and 90th percentiles in either 'temperature variability' or 'xeric variability' . Because models of correlated trait evolution have the potential to identify spurious correlations when the number of transitions between states is low 66 , we began by confirming that all of our thresholds yielded a reasonable number of transitions between states using ancestral character state estimation via the R package 'phytools' 67 and averaging the detected number of transitions across 1,000 tree topologies. At the 30th percentile threshold we detected an average of 29 transitions from small to large encephalization and 65 transitions from large to small encephalization. At the 50th percentile threshold we detected an average of 102 transitions from small to large encephalization, 112 transitions from large to small encephalization, 253 transitions from stable to variable environments and 414 transitions from variable to stable environments. At the 75th percentile threshold we detected an average of 64 transitions from small to large encephalization, 36 transitions from large to small encephalization, 265 transitions from stable to variable environments and 195 transitions from variable to stable environments. Finally, at the 90 th percentile threshold we detected an average of 46 transitions from small to large encephalization, 15 transitions from large to small encephalization, 237 transitions from stable to variable environments and 127 transitions from variable to stable environments. The 90th percentile threshold was therefore ultimately dropped as a criterion for dichotomizing encephalization because the low number of transitions it yielded would preclude any meaningful estimates of transition rates 66 .\nRates of evolutionary transition were estimated using rjMCMC analyses. Parameter values were first estimated using maximum likelihood analysis to inform our choice of priors. For all six combinations of cutoff, we calculated mean values of transition rates across our sample of 1,000 trees. Maximum likelihood estimates of each parameter value were of a similar magnitude regardless of cutoffs and ranged from 0.00002 to 0.34. Next, rjMCMC analyses were performed for 200,000,000 iterations with a burn-in of 5,000,000, a thinning interval of 1,000 iterations and an exponential prior whose mean is seeded from a uniform hyperprior ranging between 0 and 0.5. Reversible-jump helps avoid model overparameterization by exploring alternative models that can differ in parameter number 68 . Because reversible-jump analyses estimate the posterior probability of all possible model configurations along with individual parameter values, this algorithm offers the additional advantage of enabling tests of very specific hypothesis. Specifically, the posterior distribution of model types obtained through rjMCMC can be used to assess the strength of evidence that two particular transitions are different or not by comparing the relative sampling frequency of models in which the two transition types were constrained to be the same with that of models in which these two rates were allowed to vary independently of each other 69 . Statistically, these comparisons are made via BFs, which are calculated as:\nwhere i is the model set where rates are allowed to vary independently, j is a reduced model set in which the two rates are constrained to be the same, P(M n |D) is the posterior probability of model set n (computed as the proportion of steps in which the chain visited model n) and P(M n ) is the prior probability of model set n 68, 69 . For example, when testing the cognitive buffer hypothesis, P(M i |D) is the frequency of all model configurations within the posterior distribution in which the transition rate from moderate to large encephalization varied between stable and variable environments, whereas j includes all model configurations in the posterior distribution where these rates were constrained to be equal in both environments. Similarly, when testing the colonization advantage scenario, P(M i |D) is the frequency of all model configurations in which the transition rate from stable to variable environments varied between moderate and large encephalization, while j includes all configurations where these rates were constrained to be equal in both brain size classes. P(M n ) values for this formula are computed by exploring all possible model combinations via expanded Stirling numbers 69 : P(M j ) = 0.9592 and P(M i ) = 0.0408. Overall, resulting BF values from 3 to 12 suggest positive support for model set i and values above 12 suggest that model set i is strongly supported when compared with model set j 68 . We also report the proportion of steps in our model chains (P) in which the difference between two rates of interest was equal to zero (that is, the transition rate for the character of interest was independent of the state of the second trait). In this case, values of P < 0.014 indicate positive support for a difference between rates (that is, BF > 3) 69 . Because hypothesis testing directly assesses the proportion of steps in the posterior distribution where transition rates of interest are constrained to be equal, we visualize these results by plotting the distribution of 'rate differences' calculated across the posterior distribution. These rate differences were calculated at each step of the chain as either the difference in estimated transition rate from moderate to large brain sizes in variable versus stable environments (when testing the cognitive buffer hypothesis), or the difference in estimated transition rates from stable to variable environments in species with large versus moderate brain sizes (when testing the colonization advantage hypothesis). Plotting the distributions of rate differences (Fig. 3) allows us to assess both the support for a particular hypothesis (the proportion of steps where rate difference = 0) and the directionality of these potential differences. Besides explicitly testing the cognitive buffer and colonization advantage scenarios as indicated above, we also tested for differences in the rates of colonization of stable environments between brain size classes as well as for differences in the rate of evolution of small to moderate brain sizes in stable versus variable habitats.\nWe ran each rjMCMC analysis three times to insure chain convergence and assess the consistency of our results. These checks were performed with the 'coda' package in R 58 and included visually inspecting the traces of all of our posterior estimates, assuring effective sample sizes were greater than 1,000, and estimating PSRF using Gelman and Rubin's convergence diagnostic 59 . PSRF values were below 1.1 for all parameter estimates indicating proper chain convergence properties. Effective sample sizes over 1,000 were obtained for all runs, except for analyses using the combination of 50th percentile encephalization threshold and 75th percentile environment threshold. To ensure consistent results for this cutoff, we performed three additional runs for 619,000,000 iterations (the upper limit of our current computational resources). While four rate parameters in these models still failed to reach target effective sample sizes of 1,000 during the extended runs, their effective sample sizes were nevertheless fairly high (range: 371-997). Furthermore, the plots of running values across iterations for BFs testing the cognitive buffer and colonization advantage hypotheses in these models indicate that these results are also highly stable (Supplementary Fig. 2 ). Posterior distributions of parameter estimates from the different chains produced for each threshold were subsequently pooled to calculate both the mean values and standard deviations for each transition rate (Supplementary Fig. 3 ).\nAncestral trait reconstruction. The ancestral states reported in Fig. 4 were reconstructed for visualization purposes only and estimated with the 'phytools' 66 package in R. Reconstructions of continuous trait data were based on maximum likelihood and a randomly chosen tree within our candidate set. Colour coding in Fig. 4b -g is based on results from separate ancestral trait reconstructions for the different environmental variables.\nData availability. All data generated or analysed during this study are either available through cited sources or included in this published article and its Supplementary Information files."}]