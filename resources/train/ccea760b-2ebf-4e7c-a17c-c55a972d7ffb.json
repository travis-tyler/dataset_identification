[{"section_title": "Abstract", "text": "We present a cross-modality generation framework that learns to generate translated modalities from given modalities in MR images without real acquisition.\nOur proposed method performs NeuroImage-to-NeuroImage translation (abbreviated as N2N) by means of a deep learning model that leverages conditional generative adversarial networks (cGANs). Our framework jointly exploits the low-level features (pixel-wise information) and high-level representations (e.g. brain tumors, brain structure like gray matter, etc.) between cross modalities which are important for resolving the challenging complexity in brain structures.\nOur framework can serve as an auxiliary method in clinical diagnosis and has great application potential. Based on our proposed framework, we first propose a method for cross-modality registration by fusing the deformation fields to adopt the cross-modality information from translated modalities. Second, we propose an approach for MRI segmentation, translated multichannel segmentation (TMS), where given modalities, along with translated modalities, are * These four authors contribute equally to the study segmented by fully convolutional networks (FCN) in a multichannel manner.\nBoth of these two methods successfully adopt the cross-modality information to improve the performance without adding any extra data. Experiments demonstrate that our proposed framework advances the state-of-the-art on five brain MRI datasets. We also observe encouraging results in cross-modality registration and segmentation on some widely adopted brain datasets. Overall, our work can serve as an auxiliary method in clinical diagnosis and be applied to various tasks in medical fields."}, {"section_title": "Introduction", "text": "Magnetic Resonance Imaging (MRI) has become prominent among various medical imaging techniques due to its safety and information abundance. They are broadly applied to clinical treatment for diagnostic and therapeutic purposes. There are different modalities in MR images, each of which captures certain characteristics of the underlying anatomy. All these modalities differ in contrast and function. Three modalities of MR images are commonly referenced for clinical diagnosis: T1 (spin-lattice relaxation), T2 (spin-spin relaxation), and T2-Flair (fluid attenuation inversion recovery) (Tseng et al., 2017) . T1 images are favorable for observing structures, e.g. gray matter and white matter in the brain; T2 images are utilized for locating tumors; T2-Flair images present the location of lesions with water suppression. Each modality provides a unique view of intrinsic MR parameters. Examples of these three modalities are shown in Fig.1 . Taking full consideration of all these modalities is conducive to MR image analysis and diagnosis.\nHowever, the existence of complete multi-modality MR images is limited by the following factors: (1)During the scanning process, the imaging of a certain modality usually fails. (2) Motion artifacts are produced along with MR images.\nThese artifacts are attributed to the difficulty of staying still for patients during scanning (e.g. pediatric population (Rzedzian et al., 1983) ), or motion-sensitive applications such as diffusion imaging (Tsao, 2010) . (3) The mapping from one modality to another is hard to learn. Each of modality captures different characteristics of the underlying anatomy, and the relationship between any two modalities is highly non-linear. Owing to differences in the image characteristics across modalities, existing approaches cannot achieve satisfactory results for cross-modality synthesis as mentioned in (Vemulapalli et al., 2016) . For example, when dealing with the paired MRI data, the regression-based approach (Jog et al., 2013) even lose some information of brain structures. Synthesizing a translated modality from a given modality without real acquisitions, also known as cross-modality generation, is a nontrivial problem worthy of being studied.\nTake the transition from T1 (given modality) to T2 (target modality) as an example, T 2 (translated modality) can be generated through a cross-modality generation framework. In this paper, denotes translated modalities. Crossmodality generation tasks refer to transitions such as from T1 to T2, from T1 to T2-Flair, from T2 to T2-Flair, and vice versa. Recently, image-to-image translation networks have provided a generic solution for image prediction problems in natural scenes, like mapping images to edges (Xie and Tu, 2015; Lee et al., 2014) , segments , semantic labels (Long et al., 2015 ) (many to one), and mapping labels to realistic images (one to many). It requires an automatic learning process for loss functions to make the output indistinguishable from reality. The recently proposed Generative Adversarial Network (GAN) (Goodfellow et al., 2014; Pathak et al., 2016; Isola et al., 2017; Zhang et al., 2017) makes it possible to learn a loss adapting to the data and be applied to multiple translation tasks. Isola et al. (Isola et al., 2017) demonstrate that the conditional GAN (cGAN) is suitable for image-to-image translation tasks, where they condition on input images.\nPrevious work on image-to-image translation networks focuses on natural scenes (Isola et al., 2017; Tu, 2007; Lazarow et al., 2017a,b) , however, such networks' effectiveness in providing a solution for translation tasks in medical scenes remains inconclusive. Motivated by (Isola et al., 2017) , we introduce NeuroImage-to-NeuroImage translation networks (N2N) to brain MRI cross-modality generation (see Fig.2 ). Unlike some classic regression-based approaches that leverage an L1 loss to capture the low-level information, we adopt cGANs to capture high-level information and an L1 loss to ensure low-level information at the same time, which allows us to recover more details from the given modality and reduce the noise generated along with the translated modality. In this paper, we mainly focus on developing a cross-modality generation framework which provides us with novel approaches of cross-modality registration and segmentation. Our proposed cross-modality generation framework can serve as an auxiliary method in clinical diagnosis and also has great application potential, such as multimodal registration , segmentation (Iglesias et al., 2013) , and virtual enhancement (Vemulapalli et al., 2016) . Among all these applications, we choose cross-modality registration and segmentation as two examples to illustrate the effectiveness of our cross-modality generation framework.\nThe first application of our proposed framework is cross-modality image registration which is necessary for medical image processing and analysis. With regard to brain registration, accurate alignment of the brain structures such as hippocampus, gray matter, and white matter are crucial for monitoring brain disease like Alzheimer Disease (AD). The accurate delineation of brain structures in MR images can provide neuroscientists with volumetric and structural information on the structures, which has been already achieved by existing atlasbased registrations Eugenio et al., 2013) . However, few of them adopt the cross-modality information from multiple modalities, especially from translated modalities.\nHere, we propose a new method for cross-modality registration by adopting cross-modality information from our translated modalities. The flowchart is illustrated in Fig.3 . In our method, inputting a given-modality image (e.g. T2 image) to our proposed framework yields a translated modality (e.g.T 1 image).\nBoth two modalities compose our fixed images space (T2 andT 1 images). The moving images including T2 and T1 images are then registered to the identical modality in the fixed images space with a registration algorithm. Specifically, T2 (moving) is registered to T2 (fixed), T1 (moving) is registered toT 1 (fixed).\nThe deformation generated in the registration process are finally combined in a weighted fusion process and then propagate the moving images labels to the fixed images space. It is feasible since the introduction of translated modality provides us with richer anatomical information in comparison with only one modality is given, leading to more precise registration results. Our method is applicable to dealing with cross-modality registration problems by making the most of cross-modality information without adding any extra data at the same time. The second application of our proposed framework is brain segmentation for MRI data, which also plays an important role in clinical auxiliary diagnosis.\nHowever, it is a difficult task owing to the artifacts and in-homogeneities in- Figure 3 : Overview of our approach for cross-modality registration. Inputting a givenmodality image (T2) to N2N framework yields a translated modality (T 1). Then T2 (moving) is registered to T2 (fixed), T1 (moving) is registered toT 1 (fixed). The deformation generated in the registration process are finally combined in a weighted fusion process, obtaining our final registration result. The red box indicates our translated images.\ntroduced during the real image acquisition (Balafar et al., 2010; Sasirekha and Kashwan, 2015) . To this point, we propose a novel approach for brain segmentation, called translated multichannel segmentation (TMS). In TMS, as illustrated in Fig.4 , the translated modality and its corresponding given modality are fed into fully convolutional networks (FCN) (Long et al., 2015) for brain segmentation. Here, we fine tune Imagenet-FCN model using our MRI images. Thus we follow its original three-channel network, inputting one translated modality and two given modality images to serve as three channels. TMS is an effective method for brain segmentation by adding cross-modality information from translated modalities since different MRI modalities have unique tissue contrast profiles and therefore provide complementary information that could be of use to the segmentation process. For instance, TMS can improve tumor segmentation performance by adding cross-modality information from translated T2 modality into original T1 modality.\nFigure 4: Overview of our approach for cross-modality segmentation. First, we input a givenmodality image to our N2N translation network to generate a translated-modality image.\nFor instance, given a T1 image, T 2 images can be generated with our method. Second, the translated modality ( T 2) and its corresponding given modality (T1) are fed into fully convolutional networks (FCN) (Long et al., 2015) for brain segmentation. The red box indicates our translated images.\nContributions: (1) We introduce end-to-end NeuroImage-to-NeuroImage translation networks for cross-modality MRI generation to synthesize translated modalities from given modalities. Our N2N framework can cope with a great many MRI translation tasks using the same objective and architecture. (2) Registration: We leverage our N2N framework to augment the fixed images space with translated modalities for atlas-based registration. Registering moving im-ages to fixed images and weighted fusion process enable us to make the most of cross-modality information without adding any extra data. (3) Segmentation:\nOur proposed approach, translated multichannel segmentation (TMS), performs cross-modality image segmentation by means of FCNs. We input two identical given modalities and one corresponding translated modality into separate channels, which allows us to adopt and fuse cross-modality information without using any extra data. (4) We demonstrate the universality of N2N framework for cross-modality generation on five publicly available brain datasets. Experiments conducted on two sets of datasets also verify the effectiveness of two applications of our proposed framework. We finally observe competitive generation results of our proposed framework."}, {"section_title": "Related work", "text": "In this section, we mainly focus on methods related to cross-modality image generation, its corresponding registration and segmentation."}, {"section_title": "Image generation", "text": "Related work on image generation can be broadly divided into three categories: cross-modality synthesis, GANs in natural scenes, and GANs in medical images.\nCross-modality synthesis: In order to synthesize one modality from another, a rich body of algorithms have been proposed using non-parametric methods like nearest neighbor (NN) search (Freeman and Pasztor, 2000) , random forests (Jog et al., 2013) , coupled dictionary learning , and convolutional neural network (CNN) (Van Nguyen et al., 2015) , etc. They can be broadly categorized into two classes: (1) Traditional methods. One of the classical approaches is an atlas-based method proposed by Miller et al. (Miller et al., 1993) . The atlas contains pairs of images with different tissue contrasts co-registered and sampled on the same voxel locations in space. An example-based approach is proposed to pick several NNs with similar properties from low-resolution images to generate high-resolution brain MR images using a Markov random field (Rousseau, 2008) . In (Jog et al., 2013) , a regressionbased approach is presented where a regression forest is trained using paired data from a given modality to a target modality. Later, the regression forest is utilized to regress target-modality patches from given modality patches. (2) Deep learning based methods. Nguyen et al. (Van Nguyen et al., 2015) present a location-sensitive deep network (LSDN) to incorporate spatial location and image intensity feature in a principled manner for cross-modality generation. Vemulapalli et al. (Vemulapalli et al., 2016) propose a general unsupervised cross-modal medical image synthesis approach that works without paired training data. Huang et al. attempt to jointly solve the super-resolution and cross-modality generation problems in 3D medical imaging using weakly-supervised joint convolutional sparse coding.\nOur image generation task is essentially similar to these issues. We mainly focus on developing a novel and simple framework for cross-modality image generation and we choose paired MRI data as our case rather than unpaired data to improve the performance. To this point, we try to develop a 2D framework for cross-modality generation tasks according to 2D MRI principle. The deep learning based methods (Vemulapalli et al., 2016; Huang et al., 2017) are not perfectly suitable for our case on the premise of our paired data and MRI principle. We thus select the regression-based approach (Jog et al., 2013) as our baseline.\nGANs in natural scenes: Recently, a Generative Adversarial Network (GAN) has been proposed by Goodfellow et al. (Goodfellow et al., 2014) . They adopt the concept of a min-max optimization game and provide a thread to image generation in unsupervised representation learning settings. To conquer the immanent hardness of convergence, Radford et al. (Radford et al., 2015) present a deep convolutional Generative Adversarial Network (DCGAN). However, there is no control of image synthesis owing to the unsupervised nature of unconditional GANs. Mirza et al. (Mirza and Osindero, 2014) incorporate additional information to guide the process of image synthesis. It shows great stability refinement of the model and descriptive ability augmentation of the generator. Various GAN-family applications have come out along with the development of GANs, such as image inpainting (Pathak et al., 2016) , image prediction (Isola et al., 2017 ), text-to-image translation (Zhang et al., 2017) and so on. Whereas, all of these models are designed separately for specific applications due to their intrinsic disparities. To this point, Isola et al. (Isola et al., 2017 ) present a generalized solution to image-to-image translations in natural scenes. Our cross-modality image generation is inspired by (Isola et al., 2017) but we focus on medical images generation as opposed to natural scenes."}, {"section_title": "GANs in medical images:", "text": "In spite of the success of existing approaches in natural scenes, there are few applications of GANs to medical images. Nie et al. (Nie et al., 2017) estimate CT images from MR images with a ContextAware GAN model. Wolterink et al. (Wolterink et al., 2017) demonstrate that GANs are applicable to transforming low-dose CT into routine-dose CT images.\nHowever, all these methods are designed for specific rather than general applications. Loss functions need to be modified when it comes to multi-modality transitions. Thus, a general-purpose strategy for medical modality transitions is of great significance. Fortunately, this is achieved by our N2N cross-modality image generation framework."}, {"section_title": "Image registration", "text": "A successful image registration application requires several components that are correctly combined, like the cost function and the transformation model.\nThe cost function, also called similarity metrics, measures how well two images are matched after transformation. It is selected with regards to the types of objects to be registered. As for cross-modality registration, commonly adopted cost functions are mutual information (MI) (Viola and Wells, 1997) and crosscorrelation (CC) (Penney et al., 1998) . Transformation models are determined according to the complexity of deformations that need to be recovered. Some common parametric transformation models (such as rigid, affine, and B-Splines transformation) are enough to recover the underlying deformations (Rueckert et al., 1999) .\nSeveral image registration toolkits such as ANTs (Avants et al., 2009 ) and Elastix (Klein et al., 2010) have been developed to facilitate research reproduction. These toolkits have effectively combined commonly adopted cost functions and parametric transformation models. They can estimate the optimal transformation parameters or deformation fields based on an iterative framework. In this work, we choose ANTs and Elastix to realize our cross-modality registration. More registration algorithms can be applied to our method."}, {"section_title": "Image segmentation", "text": "A rich body of image segmentation algorithms exists in computer vision (Pinheiro and Collobert, 2015; Dou et al., 2016; Long et al., 2015; Xu et al., 2017) . We discuss two that are closely related to our work.\nThe Fully Convolutional Network (FCN) proposed by Long et al. (Long et al., 2015 ) is a semantic segmentation algorithm. It is an end-to-end and pixel-to-pixel learning system which can predict dense outputs from arbitrarysized inputs. Inspired by (Long et al., 2015) , TMS adopts similar FCN architectures but focuses on fusing information of different modalities in a multichannel manner.\nXu et al. propose an algorithm for gland instance segmentation, where the concept of multichannel learning is introduced. The proposed algorithm exploits features of edge, region, and location in a multichannel manner to generate instance segmentation. By contrast, TMS leverages features in translated modalities to refine the segmentation performance of given modalities."}, {"section_title": "MRI Cross-Modality Image Generation", "text": "In this section, we mainly learn an end-to-end mapping from given-modality images to target-modality images. We introduce NeuroImage-to-NeuroImage Notice that our training set is denoted as S = {(x i , y i ), i = 1, 2, 3, . . . , n}, where x i and y i refer to the ith input given-modality image and its corresponding target-modality image.\nThe training process involves two aspects. On the one hand, given an input image x i and a random noise vector z, generator G aims to produce indistinguishable images\u0177 i from the real images y i . On the other hand, discriminator D evolves to distinguish between translatedmodality images\u0177 i generated by G and the real images y i . The output of D is 0 or 1, where 0 represents synthesized images and 1 represents the real data. In the generation process, translated-modality images can be synthesized through the optimized G."}, {"section_title": "Training", "text": "We denote our training set as S = {(x i , y i ), i = 1, 2, 3, . . . , n}, where x i refers to the ith input given-modality image, and y i indicates the corresponding target-modality image. We subsequently drop the subscript i for simplicity, since we consider each image holistically and independently. Our goal is to learn a mapping from given-modality images\nThus, given an input image x and a random noise vector z, our method can synthesize the corresponding translated-modality image y.\nTake the transition from T1 to T2 as an instance. Similar to a two-player minmax game, the training procedure of GAN mainly involves two aspects: On one hand, given an input image T1 (x), generator G produces a realistic imageT 2 (\u0177) towards the real data T2 (y) in order to puzzle discriminator D. On the other hand, D evolves to distinguish synthesized imagesT 2 (\u0177) generated by G from the real data T2 (y). The overall objective function is defined:\nwhere p data (x) and p data (z) refer to the distributions over data x and z, respectively. G is not only required to output realistic images to fool D, but also to produce high-quality images close to the real data. Existing algorithms (Pathak et al., 2016) have found it favorable to combine traditional regularization terms with the objective function in GAN. An L1 loss, as described in (Isola et al., 2017) , usually guarantees the correctness of low-level features and encourages less blurring than an L2 loss. Thus, an L1 loss term is adopted into the objective function in our method. The L1 loss term is defined as follows:\nThe overall objective function is then updated to:\nwhere \u03bb is a hyper-parameter specified manually to balance the adversarial loss and L1 loss. The appropriate weight of \u03bb is based on the cross-validation of training data. A value of 100 is eventually selected for \u03bb.\nFollowing (Isola et al., 2017) , the optimization is an iterative training process with two steps: (1) fix parameters of G and optimize D; (2) fix parameters of D and optimize G. The overall objective function can be formulated as follows:\nHere, the introduction of z enables it to match any distribution rather than just a delta function. As (Srivastava, 2013) described, dropout can also be interpreted as a way of regularizing a neural network by adding noise to its hidden units. Thus we replace the noise vector z with several dropout layers in G to achieve the same effect.\nIn addition, we also explore the effectiveness of each component in our objective function. Generators with different loss functions are defined as follows:\ncGAN : Generator G together with an adversarial discriminator conditioned on the input; L1: Generator G with an L1 loss. It is essentially equivalent to a traditional CNN architecture with least absolute deviation; cGAN +L1: Generator G with both an L1 loss term and an adversarial discriminator conditioned on the input."}, {"section_title": "Network architecture", "text": "Our cross-modality generation framework is composed of two main submodels, generator (G) and discriminator (D). It is similar to traditional GANs (Goodfellow et al., 2014) .\nGenerator. Although appearances of input and output images are different, their underlying structures are the same. Shared information (e.g. identical structures) needs to be transformed in the generative network. In this case, encoder-decoder networks with an equal number of down-sampling layers and up-sampling layers are proposed as one effective generative network (Johnson et al., 2016; Pathak et al., 2016; Wang and Gupta, 2016; Yoo et al., 2016; Zhou and Berg, 2016) . However, it is a time-consuming process when all mutual information between input and output images (such as structures, edges and so on) flows through the entire network layer by layer. Besides, the network efficiency is limited due to the presence of a bottleneck layer which restricts information flow. Thus, skip connections are added between mirrored layers in the encoderdecoder network, following the \"U-Net\" shape in (Ronneberger et al., 2015) .\nThese connections speed up information transmission since the bottleneck layer is ignored, and help to learn matching features for corresponding mirrored layers. Discriminator. GANs can generate images that are not only visually realistic but also quantitatively comparable to the real images. Therefore, an adversarial discriminator architecture is employed to confine the learning process of G. D identifies those generated outputs of G as false (label 0) and the real data as true (label 1), then providing feedback to G. PixelGANs (Isola et al., 2017) have poor performance on spatial sharpness, and ImageGANs (Isola et al., 2017) with many parameters are hard to train. In contrast, PatchGANs (Isola et al., 2017 ) enable sharp outputs with fewer parameters and less running time since PatchGANs have no constraints on the size of each patch. We thus adopt a PatchGAN classifier as our discriminator architecture. Unlike previous formulations (Iizuka et al., 2016; Larsson et al., 2016) that regard the output space as unstructured, our discriminator penalizes structures at the scale of image patches. In this way, high-level information can be captured under the restriction of D, and low-level information can be ensured by an L1 term. As shown in Fig.6 , training with only the L1 loss gives obscure translated images that lack some discernible details. Under the same experimental setup, the results on the BraTs2015 dataset are improved notably with the combination of the adversarial loss and L1 loss.\nThe architecture of D contains four stages of convolution-BatchNorm-ReLu with the kernel size of (4,4). The numbers of filters are 64, 128, 256, and 512 for convolutional layers. Lastly, a sigmoid function is used to output the confidence probability that the input data comes from real MR images rather than generated images. "}, {"section_title": "Application", "text": "In this section, we choose cross-modality registration and segmentation from multiple applications as two examples to verify the effectiveness of our proposed framework. Details of our approaches and algorithms are discussed in the following subsections."}, {"section_title": "Cross-Modality Registration", "text": "The first application of our cross-modality generation framework is to use the translated modality for cross-modality image registration. Our method is inspired by an atlas-based registration, where the moving image is registered to the fixed image with a non-linear registration algorithm. Images after registration are called the warped images. Our method contains four steps: (1) We first build our fixed images space with only one modality images being given.\nWe use T1 and T2 images as one example to illustrate our method. Given T2 images, our fixed images space can consist of T2 andT 1 images by using our cross-modality generation framework. The moving images space commonly Figure 7 : Flowchart of our approach for cross-modality registration. In the fixed space, inputting T2 images into N2N framework yieldsT 1 images. T2 (moving) images are registered to T2 (fixed) images. T1 (moving) images are registered toT 1 (fixed) images. The corresponding deformations generated after registrations are combined in a weighted fusion process. Then we employ the fused deformation to the segmentation labels of moving images, outputting the registered segmentation labels of fixed images. The red box indicates our translated images.\nconsists of both T2 and T1 images from n subjects. (2) The second step is to register the moving images to the fixed images, constructing n corresponding atlases. Since multiple atlases encompass richer anatomical variability than a single atlas, we used multi-atlas-based rather than single-atlas-based registration approach. For any fixed subject, we register all n moving images to the fixed images and the deformation field that aligns the moving image with the fixed image can be automatically computed with a registration algorithm. As illustrated in Fig.7 , T2 images from the moving images space are registered to T2 images from the fixed images space and T1 images from the moving images space are registered toT 1 images from the fixed images space. (3) The deformations generated in (2) are combined in a weighted fusion process, where the cross-modality information can be adopted. We fuse the deformations generated from T2 registrations with deformations generated fromT 1 registrations (see Fig.7 ). (4) Applying the deformations to the atlas segmentation labels can yield n registered segmentation labels of fixed images. For any fixed subject, we obtain the final registration results by averaging the n registered labels of the fixed subject.\nAmong multiple registration algorithms, we select ANTs (Avants et al., 2009 ) and Elastix (Klein et al., 2010) \nEvaluation metric. We use the two evaluation metrics for cross-modality registration, namely Dice and Distance Between Corresponding Landmarks (Dist).\n(1)Dice: The first metric is introduced to measure the overlap of ground truth segmentation labels and registered segmentation labels. It is defined as (2)Distance Between Corresponding Landmarks (Dist): The second metric is adopted to measure the capacity of algorithms to register the brain structures.\nThe registration error on a pair of images is defined as the average Euclidean distance between a landmark in the warped image and its corresponding landmark in the fixed image. To compute the Euclidean distance, all 2D-slices after registration are stacked into 3D images.\nDataset. We preprocess the original MRI data from Iseg2017 and MRBrain13 datasets with the following steps to make it applicable to our proposed framework.\n(1) We first shear the 3D image into a smaller cube, each side of which circumscribes the brain. (2) The brain cube is then resized to a size of 128 \u00d7 128 \u00d7 128 voxels. (3) The last step is to slice the brain cubes from all the subjects into 2D data along the z-axis (128 \u00d7 128, 128 slices).\nAfter preprocessing, the brain slices with the same depth value from different subjects are spatially aligned. During the training phase, a pair of brain slices from two different subjects with the same depth value is treated as a pair moving and fixed images. In order to conduct five-fold cross-validation for our experiments, the value of n (numbers of atlases) is selected differently in each dataset. For Iseg2017 dataset, we choose 8 subjects in the moving images space and another 2 subjects in the fixed images space (n = 8). For MRBrain13 dataset, 4 subjects are selected for the moving images space while one subject in the fixed images space (n = 4)\nIseg2017 and MRBrain13 datasets provide ground truth segmentation la- bels. Seven well-defined anatomic landmarks (see Fig.10 ) that are distributed in the lateral ventricle are manually annotated by three doctors. We consider the average coordinates from three doctors as the ground truth positions of the landmarks.\nResults. Our experiments not only include registration with real data, but also with translated images ( T 1 and T 2 images for Iseg2017 dataset, T 1 and T 2-F lair images for MRBrain13 dataset). The deformations generated in each set of experiments are combined in a weighted fusion process, yielding the final registration deformation. In order to compute the Euclidean distance of those corresponding landmarks between warped images and fixed images, all 2D-slices are then stacked into 3D images. Besides, we also employ the fused deformation to segmentation labels of moving images, obtaining registered segmentation results of fixed images. Table 7 summarizes the registration results both in terms of Dist and Dice.\nWe introduce the cross-modality information from our T 1 images into T2 images and T2-Flair images, of which the performance are denoted as \"T2+ T 1\"\nand \"T2-Flair+ T 1\". Likewise, \"T1+ T 2\" and \"T1+ T 2-F lair\" indicate performance of registrations with cross-modality information from our T 2-F lair images added into T1 images. We also show the upper bounds of registrations with translated images, which are denoted as \"T1+T2\" and \"T2-Flair+T1\". The weights for the combination are determined through five-fold cross-validation.\nThe optimal weights of 0.92 and 0.69 are selected forT 1 images in terms of white matter and gray matter on Iseg2017 and 0.99 and 0.82 are selected on"}, {"section_title": "Cross-Modality Segmentation", "text": "We propose a new approach for MR image segmentation based on crossmodality images, namely translated multichannel segmentation (TMS). The main focus of TMS is the introduction of the translated-modality images obtained in our proposed framework, which enriches the cross-modality information without any extra data. TMS inputs two identical given-modality images and one corresponding translated-modality image into three separate channels which are conventionally used for RGB images. Three input images are then fed into FCN networks for improving segmentation results of given-modality images. Here, we employ the standard FCN-8s (Long et al., 2015) as the CNN architecture of our segmentation framework because it can fuse multi-level information by combining feature maps of the final layer and last two pooling layers. Fig.8 depicts the flowchart of our segmentation approach. For instance, given a T1 image, T 2 images can be generated with our method. Second, two identical given-modality images and one corresponding translated-modality image are fed to channels 1, 2, and 3 and segmented by FCN networks. Under the standard FCN-32s, standard FCN-16s, and standard FCN-8s settings, we output our segmentation results. The red box indicates our translated images.\nWe denote our training dataset as S = {(x i ,\u0177 i , l i ), i = 1, 2, 3, . . . , n}, where x i refers to the ith given-modality image,\u0177 i indicates the ith corresponding translated-modality image obtained in our proposed framework, and l i represents the corresponding segmentation label. We denote the parameters of the FCN architecture as \u03b8 and the model is trained to seek optimal parameters \u03b8 * .\nDuring testing, given an input image x, the segmentation outputl is defined as below:\nwhere k denotes the total number of classes, h(\u00b7) denotes the feature map of the hidden layer, s(\u00b7) refers to the softmax function and s k indicates the output of the kth class.\nEvaluation metric. We report segmentation results on Dice (higher is better).\nDataset. The original training set is divided into P artA and P artB at the ratio of 1:1 based on the subjects. The original test set maintains the same (denoted as P artC). P artA is used to train the generator. P artB is then used to infer the translated modality. P artB is then used to train the segmentation model, which is tested on P artC.\n(1)Brats2015 : The original Brats2015 dataset contains 1924 images (P artA:\n945, P artB: 979) for training and 451 images (P artC) for testing. After preprocessing, 979 images are trained for 400 epochs and 451 images are used for testing.\n(2)Iseg2017 : The original Iseg2017 dataset contains 661 images (P artA:\n328, P artB:333) for training and 163 images (P artC) for testing. After preprocessing, 333 images are trained for 800 epochs and 163 images remain for testing.\nResults. Our experiments focus on two types of MRI brain segmentation:\ntumor segmentation and brain structure segmentation. Among all MRI modalities, some modalities are conducive to locating tumors (e.g. and some are utilized for observing brain structures (e.g. T1) like white matters and gray matters. To this point, we choose to add cross-modality information from T2 and T2-Flair images into T1 images for tumor segmentation and add cross-modality information from T1 images into T2 images for brain structure segmentation. Experiments of tumor segmentation are conducted on Brats2015 and experiments of brain structure segmentation are conducted on Iseg2017.\nAs shown in Tables 9, cross-modality information from T 2-F lair and T 2 images contributes improvements to tumor segmentation of T1 images (7.89% and 6.32% of tumors respectively). Likewise, Table 10 shows that cross-modality information from T 1 images leads to improvements of wm and gm segmentation of T2 images (3.08% of wm and 2.09% of gm). We also add cross-modality information from real modalities to make an upper bound. We observe a minor gap between results of TMS and the upper bound though our translated modalities are very close to real modalities. It is explicable by the presence of abnormal tissue anatomy (eg. tumors) and the cortex in MR images. The tumors are diffuse and even a small difference in the overlap can cause a low value for the Dice. In addition, in some finer cortex regions (unlike large homogeneous gray matter and white matter), our approach may produce some relatively coarse images, leading to a lower Dice. Overall, TMS outperforms the traditional FCN method when favorable cross-modality information is adopted. Fig.12 and Fig.13 visualize some samples of our segmentation results on BraTs2015 and Iseg2017 respectively."}, {"section_title": "Experiments and results", "text": "In this section, we demonstrate the generalizability of our framework for MR image generation and apply it to cross-modality registration and segmentation. We first conduct a large number of experiments on five publicly available datasets for MR image generation (BraTs2015, Iseg2017, MRBrain13, ADNI, RIRE ). Then we choose Iseg2017 and MRBrain13 for cross-modality registra-tion. We finally choose BraTs2015 and Iseg2017 for cross-modality segmentation. Among these five MRI datasets, the BraTs2015, Iseg2017, and MRBrain13 datasets provide ground truth segmentation labels."}, {"section_title": "Implementation details", "text": "All our models are trained on NVIDIA Tesla K80 GPUs. Our code 1 will be publicly released upon acceptance.\nGeneration: We train the models on a torch7 framework (Collobert et al., 2011) using Adam optimizer (Kingma and Ba, 2014 ) with a momentum term \u03b21 = 0.5. The learning rate is set to 0.0002. The batchsize is set to 1 because our approach can be regarded as \"instance normalization\" when batchsize = 1 due to the use of batch normalization. As demonstrated in (Ulyanov et al., 2016) , instance normalization is effective at generation tasks by removing instancespecific information from the content image. Other parameters follow the ref-\nerence (Isola et al., 2017) . All experiments use 70\u00d770 PatchGANs.\nRegistration: A Windows release 2.1.0 version of ANTs (Avants et al., 2009) as well as its auxiliary registration tools are used in our experiments. As for the Elastix (Klein et al., 2010) , a Windows 64 bit release 4.8 version is adopted. All the registration experiments are run in a Microsoft High-Performance Computing cluster with 2 Quad-core Xeon 2.43 GHz CPU for each compute node. We choose the parameters by cross-validation. For ANTs, we use the parameters in (Wang et al., 2013) . For Elastix, we adopt the parameters in (Artaechevarria et al., 2009) .\nSegmentation: We implement standard FCN-8s on a publicly available MXNET toolbox (Chen et al., 2015) . A pre-trained VGG-16 model, a trained FCN-32s model, and a trained FCN-16s model are used for initialization of FCN-32s, FCN-16s, and FCN-8s respectively. The learning rate is set to 0.0001, with a momentum of 0.99 and a weight decay of 0.0005. Other parameters are set to the defaults in (Long et al., 2015) ."}, {"section_title": "Cross-Modality Generation", "text": "Evaluation metrics. We report results on mean absolute error (MAE), peak signal-to-noise ratio (PSNR), mutual information (MI), Structural Similarity Index (SSIM) and FCN-score.\nWe follow the definition of MAE in (Pedregosa et al., 2011) :\nwhere target-modality image y and translated-modality image\u0177 both have a size of 256 \u00d7 256 pixels, and (i, j) indicates the location of pixels.\nPSNR (Hore and Ziou, 2010 ) is defined as below:\nwhere MAX is the maximum pixel value of two images and MSE is the mean square error between two images.\nMI is used as a cross-modality similarity measure (Pluim et al., 2003) . It is robust to variations in modalities and calculated as:\nwhere m, n are the intensities in target-modality image y and translated-modality image\u0177 respectively. p(m, n) is the joint probability density of y and\u0177, while p(m) and p(n) are marginal densities.\nSSIM (Wang and Bovik, 2009 ) is defined as follows:\nwhere \u00b5 x and \u00b5 y denote the mean values of original and distorted images. \u03c3 x and \u03c3 y denote the standard deviation of original and distorted images, and \u03c3 xy is the covariance of both images.\nFCN-score is used to capture the joint statistics of data and evaluate synthesized images across the board. It includes accuracy and Dice. On one hand, accuracy consists of the mean accuracy of all pixels (denoted as \"all\" in the tables) and per-class accuracy (such as mean accuracy of tumors, gray matter, white matter, etc.). On the other hand, the Dice is defined as follows:\n(2|H \u2229 G|)/(|H| + |G|) where G is the ground truth map and H is the prediction map.\nHere, we follow the definitions of FCN-score in (Isola et al., 2017) . Note that different modalities of the same subject from five brain MRI datasets that we choose are almost voxelwise spatially aligned. We do not choose to coregister the data in our datasets since this is beyond the scope of our discussion. We respectively illustrate five publicly available datasets used for cross-modality MRI generation.\n( (4)ADNI : The ADNI dataset (Nie et al., 2017) contains T2 and PD images (proton density images, tissues with a higher concentration or density of protons produce the strongest signals and appear the brightest on the image) from 50 subjects. 40 subjects are randomly selected for training and the remaining 10 for testing. 1795 training images are trained for 400 epochs with batch size 1.\n455 images are used for testing.\n(5)RIRE : The RIRE dataset (West et al., 1997) includes T1 and T2 images collected from 19 subjects. We randomly choose 16 subjects as for training and the rest for testing. 477 training images are trained for 800 epochs with batch size 1. 156 images are used for testing. Results. Generation performance with different methods on the five datasets are summarized in Table 1, Table 2, Table 3 and Table 4 . It quantitatively shows how using N2N translation network allows us to achieve better generation results than the regression-based method using RF (Jog et al., 2013) and the latest proposed Context-Aware GAN method from (Nie et al., 2017) on most datasets evaluated by MAE, PSNR, MI, and SSIM. However, there are also some cases where the RF method surpasses our N2N translation network on the BraTs2015 dataset (images with tumors). It is explicable since the RF method incorporates additional context features, taking full advantages of structural information and thus leading to comparable generation results on images with tumors.\nNote that different losses induce different quality of generated images. In most cases, our N2N network with cGAN + L1 achieves the best results on MAE and PSNR; L1 loss term contributes to superior performance on MI over other methods. MI focuses more attention on the matching of pixel-wise intensities and ignores structural information in the images. Meanwhile, the L1 loss term ensures pixel-wise information rather than the properties of human visual perception (Larsen et al., 2015) . Thus, it is reasonable that using L1\nterm contributes to superior results on MI. Fig .9 shows the qualitative results of cross-modality image generation using different approaches on five datasets. We have reasonable but blurry results using N2N network with L1 alone. The N2N network with cGAN alone leads to improvements in visual performance but causes some artifacts in cross-modality MR image generation. Using cGAN + L1 terms achieves decent results and reduces artifacts. In contrast, the RF method and Context-Aware GAN lead to rough and fuzzy results compared with N2N networks.\nWe also quantify the generation results using FCN-score on BraTs2015 and Table 6 : Segmentation results of N2N translated images on Iseg2017 evaluated by FCN-score.\nNote that \"gm\" and \"wm\" indicate gray matter and white matter respectively. The minor gap between translated-modality images and the target-modality images shows decent generation performance of our framework. Iseg2017 in Table 5 and Table 6 . Our approach (cGAN + L1) is effective in generating realistic cross-modality MR images towards the real images. The cGAN-based objectives lead to high scores close to the real images.\nTo validate the perceptual realism of our generated images, two more experiments are conducted. One is conducted by three radiologists. The other is done by five well-trained medical students. For the first experiment, we randomly select 1100 pairs of images, each of which consists of an image generated by our framework and its corresponding real image. On each trial, three radiologists are respectively asked to select which one is fake in the image pair. The first 100 trials are practice after which they are given feedback. The following 1000 trials are the main experiment where no feedback are given. The average performance of the three radiologists quantitatively evaluates the perceptual realism of our approach. For the second experiment, the experimental setting is perfectly identical. Results indicate that our generated images fooled radiologists on 25% trials and fooled students on 27.6% trials."}, {"section_title": "MRBrain13.", "text": "After the weighted fusion process, we find that registrations with translated images show better performance than those with real data by achieving well as the real data itself with high contrast for brain structure leads to lower registration errors. Fig.11 visualizes samples of the registration results of our methods. More details can be found there. To demonstrate the effectiveness of our cross-modality registration approach with translated images, we propose an additional experiment by employing a known transformation to the moving images to generate transformed images that can be used as our \"fixed\". This allows us to directly estimate the benefit of adding translated modalities to the registration process when finding the known transformation during the registration step. Take T1 and T2 images as one example. The T1 and T2 images from the moving images space are first rotated a certain degree. Here we rotate them by 30 degrees. TheT 1 images generated from our framework are also rotated 30 degrees. All these rotated images are used as our \"fixed\". T2 (moving) images are registered to rotated T2 (fixed) images and T1 (moving) images are registered to rotatedT 1 (fixed)\nimages. The following fusion processes are the same as our stated method. Table 8 shows the results of our additional experiments."}, {"section_title": "Discussion", "text": "We have described a new approach for cross-modality MR image generation using N2N translation network. Experimental results in section 5 have highlighted the capability of our proposed approach to handle complex crossmodality generation tasks. The rationales are as follows. First, the cGAN rather than GAN network is essentially conceived of as a supervised network. It not only pursues realistic looking images, but also penalizes the mismatch between input and output so as to produce grounded enough real images. Second, the L1 term, which introduces pixel-wise regularization constraints into our generation task, guarantees the quantifications of low-level textures. Besides, we also described registration and segmentation applications of generated images.\nBoth given-modality images and generated translated-modality images are used together to provide enough contrast information to differentiate different tissues and tumors, contributing to improvements for MR images registration and segmentation. Although our approach generally achieves excellent performance, we recognize that in some cases our generated images are still not as good as real images at tiny structures. As illustrated in Fig.14 , there are also abortive cases where tiny structures may be mistaken. In the yellow box, the eyebrow-like structure is missing. The red box indicates a non-existent round structure which might be confounded with the vessel. In the green box, the learned structure seems to be discontinuous which might give rise to perplexity for radiologists to make a diagnosis. In the future, we will improve our algorithm to describe more tiny structures."}, {"section_title": "Conclusion", "text": "In this paper, we have developed a conditional-generative-adversarial-networkbased framework for cross-modality translation that demonstrates competitive performance on cross-modality registration and segmentation. Our framework builds on top of the ideas of end-to-end NeuroImage-to-NeuroImage translation networks. We also have proposed two new approaches for MR image registration and segmentation by adopting cross-modality information from translated modality generated with our proposed framework. Our methods lead to comparable results in cross-modality generation, registration and segmentation on widely adopted MRI datasets without adding any extra data on the premise of only one modality image being given. It also suggests promising future work towards cross-modality translation tasks beyond MRI, such as from CT to MRI or from MRI to PET."}]