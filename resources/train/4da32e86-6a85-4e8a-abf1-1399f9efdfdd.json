[{"section_title": "Abstract", "text": "Abstract. Accurate estimation of intracranial volume (ICV) is key in neuro-imaging-based volumetric studies, since estimation errors directly propagate to the ICV-corrected volumes used in subsequent analyses. ICV estimation through registration to a reference atlas has the advantage of not requiring manually delineated data, and can thus be applied to populations for which labeled data might be inexistent or scarce, e.g., preterm born animal models. However, such method is not robust, since the estimation depends on a single registration. Here we present a groupwise, template-free ICV estimation method that overcomes this limitation. The method quickly aligns pairs of images using linear registration at low resolution, and then computes the most likely ICV values using a Bayesian framework. The algorithm is robust against single registration errors, which are corrected by registrations to other subjects. The algorithm was evaluated on a pilot dataset of rabbit brain MRI (N = 7), in which the estimated ICV was highly correlated (\u03c1 = 0.99) with ground truth values derived from manual delineations. Additional regression and discrimination experiments with human hippocampal volume on a subset of ADNI (N = 150) yielded reduced sample sizes and increased classification accuracy, compared with using a reference atlas."}, {"section_title": "Introduction", "text": "Background. Intracranial volume (ICV) is a crucial covariate in MRI-based neuroimaging studies. Correcting for ICV, by division or regression [1] , is necessary for comparing volume estimates of brain structures from cases with different head sizes. While the automated segmentation of brain structures has received a considerable amount of attention in the literature, ICV estimation is often overlooked, despite the fact that a poor ICV estimate can have a very detrimental impact on the corrected volume of an otherwise very well segmented structure. Compared with skull stripping, ICV estimation needs to account for all the tissue and fluid inside the skull, not only the brain. Otherwise, atrophy or growth of brain structures would be partially explained by changes of the whole brain.\nThe literature of ICV estimation is dominated by methods designed for adult human brain MRI. Earlier approaches relied on simple thresholding and morphological operations [2] . In the 2000s, methods based on linear registration [3, 4] gained popularity: scaling factors are derived from an affine registration to a reference atlas, and multiplied by the ground truth ICV of the atlas to yield the estimates. These methods are implemented in widespread neuroimaging packages (e.g., FreeSurfer [5] , FSL [6] ). Other approaches rely on explicit segmentation of the intracranial cavity, typically with supervised methods based on parametric or non-parametric models. Representative examples of the former are the Bayesian segmentation [7] implemented in the SPM package [8] , or variants thereof [9] . Examples of the latter include multi-atlas methods [10] and patch matching [11] .\nAlthough supervised methods can potentially yield better results, registrationbased algorithms for ICV estimation are still widely used in adult human brain MRI, e.g., in FreeSurfer and FSL. The reason is threefold: they are fast; they do not require multimodal MRI pulse sequences; and they do not require labeled training data. Even if no ground truth ICV is available for the reference atlas, the ICV can still be estimated up to a constant scaling factor, which has no impact on the subsequent ICV correction. The main drawback of registration-based ICV estimation is that it is very sensitive to registration errors, which reflect directly on the ICV estimates through the determinant of the transformation matrix.\nMotivation: limitations in ICV computation for developing brain and animal models. The literature on ICV estimation in the developing human brain is very sparse, but it is possible to use registration-based methods based on existing atlases, such as those described in [12, 13] . In animals, however, the availability of atlases -particularly for species other than mouse, rat and monkey -is very limited, especially for the developing brain. A particularly interesting case is rabbit models, which are increasingly important in neuroscience. One of the main application of rabbit models is the study of preterm birth, a problem with large economic and social impact [14, 15] , and which is difficult to study in humans [16] . The only available rabbit atlas [17] is for the adult brain, and has no ICV information, as it was created from ex vivo brains without the skull.\nContribution. In this paper, we address the problem of ICV estimation by computing the ICV of all subjects/cases in a study simultaneously. The method has two major advantages: it does not require any labeled data, which is costly to collect (which is why many methods rely on semiautomatically generated silver standards, e.g., [4, 11, 10] ); and is agnostic to species. Therefore, the proposed method readily enables application to developing brain and animal studies.\nMore specifically, we propose a probabilistic framework, in which the true, underlying ICVs are assumed to be independent samples of a Gaussian distribution with unknown parameters, and in which pairwise registrations yield noisy measurements of the ratios between these ICVs. Within this framework, we use Bayesian inference to compute the most likely ICVs. The information in the registrations enables estimation up to a scaling factor, which is disambiguated by the model hyperparameters. The proposed method preserves the advantages of registration-based algorithms described above, while being more robust to registration errors. Such robustness translates into increased statistical power and reduced sample sizes in subsequent analyses, as shown in our experiments below.\nexp(\u2212|vi \u2212 vj|/c) (b) Fig. 1 . Graphical model (a) and corresponding equations (b). Circles represent random variables, boxes represent hyperparameters, shaded elements are observed, and plates indicate replication. N is the Gaussian distribution, and L is the Laplace distribution."}, {"section_title": "Methods", "text": ""}, {"section_title": "Probabilistic framework", "text": "The graphical model of our probabilistic framework is shown in Figure 1 .\nt be a vector of log-transformed ICVs from N subjects; since we work with ratios, the logarithmic domain is more appropriate. These ICVs are assumed to be independent samples of a Gaussian distribution with unknown mean and variance (\u00b5, \u03c3 2 ). Prior knowledge on these two parameters is encoded in the hyperparameters of their prior distribution, which we choose to be a Normal Inverse Gamma (NIG), parameterized by [m, n, a, b]\nt . This is the conjugate prior of a Gaussian with unknown mean and variance, and can be decomposed into an Inverse Gamma (IG) distribution on \u03c3 2 (parameterized by [a, b] t ) and a Gaussian distribution on \u00b5, with mean m and variance \u03c3 2 /n. Now, we assume that we have a set S of subject pairs (i, j) for which pairwise scaling factors S ij have been computed. Factor S ij corresponds to a noisy estimate of the difference in log-ICVs between subjects i and j, i.e., v i \u2212 v j . The set of measurements does not need to exhaustively cover every (i, j), but must ensure that the adjacency matrix A ij = \u03b4(S ij = 0) corresponds to a fully connected graph, such that there is always a path of scaling factors available between any two subjects. We use the matrix S to represent the measured scaling factors, with diagonal S ii = 0, \u2200i, and S ij = NaN if the scaling factor is not available, i.e., (i, j) \u2208 S. These measurements, which are computed with a linear registration algorithm, correspond to the logarithm of the determinant of the estimated transform matrices. Here we assume that the registration method is symmetric, which yields an antisymmetric S, i.e., S ij = \u2212S ji . In order to make the algorithm robust against outliers, we further assume that the measurement errors are independent samples of a Laplace distribution (based on the robust 1 norm, rather than 2 that the Gaussian distribution relies on) with zero location and scale parameter c. Assuming zero location is appropriate, since the registration is symmetric. The scale parameter is unknown, but we place a conjugate prior distribution on it -the IG distribution, with hyperparameters \u03b1 and \u03b2."}, {"section_title": "Bayesian inference", "text": "Our goal is to find the valuev that maximizes the posterior probability of the ICVs v, given the pairwise scaling measurements and the hyperparameters:\nThanks to the conjugate priors, the two integrals in Equation 1 have closed-form solutions, so we can easily consider all possible values of the model parameters -weighted by their probabilities -in the estimation. The negated logarithm of this expression is the cost function to minimize (C). In the appendix, we show that C is equal to:\nwhere Z is a term independent of v, andv = (1/N ) N i=1 v i is the sample mean of v. The final optimization problem is hence: argmin v C(v; S, m, n, a, b, \u03b1, \u03b2). This is an unconstrained problem, which can be efficiently solved with standard algorithms; we used conjugate gradient [18] initialized with v i = m, \u2200i. The final solution is obtained by exponentiatingv to bring it back to the natural domain."}, {"section_title": "Experiments and results", "text": ""}, {"section_title": "Data", "text": "We used two brain MRI datasets in this study: one of rabbits, and one of humans. The rabbit dataset was acquired as part of a study seeking to understand the effects of steroids on fetuses. Scans from 7 rabbits (5 preterm born, 2 term) were acquired in vivo on a Bruker 9.4T animal scanner using a RARE T2 sequence (TR=42ms, TE=1000ms, 0.15mm resolution isotropic). The intracranial cavity was manually delineated by S.F. on the images, providing a ground truth for the ICVs. Since the size of the rabbit dataset is limited, we also performed experiments on a larger, more conventional human dataset consisting of T1 scans of 150 subjects from the Alzheimer's Disease Neuroimaging Initiative (ADNI): 77 Alzheimer's disease (AD) patients and 73 age-matched controls (EC). No ground truth ICVs was available for this dataset, so we used indirect validation techniques. While direct validation is generally preferable, indirect methods make the evaluation independent of segmentation errors, and do not require manual delineation, which is prohibitive for large datasets.\n(a) (b) 8 Ground truth volume (ml) "}, {"section_title": "Experiments on rabbit dataset", "text": "This experiment assesses the performance of the method in pediatric animal brain MRI, in which the availability of labeled data is extremely limited. We used correlation with ground truth volumes rather than absolute errors because the errors depend on m, whereas correlations do not, and also because ICV correction is based on correlation. We set the hyperparameters to n = a = \u03b1 = 0.001, b = \u03b2 = 0.1, which represents very weak priors, such that the posterior distribution of the model parameters is mostly driven by the data. We set m to the mean value of the ground truth volumes, which has no effect on the correlation or ICV correction. For registration, we used a symmetric linear method based on block matching (NiftyReg [19] ), applied to images downsampled by a factor of 4 in each dimension (for efficiency). Figure 2 shows sample MRI slices and the scatter plot for the ground truth and estimated ICVs, along with their linear regression. The correlation is very strong: \u03c1 = 0.996, with p \u2248 10 \u22126 . These results are encouraging, but further validation is needed, given the small dataset."}, {"section_title": "Experiments on human dataset", "text": "We further evaluated our method indirectly with three experiments on the human dataset: we tested the strength of the correlation of hippocampal volume with age and ICV; we evaluated the ability of the ICV-corrected hippocampal volumes to discriminate EC from AD; and we tested the dependence of the performance on the set size |S|.\nWe compared our proposed approach (\"PROP\") against performing no correction (\"NOCORR\") and four different methods: 1. FreeSurfer v5.3 [4] (\"FS\"): based on registration to a single template (MNI305) using cross-correlation; 2. Single atlas (\"SINGAT\"): a reimplementation of FS with NiftyReg at full resolution; 3. SPM [7] : we compute the ICV by summing the volumes of the gray matter, white matter and CSF, computed with SPM12 (default parameters); and 4. Non-linear (\"PROPNL\"): PROP with nonlinear registration [20] -we manually segmented the intracranial cavity in the atlas; nonlinearly propagated this mask to all subjects to create a silver standard; computed pairwise nonlinear registrations between subjects; propagated the silver standard masks; and computed S ij as the difference in mask volume before and after registration. By matching registration algorithms, SINGAT isolates the contribution of our framework to the improvement achieved over FS. SPM represents a much more complex, segmentation-based algorithm. PROPNL enables us to assess the potential improvement yielded by a more precise registration, which in principle could avoid bias from brain atrophy and disregard the contribution of extracranial regions. We used the same values of n, a, \u03b1, \u03b2 as in the rabbit dataset, and set m to the mean ICV computed by FreeSurfer.\nEffect of aging on hippocampal volume: Using only the healthy subjects, we first inspect the partial correlation between hippocampal volumes (computed with FreeSurfer, left-right averaged) and age/ICV, i.e., correcting for each other. For our method, we used all pairwise registrations. The results are shown in Table 1 , and sample outputs in Figure 3 . All methods increase the correlations between hippocampal volume and age. SINGAT outperforms FreeSurfer, thanks to the more robust registration. Despite being a more complex method, the performance of SPM is on par with that of SINGAT, because SPM sometimes includes large portions of bone in the segmentation due to poor contrast in T1 MR (see Figure 3a) . We observed a similar effect in PROPNL, exacerbated by the fact that errors propagate along two registrations (see Figure 3b ). Our method produces the highest correlation, with a mild, borderline significant (Steiger's test [21] : p = 0.05) improvement over the second-to-best method (SINGAT). Compared with the widely used FreeSurfer, the improvement is noticeable: \u2206\u03c1 = 0.08 (Steiger's p = 0.01), and sample size reduced from 10 to 8. A similar trend can be observed for the correlation between ICV and hippocampal volume.\nAlzheimer's disease classification: We computed the area under the ROC curve (AUROC) and the accuracy at its elbow for classifiers based on thresholding ICV/age corrected hippocampal volumes. We used DeLong's test [22] to compare AUROCs. The results are shown in Table 2 . Our method provides the highest AUROC, with significant improvement with respect to all others, except SPM. It also provides the second-to-best accuracy at elbow, after PROPNL."}, {"section_title": "Performance as a function of the number of available registrations:", "text": "Since the number of registrations increases quickly with N , it is useful to test how robust our algorithm is against missing scaling factors, to see if computational cost can be reduced by computing only a subset of the registrations, without significant loss of accuracy. For a number of set sizes, we drew 100 random samples (with rejection to ensure fully connected graphs); computed the partial correlations, AUROCs and accuracies; and calculated their averages across the samples. The results are shown in Figure 4 . The correlations increase quickly in the beginning, and plateau at around 40-50% of the maximum set size. The AUROC and accuracy improve slowly until 100%, as they are more sensitive to volume estimate changes in samples closer to the decision boundary."}, {"section_title": "Discussion and conclusion", "text": "We propose an ICV estimation method that does not require labeled data and is agnostic to the imaged species, and which inherits the advantages of registrationbased ICV estimation -while being more robust against registration errors. This is despite using linear registration, which could be biased by extracranial and intracranial changes (e.g., neck size, atrophy); such bias was not observed in our experiments. Our approach can be combined with any registration method; we used a symmetric algorithm to save half of the registrations when building S. Despite the high number of required registrations, our method is not too computationally expensive, as low-resolution registrations run in 3-4 seconds on a single core. Moreover, S can be precomputed such that, when a new scan arrives, only N new registrations are required. We also tested a non-linear version, but the increased flexibility did not compensate for the introduced registration errors and increased computational cost. The inference algorithm takes just a few seconds, which is negligible compared with the running time of the registrations.\nThe experiments in this paper have shown that our method outperforms single atlas ICV estimation in analyses like effect of age and AD classification. Moreover, it also outperforms the much more complex SPM, in spite of using linear registrations. Even though the contribution of the raw hippocampal volume is larger that that of the ICV to such analyses, our method can still provide a moderate, statistically significant improvement. Future work will consider more complex distributions for the ICVs, e.g., conditioned on sex and gestational age. \nas the integral is over the probability density of IG(\u03b1 , \u03b2 ) and thus equal to 1. For the second integral in Equation 1 (over \u00b5 and \u03c3 2 ), substitution of the expressions for the probabilities (again, see Figure 1b in the paper) yields:\nWe now define m = (nm + Nv)/(n + N ), n = n + N , a = a + N 2 , and: \nsince the integral is over the probability density function of N IG(m , n , a , b ) and hence equal to 1.\nCombining Equations 4 and 6, the problem in Equation 1 becomes: , where z groups the terms independent of v. Taking the negated logarithm: C = \u03b1 log \u03b2 + a log b + log z.\nSubstituting a , b , \u03b1 and \u03b2 into this equation, and defining Z = log z, we finally obtain the cost function in Equation 2."}]