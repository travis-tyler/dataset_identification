[{"section_title": "Abstract", "text": "Abstract. As deep learning is showing unprecedented success in medical image analysis tasks, the lack of sufficient medical data is emerging as a critical problem. While recent attempts to solve the limited data problem using Generative Adversarial Networks (GAN) have been successful in generating realistic images with diversity, most of them are based on image-to-image translation and thus require extensive datasets from different domains. Here, we propose a novel model that can successfully generate 3D brain MRI data from random vectors by learning the data distribution. Our 3D GAN model solves both image blurriness and mode collapse problems by leveraging \u03b1-GAN that combines the advantages of Variational Auto-Encoder (VAE) and GAN with an additional code discriminator network. We also use the Wasserstein GAN with Gradient Penalty (WGAN-GP) loss to lower the training instability. To demonstrate the effectiveness of our model, we generate new images of normal brain MRI and show that our model outperforms baseline models in both quantitative and qualitative measurements. We also train the model to synthesize brain disorder MRI data to demonstrate the wide applicability of our model. Our results suggest that the proposed model can successfully generate various types and modalities of 3D whole brain volumes from a small set of training data."}, {"section_title": "Introduction", "text": "Recent deep neural networks, especially Convolutional Neural Networks (CNN), have shown outstanding performance in various computer vision tasks such as classification and segmentation based on the availability of large data. Along with these achievements, areas of medical image analysis including disease diagnosis and lesion detection have also made a remarkable breakthrough using CNNs. However, training CNN-based models requires a large set of medical image data [15] , which are laborious and costly to obtain. Conventional geometric transformation methods (e.g. flip, rotation) can be used to augment training data, but their outputs are highly dependent on the original data.\nOne actively explored solution for the data deficit problem is Generative Adversarial Networks (GAN) [5] , which have succeeded in the computer vision domain by generating natural images that are realistic but different from the original. Two major approaches exist to medical image generation using GANs: image-to-image translation and generating images from random distribution. The former has been extensively explored in various contexts such as T1-T2 cross-modal synthesis of 2D slices [4] , modality conversion from T1 to FLAIR in 3D volumes [18] , and 3D brain tumor MRI synthesis from normal control [17] . In this approach, training is relatively easy as it is done with the guidance of another dataset, and the quality of generated images is comparable to that of real images. However, it requires extensive training data, and the generated output rely on the attributes of the original data such as shape. In the latter, Han et al. [8] and Bermudez et al. [3] generated realistic 2D tumor and normal MRI slices from random variables, respectively. This method can generate completely new images with more variability by learning the data distribution itself. However, it is rarely attempted due to difficulties in stabilizing training, which limited previous works to generating 2-dimensional slices.\nIn this paper, we propose a 3D GAN model that successfully generates 3D brain MRI from random vectors. We adapt the structure of \u03b1-GAN [16] for 3D image generation, which addresses mode collapse and image blurriness by introducing additional auto-encoder and code discriminator networks on top of the existing generator and discriminator. We also utilize Wasserstein GAN with Gradient Penalty (WGAN-GP) [7] loss functions to prevent unstable training. To the best of our knowledge, this work is the first attempt to generate completely new 3D brain MRI from random distribution. To demonstrate the versatility of our model, we train the model with brain tumor and stroke lesion MRI and show that it can generate realistic 3D whole brain images of multiple types (e.g. normal or diseased) and modalities (e.g. T2 or FLAIR). The proposed model is expected to be widely applicable for medical image analysis tasks such as disease diagnosis by enabling use of cross-modal information, and especially useful for rare diseases, as it requires a small amount of data."}, {"section_title": "Methods", "text": "Model Architecture. The main challenge in 3D generation is that the mode collapse problem, where GANs produce only a limited variety of images, becomes more severe as the complexity of the task increases abruptly going from 2D to 3D generation. A natural alternative is to use Variational Auto-Encoder (VAE) [14] , which is free from mode collapse but outputs are characterized with blurriness. In order to effectively address the problems of both mode collapse of GANs and blurriness of VAEs, we use \u03b1-GAN [16] , a solution born by combining both models. \u03b1-GAN proposes a code discriminator network C that replaces variational inference in VAE, a process in which the posterior from the encoder z e \u223c q e (z|x) is explicitly set as a specific distribution such as Gaussian and matched to the random prior z r \u223c P (z) with the reparametrization trick. Since this process has a different objective from GANs, \u03b1-GAN transforms this inference in a more GAN-like fashion: By treating the encoder output z e \u223c q e (z|x) as Fig. 1 . Detailed architecture of the proposed model. n, k, s, and p refer to the number of the channels, the kernel size, the stride size, and the padding size, respectively. x rand is the generator output from random vectors zr and xrec is the output from encoded vectors ze.\nfake and z r as real, the encoder and the code discriminator play an adversarial game. When C is not able to discriminate both, the posterior and the prior are perfectly matched. Thus, the posterior probability can be estimated implicitly. Under the unified objective of VAE and GAN, benefits of both models can be exploited, and the generation performance improves.\nWe adapt the network structure of the \u03b1-GAN to 3-dimensional generation tasks, as shown in Figure. 1. Our discriminator and encoder networks have five 3D convolution layers, each of which uses 4\u00d74\u00d74 filters. Since the output from the last layer has to be a single value for the discriminator and a vector for the encoder, output channel sizes are set accordingly. We use Batch Normalization (BatchNorm) and Leaky Rectified Linear Unit (LeakyReLU) layers after each layer. In the first and the last layer, BatchNorm is removed for maintaining the originality of the input and the output.\nIn our generator network, we use resize-convolution [12] to reduce the number of parameters and checkerboard artifacts. Instead of transpose convolution layers, conventional nearest neighbor upscale is applied before convolution layers with 3\u00d73\u00d73 filters both. For training stability, BatchNorm and ReLU are applied after each convolution layer except for the last layer, where BatchNorm is removed and Hyperbolic tangent (Tanh) activation is used. Our code discriminator network consists of three fully-connected layers. Similar to the discriminator, LeakyReLU and BatchNorm layers are placed between each fully-connected layer.\nSince the model has difficulty learning the proper distribution with a small latent vector size of \u223c100, we use moderately large latent vectors of size 1000 after empirically verifying that the large latent vectors have enough capacity to reflect the variety of images (See Experiments and Results). Loss Function. Our model with the basic GAN loss function suffers from significant instability in training, with the generated data distribution deviating from the real. Therefore, we use the loss function of WGAN [1] , which measures the Wasserstein distance between both distributions. The distance metric is de-\nWe also include the gradient penalty term [7] , which improves upon the vanilla WGAN loss by replacing the gradient clipping with following for maintaining the 1-lipschitz condition: Whenx is any point sampled between real and generated samples, the gradient penalty term L GP is described as Ex[(||\u2207xD(x)||2 \u2212 1) 2 ]. D and x can be replaced into C and z in code discriminator.\nAs with \u03b1-GAN, our loss function has a total of four loss terms, one for each network. In the discriminator loss L D , the reconstructed images G(z e ) and random generated images G(z r ) are both treated as fake. Therefore, the discriminator loss term is the sum of two distance metrics. The loss term for code discriminator L C and encoder L E has the identical form as discriminator and generator loss of WGAN-GP, except that the input values are latent vectors z r and z e instead of images. In the case of generator loss L G , reconstruction loss term is added as L1 distance between reconstructed images G(z e ) and real images x real . Gradient penalty terms L GP \u2212D and L GP \u2212C are also added to L D and L C . The encoder loss L E is not specified here as it is the generator version of the code discriminator loss. For the parameters \u03bb 1 and \u03bb 2 , we use the fixed value of 10 in both cases. Our final loss function is as follows:\n(1)\nTraining. In training, the encoder and the generator are considered as one network. Thus, we sum up the loss functions of the two networks as one and optimize the networks in the order of encoder-generator, discriminator, and code discriminator. Since the generator has slower optimization speed, we update it twice in one step."}, {"section_title": "Dataset and Preprocessing", "text": "Normal MRI Data. For the generation task, the Alzheimer's Disease Neuroimaging Initiative (ADNI) 1 dataset is used. 991 T1 structural images labeled control normal (CN) are selected as real data. To prevent an extremely high variability between subjects, the non-brain areas of raw MR images are removed with recon-all function from FreeSurfer 2 software package. The process is done by the dataset providers. Redundant planes with all-zero values are trimmed, then images are resized into 64\u00d764\u00d764. To compensate for the lack of samples without transforming the attributes of the original data, only left-right flip and intensity randomization are applied. Diseased MRI Data. For additional experiments, two brain disorder MRI datasets are used. First, we train the model with BRATS 2018 [2, 11] dataset for brain tumor MRI generation, using 210 subjects in the training dataset labeled as 'HGG 3 .' Each subject has images of four different modalities (T1, T1ce, T2, FLAIR). We use FLAIR and T2, which have imminent visual features of tumors. Second, Anatomical Tracings of Lesions After Stroke (ATLAS) 4 [10] dataset is used for stroke MRI generation. The dataset contains 220 T1w images, which have diverse stroke lesions. Non-brain areas are removed using segmentation tools from SPM12\n5 . Images from both datasets are processed with redundant planes trimming, resizing into 64\u00d764\u00d764, and left-right flip."}, {"section_title": "Experiments and Results", "text": "Experiment Details. Our experiments are conducted on an NVIDIA Titan Xp 12GB GPU. Programs are implemented with Python, using the Pytorch deep learning library 6 . For training the model, the Adam optimizer is used with learning rate of 0.0002 for all four networks, and the size of mini-batch is set to 4. We normalize all data into the range [-1, 1]. All the generated samples are generator outputs from random latent vectors z r . The results are obtained by considering 3D training images with additional augmentations (flip, intensity randomization) as real. Baseline Models. For comparison, 3D-\u03b1-GAN, 3D-VAE-GAN, 3D-WGAN-GP are used as baseline models. The VAE-GAN [9] model has similar motivation and structure to our model in that it combines VAE and GAN for training stabilization and image blurriness. WGAN-GP is chosen to evaluate effectiveness of the proposed approach in alleviating the mode collapse problem. Lastly, we include the baseline 3D-\u03b1-GAN model trained with the basic GAN loss to verify the validity of our WGAN-GP loss function. All models are composed of 3D-convolutional layers and implemented with 1000-dimensional latent vectors as input. Generated Images. In Figure. 2, center-cut slices of generated 3D samples are shown. The generated images from 3D-WGAN-GP and 3D-VAE-GAN are extremely similar to each other, which indicates that the models have mode collapse. Samples from 3D-VAE-GAN are blurry and the detailed features of the brain disappear. In the 3D-WGAN-GP and baseline 3D-\u03b1-GAN, images suffer from unwanted artifacts. In contrast, samples from our model reflect the detailed attributes of brains (e.g. sulci, gyri) with proper diversity. More samples are provided as full volume slices in Supplementary Material. Quantitative Results. Table 1 shows the quantitative results. First, we investigate the distribution distance between the real and generated samples with maximum mean discrepancy (MMD) scores [6] . Due to the memory issue, we use the averaged batch-wise MMD 2 calculations for the entire data. The final MMD scores are the averaged values of 100 tests. We use batch size of B = 8. If a flattened batch of generated samples is set as g, and real samples as r, a single batch-wise MMD 2 value is calculated as:\ng \u00b7 g + r \u00b7 r \u2212 2g \u00b7 r . The generated samples from our model has the lowest MMD scores, indicating that the distribution of our result samples are the closest to that of the real data. Second, we evaluate the generation diversity with multi-scale structural similarity metric (MS-SSIM) [13] . MS-SSIM scores are calculated with the average from 1000 sample pairs. In the case of 3D-WGAN-GP and 3D-VAE-GAN, the similarity scores between generated samples are very large, thus mode collapse occurs. Baseline \u03b1-GAN and our models can generate diverse samples with relatively similar scores to that of the real data. However, the model with too small latent vectors fails to escape the mode collapse.\nQualitative Results. To qualitatively analyze the results, we compare the generated and real data distributions by visualizing 512 generated samples from each model and 512 randomly selected samples from real data with Principal Component Analysis (PCA). Figure. 3(a,b) shows the scatter plot results of PCA, with each point representing a data sample. In the case of 3D-WGAN-GP, only a small range of images are generated and the distance from other distributions is very large. With the 3D-VAE-GAN, the output samples are within the real data distribution range, but it produces a limited variety of images. With the baseline 3D-\u03b1-GAN model, the mode collapse problem is solved, but the distribution is still not closely matched to the real data. Compared to the baseline models, the results from our proposed model have the most similar distribution range to the real data. The results show that \u03b1-GAN, but not VAE-GAN, exceeds the threshold of mode collapse because \u03b1-GAN accomplishes a more accurate latent distribution matching by replacing KL divergence with JS divergence, which can measure the exact distance between the distributions. Figure. 3(c) shows the effects of different latent vector sizes. Experiments are carried out with our model, varying the latent variable size. The figure shows that the model with small latent vector size of 100 suffers from severe mode collapse. While it is possible to obtain acceptable results using a very large size, many samples are out of the real data distribution. The best results can be obtained using a moderately large latent vector size, corroborating the quantitative results. Diseased MRI generation. To test the versatility of our model, we train the model with brain tumor and stroke 3D MRI data. We use three different training sets: Tumor-T2, Tumor-FLAIR and Stroke-T1w. Figure. 4(a,b) shows image samples of severe cases of brain tumor in FLAIR and T2. For better visualization, we display color-mapped images where yellow indicates higher and blue indicates lower intensity. Our model generates realistic samples with brain tumor lesions at various positions while properly reflecting the characteristics of different modalities. Figure. "}, {"section_title": "Conclusion", "text": "In this paper, we present a novel auto-encoder based GAN model that generates realistic 3D brain MRI data with a small amount of training samples. We demonstrate that our model outperforms alternative structures in capturing the real data distribution and generating diverse samples. Moreover, our model can be applied to various types of data and generates images that accurately reflect the attributes of each type. The results suggest that our model can be used for efficient data augmentation of 3D brain MRI data, opening up possibilities for applications such as disease diagnosis.\nAs future work, we are generating disease images that are difficult to generate with image-to-image translation (e.g. Alzheimer's) and planning to show the improvement in diagnostic performance with the generated images. "}]