[{"section_title": "Abstract", "text": "Introduction: Accurate differentiation of brain tissue types from T1-weighted magnetic resonance images (MRIs) is a critical requirement in many neuroscience and clinical applications. Accurate automated tissue segmentation is challenging due to the variabilities in the tissue intensity profiles caused by differences in scanner models and acquisition protocols, in addition to the varying age of the subjects and potential presence of pathology.\nIn this paper, we present BISON (Brain tISue segmentatiON), a new pipeline for tissue segmentation.\nMethods: BISON performs tissue segmentation using a random forests classifier and a set of intensity and location priors obtained based on T1-weighted images. The proposed method has been developed and cross-validated based on multi-center and multi-scanner manual labels of 72 subjects aging from 5-96 years old, ensuring the generalizability of the results to new data from various age ranges. In addition, we assessed the test-retest reliability of BISON on 2 datasets; a. using 20 subjects that had scan/re-scan MRIs and manual segmentations available, and b. using a human phantom dataset including 90 scans from a single individual acquired across 10 years.\nThe results of the proposed method were compared against Atropos, a commonly used tissue classification method from ANTs. The proposed method yielded cross-validation Dice Kappa values of \u03baGM = 0.88 \u00b1 0.03, \u03baWM = 0.85 \u00b1 0.03, \u03baCSF = 0.77 \u00b1 0.11, outperforming ANTs Atropos (\u03baGM = 0.79 \u00b1 0.05, \u03baWM = 0.84 \u00b1 0.05, \u03baCSF = 0.64 \u00b1 0.22) as well as test-retest Dice Kappa values of \u03baGM = 0.94 \u00b1 0.006, \u03baWM = 0.92 \u00b1 0.006, \u03baCSF = 0.77 \u00b1 0.11 outperforming both manual (\u03baGM = 0.92 \u00b1 0.01, \u03baWM = 0.91 \u00b1 0.01, \u03baCSF = 0.74 \u00b1 0.03) and\nANTs Atropos (\u03baGM = 0.87 \u00b1 0.001, \u03baWM = 0.92 \u00b1 0.001, \u03baCSF = 0.79 \u00b1 0.05). The human phantom dataset validations showed high generalizability for both Atropos (\u03baGM = 0.97 \u00b1 0.01, \u03baWM = 0.96 \u00b1 0.01, \u03baCSF = 0.93 \u00b1 0.02) and BISON (\u03baGM = 0.95 \u00b1 0.01, \u03baWM = 0.94 \u00b1 0.01, \u03baCSF = 0.85 \u00b1 0.03), while Atropos tended to consistently under-segment the cortical CSF. Finally, our assessment of BISON, Atropos, FAST from FSL, and SPM12 segmentations in presence of white matter hyperintensities (WMHs) showed that BISON outperforms the other three methods, correctly detecting WMHs as WM.\nOur results show that BISON can provide accurate and robust segmentations in data from different age ranges and various scanner models, making it ideal for performing tissue classification in large multi-center and multi-scanner databases."}, {"section_title": "Introduction", "text": "Accurate voxel-wise segmentation of different tissue types (i.e. gray matter (GM), white matter (WM), and cerebrospinal fluid (CSF)) in magnetic resonance images (MRIs) is important in many neuroimaging applications (Gonz\u00e1lez-Vill\u00e0 et al., 2016) . Regional and overall volumetric differences and changes in different tissues can be used to assess disease severity and progression. Tissue classification is also a necessary step in many image processing pipelines and applications (Ad-Dab'bagh et al., 2006; De Boer et al., 2009; Mateos-P\u00e9rez et al., 2018; Sajja et al., 2006; Schmidt et al., 2012; Sim\u00f5es et al., 2013; Steenwijk et al., 2013) , as well as for functional activation localization in functional MRI (fMRI) processing algorithms (Jo et al., 2010) . Manual tissue classification is subject to rater variability and time consuming, and therefore impractical, especially in large datasets.\nTissue segmentation is generally performed based on T1-weighted MR images, which provide a high inter-tissue contrast. However, accurate tissue segmentation can be challenging due to the presence of imaging artefacts such as noise, partial volume effects, and magnetic field non-uniformities (Cabezas et al., 2011) , differences in scanner models and image acquisition protocols, as well as intensity profiles and anatomical variabilities across subjects from different ages and with different pathologies. Many researchers have attempted to address this problem, using either atlas-based techniques (Aljabar et al., 2009; Cabezas et al., 2011; Collins and Evans, 1997; Collins and Pruessner, 2010; Klein and Tourville, 2012; L\u00f6tj\u00f6nen et al., 2010; Shen and Davatzikos, 2001; Wu et al., 2007) where one (or multiple) atlas with tissue (or structure) labels is nonlinearly registered to the subject volume. Using the obtained transformation, the labels of the atlas are then transformed to the subject volume.\nSuch methods tend to provide better segmentations for the subcortical regions, but are generally not very accurate in the cortex, where there is more subject variability. Another commonly used approach is intensity-based classification, where a machine learning technique is trained on voxel-wise intensity and location features (Cocosco et al., 2003; Dadar et al., 2017a; Duda et al., 2001; Fischl et al., 2002; Gonz\u00e1lez-Vill\u00e0 et al., 2016; Makropoulos et al., 2014; Scherrer et al., 2009; Van Leemput et al., 1999) . While these methods generally perform well on data with similar intensity profiles as their training libraries, they are susceptible to inaccuracies in cases where the input images have different intensity distributions (due to scanner or imaging protocol differences, age differences, or in cases of disease) from the images they have been trained on.\nOne of the major challenges when performing tissue classification on aging subjects or individuals with neurodegenerative diseases is the presence of white matter hyperintensities (WMHs). WMHs are areas of increased signal on T2-weighed and FLAIR MRI sequences, which appear as hypointense on T1w images (Dadar et al., 2018b) . These hypointense WMH regions can present with a similar intensity profile to the gray matter in T1w images and can be segmented as GM by tissue classification methods that are solely or highly dependent on image intensities. This is particularly important in neurodegenerative disease populations (e.g. Alzheimer's disease and Parkinson's disease), where WMHs are very common findings (van der Flier et al., 2018) and have been shown to interact with neurodegeneration and contribute to cognitive deficits (Dadar et al., 2018c (Dadar et al., , 2019 and therefore their misclassification as GM may systematically bias the findings of such studies.\nIn this paper, we present BISON (Brain tISsue segmentatiON) pipeline, an intensity and location-based tissue segmentation method that has been trained and validated on Neuromorphometrics dataset, a manually segmented library of 92 subjects, aged from 5 to 96 years old, from 4 different datasets. We further validated the performance of BISON on a subset of the Neuromorphometrics dataset that had test-retest scans available and a human phantom dataset, containing 90 scans acquired across 11 different sites to ensure the robustness and generalizability of the results. This multi-center and multi-scanner training and validation ensure the generalizability of the results to data from different scanners and age ranges. In addition, we make the segmentation pipeline along with the pre-trained classifier publicly available (http://nist.mni.mcgill.ca/?p=2148)."}, {"section_title": "Methods", "text": ""}, {"section_title": "Data", "text": "Data used in this paper was obtained from the Neuromorphometrics database of neuroanatomically labelled MRI brain scans (http://www.neuromorphometrics.com/?page_id=23#demo) (Caviness Jr et al., 1999 Human Phantom Dataset: A second dataset of 90 scans acquired from one subject (healthy male, aged 42-51 years) between years 2008 and 2017 across 11 different sites was used to further assess the generalizability of the segmentations to data from different scanners. Table 2 summarizes the acquisition parameters for each dataset included in Noromorphometrics as well as the range of the parameters in the Human Phantom dataset. "}, {"section_title": "MR Images", "text": ""}, {"section_title": "Manual Labels", "text": "The manually segmented labels were created and edited by highly trained neuroanatomical technicians using Neuromorphometrics software (Worth et al., 2001) . This tool allows the use of intensity histograms, iso-intensity contours and the manual drawing and erasing of borders where necessary, allowing the user to efficiently delineate and label anatomy in 3 dimensions. The segmentation protocol specifications of Neuromorphometrics dataset can be found in http://Neuromorphometrics.com/ParcellationProtocol_2010-04-05.PDF."}, {"section_title": "Preprocessing", "text": "All MRI images were preprocessed using MINC toolkit, publicly available at https://github.com/BIC-MNI/minc-tools through the following steps: (I) denoising (Coupe et al., 2008) , (II) intensity non-uniformity correction (Sled et al., 1998) , and (III) image intensity normalization into range (0-100) using a linear intensity histogram matching algorithm. All T1-weighted images were both linearly and non-linearly registered to the MNI-ICBM152 template (Collins and Evans, 1997; Dadar et al., 2018a) to enable the use of anatomical priors in the segmentation.\nTo assess the test-retest reliability of the proposed method, the two T1-weighted scans for the subjects from the 20 Repeats dataset were co-registered using a 6-parameter rigid body registration. Using this transformation, the manual and automated segmentations of the second repeat were then co-registered to the first repeat for each subject."}, {"section_title": "Tissue Segmentation", "text": "For a given voxel with intensity value I from image T at location (x, y, z), the following set of intensity and location features are used to train a Random Forests classifier (Breiman, 2001) to perform tissue segmentation:\n1. Voxel intensity of the preprocessed native T1-weighted image at the specific voxel location; i.e. T(x, y, z).\n2. The voxel intensity of the brain template for the specific voxel location; i.e. MNI (x, y, z) . To achieve this, the MNI-ICBM152 average template was nonlinearly registered to the native T1-weighted image (using the linear + nonlinear transformations).\n3. Three features representing the tissue probability of the atlas for each tissue type at the specific voxel location; i.e. PGM (x, y, z) , PWM(x, y, z) , PCSF(x, y, z) . To achieve this, the probabilistic gray matter (GM), white matter ( The Scikit-learn Python library implementation of the Random Forest classifier with 100 estimators was used (Pedregosa et al., 2011) . Training and segmentations were performed in the native space of the T1-weighted images, to avoid any blurring caused by resampling of the images that might reduce the contrast at the tissue borders.\nA set of 72 subjects from ADNI 30 (N=29), CANDI 13 (N=13), and OASIS 30 (N=30) were used to train the random forests classifier. Ten-fold cross validation across subjects was used to train and validate the performance of the classifier; i.e. no voxels from the subjects used for validation were used in the training stage. To avoid any overfitting caused by using multiple scans from the same subject, neither the repeat scan from the ADNI 30 subject or any of the data from 20 Repeats dataset were used in the training library. This enabled us to use the 20 Repeat dataset as a held-out validation dataset.\nDice Kappa similarity index (Dice, 1945) and volumetric correlations were used to compare the agreement between manual and automatic segmentations."}, {"section_title": "Comparison with ANTs Atropos", "text": "The results of the proposed method were also compared against ANTs Atropos, an ITK-based open source multi-class brain segmentation technique distributed with (ANTs http://www.picsl.upenn.edu/ANTs). Atropos performs tissue classification within a Bayesian framework by modeling the class intensities based on either parametric or non-parametric finite mixtures (Avants et al., 2011) . Atropos incorporates the template-based tissue probability maps as prior information in the form of Markov Random Fields (MRF). Based on Atropos requirements, the preprocessed T1-weighted images were linearly registered to the MNI-ICBM152 template. Using the nonlinear transformations, the MNI-ICBM152 tissue probability maps were also registered to these images to be used as MRF tissue priors.\nAtropos was then run with default parameters to segment 3 classes on all Neuromorphometrics scans. Using the linear transformations, all the automated Atropos segmentations were then transformed back to the native space of the T1-weighted images and were compared against manual segmentations and BISON. To ensure that this resampling does not unfairly misrepresent Atropos performance, the Dice Kappas for Atropos were also calculated without this resampling step."}, {"section_title": "Data and Code Availability Statement", "text": "The full script for the BISON segmentation pipeline along with the random forest classifier pre-trained on the Neuromorphometrics dataset is publicly available at (http://nist.mni.mcgill.ca/?p=2148)."}, {"section_title": "Results", "text": ""}, {"section_title": "Cross Validation Performance", "text": "The performance of BISON was first validated through 10-fold cross validation. All voxels within the manually segmented masks (i.e. all voxels labeled as GM, WM, or CSF by the raters) of the subjects were classified and used for validation. Figure 1 shows the boxplot of the Dice Kappa for each tissue and each dataset, for BISON and Atropos. The overall correlation between manual and automatic volumes was rGM = 0.95, pGM <0.0001, rWM = 0.89, pWM <0.0001, and rCSF = 0.97, pCSF <0.0001 for the proposed method, and rGM = 0.87, pGM <0.0001, rWM = 0.89, pWM <0.0001, and rCSF = 0.70, pCSF <0.0001 for ANTs Atropos. Figure 2 shows the volumetric correspondence between the manual and automatic volumes. Figure 4 shows the test-retest boxplots of the Dice kappa values for each tissue for both for the manually segmented labels and the automatically segmented results. When comparing to manual labels of the test-retest (R1 and R2) data, the average Dice Kappa value for BISON was \u03baGM = 0.86 \u00b1 0.02, \u03baWM = 0.82 \u00b1 0.02, \u03baCSF = 0.58 \u00b1 0.09 for the first scan (R1), and \u03baGM = 0.86 \u00b1 0.01, \u03baWM = 0.83 \u00b1 0.02, \u03baCSF = 0.58 \u00b1 0.08 for the second scan (R2). In comparison, Atropos obtained mean Dice Kappas of \u03baGM = 0.77 \u00b1 0.03, \u03baWM = 0.87 \u00b1 0.01, \u03baCSF = 0.38 \u00b1 0.12 for the first scan, and \u03baGM = 0.78 \u00b1 0.03, \u03baWM = 0.87 \u00b1 0.02, \u03baCSF = 0.37 \u00b1 0.12 for the second scan. All the differences are statistically significant (paired t-test, p<0.0001)."}, {"section_title": "Test-Retest Performance", "text": "Consistency (or reproducibility) was estimated by comparing the segmentations of test data to the retest data. For the manual segmentations, this gives the inter-rater reliability. The average test-retest Dice Kappa values were \u03baGM = 0.92 \u00b1 0.01, \u03baWM = 0.91 \u00b1 0.01, \u03baCSF = 0.74 \u00b1 0.03 for the manual segmentations; \u03baGM = 0.94 \u00b1 0.006, \u03baWM = 0.92 \u00b1 0.006, \u03baCSF = 0.77 \u00b1 0.11 for the proposed method; and \u03baGM = 0.87 \u00b1 0.001, \u03baWM = 0.92 \u00b1 0.001, \u03baCSF = 0.79 \u00b1 0.10 for ANTs Atropos. The differences between Atropos and BISON were statistically significant for GM (paired t-test, p<0.0001), but not for WM and CSF. Figure 5 shows the manual and automated segmentation results for both repeats for one subject. Overall, Atropos tends to over-segment CSF, and has failed to detect the putamen and thalamus in some slices, where the contrast between GM and WM is relatively low (e.g. row 3). "}, {"section_title": "Generalizability", "text": "In order to assess the consistency of the segmentations on data from different scanners, we segmented 90 T1w MRI scans obtained across 10 years from one subject. Figure 6 shows "}, {"section_title": "Tissue Segmentation in Presence of Vascular Pathology", "text": "To compare the performance of BISON with other commonly used tissue classification pipelines in presence of vascular pathology, we assessed the subjects with high loads of WMHs in the Neuromorphmetrics dataset. 16 subjects with moderate to severe levels of WMHs were identified based on visual assessment. T1w images of these subjects were also segmented by SPM12 (Penny et al., 2011) , and FAST from FSL (Zhang et al., 2001) , in addition to Atropos and BISON. Visual qualitative assessment of the segmentation results showed that while BISON was able to successfully detect most of the WMHs as WM, Atropos and FAST segmented them as GM. SPM12 segmented most of the WMHs as WM, however, the presence of WMHs led to gross under-segmentation of the GM (and a corresponding over-segmentation of WM). Figure 9 shows axial slices covering the brain of one subject with WMHs. The WMH regions are shown with red arrows. Table 3 shows the Kappa values for GM, WM, and CSF for this subject as well as the average values for all 16 subjects for each method.\nT1w Image Manual Labels Atropos Labels BISON Labels FAST Labels SPM12 Labels Fig. 9 . Axial slices covering the brain comparing manual segmentations and automatic segmentations from Atropos, BISON, FAST, and SPM12 for a subject with WMHs. WMH regions are indicated by red arrows.\nWMH= White Matter Hyperintensities. "}, {"section_title": "Discussion", "text": "In this paper, we presented a robust pipeline for tissue segmentation and validated its performance in a multi-cohort and multi-scanner scanner dataset of subjects with different age ranges. The proposed method uses a set of intensity and spatial probability features as well as a Random Forest classifier to perform tissue classification. We quantitatively compared the performance of the proposed technique against ANTs Atropos in Neuromorphometrics and Human Phantom datasets, both of which include multi-center and multi-scanner images. We also compared the performance of BISON in presence of WMHs with Atropos, SPM12, and FAST from FSL; three frequently used publicly available tissue classification methods.\nTraining and validation of the proposed method on multi-center and multi-scanner data ensures its generalizability to new data, since automated methods that are trained based on single scanner datasets generally tend to over-specialize on the characteristics of that specific dataset (e.g. scanner model, acquisition sequence, population under study) and perform worse when applied to data from other scanners or populations (Dadar et al., 2017b) . This is even more true when the automated methods are trained and validated only against synthetically generated images. Our previous experience has shown that including multi-scanner datasets in the training library can increase the generalizability of the segmentation method (Dadar et al., 2017a) .\nANTs Atropos Dice Kappa values were lower than the original results reported in the paper (\u03baGM = 0.95, \u03baWM = 0.96, and \u03baCSF = 0.94), however, those results were developed and validated based on synthetic data and automatically generated labels (BrainWeb 20-subject dataset: https://brainweb.bic.mni.mcgill.ca/brainweb/anatomic_normal_20.html) of normal young brains generated by an MRI simulator (Aubert-Broche et al., 2006) , which is a much less challenging problem, and also not affected by inter-rater and intra-rater variability caused by manual segmentations (Avants et al., 2011) . To ensure that the lower performance was not caused by any differences in our application of Atropos, we applied Atropos to the BrainWeb dataset as well as the example provided by ANTs and were able to obtain similar results.\nAtropos tended to segment CSF more generously in subjects that had lower CSF volumes (Figures 2, 3) , and under-segment them in subjects with large levels of CSF. The volumetric comparisons ( Figure 2) An important concern when using a segmentation tool in aging and diseased populations is the presence of vascular pathology. WMHs of presumed vascular origins are very common findings in such cohorts (Wardlaw et al., 2015) , and can be present in as high as 75% of the for WM, and 0.22 for CSF by Greenspan et al. (Greenspan et al., 2006) . This lower performance on real scans (compared to the synthetic data on which most methods are generally trained) is likely due to the added complexities caused by the heterogeneity in the real data; such as scanner or acquisition protocol differences, population differences, presence of pathology, and the inter-rater and intra-rater variabilities in the manually generated labels. In our experiments with the 20-Repeats dataset, the average test-retest Dice\nKappa values were \u03baGM = 0.92 \u00b1 0.01, \u03baWM = 0.91 \u00b1 0.01, \u03baCSF = 0.74 \u00b1 0.03 for the manual segmentations, representing the level of variability in the manual segmentations that will inevitably lead to lower reported performances when automatic methods are compared against manual labels.\nSince Neuromorphometrics dataset only includes T1-weighted images, the proposed method was trained and validated to segment tissue classes using only T1-weighted images.\nHowever, the pipeline has been developed to be able to handle (and the open-source software handles) any combination of other input sequences such as T2-weighted, PD-weighted and FLAIR images in addition to the T1-weighted images and can be retrained to segment other structures as well if a library manual labels is provided. The option of using additional FLAIR or T2-weighted images can be particularly useful in improving accuracies in presence of pathologies such as WMHs, tumors, stroke, etc.\nAccurate and robust tissue classification from T1-weighted MR images is critical to many image processing and clinical applications. Due to the high variability of the tissue intensity profiles across different populations, image acquisition parameters, scanner models, manual segmentation protocols as well as rater variability, a tissue segmentation method that can provide robust classifications in different datasets is highly advantageous. Our results suggest that the proposed pipeline can provide accurate and robust tissue segmentations in multicenter and multi-scanner data, making it particularly useful for in analysing large multi-center MRI databases."}]