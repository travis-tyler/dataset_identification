[{"section_title": "Introduction", "text": "[2] The tropical Pacific plays a central role in the global climate system [Bjerknes, 1966], and is a place that both oceanographers and atmospheric scientists agree that the ocean affects climate. The role of ocean dynamics in controlling the variations between El Ni\u00f1o events is not yet completely understood [Kirtman and Schopf, 1998;Fedorov et al., 2003;MacMynowski and Tziperman, 2008] and a dynamically consistent hindcast for the tropical Pacific would provide a testbed for studying the main features that control this process [Galanti et al., 2002]. An accurate description of the time-evolving state of the tropical Pacific ocean is a key step toward understanding these events and better studying the tropical currents and their interactions. [3] The circulation of the tropical Pacific has been studied extensively in recent years using both observations and numerical models. However, to date most of these studies were limited by the small amount of available data [Durand and Delcroix, 2000;Lagerloef et al., 1999;Vialard et al., 2001]. On the other hand, numerical ocean models provide a crude approximation of reality because of the many sources of uncertainties in the model. It is now recognized that data assimilation, which optimally combines the disparate data types and ocean models, provides the best way to obtain an accurate and dynamically coherent four-dimensional picture of the state of the tropical Pacific Ocean [Wunsch, 1996;Robinson and Lermusiaux, 2001;Bennett, 2002]. In essence, the observations guide the model toward a realistic trajectory, while the model provides a spatiotemporal dynamics interpolation for the observations. [4] High-resolution tropical Pacific models require significant computing resources because of the very large basin. Consequently, previous assimilation studies in the tropical Pacific set restrictions on the model (e.g., limited resolution or simplified dynamics) and/or on the assimilation scheme to reduce computational burdens, and did not include all data sets in their system. Three-dimensional data assimilation techniques were first implemented, based on optimal interpolation (OI) [e.g., Giese and Carton, 1999] or the three-dimensional variational (3DVAR) methods [e.g., Tang et al., 2004]. These methods provide a static analysis of the system state using observations over a given time, without enforcing dynamical constraints in the time dimension. At present, most of the advanced assimilation schemes are based on the adjoint method or on the Kalman filter [Wunsch, 1996]. For instance, Bonekamp et al. [2001] used the adjoint method to adjust the model wind stress over the tropical Pacific while constraining the model to pseudotemperature data profiles in a twin experiments approach. Weaver et al. [2003] successfully tested an incremental approach of the adjoint method with a primitive equation model while assimilating temperature profiles and adjusting initial conditions. Recently, Bennett et al. [2006] used the representer method, which solves the dual formulation of the adjoint problem, to assimilate Tropical Atmosphere and Ocean (TAO) data into an intermediate coupled oceanatmosphere model. Because a full implementation of the Kalman filter is not possible in practice, simplified Kalman filters with different degrees of approximations were also used to assimilate altimetric data and TAO data in thetropical Pacific [e.g., Cane et al., 1996;Hoteit et al., 2002Hoteit et al., , 2003]. [5] All previous assimilation studies in the tropical Pacific used a restricted set of observations or relatively low resolutions to reduce computational burdens. Whether an eddy-permitting ocean general circulation model of the tropical Pacific can dynamically fit available observations within error bars remains an open question. Several studies [e.g., Bennett, 2002;Bennett et al., 2006] have addressed this question using assimilation in the tropical Pacific and found that even using only monthly averaged TAO current meter data over a few months, the ocean model did not fit the observations within (admittedly strict) error bars. The eddy-permitting adjoint-based assimilation system described here is based on the estimating the circulation and climate of the ocean (ECCO) assimilation system [Stammer et al., 2002]. It uses the Massachusetts Institute of Technology general circulation model (MITgcm) [Marshall et al., 1997] and its adjoint to dynamically merge most available observations of the tropical Pacific. It differs from previous ECCO work in that it resolves the energetic eddy field at (1/3\u00b0horizontal resolution and 50 vertical layers in the region (with the associated adjoint difficulties), it assimilates data at daily frequency (instead of monthly), it adjusts open boundaries, and it enforces smoothness in the final solution in space and time. The effort aims at producing optimized ocean states and forcing fields for the tropical Pacific Ocean which are consistent with the model dynamics. Such a framework is expected to provide a unique tool to understand the variability of the tropical Pacific in greater detail than has been possible before. Optimized states can be, for instance, used to explore midlatitude influences on the tropics, examine El Ni\u00f1o-Southern Oscillation (ENSO) variability through the years, and help exploring oceanic limitations on predictability of ENSO events [Lee et al., 2000;Galanti et al., 2002]. [6] In previous work, the MITgcm tropical Pacific model was integrated using a variety of initial conditions, forcing sets and horizontal and vertical resolutions [Hoteit et al., 2008]. Comparisons with different data sets have shown promising model/data agreement at 1/3\u00b0horizontal resolution without assimilation, suggesting that this configuration was sufficiently capable to be used for data assimilation. In addition, Hoteit et al. [2005] described the technical features of the assimilation system, including the challenges of the adjoint method in a nonlinear model. Nonlinearities can lead to strong and varied sensitivities to controls, as in the Lorenz model [Lea et al., 2002;K\u00f6hl and Willebrand, 2002]. Strong sensitivities cause poor conditioning and may be a symptom of nonlinearity, meaning multiple solutions. This problem was avoided by integrating a more viscous and diffusive adjoint model backward in time. Assimilation experiments were successfully conducted in which initial conditions, surface atmospheric forcing, and fields at open boundaries were adjusted to fit a tropical Pacific model to the World Ocean Atlas 2001 climatology (WOA01) of monthly mean temperature and salinity [Conkright et al., 2002], the Reynolds monthly sea surface temperature [Reynolds and Smith, 1994] analysis, and along-track TOPEX/POSEIDON altimeter data. [7] The vertical and horizontal resolution used in the present tropical Pacific assimilation system is meant to be sufficient to reproduce the observed momentum balance on the equator. The fit included most of the observational data sets, in comparison to earlier studies, which have used more limited subsets of the observations. The observations were further used with relatively high time resolution, 1 -5 days depending on the data set. The system produces an estimate of the state of the tropical Pacific for the year 2000 that is meant to be useful for analysis. This is relatively a short assimilation window to study the circulation of the tropical Pacific, but is the first effort to dynamically fit an eddypermitting ocean general circulation model of the tropical Pacific to a complete multivariate data set over such a long assimilation window. The year 2000 was chosen as a ''typical'' cold year, as opposed to strong cold events or warm events, with fair coverage of data and available ECCO global state estimates for nesting. The assimilation solution obeys the model dynamics and fits the multivariate data sets within reasonable error bounds. The dynamical balances of the solution on and off the equator are studied and are in line with previous studies [Qiao and Weisberg, 1997;Blanke and Raynaud, 1997;Bonjean and Lagerloef, 2002]. The limitations of the solution due to the poor controllability of intrinsic variability such as tropical instability waves (TIWs) are also discussed. The fit to smallscale surface temperature and height variability may introduce some unrealistic features into the control fields, particularly in the wind forcing. The estimated wind fields are smoothed in offline experiments, following a simple version of ensemble-based uncertainty analysis introduced here in the context of 4DVAR. This reduces the structure of the controls and reevaluates the fit to the observations (i.e., the cost function). In addition, the controls from the 1/3\u00b0s olution are used on a 1/6\u00b0version of the model with better-resolved topography with little change in the solution, suggesting that the time-evolving model state and the adjusted controls should be useful for analysis or to supply the forcing, initial, and boundary conditions for runs of other models. Similar findings were reported by Gebbie et al. [2006] and Lea et al. [2006]. [8] This paper is organized as follows. Section 2 describes the assimilation system, including the model and the assimilation method. The main characteristics of the assimilated data sets are briefly reviewed in section 3. Section 4 describes the specified uncertainties for each of the observation types and the control variables. Smoothness and dynamical constraints on the control variables are also discussed. The assimilation system is evaluated and its solution is analyzed in section 5 with concluding remarks in section 6."}, {"section_title": "Description of the Assimilation System", "text": ""}, {"section_title": "Model", "text": "[9] The MITgcm [Marshall et al., 1997] is based on the primitive (Navier-Stokes) equations on a sphere under the Boussinesq approximation. It is operated in hydrostatic mode with an implicit free surface. The equations are written in z coordinates and discretized using the centered second-order finite differences approximation in a staggered ''Arakawa C-grid.'' The numerical code is designed to enable computer generation of its adjoint using the automatic differentiation tool TAF [Giering and Kaminski, 1998]. Examples of the use of TAF with the MITgcm are described by Marotzke et al. [1999] and Heimbach et al. [2005]. Stammer et al. [2002] produced the first 2\u00b0\u00c2 2\u00b0g lobal state estimation using the ECCO assimilation system. [10] The configuration of the tropical Pacific model is described by Hoteit et al. [2008]. The domain covers the tropical Pacific basin extending from 26\u00b0S to 26\u00b0N and from 104\u00b0E to 68\u00b0W. The maximum bottom depth is at 6000 m and the bathymetry is extracted from the global topography prepared by Smith and Sandwell [1997]. The model is integrated on a 1/3\u00b0\u00c2 1/3\u00b0Mercator grid, with 50 vertical levels. The levels are every 10 m from the surface to 250 m in depth, with spacing gradually increasing below to a maximum of 300 m. No-slip conditions are imposed at the lateral boundaries while bottom friction is quadratic with a drag coefficient equal to 0.002. The subgrid-scale physics is approximated by a tracer diffusive operator of the second order in the vertical and by the K profile parameterization (KPP) in the surface mixed layer [Large et al., 1994]. Vertical diffusivity and viscosity are parameterized by Laplacian mixing with values 1 \u00c2 10 \u00c06 m 2 /s and 1 \u00c2 10 \u00c04 m 2 /s, respectively. In the horizontal, diffusive and viscous operators are of second and fourth order, respectively, with coefficients 5 \u00c2 10 2 m 2 /s and 4 \u00c2 10 11 m 4 /s. No other parameterization of eddy mixing was used. [11] Open boundaries (OB) are set at 26\u00b0S and 26\u00b0N, as well as at four straits in the Indonesian throughflow. Temperature and salinity and the horizontal components of the velocity are specified on the boundary. The model is a one-way nesting in the 1\u00b0global ECCO solution (but the control of the OB changes that, see section 2.3). Timeinterpolated monthly mean values obtained from the 1\u00b0E CCO global state estimate [K\u00f6hl et al., 2007] were prescribed at the grid points just outside the OB and the model solution is relaxed to these values within a buffer zone of 3\u00b0over timescales varying linearly from 1 day at the boundary and 40 days at the edge of the zone. The normal velocity fields across the open boundaries have been further corrected on a monthly basis to enforce the same transport at 26\u00b0N and 26\u00b0S, as in the global ECCO solution, and to exactly balance the volume flux into the domain by the transport out in the Indonesian throughflow, as described by Hoteit et al. [2008]. Surface fluxes of momentum, heat, and freshwater are prescribed at the ocean-atmosphere interface. Atmospheric forcing fields were obtained from the National Centers for Environmental Prediction (NCEP)/National Center for Atmospheric Research (NCAR) reanalysis project [Kalnay et al., 1996]. This data set is available on a 1\u00b0\u00c2 1\u00b0g lobal grid. It contains twice-daily wind stress vectors and daily net heat flux, net short-wave radiation and water flux at the sea surface. [12] The model was integrated over a 9 year period from 1992 to 2001 with a variety of forcing and resolutions [Hoteit et al., 2008]. At 1/3\u00b0resolution, and depending on the forcing, the model cold tongue was in rough agreement with SST observations and it showed a realistic equatorial undercurrent (EUC), north equatorial counter current (NECC), and south equatorial current (SEC). It reproduced many features of the observed current and temperature variability during the 9 year period, including El Ni\u00f1o events and TIW variability. On the basis of model/data comparisons, it was judged sufficient for assimilation experiments."}, {"section_title": "Assimilation Method", "text": "[13] This section presents a brief summary of the assimilation method. The reader is referred to the paper by Hoteit et al. [2005] for a detailed description and discussion of the method. [14] The assimilation method is based on the so-called strong constraint formulation of the adjoint method. This problem is posed as the minimization of a cost function measuring the difference between the model solution and data over a specified period of time and constrained by the nonlinear model equations subject to a set of control variables. The gradient of the cost function, which is obtained by integrating the adjoint of the tangent linear model backward in time [Le Dimet and Talagrand, 1986], is then used to determine descent directions toward the minimum in an iterative procedure. The cost function is a weighted sum of quadratic norms of model-data misfit (J data ) and changes to the control variables (J control ) between the initial time (t 0 ) and the final time (t f ) of the assimilation window. If the weights are chosen as the inverse of the covariances, by analogy to the statistical estimation problem, the cost function can be written as HOTEIT ET AL.: ASSIMILATION IN THE TROPICAL PACIFIC where x(t) is the model state vector and u b (t) is a first guess (or ''background'' estimate) of the unknown control vector u(t) at time t. Here u represents errors in the model parameters, the external forcing fields, and the internal model physics, which fully control the evolution of the model state. The vector y(t) contains all observations available at time t and is related to the model state through the observation operator H t plus some observational errors. Note that R(t) and Q(t) are weight matrices representing the covariance of observation errors and control (background) errors, respectively. In the formulation of J, it is implicitly assumed that the errors in the control vector are uncorrelated with the observation errors and that both errors are mutually uncorrelated in time."}, {"section_title": "Control Variables", "text": "[15] The control vector u consists of the model initial conditions x 0 , all atmospheric forcing fluxes f(t), and temperature, salinity, and horizontal velocities at the open boundaries x ob (t). This increases the controllability of the regional model over previous adjoint-based assimilation experiments in the tropical Pacific which restricted their control to the initial conditions as in the work of Luong et al. [1998] and Weaver et al. [2003], or to the wind-forcing as in the work of Bonekamp et al. [2001]. Initial velocities were not adjusted because these do not have a significant role in controlling the model behavior over long enough assimilation windows. Their impact is expected to fade quickly after couple of weeks as the velocity would quickly adjust to the temperature and salinity fields through the geostrophic balance. The term representing the constraints on the control variables in J has the form where Q 0 , Q f , and Q ob represent the associated error covariances for initial conditions, forcing, and boundary conditions, respectively. [16] The model sea surface height (SSH) is sensitive to the barotropic component of the normal velocities at the OB. This makes the estimation of velocities at the OB very poorly conditioned when simultaneously adjusted with other control variables. To avoid large contrasts in sensitivities, which can severely slow gradient descent optimization [Zupanski, 1996], decreased weighting was applied to the barotropic component of the normal velocities at the OB. This was achieved after a decomposition of the normal velocity into barotropic-baroclinic modes as described by Hoteit et al. [2005]. In the MITgcm, the boundary conditions require the complete specification of the ocean state, temperature (T), salinity (S), and zonal (U) and meridional (V) velocities. Accordingly, four separate penalty terms were added to the cost function, one for each state variable [Zhang and Marotzke, 1999]. The cost function term for the adjustment of the open boundaries is then x U ob (t), and x V ob (t) represent the temperature, salinity, and zonal and meridional velocities (the bardenotes the barotropic component and~denotes the baroclinic components) at the open boundaries, respectively. [17] Uncertainties in the internal model physics were not represented in the control vector, so that regions out of reach of the surface forcing and open boundary controls are determined by initial conditions alone. This may lead to uncontrollable misfits, as discussed above, such as model drifts at depths where the controls do not penetrate during short-time integrations. Recently, Stammer [2005] and Ferreira et al. [2005] introduced errors in the internal physics of the ECCO MITgcm by adding control of the model mixing parameters, which represent some of the least-understood physical approximations in the model. This is far from the complete control used by Bennett et al. [2006], but provides an efficient way to include some model errors. [ 18] No errors in the model dynamics were included in the assimilation experiments reported here, but the control variables were able to reduce the cost function and no large uncontrollable misfits were seen over 1 year of integration. This does not mean that model errors are not significant, and the control adjustments may include components that are compensating for model errors. Mixing parameter adjustments will be included in future experiments, although each added set of control parameters must be evaluated by the reduction in the cost function that it provides, and the data coverage and duration of the present experiments are not yet large enough to force the adoption of model error terms in the control vector."}, {"section_title": "Sensitivity Growth", "text": "[19] The forward model runs exhibit strongly growing flow instabilities in energetic regions with low potential vorticity gradient. The growth of these perturbations is limited by nonlinearities once they reach finite size, meaning that the high linear growth rates do not apply for long time periods [Pires et al., 1996;Weaver et al., 2003;Hoteit et al., 2005]. This poses a technical problem for adjointbased assimilation, which depends on the linearized sensitivities to adjust the controls. These strong linear sensitivities, which have been associated with rapidly growing nonlinear perturbations (''intrinsic variability'') that are not easily predictable or controllable by the system, indicate the presence of many small-amplitude but tightly packed extrema [K\u00f6hl and Willebrand, 2002]. This may prevent any significant reduction in the cost function when using a gradientbased descent optimization algorithm, as these algorithms are only designed to converge toward local minima. Relative to the forward model runs, increased viscosity and diffusivity terms are used in the adjoint model runs to avoid large sensitivities related to the flow instabilities present in the high-resolution model. As argued by Hoteit et al. [2005], increased dissipation reduces the growth rates of the smallscale instabilities and thus reduces the largest sensitivities seen in long backward integrations while having less effect on the larger scales. This is similar to performing the optimization in a smooth subspace, which means loss of accuracy due to the omission of strongly nonlinear variations, generally related to small-scale phenomena. This is necessary, however, in order to optimize the cost function over assimilation periods longer than about a month. Likewise, KPP was turned off in the adjoint run to avoid similar growing sensitivities [K\u00f6hl et al., 2007]."}, {"section_title": "Assimilated Observations", "text": "[20] The tropical Pacific Ocean has a relatively large number of varied observations which hold the promise of information useful for improving the forcing and boundary conditions of the tropical Pacific model. Most available data sets in the tropical Pacific, including the one used in the ECCO 1\u00b0global system and velocities data provided by the TAO array and drifters, were assimilated into the system. Prior and post-assimilation quality controls were applied to all the observational data sets to remove spurious data."}, {"section_title": "Satellite Observations", "text": "[21] Satellite observations include daily along-track sea surface height (SSH) data provided by the TOPEX/Poseidon (T/P) mission and sea surface temperature (SST) measurements from the TMI observation system (TRMM -Tropical Rainfall Measuring Mission satellite -Microwave Imager). Daily T/P along-track data were obtained from NASA's PO-DAAC at the Jet Propulsion Laboratory (JPL) and processed as described by Stammer and Wunsch [1994] and averaged to the 1/3\u00b0model grid. The SST from microwave retrievals can be obtained in the presence of clouds. The TMI mission provides data on a 1/4\u00b0Mercator grid starting from January 1998 [Wentz et al., 2000]. In this case weekly averaged TMI data are resampled from the 1/4\u00b0grid to the nearest model grid point. To isolate errors associated with uncertainties in the geoid, the mean and time-varying components of the SSH data were fit separately. The 1 year T/P along-track mean SSH was interpolated to the model grid using Gaussian weights and the Gravity Recovery and Climate Experiment (GRACE) geoid [Tapley et al., 2005] at the grid points was subtracted to yield an estimate of the mean ocean dynamic topography to constrain the mean model SSH during the assimilation. Because of the relatively large expected errors in the geoid estimate for scales smaller than 500 km, this constraint had little effect. The model SSH anomalies with respect to the 1 year mean were separately fit to the along-track T/P anomalies."}, {"section_title": "Profile Data", "text": "[22] Profile data from several archives are assimilated into the model. These include temperature and salinity profiles from Argo profiling floats, conductivity-temperature-depth (CTD), expendable bathythermographs (XBTs), moored buoys, and horizontal velocities from surface drifters [Lagerloef et al., 1999] and the TOGA-TAO buoy network [McPhaden et al., 1998]. Temperature and salinity profiles were kindly provided by Willis et al. [2004]. They have been compiled from the World Ocean Database 2001 (WOD01) [Conkright et al., 2002] as well as the Global Temperature-Salinity Profile Program (GTSPP), both of which are maintained by the National Oceanographic Data Center (NODC). The WOD01 data set includes data in the latest decades and additional data for the period of WOD94. The GTSPP data supply data lacking in WOD01, including the most recent. The TAO buoy array provides time series of currents along the equator from six upward-looking acoustic Doppler current profilers (ADCP) that measure upper ocean currents between 10 m and 250 m. The standard WOCE-TOGA drifters with drogues at 15 m depth [Yu et al., 1995] provide surface velocities observations over the tropical Pacific. These data sets were quality controlled to remove spurious data, as described by Willis et al. [2004]. This includes checks for duplication, visual inspection, outlier, spike, and instability detection. [23] There is a trade-off between averaging the data before assimilation to cut down on the number of data, versus giving all the data to the assimilation and letting it do its own averaging of redundant data. The latter approach is more satisfying in theory, because an intermediate step of griding and averaging will be less able to distinguish outliers than the eventual assimilation, and bad data averaged into a gridded file will be hard to find and remove. One by-product of averaging is that some of the incompatibility between multiple measurements in the same spot is removed before the assimilation begins, which allows a greater fractional reduction in the cost function and saves iterations. In this case, all in situ data (profiles, drifter velocities, and mooring temperatures and velocities) were averaged (temperature and salinity profiles were median filtered at each depth) over 5 day intervals in 2\u00b0longitude by 1/2\u00b0latitude bins. This filters out some of the variability from unresolved (or uncontrollable) physics, such as internal waves, fine structure, and small eddies. The output values were applied as constraints on 5 day averaged model fields at the center of the bin."}, {"section_title": "Analyzed Data", "text": "[24] Ocean climatologies provide a pre-smoothed analysis of prior observations to constrain the model solution on a regular grid. Model values are not compared directly to the climatologies, instead time and space averages of the model values are compared to the climatologies. Climatologies provide useful information at non-observed locations and enhance smoothness in the final solution. This work used the World Ocean Atlas 2001 climatology (WOA01) of monthly mean T and S [Conkright et al., 2002], the Reynolds monthly SST [Reynolds and Smith, 1994], and the analyzed mean zonal equatorial currents from the paper by Johnson et al. [2002]. The WOA01 climatology is based on historical hydrographic data that are merged and spatially averaged as described by Levitus and Boyer [1994]. The Reynolds optimum interpolation SST analyses are produced on a 1\u00b0g rid using buoy and ship data as well as satellite SST data. The 1\u00b0WOA01 data were vertically interpolated onto the center of the model layers. The WOA01 and Reynolds analyses were used to constrain the monthly averaged model values, also averaged over 1\u00b0regions centered on the 1\u00b0a nalysis grids. Johnson's time-mean velocity analysis of ADCP observations was produced using objective mapping with a Gaussian spatial covariance. Johnson's analysis has been interpolated onto the model grid first horizontally and then vertically using linear interpolation and is compared to the model annual mean velocities. The error covariances and weights for these data are adjusted for the partial dependence of expected misfit at adjacent climatology points (i.e., nondiagonal error covariances), and the expected misfits are set to be large (see below) to allow for interannual variability, because the WOA01 and Johnson averages are long-term, not just for the year 2000."}, {"section_title": "Cost Function for Data", "text": "[25] The satellite observations consisted of time-mean dynamic topography (T/P minus GRACE: SSH T/P\u00c0GRACE ), daily along-track T/P SSH anomalies (SSH 0 T/P (t)), and weekly TMI SST (SST TMI (t)). Profile data were 5 day averaged profiles (Pr 5 (t)) of horizontally binned temperature and salinity from XBTs, CTDs, and profiling floats and horizontal velocities and temperature from drifters and TAO moorings. Analysis products consisted of monthly Reynolds SST (SST Rey (t)), monthly subsurface climatology temperature (T Lev (t)) and salinity (S Lev (t)), and Johnson annual mean zonal velocity U Joh . The model mean SSH (SSH) and daily mean SSH anomalies (SSH 0 (t)) were constrained to the SSH data. The weekly averaged model SST (SST(t)) was constrained to the TMI data. The 5 day averaged model temperature, salinity, and horizontal velocities Y 5d (t) were interpolated to the profile locations and constrained to their corresponding 5 day averaged profiles from observations. Monthly means of the model temperature (T m (t)), salinity (S m (t)), and SST (SST m (t)) were constrained to match the climatological temperature, salinity, and SST. The explicit form of the model-data misfit term in the cost function is All data uncertainty covariance matrices R were diagonal."}, {"section_title": "Error Covariances, Smoothness, and Dynamical Constraints", "text": "[26] The specification of the covariance matrices of the uncertainties on the control variables Q is crucial to the effectiveness of any adjoint-based assimilation system as they affect the size and structure of the adjustments to the control variables. However, there are generally insufficient prior observations in practice to determine these matrices and rough estimates are used instead. These matrices are generally not assumed to be diagonal in order to enforce smoothness in the estimated adjustments [Weaver et al., 2003]. [27] For this analysis, horizontal smoothness is enforced by penalizing the quadratic product of the horizontal Laplacian of the control fields in the cost function normalized by a diagonal weight. Combining the Laplacian penalty term with a diagonal Q penalty on the underlying field approximates weighting the control fields by the inverse of a Gaussian covariance [Bennett, 2002]. A preferred method to penalize the control structure is to define a generating field of the control that has a diagonal covariance matrix but is converted to the actual control by integrating the diffusion equation in time (inverting the Laplacian) as described by Weaver et al. [2003]. Working in the whitened control space has the added benefit of improving the preconditioning of the descent. This has been implemented in the MITgcm and will be used in the future. [28] To set the weights for the Laplacian penalty, the horizontal correlations are approximated as a single Gaussian with horizontal width l, as suggested by Bennett [2002] and recently implemented by Lea et al. [2006]. For the control of temperature and salinity in the initial conditions and at the open boundaries, the width of the Gaussian correlations l was set to 100 km, for velocities at open boundaries l = 50 km, for atmospheric forcing l = 200 km. These are typical midlatitude decorrelation scales to avoid oversmoothing. To implement this expression, the variance of the prior uncertainties s r 2 was estimated for each control variable. [29] For the initial temperature and salinity errors and at the open boundaries, s r 2 were parameterized by a rootmean-square (RMS) 20 m displacement acting on potential temperature and salinity gradients from the WOA01 climatology. Displacements due to a variety of physics should be an important source of misfits between the ocean and the WOA01 products, which were used as first guess (and background) for the assimilation. Displacements and mean gradients were used as a guide, but temperature and salinity variability were not assumed to be correlated as in the balanced formulation of the background covariance matrix of Weaver et al. [2006]. Enforcing balanced controls establishes the multivariate component of the error covariances. This removes undesirable effects during the initialization period caused by unbalanced dynamics in the adjusted initial conditions and will be used in future studies. Instead, following Stammer et al. [2002], penalties on time-mean vertical velocity during the first 3 months of the integration provided a weak balance constraint to encourage geostrophic balance in the initial conditions. The balance constraint on the initial conditions is not expected to have a large effect on the assimilation solution with long assimilation windows, as in the present study, because the influence of the initial conditions fades away in time. [30] The same errors were also used for temperature and salinity at the open boundaries. Because of the lack of accurate climatological fields of velocity, uncertainties for the horizontal velocities at the open boundaries were estimated as a fraction of the standard deviation (over time) of the model variability during the 9 year model runs described by Hoteit et al. [2008]. Error bars for the baroclinic modes of the normal velocities at the boundary were also estimated from the standard deviation of the same modes of the 9-year run velocities. The weight for the barotropic mode was empirically set to a small value as done by Hoteit et al. [2005]. Following Gebbie et al. [2006], deviation from the thermal wind balance on the boundary was penalized in a ''soft constraint'' approach to bring the boundaries closer to geostrophic balance. A net mass flux to match the outer model was added to the adjusted velocities. [31] For the atmospheric forcing, following Stammer et al. [2002], the a priori uncertainties were set as fractions of the local standard deviation (over time) of the NCEP forcing. An upper and lower limit was set for each control variable to limit the estimated uncertainty to be in the range. For example, error profiles from WOA01 data were used as lower bounds for uncertainty in the temperature and salinity fields. The resulting two-dimensional uncertainty fields were spatially filtered to remove small-scale structures. To enable the assimilation to remove large biases from the atmospheric forcing fields, the time mean and the anomalies of these fields were constrained separately in the total cost function and larger errors were assigned for the mean components with the same horizontal smoothing penalties applied as for the anomalies. The expected standard deviations of the time-mean controls were uniform horizontally and were 0.1 N/m 2 for wind stress, 30 W/m 2 for the heat flux, and 1.6 \u00c2 10 \u00c08 m/s (1.4 mm/d) for freshwater flux. [32] The prior uncertainties for the time-varying anomalies of the zonal wind stress and the heat flux controls are plotted in Figure 1 (top). A lower bound of 0.04 N/m 2 was imposed for the wind to keep the uncertainty from getting too small, so the weights for the zonal wind stress are practically constant in the equatorial region. The largest uncertainties on the zonal wind stress are located in the southwestern Pacific in an area of seasonal variations in the wind stress curl, and in a localized area north of the Philippines. Uncertainties specified for the heat flux are also limited to a constant near the equator, but exhibit more variability in the subtropical regions particularly in the northwestern Pacific. Figure 2 (top) plots zonal cross sections (down to 400 m depth) of the estimated uncertainties on the temperature and salinity at the initial time and on the open boundaries. By construction, large uncertainties for the temperature are concentrated near the thermocline. Maximum errors for the salinity are located in two areas: In the eastern Pacific down to approximately 70 m depth associated with the southernmost annual position of the Intertropical Convergence Zone (ITCZ) and in the western Pacific between 75 m and 150 m depth, which is a region of increased salinity variations with depth created by a net freshwater input to the ocean due to the excess of precipitation over evaporation. [33] Vertical correlations for the adjustments of the initial conditions and open boundaries and time correlations for the adjustments of the atmospheric forcing (anomalies) and open boundaries were modeled with an approximate exponential form by adding first derivative penalty terms with diagonal weights to the cost function. Combining first derivative penalties with diagonal variances and a diagonally weighted penalty on the underlying field approximates a covariance with exponential correlations [Bennett, 2002]. Weights for these penalties were estimated from the standard deviations of the vertical derivatives of the 9 year model outputs [Hoteit et al., 2008] for the initial conditions and the time derivatives of the NCEP fields for the atmospheric forcing. The weights for the zonal wind stress and heat flux time derivatives are shown in Figure 1 (bottom). These plots exhibit similar structures to the weights of the forcing fields with the largest uncertainties located in the western subtropics. The numbers are multiplied by a factor to account for the redundancy of the 1/3\u00b0grid and to not overconstrain the forcing. [34] The observation error covariance matrix R for the expected misfits with observations is a sum of estimates of measurement errors, representation errors, and model errors. The definitions of the latter two are murky, but representation errors often refer to unresolved features such as internal waves, fine structure, and small eddies, while model errors refer to dynamical errors such as numerical diffusion and parameterized momentum, heat, and tracer fluxes which are not included in the controls. Although these are state-space errors, they are in principle transformed to data space by the observation operator to become part of R, which should produce complicated off-diagonal terms. [35] In contrast to control fields, on which efficient smoothing operators can be applied because they are complete and regular, enforcing non-diagonal covariances for irregularly spaced observations is more expensive. Gridded products like WOA01 and Reynolds-SST or satellite TMI products can be treated like the control fields. In our system, R is assumed to be spatially uncorrelated so that R is diagonal. In cases where the decorrelation scale of errors is expected to be larger than the data spacing, such as climatology, analyses, and some satellite data such as TMI and SST data, correlation of errors was accounted for by overestimating the diagonal errors for these data sets. This means that the sum of the weights of closely located points would have the equivalent weight of one observation and constrain the average of the data to be near the average of the model. [36] Errors for TOPEX SSH data were estimated from the gridded AVISO (Archiving, Validation and Interpretation of Satellite Oceanographic) SSH data variability with values limited to be between 2.5 cm and 5 cm. Mean GRACE SSH was assimilated with a nominal accuracy of 5 cm to model the uncertainty of small-scale geoid features. Because of the high spatial and temporal resolution of the TMI SST measurements, an observational error of 0.5\u00b0was specified and augmented by a representation and model error was estimated as 50% of the standard deviation of the TMI fields. This relatively large number was used to account for the large number of points and allow small-scale misfits while enforcing agreement at larger scales. In spite of this attempt to reduce the weighting, the TMI misfits dominated the cost function misfits initially. The TOPEX and TMI uncertainties used in the cost function are shown in Figure 2 (bottom). There are four main regions of large expected SSH misfits: On the equator in the cold tongue/Ni\u00f1o3 region, north of the equator in the eastern Pacific, near the east coast of Mindanao, and off the east coast of New Guinea. TMI uncertainties are more localized and are concentrated in the western subtropics and over the cold tongue region. Errors for temperature and salinity profiles were also parameterized Figure 2. (top) Equatorial cross sections of the specified errors for the assimilation of WOA01 temperature and salinity data. These are the same errors used for the adjustments of the temperature and salinity at the initial time and at the open boundaries. (bottom) Specified errors for the assimilation of the TOPEX sea surface height and the TMI sea surface temperature measurements. by a 10 m RMS displacement acting on potential T and S gradients from WOA01. Errors for horizontal velocity data from the TAO array and drifters were estimated as 0.25 times the variance (not including the mean) at each point, depending on the number of points available in a 5 day bin, and limited to a minimum of 5 cm/s and a max of 15 cm/s. The largest values were found within 150 m of the surface, above the depths of the mean zonal velocity maximum in the west, but including the maximum to the east. For climatology, errors for WOA01 data were the same as those used for the control of the initial conditions. Errors for Reynolds SST were set as a fraction of the data standard deviations and errors for the Johnson mean zonal velocities were set as 20% of the total signal to account for interannual variability."}, {"section_title": "Assimilation Experiments in 2000", "text": "[37] Hindcast assimilation experiments were performed over a 1 year period starting from 1 January 2000 to estimate the state of the tropical Pacific ocean for that year. The control variables were the initial conditions, adjustments to the atmospheric forcing fields linearly interpolated over a 2 day interval, and boundary condition adjustments linearly interpolated on a weekly interval. Descent directions toward the minimum of the cost function were iteratively determined using the Quasi-Newton M1QN3 algorithm [Gilbert and Le Mar\u00e9chal, 1989]. The starting point for minimization is used as the background state, so adjustments to the starting guesses are penalized. [38] For spin-up, the model was integrated for 3 months in 1999 between October and December starting from the WOA01 temperature and salinity and using NCEP forcing. The model state at the end of the integration period was used to initialize the reference run and as background and first guess for the initial conditions of the assimilation run. The runs with adjusted controls are compared with the reference run to evaluate the effects of the adjustments. The analysis concentrates on the model state and controls after 135 optimization iterations with M1QN3. The rate of cost function decrease after 135 iterations was relatively small (less than 1% per iteration) and the differences between the model and the observations were reduced to within 1 -2 times the guessed levels of expected misfit for most data types."}, {"section_title": "Sensitivity to the First Guess", "text": "[39] In addition to the main assimilation, several assimilation experiments were launched to study the sensitivity of the system to the starting point of the optimization. Because of the computational cost and the rapidly decreasing rate of cost function reduction, the number of iterations in these experiments was limited to 30. In previous work the system was found to be weakly sensitive to the first guess of the initial conditions, moving toward similar solutions whether starting from NCEP or ECCO ocean fields [Hoteit et al., 2005]. In this paper, the sensitivity to first guess forcing fields was explored through separate assimilation experiments starting from NCEP forcing, from the 1\u00b0ECCO global state estimate, and from QuikScat microwave scatterometer satellite winds and NCEP heat and salt fluxes (QuikScat data were downloaded from the Institute Francais de recherche pour l'exploitation de la Mer (IFREMER) Web site at http://www.ifremer.fr/cersat/en/index.htm). The results of these experiments (not shown) suggest that the assimilation system moves toward similar solutions regardless of the first guess for these control variables. The initial total cost function is smallest when the assimilation starts from the QuikScat forcing, showing that these forcing fields have better skill in the model than NCEP or ECCO, but the difference in cost function disappeared after only a few iterations, even though the estimated forcing fields remained different. In the first guess experiments, when starting from ECCO forcing, 30 iterations of the assimilation removed much of the strong 1\u00b0ECCO adjustments over the NECC and in the western Pacific over the SEC. [40] The optimized net heat flux and net fresh water flux moved only slightly closer during the 30 iteration experiments (not shown). Because of the ambiguity mentioned above, the adjustments to the heat flux were generally less than 10 W/m 2 (small compared with the 30 W/m 2 prior uncertainty for the time mean) whether the optimization started from NCEP or ECCO forcing. Relative to NCEP, similar patterns were obtained from both runs, with less heat over the cold tongue and more heat over the subtropical gyres. However, the heat flux adjustments after 30 iterations were small compared with the adjustments made by the ECCO global optimization."}, {"section_title": "Cost Function Terms", "text": "[41] The optimization starting from NCEP was carried on to 135 iterations. The total cost function as a function of the number of iterations is shown in Figure 3. The curve has been normalized by the total number of observations in the sum over time and space, so a value of 1 would roughly indicate that the solution fits the data within the specified uncertainty. Although the normalized cost function goes below 1, this is merely an indication that some data types had overly generous error bars, so the iteration was not stopped at 1. The decrease in the total cost function is fast during the first few iterations. It slows rapidly with iteration count. The improvements made to the data cost function terms after roughly the 100th iteration are rather small and tend to be balanced by the increase of the cost function terms for the control variables. Cost function decrease can slow for reasons besides the decrease of the data misfit gradients and the rise of the control penalty gradients. The most likely problems are due to preconditioning and nonlinearity. Overall, after 135 iterations, the total cost function is reduced by more than 75% compared to the NCEP reference run without assimilation, but only about 50% compared to QuikScat (not shown). [42] Because it is difficult to know a priori what misfits are expected between the observations and model, error levels were rationalized in a variety of ways as discussed above. The accuracy of the estimates varied, and the difficulty of specifying good data error covariance matrices has been discussed above. The final misfit levels achieved by the assimilation give feedback on the prior assumptions. This means that it is difficult to use the Chi-squared test to judge the output, because the prior standard deviations are somewhat arbitrary. A larger problem is the difficulty of enforcing non-diagonal data error covariance matrices in the irregularly spaced observations, and the approximations used to set the prior errors to account for correlated errors. In addition, the observed distributions are not expected to be exactly Gaussian, so the distribution of the normalized residuals is nearly as important as the standard deviation as a criterion for modifying or rejecting the prior hypothesis. [43] The individual cost terms decrease generally at the same rate as the combined cost function, although the convergence of the climatological salinity term is slower than that of most other data terms and the TAO velocity terms change only slightly with iteration count. Figure 4 only shows the cost function terms at the start, middle, and end of the iterations, in order to show all the observations. Figure 4. Individual cost contribution for each data term in the total cost function as obtained from the reference run and from assimilation runs after 75 and 135 iterations. In the x axis, TOPEX refers to TOPEX SSH anomalies data, GRACE to GRACE SSH mean, LEV-T and LEV-S to Levitus temperature and salinity climatology, TMI to TMI SST data, REY to Reynolds SST analysis, T-INS and S-INS to in situ temperature and salinity data (including profiles from floats, XBTs, Argo, and TAO), JOHNS to Johnson analysis, and U-INS and V-INS to zonal and meridional velocities from TAO and drifters. The absolute cost function levels are shown, so data quantity influences the size of the terms and the influence on the solution. The size of the decrease is not by itself an indication of the quality of the solution, but gives an idea of the importance of each data type to the optimization, and the progress of the algorithm. Starting from a relatively good solution means that further cost function decrease is hard to come by, and the TAO velocity data in particular reflect this. [44] Figure 5 shows the cost of the controls and balance constraints at the same three iterations. Figure 5 shows that most of the adjustments were applied to the wind stress (TAUU and TAUV), with the initial conditions (TEMP0 and SALT0) also changing significantly. The wind stress adjustments grow rapidly to a large size before the smoothness penalties affect the iteration, and then decrease, while the other terms grow steadily. The heat flux (HFLUX) and salt flux (SFLUX) change relatively little. This is thought to be due to the slow response to these forcing terms and the ambiguity with the initial conditions as mentioned above. The open boundaries on the north, south, and west (OBCSN, OBCSS, OBCSW) have small contributions to the control penalty in the cost function, at least in part due to the relatively small number of points involved because of the larger time spacing. The vertical velocity constraint (WDRIF in Figure 5) grows with increasing adjustments and then reduces as the flow balances, and the penalty for ageostrophy on the boundaries decreases uniformly. [45] The temporal and spatial distributions of cost function terms for selected data types are plotted in Figures 6  and 7. The curves have been normalized by the number of observations in the sum over time and/or space, so a value of 1 would roughly indicate that the solution fits the data within the specified uncertainties. As mentioned earlier, quantitative chi-squared consistency [Bennett, 2002] is not expected in this case. [46] The monthly averaged cost function for WOA01 temperature is small in January for the reference solution, because the reference model used WOA01 as an initial condition. The misfit increases over time as the model monthly means for the year 2000 differ from the long-term monthly means in WOA01. Although the weights are small for the WOA01 climatology, the final control adjustments reduce the RMS misfit with WOA01 over the entire period. The RMS model-data misfit is small compared with the size of the expected interannual variability in both reference and adjusted runs. This reflects the weakness of this constraint, which was not meant to override any observations. The daily along-track SSH cost term has a ''U'' shape and again the assimilation is also able to control and improve its skill over the entire assimilation period, although the normalized misfit variance is greater than 1 for the SSH. [47] The contributions to the cost function in 25\u00b0\u00c2 8\u00b0boxes summed over the entire interval and all depths are shown in Figure 6 for the salinity term for the starting and ending solutions. The salinity model/data misfit is Figure 5. Individual cost contribution for each control term in the total cost function as obtained from the reference run and assimilation runs after 75 and 135 iterations. In the x axis, TEMP0 and SALT0 refer to the initial temperature and salinity fields, WDRIF to the vertical velocity constraint, TAUU and TAUV to the zonal and meridional wind stress, HFLUX and SFLUX to the heat and salinity fluxes, OBCS symbols to the constraints on each open boundary, and AGEOS to the thermal wind balance on the boundary constraint. Figure 6. Spatial distribution of the cost contribution averaged over 25\u00b0\u00c2 8\u00b0boxes for (top) the WOA01 salinity misfit, (middle) TMI SST misfit, and (bottom) TOPEX SSH anomalies misfit from (left) the reference run and (right) the assimilation run after 135 iterations. All costs were normalized by the number of observations in the sum, so they represent misfits normalized by the assumed observational errors. The plot scale was limited to 3, so higher values are saturated. Figure 7. Evolution in time of the cost contribution from (left) the WOA01 temperature misfit (summed month by month) and (right) the TOPEX SSH anomaly misfit (summed day by day) from the reference run, the assimilation run after 75 iterations, and after 135 iterations. All costs were normalized by the number of observations in the sum, so they represent misfits normalized by the assumed observational errors. reduced over the entire domain, although the starting misfit values are not large. Normalized misfit variance remains higher near Indonesia, although it is less than 1 as desired for this constraint. The larger residuals in the west are due to complicated topographic interactions in the region, the slow adjustment of salinity in the west, and from bad points in the climatology fields near the coast. The SST misfits between the model and the TMI observations are reduced significantly, but a few regions remain higher around Indonesia and the Philippines, in the cold tongue region, and along the eastern boundary. The SSH misfits are reduced by the largest fraction away from the equator, but are not reduced as much near the northern and southern boundaries, partly because the boundary conditions keep the SSH variability zero on the open boundaries. In addition, the western region is poorly reproduced, due to both complicated and poorly resolved topography and shallow water. In retrospect, larger (representation and model) errors should have been assumed in those regions."}, {"section_title": "Adjustments to the Control Variables 5.3.1. Adjusted Controls", "text": "[48] The time-mean adjustments to the NCEP zonal wind and heat flux are shown in Figure 8 (top) for the end of the 135 iterations. The wind stress adjustments are banded zonally, and are concentrated near the equator. The small scales indicate that the smoothness constraints applied through the Laplacian were not strong. The effects of the heat and freshwater flux adjustments take longer to propagate away from the surface than the wind stress effects, and require a longer assimilation window to emerge from ambiguity with the initial conditions compared to the wind. [49] The relatively short (1 year) duration of the assimilation window leads to ambiguity between initial condition and forcing adjustments, so initial condition adjustments can take the place of forcing adjustments, particularly off the equator. The wind stress is expected to be the main driver of the equatorial circulation. The depth penetration of the effects of adjusted wind-forcing depends on the duration of the model run and can be as large as 1000 m near the equator for the 1 year run. The sensitivities with respect to the wind were the largest and the optimization adjusted this control variable first. After roughly 25 iterations, the main form of the wind adjustments was set and the cost function terms for the other control variables started to increase. [50] Most of the adjustments to the wind fields are concentrated within 10\u00b0of the Equator where the assimilation moved toward similar solutions for the mean zonal wind stress during the first 30 iterations whether starting the optimization from NCEP wind or QuikScat wind. The final adjusted zonal and meridional wind stress (Figure 9) altered the NCEP starting guess to look more like QuikScat within 10\u00b0of the equator, but the ending values were about halfway between the two. The NCEP easterly zonal wind is strengthened on both sides of the equator and the double convergence of the meridional winds in the eastern Pacific seen in NCEP is slightly reduced by the adjustments but not eliminated. A longer assimilation period would reduce the ambiguity between forcing and initial conditions and improve the forcing estimates. [51] The adjustments to northward velocity and temperature on the southern boundaries are shown in Figure 8 to be relatively small (maxima of 3 cm/s and 0.4\u00b0, respectively). The small adjustments to the open boundary conditions can Figure 8. (top) Time-mean adjustments relative to the NCEP forcing over the one year assimilation period for (left) the net zonal wind stress (N/m 2 ) and (right) the heat flux (W/m 2 ). (bottom) Time-mean adjustments relative to the ECCO ocean state fields over the one year assimilation period for (right) the northward velocity (\u00b0C) and (left) temperature (cm/s) at the southern open boundary. be probably explained by the short 1 year assimilation window. Within a year, features propagating through the boundaries are expected to have limited influence on much of the tropical Pacific circulation. The geostrophic balance is enforced, although this is not apparent from Figure 8."}, {"section_title": "Intrinsic Variability and Adjusted Winds", "text": "[52] The adjusted forcing includes compensation for model errors, especially those introduced by the parameterization of subgrid-scale processes in the mixing layer and the interior. The assimilation should ideally include model error terms such as unresolved turbulent fluxes Bennett et al. [2006], Stammer [2005], Ferreira et al. [2005], but this has not yet been implemented in this system. In addition, adjoint model errors are introduced by the increased viscosity and diffusivity and by the omission of KPP in the adjoint model integration. The eddy-permitting model allows uncontrollable ''intrinsic variability'' such as tropical instability waves in the east. These produce large sensitivities that are not linear and so can impede the convergence of the linearized iteration. In our examples, they are suppressed by using 10\u00c2 normal mixing parameters in the backward adjoint run but normal mixing in the forward run. The enhanced damping reduces the growth rate of unstable modes, stabilizing the sensitivity growth by reducing energy flows from mean flow to growing perturbations. This introduces errors in the adjoint model because it reduces the energy and momentum fluxes due to the intrinsic variability. To the extent that these errors occur close to the surface, the assimilation system will supply the missing intrinsic variability by adjusting the estimated forcing, mainly wind stress forcing. [53] The main regions where instability was suppressed were in the TIW region and the western tropical Pacific. Power spectra of the forcing field adjustments were smooth and red, with no enhanced variance at TIW frequencies. On the other hand, small-scale variability and westward propagation is clearly present in the zonal wind stress adjustments plotted in Figure 10. Small-scale features in the wind stress are expected at TIW length and timescales [Chelton et al., 2001], but the veracity of these adjustments is difficult to verify. Fitting ''intrinsic variability'' such as tropical instability waves with wind-forcing may produce unsmooth wind adjustments because of the lack of an accurate covariance for the space-time structure of the errors in the wind forcing. An alternative method to deal with representation and model error would be to include a data error covariance representing the space-time structure of the intrinsic variability. This is feasible for gridded observations like TMI, but is more difficult to apply for irregularly spaced observations like altimeter or drifter currents. In order to explore the hypothesis that the small-scale forcing adjustments were created to fit the possibly intrinsic smallscale ocean variability, the estimated forcing fields were filtered in experiments to remove varying amounts of highfrequency and high-wave number energy and the model was re-run with filtered adjusted winds to see the difference in state and cost function. This is a simple version of an ensemble-based uncertainty analysis of the 4DVAR solu- Figure 9. The time-mean NCEP, QuikScat, and adjusted winds (NCEP plus assimilation adjustments) for (left) the net zonal wind stresses (N/m 2 ) and (right) the meridional wind stresses. tion, because all solutions that achieve similar cost function are similarly acceptable. Of course, not all the small-scale features in the adjusted wind stress are unrealistic, but some may be. We are trying to assess the uncertainty in the solution by removing them and examining the change in the cost function. [54] The square root of the spatial mean of the sum of squares (including the mean) of the wind stress adjustments (RMSA) varies with time, starting at a maximum and reaching a plateau near the center of the interval before tailing off in the last few months. Figure 10 (top right) shows the RMSA time series for the zonal component of wind stress. Although the mean and the time-varying part of the forcing adjustments are penalized separately, they are estimated together, so weak adjustments are expected at the end of the assimilation period as there is less future data to fit. The time mean of the wind stress and the regression of the time-varying wind stress on the RMSA time series (Figure 10, top left) have nearly identical spatial structure, suggesting that the artificial time-dependence introduced by the finite assimilation interval can be removed. The horizontal structure from the RMSA regression will therefore be taken as the spatial ''mode'' 1 of the adjustments, with the RMSA time series as its time coefficient, and its effects are removed from the adjustments to produce residual adjustments (bottom left of Figure 10. This mode is also very similar to the first principal component. [55] The total cost function was not sensitive to the time smoothing of the mode 1 coefficient (RMSA) time series. Model runs with different running mean smoothing of these coefficients produced insignificant changes (\u00b11%) in the total cost function. The lowest cost functions were obtained with coefficients constant in time and equal to 1 for zonal winds and 0.8 for meridional winds, improving over the cost function values obtained by the assimilation. This supports the hypothesis that the regressed mode represents a time-independent mismatch between the NCEP wind stress and the model, which is why the time mean of the adjustments have nearly identical form. It also supports the conjecture that artificial time-dependence of the adjustments can be reduced. A prior decomposition of the controls into mean and anomalies should have a similar effect. [56] The cost function was more sensitive to the smoothing of the residual wind variability remaining after removal of the regressed mode. A set of model runs were performed with different degrees of smoothing of the residuals of the adjusted winds. A moving average of 10 days in time, and 5\u00b0and 2\u00b0in the zonal and the meridional directions, respectively, resulted in a smoother solution with only a 4% increase in the total cost function. These scales were chosen to remove the smallest-scale structures in the controls, which were meant to have been excluded by the smoothness penalty function. Doubling the timescale of the smoothing of the residuals led to more than 12% degradation in the total cost function, consistent with the expectation of a red spectrum for the wind adjustments. Figure 10 (bottom) shows a time-longitude diagram of the residual wind adjustments on the equator with and without the 10/5/2 smoothing. [57] The largest effects of smoothing the winds on model state were in the SST, shown in Figure 11. The overall shape of the mean SST (not shown) is in good agreement with the TMI, showing a warm pool and cold tongue as expected. Only the differences between model and TMI are shown. The mean and RMS differences are only slightly increased by the smoothing, and the errors are concentrated along the Figure 10. (top left) Spatial structure of the zonal wind stress adjustments to the NCEP zonal wind stress (N/m 2 ) from the assimilation regressed on the time series of the square root of the squared adjustments averaged over x and y (RMSA). This is also the mean adjustment, to within about 2%. (top right) RMSA time series. (bottom) Time-longitude plot of the residual (mode shown above removed) zonal wind adjustments on the equator (left) before and (right) after smoothing. eastern boundary and in the TIW region. In spite of these errors, the agreement with TMI is well within the specified errors. Other data types are not much affected, and the fit is even improved by the smoothed winds in some cases. These experiments show that the solution is not alarmingly sensitive to the exact structure of the wind stress adjustments, and that structures with small scale in space and time can be removed after the fact without greatly changing the character of the solution. In some of the following analyses, ''smoothed'' winds will be used, meaning that the adjustments have constant regression mode amplitude and residual adjustments smoothed with the 10/5/2 filter. [58] One of the difficult aspects of the adjoint method is the expense of making uncertainty estimates for the estimated controls. The smoothing experiments are a postprocessing approach to exploring alternate solutions beyond the subspace spanned by the descent directions. Because the cost function is the measure of validity of any solution, an ensemble of solutions with near-minimum cost function can be used as an indication of errors. This ensemble can be generated from linear combinations of descent directions or any other means that produce solutions with good cost function performance. In this case, the limited set of alternate solutions just serve as a robustness check on the estimated solution."}, {"section_title": "Downscaling to 1/6\u00b0Resolution", "text": "[59] The adjusted controls (both original and smoothed) were further tested by using them to drive a 1/6\u00b0grid model run. The higher resolution run had smaller mixing parameters, and topography that resolves small-scale features and especially islands that were missing or poorly represented in the 1/3\u00b0topography. The cost function and common metrics of model state (such as EUC structure) of the 1 year integration with the 1/6\u00b0grid was not significantly different from the 1/3\u00b0grid run with the same controls, indicating that the dynamics were not greatly changed by the increase in resolution and that the forcing fields, initial conditions, and boundary conditions were compatible for a substantially different model configuration. Some of the discussion in the following will cover the 1/6\u00b0grid results."}, {"section_title": "Estimated State", "text": "[60] In this section, a series of comparisons between the model solution and the observations are presented to evaluate the fit in dimensional terms to focus on the performance with particular data sets. [61] The mean and standard deviation of the SSH fields are compared in Figure 12 for observations, reference model run, and assimilated solution. The mean SSH is compared with that estimated from GRACE. The mean SSH of the assimilation is closer to the observations than the reference run, even though the weights of the mean SSH in the cost function were relatively low because of the low resolution of the geoid measurements. There are still significant differences, most notably in the western-intensified gyres in the south Pacific. [62] The variability of the SSH from the model (with and without assimilation) was also compared with the gridded AVISO SSH variability. As illustrated in the maps of the SSH standard deviation from these solutions (Figure 12,  right), the SSH variability from the optimized solution is increased north of the equator and is in better agreement with the analyzed AVISO variability than the variability of the reference run. The variability of the optimized run is still weak, especially near the northern boundary in the west and the eddies generated from the mountain winds in central America. The variability in the NECC is also still weak and located too far to the east. The zonal band of variability to the east of New Guinea is much more realistic in the [63] To evaluate the estimated model state, we examine zonal cross sections of the mean temperature, salinity, and zonal velocity fields at the equator. Figure 13 compares the reference and the optimized temperature, salinity, and zonal velocity to the fields from Johnson's reanalysis. The temperature and salinity climatology was not used as a constraint, but observations that contributed to it were included. The time period for the analysis is much longer than just the year 2000, but the general structure of the fields can be compared. The improvement of the salinity, particularly in the west, is more obvious than for temperature. Both initial conditions and heat and freshwater flux adjustments contribute to these differences."}, {"section_title": "Equatorial Currents", "text": "[64] The zonal current on the equator is shown in Figure 13 for the time-average of the year 2000. It is also compared with the Johnson analysis and the reference run, showing only slightly improved agreement in the optimized run with better core for the EUC, perhaps partly due to the reference run is already close and partly due to the time mismatch between the two estimates. The comparison to TAO currents for the year 2000 has no time mismatch, but the overall fit is not greatly improved either, only decreasing by about 25% (Figure 4). The estimated equatorial currents by the assimilation system are generally within two times the assumed uncertainties for the TAO moorings velocities. The most important improvements in the estimated velocities with respect to the model reference run without assimilation are located near the surface where the wind impact is more pronounced. Figure 14 shows a comparison in time and depth for zonal velocities over the year 2000 between TAO moorings and the model at three different longitudes: 165\u00b0E, 190\u00b0E, and 220\u00b0E. The near-surface zonal velocity in the western Pacific in the adjusted run is in slightly better agreement with the TAO measurements than the model reference run. The EUC core is also slightly deeper in the adjusted run, and stronger in the first few weeks, but it remains shallower and weaker than in the observations. From an analysis of the corrections and sensitivities, it is seen that the assimilation controls the EUC primarily by adjusting the wind stress in the tropical band, which affects the pressure gradient on the equator and the inflow to the EUC from off the equator. Improvement is harder to see in the eastern Pacific, where the EUC remains too deep, although its strength is improved in the middle of the year. [65] Figures 3-14 discussed above generally show comparisons with observations that were assimilated, and so are not independent validation of the model output, although the requirement of dynamical consistency greatly reduces the freedom to fit observations. The point of the assimilation is to construct forcing and boundary fields that are in balance with the model dynamics and make the model match a comprehensive set of observations, so no major Figure 12. (left) Mean sea surface height over the year 2000 (a) observed by the Grace mission and (b) estimated from the model reference run and (c-d) assimilation run. (right) Sea surface height standard deviation from weekly fields in the year 2000 as (e) estimated from AVISO products and estimated from (f) the model reference run, (g) the assimilation run, and (h) the 1/6\u00b0run forced with the 1/3\u00b0adjusted controls. Figure 13. Cross section of (left) temperature, and (middle) salinity, and (right) zonal velocity at the equator as (a -c) obtained from Johnson's reanalysis, (d -f) estimated from the model reference run, (g -i) assimilation run, and (j -l) the 1/6\u00b0run forced with the 1/3\u00b0adjusted controls averaged over the assimilation period in the year 2000. Figure 14. Time evolution of the zonal velocities at the equator in depth at three different longitudes (top) as measured by the TAO moorings and (middle) as obtained from the model run and (bottom) assimilation run. data sets were withheld in this case. The cross-validation of the solution against independent observations is a commonly used check on assimilation results, but suffers from difficulties in gauging the extent of the independence. For example, dropping every other XBT profile has little effect on this solution, due to the redundancy of the data set, and withholding data in particular regions is tedious and may be selffulfilling (if all data are withheld, no information is available to adjust the controls). [66] One aspect of the circulation in the tropical Pacific that was not directly assimilated is the subsurface countercurrents (SCC) and zonal jets. Features such as the Tsuchiya jets [Tsuchiya, 1975;Johnson and Moore, 1997;Rowe et al., 2000] are seen in high-resolution models [Donohue et al., 2002;Ishida et al., 2005]. These features have been explained as arrested fronts at a convergence of wave characteristics [McCreary et al., 2002], as features connected to the ventilated thermocline [Hua et al., 2003], and as features maintained by eddy fluxes of momentum [Ishida et al., 2005;Jochum and Malanotte-Rizzoli, 2004] and are thought to be strongly sensitive to the mixing in the model [Furue et al., 2007]. These features are seen in the model output, and Figure 15 compares the velocity on the 26.75 isopycnal for three different forcing fields and two model resolutions. The level was picked to be roughly in agreement with the lower bound of the zonal velocity maximum flow seen at 165\u00b0E by [Donohue et al., 2002], and the flow shown by Ishida et al. [2005] between 26.8 and 26.6, although Ishida et al. [2005] also integrate zonal flow between 26.8 and 26.0 to span the pycnostad and the gradual decrease in density associated with warming of the jets downstream. The NCEP and QuikScat wind forcings produce dramatically different zonal velocity fields, neither of which shows the pattern of jets in the western Pacific as seen for example by Johnson and Moore [1997] and Donohue et al. [2002]. The adjusted forcing produces strong jets on the isopycnal that diverge from the equator to the east as they follow the isopycnal upward, although the cores of the jets gradually move to lower densities to the east (not shown). The density levels of the maxima of the jets in the adjusted model range from about 26.75 in the west to about 26.25 to the east, weakening to the east, similar to those shown by Ishida et al. [2005] for the small layer integrals. To check the effects of the model grid on the features, they are also shown for the model run at 1/6\u00b0r esolution with the same controls ( Figure 15). The jets are slightly stronger in the west, but the structure is very similar. The eddy flux statistics were not saved in our integrations, so a detailed diagnosis in comparison with that of Ishida et al. [2005] was not attempted. Figure 15. Mean zonal velocities mapped on the 26.75 isopycnal (about 400 m depth on the equator) from the (1/3\u00b0) reference run forced with NCEP reanalysis, the (1/3\u00b0) reference run forced with QuikScat winds and NCEP heat and salt fluxes, the (1/3\u00b0) assimilation run, and a reference run at 1/6\u00b0resolution forced with the adjusted winds with the 1/3\u00b0assimilation run."}, {"section_title": "Equatorial Momentum", "text": "[67] Section 5.5 focused on an analysis of the model's skill in reproducing observed mean and variable ocean structures in SSH, SST, and velocity. One concern with assimilated model output is that the observed features may have been reproduced, although the dynamical balances have been distorted because of the need to overcome model error and approximations in the assimilation scheme. Although the result presented here is dynamically consistent by construction, the sizes of the terms in the dynamical equations should still be checked. The terms in the momentum equation are calculated from the 1 year mean velocity and pressure fields, leaving out the Reynolds stress divergences due to time variation resolved by the model. The MITgcm uses the flux form to calculate the momentum terms, but the individual terms have been estimated separately offline. The time derivatives of velocity in the 1 year average were small, only a few percent of the larger terms, so the mismatch between the Coriolis force and the other mean terms (lumped together as ''right-hand side'' (RHS) in Figure 6 is mainly due to the turbulent stresses resolved by the model. Writing the momentum equations as a balance between Coriolis force and all the other terms: where f is the dynamic pressure, u is the three-dimensional velocity, f is the Coriolis parameter, K v is the vertical eddy viscosity parameter, and a x and a y are the residual forces. Selected terms in the momentum balance for the 1 year mean of the reference and adjusted runs are plotted in Figure 16. (top, left) Zonal and (right) meridional acceleration terms (m/s) at 144 m depth for 1/3\u00b0\u00c2 1/3\u00b0model runs with (top) reference controls and (bottom) adjusted controls. The sections are shown at longitude 210\u00b0E. Figure 16 as a function of latitude at 144 m, the approximate depth of the maximum zonal velocity in the equatorial undercurrent (EUC) in the adjusted run. Zonal (Figure 16, left) and meridional ( Figure 16, right) acceleration terms (m/s) for the reference and adjusted runs winds were evaluated along a meridional section at 210\u00b0E. This longitude is chosen to be away from complex topography and near the center of the basin. The parameterized horizontal friction terms were negligible in these balances. [68] The meridional budget shows a nearly geostrophic balance, as expected [Pedlosky, 1987], with the matching slopes of terms @p/@y and fu suggesting that the bu = @ 2 u/@y 2 relationship holds for both runs. The flows are smaller for the reference run, partly because the EUC core is at a different depth. In particular, the SEC is stronger in the adjusted run, reversing to a weak countercurrent at about 9\u00b0S that is not seen in the reference run. The acceleration terms and residuals are stronger in the adjusted run, which has larger mean and zonal velocities and stronger variability, particularly in the NECC between 6\u00b0N and 7\u00b0N. [69] When sufficiently resolved, the zonal momentum balance within about 2.5\u00b0of the equator is dominated by a balance between the pressure gradient (blue line in Figure 16) and the advection of the gradients of zonal velocity (uru) (lines with symbols). The x and z derivatives dominate on the equator, indicating that the core of the current is not exactly at this level on the equator. Between about 0.5\u00b0and 2.5\u00b0off the equator, the meridional advection of the meridional gradient of zonal velocity v(@u/@y) dominates the balance, showing the acceleration of the water converging into the undercurrent. The vertical advection of the vertical gradient of zonal velocity w(@u/@z) is relatively small off the equator due to the choice of depth. The background vertical viscosity term is shown as the dotted line, and plays a significant role in the balance in the EUC. There is a residual difference between the Coriolis term (green line) and the summed mean accelerations (red line) due to resolved turbulent stress divergence. The reference model run has a smaller residual than that of the adjusted model, presumably partly due to the lower level of variability in the reference simulation. [70] The zonal momentum balance on the equator and especially the role of nonlinear terms in the balance as a function of depth has been examined previously by Qiao and Weisberg [1997] from moorings on the equator at 140\u00b0W. They saw the depth of the EUC core vary in time between about 100 m and 140 m at that longitude with an average depth of about 120 m over 13 months starting in May 1990 and an average speed of about 1.1 m/s, compared to about 0.9 m/s in the adjusted model. The balances at that longitude are similar to those shown in Figure 16. [71] Previous comparisons of non-assimilated 1/3\u00b0and 1/6\u00b0model runs with the Qiao and Weisberg [1997] calculations showed qualitative agreement, but the momentum flux divergences were half the size of those seen in the observations [Hoteit et al., 2008]. The adjusted runs increased the sizes of the mean terms to about 80% of those seen in the observations. The mean eddy flux divergences seen in their observations are about 1 \u00c2 10 \u00c07 m/s with a standard deviation of 1 \u00c2 10 \u00c07 m/s at the core of the EUC, compared to the vertical eddy viscosity term that closes the balance in the model and is about 0.4 \u00c2 10 \u00c07 m/s on the equator. Thus, the balances in the adjusted model shown here exhibit no large deviations from expectations."}, {"section_title": "Discussion", "text": "[72] An eddy-permitting four-dimensional hindcast has been presented for the tropical Pacific Ocean. The hindcast is dynamically consistent, produced by an adjoint assimilation system. Controls consisting of initial conditions, boundary conditions, and surface forcing have been adjusted to bring a 1 year model run into useful agreement with a wide variety of observations for the year 2000. The observations were sampled on intervals of 1 -5 days, leading to a large number of constraints. The solution reproduces most of the features of the time-dependent ocean structure and circulation seen in the observations. The largest errors are in the western Pacific near land and near the northern and southern boundaries where the model cannot produce much small-scale SSH variability. Because the controls only include forcing at the surface and initial and boundary conditions, the model cannot fit subsurface features that are inconsistent with the model dynamics and unaffected by these controls. This, along with the finite number of descent iterations, means that a perfect fit to observations is not expected. [73] The adjustments to the forcing, initial, and boundary conditions were not large compared to their allowed ranges, and the model dynamics are compatible with the data to lowest order. Experiments with different starting forcing estimates tended to similar solutions, suggesting that the results are not sensitive to this choice. The adjusted controls produce a model run that matches the observations, and could in principle be used to produce a consistent solution in another model. The assimilation system was found to be weakly sensitive to the starting guess of the wind fields, as suggested by the results of different assimilation runs forced with NCEP, ECCO, and QuikScat winds. As part of an uncertainty analysis, space and time smoothing of the wind forcing outside the assimilation yielded an alternative set of forcing fields that were applied to the model and produced only small differences in the estimated model state. These alternative solutions are a few elements of what could be an ensemble of acceptable solutions as measured by the cost function, and which would provide some measure of the uncertainty in the solution. Both original and smoothed adjusted controls were applied to another implementation of the MITgcm with different topography and doubled horizontal resolution as a check on the adjusted controls. The higher resolution runs did not differ greatly in the agreement with observations, although some small-scale features were changed, particularly in regions of complicated topography. This suggests that the estimated controls are not specific to the model resolution, provided the resolution is not coarser than 1/3\u00b0, and allows downscaling by computing adjusted forcing and boundary conditions and applying them to a higher resolution model for analysis or to serve as a starting point for continued assimilation. The important terms in the momentum equations after assimilation remained in line with previous studies and were not significantly changed from the reference run. Small features (subsurface countercurrents) of the near equatorial circulation were enhanced in the assimilated solution. [74] Many technical details of the assimilation need to be refined. Perhaps the most obvious is the adjustment of the prior estimates for control parameter and observational error covariances. The non-diagonal error covariance matrices for the control variables are set in an approximate way, although converting to a whitened generating function for the controls as done by Weaver et al. [2003] will improve the preconditioning of the descent algorithm. Three-dimensional multivariate background covariances based on a dynamical extrapolation of observed statistics might be also used to improve large-scale inversions [Lermusiaux, 2002]. Methods to enforce large-scale observational errors in irregularly spaced data sets need to be implemented. Finally, uncertainties in the internal model physics were not represented in the control vector, so that regions out of reach of the surface forcing and boundary controls were determined by initial conditions alone. In the 1 year integration of the tropical Pacific model, no large errors or drifts were observed in the deep ocean away from the coasts, even without assimilation. In the assimilation runs the surface controls were able to reduce the cost function. This does not mean that model errors are negligible, and the forcing adjustments may include components that are compensating for model errors. Stammer [2005] and Ferreira et al. [2005] have allowed for errors in the internal physics of the ECCO MITgcm by adding control of mixing parameters, which represent some of the least-understood physical approximations in the model. [75] This study demonstrated the efficiency of a fourdimensional assimilation based on the MITgcm and its adjoint to dynamically map the tropical Pacific observations, providing an accurate picture of the circulation in this region. The improved assimilation system will be used in the future to determine a time-evolving ocean state estimate and adjusted forcing for the tropical Pacific over assimilation periods extending to several years. These reanalyses will be made available to the community for general scientific studies of the tropical Pacific."}]