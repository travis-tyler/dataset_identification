[{"section_title": "Abstract", "text": "ABSTRACT This paper presents a novel approach for diffeomorphic image regression and atlas estimation that results in improved convergence and numerical stability. We use a vector momenta representation of a diffeomorphism's initial conditions instead of the standard scalar momentum that is typically used. The corresponding variational problem results in a closedform update for template estimation in both the geodesic regression and atlas estimation problems. While we show that the theoretical optimal solution is equivalent to the scalar momenta case, the simplification of the optimization problem leads to more stable and efficient estimation in practice. We demonstrate the effectiveness of our method for atlas estimation and geodesic regression using synthetically generated shapes and 3D MRI brain scans."}, {"section_title": "INTRODUCTION", "text": "Within the last 15 years, there has been extensive research in developing methods for representing shapes and their variability across a population [1] and along time [2] as diffeomorphic deformations of a template image. In particular, the optimization methods [2, 3, 4] based on initial deformation momenta, which encode full geodesic paths in the space of diffeomorphisms, have improved the state-of-the-art methods for shape statistics [5] .\nPrevious approaches [2, 3, 4] represent the momenta as a scalar field multiplied by the initial image gradient. In these approaches, the forward evolution of a geodesic and the associated backward adjoint system involve imprecise finite difference gradients of a noisy image. Furthermore, the template and momenta must both be jointly estimated by iterative optimization, leading to poor convergence.\nInstead of scalar momenta, we use vector momenta. In our formulation, the evolution of the geodesic and adjoint system is decoupled from the template image. We also derive a * Data collection and sharing for this project was funded by the Alzheimer's Disease Neuroimaging Initiative (ADNI) (NIH Grant U01 AG024904). The research in this paper was supported by NIH grant 5R01EB007688, the University of California, San Francisco (NIH grant P41 RR023953, NSF grant CNS-0751152), and NSF CAREER Grant 1054057.\nclosed-form update for the optimal template, which results in more efficient optimization. This novel framework for template estimation applies to both the atlas estimation and the geodesic regression."}, {"section_title": "METHODOLOGY", "text": ""}, {"section_title": "Preliminaries", "text": "We follow the well-established framework of large deformation diffeomorphic metric mapping (LDDMM) [6, 9] , in which anatomical variability is represented by maps of diffeomorphisms, which are topology-preserving smooth invertible transformations of the underlying coordinate system. We briefly review the mathematical framework of LDDMM.\nLet \u2126 be the coordinate space of the image, I. A diffeomorphism, \u03c6(t), is constructed by the integration of an ordinary differential equations (ODE) on \u2126 defined via a smooth, time-indexed velocity field, v(t). The deformation of an image I by \u03c6 is defined as the action of the diffeomorphism, given by \u03c6 \u00b7 I = I \u2022 \u03c6 \u22121 . A right-invariant Riemannian metric on the space of diffeomorphisms is obtained by choosing a positive-definite, self-adjoint differential operator L, which acts on velocity fields. This operator induces the structure of a Sobolev space on the collection of velocity fields and determines the norm of a velocity field, v 2 = \u2126 (Lv(x), v(x))dx. Deformation momenta: The tangent space at identity, V = T Id Diff(\u2126) consists of all vector fields with finite norm. Its dual space, V * = T * Id Diff(\u2126) consists of vector-valued distributions over \u2126. The velocity, v \u2208 V , maps to its dual deformation momenta, m \u2208 V * , via the operator L such that m = Lv and v = Km. The operator K :\nIn the diffeomorphic image pair registration problem, it has been shown that the optimal initial momentum is orthogonal to the level sets of the deforming image [7] . That is m(x) = \u03b1(x)\u2207I(x) for a scalar function \u03b1 at all times. Note that constraining \u03c6 to be a geodesic with initial momentum m 0 = m(0) implies that \u03c6, m, I, and \u03b1 all evolve in a way entirely determined by the metric L, and that the deformation is determined entirely by the initial scalar function \u03b1 0 = \u03b1(0). EPDiff for geodesic evolution: Given the initial velocity, v 0 \u2208 V , or equivalently, the initial momentum, m(0) = m 0 \u2208 V * , the geodesic path \u03c6(t) is constructed as per the following EPDiff equation [8, 7] :\nwhere D denotes the Jacobian matrix. Operator ad * is dual of the negative Jacobi-Lie bracket of vector fields [7, 8, 9] :\nThe deformed image I(t) = I 0 \u2022 \u03c6 \u22121 (t) evolves via:"}, {"section_title": "Geodesic Regression and Atlas Estimation", "text": "Geodesic regression in the space of diffeomorphisms is a natural generalization of Euclidean least squares regression. The parameter estimates consist of an \"intercept\", i.e., a template image at the initial time point, and a \"slope\", i.e., an initial momenta defining a diffeomorphic geodesic evolution of the template image that best describes the time-dependent image data. The atlas estimation problem can be thought of as a special case of the geodesic regression problem, with the initial momenta removed. This is analogous to how linear regression reduces to mean estimation when the slope term is removed. In this section we present a novel formulation of the template estimation problem in geodesic regression and atlas construction using vector momenta, which unlike the scalar momenta formulation has the advantage of stable, closed-form updates to the template. Geodesic Regression: Given N observed images J i at time points t i , for i = 1 \u00b7 \u00b7 \u00b7 N such that t 1 = 0 and t N = 1, the geodesic that passes closest, in the least squares sense, to the data minimizes the energy functional\nwhere I 0 and m 0 are the initial \"intercept\" and \"slope\" to be estimated that completely parameterize the geodesic. Here,\nAs per optimal control theory, we add the Lagrange multipliers to constrain, \u03c6 m0 (t i ) to be along the geodesic path. This is done by introducing time-dependent adjoint variables,m,\u00ce andv, as per the EPDiff evolution equations (1) to giv\u1ebd\nThe optimality conditions for m, I, v are given by the following time-dependent system of ODEs, termed the adjoint equations:\nsubject to boundary condition\u015d\nwith added jump conditions at observed measurements,\nand\u00ce(t i\u2212 ) denote the limits from above and below, respectively, of the integrated\u00ce.\nFinally, the variation of\u1ebc with respect to the initial momenta is\nand the variation of\u1ebc with respect to the initial image, \u03b4 I0\u1ebc can be directly computed from the energy functional\u1ebc. Notice only the second term has a dependence on I 0 i.e., I(\nA change of variable for \u03c6 implies the derivative with respect to I 0 is\nThis results in a closed-form solution for I 0 at optimum:\nNotice, at optimum, the resulting vector momentum are horizontal, i.e., along gradient of the image. This follows from taking the gradient in Eq.(4) with respect to velocity, v 0 instead of momenta, m 0 and a change of variables for \u03c6 such that:\nComparison to optimization with scalar momenta: The above analytical update on image, Eq.(9) results in a robust algorithm that does not require joint parameter tuning during optimization unlike previous methods based on scalar momenta. The numerical schemes only optimize on momenta. However, previously proposed scalar momentum based optimization involve joint optimization over both the template image and the momenta. Moreover, computation of the gradient for image update involves integration of higher order closed-form solution for atlas estimate, I at optimum:"}, {"section_title": "RESULTS", "text": "Our implementation of geodesic regression and atlas building is developed based on MPI and the GPU image processing framework by [10] . We evaluate our proposed shooting method using synthetic and real 3D-structural MRI data both for the geodesic regression and the atlas construction problem. In our experiments, the kernel, K corresponds to the invertible and self-adjoint fluid operator, L = \u2212a\u2207 2 \u2212 b\u2207(\u2207\u00b7) + c, with a = 0.01, b = 0.01 and c = 0.001. Experiments with synthetic data: For geodesic regression: We generated ground truth geodesic on diffeomorphisms by solving the image matching problem and generated sampled shapes along the geodesic. Fig. 1(top) shows our example of shapes along this geodesic: plus to flower. To validate the robustness of estimation of initial conditions at t = 0, geodesic regression was performed given the sampled shapes only for t > 0.5 as input to the algorithm. We used closed-form image update and a simple constant stepsize gradient descent for momentum update. The resulting estimated baseline template for this experiment (Fig. 1, bottom  right) closely matches the ground truth image at t = 0 (Fig. 1,  bottom left) . The estimated initial deformation momenta vectors also closely match the ground truth. Fig. 2 reports our experiment with results for assessing the stability of optimization when compared to scalar momenta geodesic regression. The comparison was done based on constant stepsize gradient descent on exactly the same input to both the algorithms. Identical numerical integration methods (fourth order RungeKutta) were used in both the algorithms for integrating the evolution equations. We observe that the scalar momentum has difficulty converging even with very small steps for image update while vector momentum converges early to a stable energy.\nFor atlas construction: The atlas was estimated from uniformly rotated ellipses across 180\n\u2022 . Fig. 3 shows the input to the atlas algorithm and the estimated template. The average shape given equally rotated ellipses were expected to be a circle. A perfect circle shape was recovered as the estimated template by our algorithm. Experiments with brain images from ADNI: The geodesic regression was performed on longitudinal scans of a subject with Alzheimer's disease (AD) from the ADNI database (adni.loni.ucla.edu). This individual had MRI scans taken at uneven time intervals, i.e., at ages = 70.75, 71.38, 71.78 and 72.79. Fig. 4 (top) shows the original MRI scan data: comparison of the MRI scans with the baseline scan at age=70.75. Expansion of lateral ventricles in this individual is more evident by the end of second year of scan. Our geodesic regression algorithm captures the estimates of the smooth trend of atrophy (Fig. 4 (bottom) ). To illustrate reliability of our method, we use the estimated initial conditions to predict the future trend of atrophy for this Alzheimer's subject. The estimated 3D MRI template at t = 70.75 is evolved for 6 years in the future via EPDiff Equations (1). The resulting generated brains exhibit a clear trend in shrinking hippocampus, and expanding ventricles along with cerebro spinal fluid across the whole brain with time. These patterns of atrophy are well known to characterize the disease progression in AD. Fig. 6 shows our atlas estimate of 50 cognitively normal subjects in ADNI database."}]