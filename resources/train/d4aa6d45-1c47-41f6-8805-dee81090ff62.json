[{"section_title": "I. Introduction", "text": "From the early days in aeronautical engineering, where wing divergence and control reversal were among the problems to solve for aircraft design, to dynamic flutter calculations to avoid wing failure, static and dynamic aeroelasticity issues have caused many control challenges and even loss of (fighter) aircraft during high-speed manoeuvring. 1 However, aeroelastic effects are not restricted to aircraft alone. Especially long and slender bodies, such as (small) conventional launch systems, may suffer from an unwanted coupling between the rigid body and its flexible modes. This coupling may be amplified by the large variation of mass properties (due to oxidiser and fuel consumption), as well as the change in operational conditions, because of the large flight and altitude regime. The potential motion of a volume of (liquid) fuel and oxidiser, a phenomenon known as sloshing, further complicates the situation. The dynamic effect due to sloshing is not constant, since the liquid mass as well as the tank filling grades change significantly during the flight. The stability of aeroelastic bodies, such as missiles and launchers, has been studied since the 1960s [2][3][4] and invariably focussed on the interaction between rigid and flexible modes, and the response to wind gust and turbulence, or the impact of aeroelasticity on control-system stability margins, e.g., the work covered in Ref. 5. Our previous work focussed on the effect of aeroelasticity on launch vehicle stability, controllability, and controller performance in a single point during the ascending flight, 6 as well as the additional effect of wind gust and turbulence during the trajectory from lift off to burnout of the first stage, taking transient effects into account. 7 Having liquid propulsion systems has, as a consequence, that the liquid in the oxidiser and fuel tanks can move, which can have an adverse effect on the launcher's stability. But even when the motion is a stable one, it can have significant impact on the attitude-controller performance. Many authors have studied the effect of sloshing on the stability and controllability of launchers and satellites. [8][9][10][11][12] Cui et al. discuss the parametric resonance of small-amplitude sloshing and show stability diagrams for different sloshing damping. 8 Non-linear slosh damping is also included in the stability analysis in Ref. 9 to come up with a relationship between the non-linear slosh damping and an equivalent linear damping at a given slosh amplitude. Also a more accurate (analytical) prediction of the danger zone of slosh mass locations is given, when the launcher is controlled by proportional-derivative feedback. Using a multi-body formulation and bifurcation analysis, the neutral stability curves for a typical launcher in planar atmospheric flight are obtained in Ref. 10, and Bode plots are provided for the linearised system. In terms of control, the non-linear dynamics and control of a launcher's upper-stage are considered by applying Lyapunov-based non-linear feedback control laws with thrust-vector control. 11,12 Most of the performed studies, especially when related to control-system design, assume perfect knowledge on the slosh motion, by applying an equivalent mechanical model. When the slosh states are required in the feedback laws, however, it is not necessarily true that this \"perfect\" knowledge is available, and at best one can estimate the required slosh states. Our previous work confirmed that slosh dynamics may provide a significant issue for the controller, 13 such that not only a robust-controller design is required, but that information about the slosh dynamics itself can significantly improve the controller response. Here, it is indeed assumed that slosh states are not directly measurable, and therefore have to be estimated. The problem of slosh-state estimation will therefore be the topic of the current paper. As a reference, the two-stage PacAstro launcher for small payloads up to 225 kg has been selected for its availability of some geometrical and structural data a . The launcher is treated as a flexible beam with lumped masses to account for the subsystems and the fuel. Modelling of the slosh motion is done for oxidiser and fuel separately, with one tank each per stage of the selected two-stage launcher. In Appendix A, a summary of mass and geometry data can be found. The layout of this paper is as follows. Section II will discuss the slosh-dynamics model, whereas in Sec. III, a general overview of the state-space model is provided. Section IV presents the background on observer design, based on the theory of sliding modes. Next, in Sec. V, the results of the study are shown, split into two parts: first, the nominal case is considered, and second, parameter uncertainties in the slosh model are taken into account. Section VI, finally, concludes this paper."}, {"section_title": "II. Slosh Dynamics Model", "text": "A detailed analysis of slosh dynamics would require extensive CFD calculations that can predict the motion of the liquid. However, coupling the equations of motion of a flexible space vehicle to the equations of motion of a continuous liquid is too computationally heavy for ordinary design analyses, especially in the preliminary design phase when many runs have to be executed. It is therefore more practical to replace the liquid conceptually by an equivalent linear mechanical system, and thus include the dynamic effects of sloshing in the launcher control and stability analysis. The two most commonly used mechanical motion models are that of a spring-mass-damper and a (damped) pendulum, attached at a time-dependent location inside the tanks. Formulations for either model are dependent on the shape of the tank, e.g., being cylindrical, rectangular, spherical or tear drop. Circular cylindrical tanks are widely used in launch vehicles and spacecraft, and are thus the preferred tank shape for the mechanical model. In the current study, the slosh model for a cylindrical tank (partially) filled with fuel or oxidiser will be based on a damped mass-spring system. This will also facilitate the design of the observer (Sec. IV), contrary to the use of a damped pendulum. The main parameters to evaluate the state-space model to be discussed in the next section are the eigenfrequency, \u03c9 s,j , of the j th slosh mode and the corresponding damping factor, \u03b6 s,j . These parameters are a function of the (time-dependent) filling grade of the tanks, as well as the type of liquid through its density. Additional parameters are the slosh mass, m s,j , and slosh-mass location, x s,j . Abramson, in Refs. 15 and 16, as well as Dodge in Ref. 17, provide a simple model to calculate n s eigenfrequencies for different tank shapes, including the cylindrical one. Let the geometry of the cylindrical tank be defined by its height, h, and diameter, d. A volume-based filling grade of x f ill means that the actual liquid level is equal to h = x f illing h. Figure 1 shows a schematic of the slosh-mass configuration for the lateral-induced motion. Indicated in the figure is a single slosh mode, represented by a damped mass-spring system with mass m s , spring stiffness, k s , and damping, c s . The mass m 0 is a static mass, i.e., that portion of the liquid that does not move. At some point in time, though, when the tank has significantly emptied, all remaining liquid can slosh and m 0 has become zero. The eigenfrequency \u03c9 s,j is defined to be: a PacAstro was a US transportation service company, formed in 1990, to provide low-cost transportation of small satellites to Low Earth Orbit for approximately $5 million per launch using proven technology. 14 Unfortunately, the launcher never came to operation despite several engine tests and three launch contracts, due to the lack of development funding. The company ceased to be in 1997.  with k s,j being the equivalent spring stiffness for mode j, and m s,j the mass of the moving part of the liquid. k s,j and m s,j are given by: In the above equations, \u03be j are the roots of specific Bessel functions, 16 and are for n s = 5 given by \u03be 1 = 1.841, \u03be 2 = 5.331, \u03be 3 = 8.536, \u03be 4 = 11.706, and \u03be 5 = 14.864, respectively. Values for higher modes can be approximated by The portion of the liquid that moves has a distance to the current tank centre of mass of such that with the absolute location of (the bottom of) a particular tank i, x tank , measured from the aft skirt of the first stage and the location of the global centre of mass, x cm , the distance of the slosh mass from x cm is then given by: The location and mass of the non-moving part are: The total mass of the liquid, m liq , is a function of the filling grade, the geometry of the tank, and the liquid density, \u03c1 liq . For the cylindrical tank, this is m liq = \u03c0 4 d 2 h \u03c1 liq . In the current study, we consider the tanks of the first stage only (see Appendix A for details on the tank geometry, and oxidiser and fuel properties).  Previous work showed that for flight control it is justified to only include the first lateral slosh mode of the liquid surface. 13 The steady-state values of the natural frequencies are \u03c9 LOX = \u03c9 RP 1 \u2248 4.44 rad/s. Note that these values hold for a single, isolated tank. The last element to be discussed is the damping of the slosh modes. The experimental study by Stephens et al. 18 found the following correlation for the primary slosh mode: with \u03be 1 = 1.841, h r being the liquid depth, and K a constant (K = 0.83, see Ref. 13). In the above equation, \u03b6 s is the damping ratio of the amplitude of the free-surface oscillation, i.e., a percentage of the critical damping ratio (\u03b6 s,crit = 1), and Re is a dimensionless parameter analogous to an inverse Reynolds number: with r being the tank radius, g the acceleration due to gravity, and \u03bd the kinematic viscosity of the liquid."}, {"section_title": "III. Pitch-Plane State-Space Model", "text": "To investigate the stability and control characteristics of flexible launchers, it usually suffices to restrict to pitch-plane motion only. A state-space model describing the error dynamics of a flexible launcher, of which the configuration is shown in Fig. 2, has been derived in Ref. 6. Input to this error-dynamics model is a modal description as a function of current mass, the normal-load and pitch-moment distribution, and, of course, the flight conditions. The mass matrix is created using a consistent formulation for a linearised beam element. Furthermore, the launcher is assumed to move with a steady-state velocity u 0 , and the local deformation is determined by the combination of thrust, T , gravity, mg d , aerodynamic normal force, N , and aerodynamic pitch moment, M . The liquid motion in the fuel and oxidiser tanks will introduce perturbing accelerations that affect the motion of the launcher. Besides the actual slosh dynamics, sloshing will introduce coupling effects with the rigid translational and rotational motion, as well as with the flexible-body dynamics. In Fig. 3 the configuration of the flexible launcher is shown, with two slosh masses, m s,1 and m s,2 , for the RP-1 and LOX tanks of the first stage, and two for the second stage (m s,3 and m s,4 ). In its general form, the system equation of the extended state-space model is given by 13 with the state and control vector given by ..\u017c s,ns z s,ns T and u = \u03b5 T,c (the commanded swivel angle), respectively. The matrices A and B are the system and control matrix, respectively, whereas E is the (coupled) mass matrix. Due to the different nature of groups of state variables, it makes sense to partition A and B into submatrices representing the rigid-body motion, the engine dynamics, the flexible-body motion, and the slosh dynamics, thereby identifying the coupling terms between the different sets. The corresponding state-space matrices are then written as: where the indices indicate 1. R for the rigid-body states angle of attack b , \u03b1, pitch angle, \u03b8, and pitch rate, q; 2. E for the engine states\u03b5 T (angular acceleration),\u03b5 T (angular velocity) and \u03b5 T (the angular position or swivel angle). These states originate from the assumption that the engine is modelled as an electrohydraulic servo system, represented by a third-order transfer function; 3. F for the flexible-body states\u03b7 i and \u03b7 i for mode i. The total number of states in this group depends on how many bending modes n f are taken into account; 4. S for the slosh-mass states\u017c s,j and z s,j for slosh mass j. The total number of states in this group is given by n s , i.e., the product of the number of slosh masses and modes per mass. For the current research of observer design, we will consider the combination of rigid body and slosh motion only and treat the effect of engine and flexible-body dynamics as disturbances. Following the analysis in Sec. II, a single slosh mass will be considered for both the LOX and RP-1 tank, and of the first stage only. The relevant sub-matrices of Eqs. (10) and (11) follow from the complete model stated in Refs. 6 and 13: b Pitch-plane translational motion is defined by u 0 and the vertical velocity, w. However, to study the rotational motion for a single point in the trajectory, it makes more sense to use the angle of attack, \u03b1, which can be derived from the (small) w through the relation  and the coupling matrices The control matrix is defined by B R , whereas B S = 0: Finally, the mass matrix, E, is given by The focus of the paper is a single design point, i.e., the time of maximum dynamic pressure (TMDP). To get some insight in the closed-loop stability, a feedback law with proportional and derivative gains of K p = 2.8 (on \u03b8) and K d = 0.9 s (on q) that is known to stabilise the flexible launcher without slosh dynamics is considered. 6 This design was based on a closed-loop rigid-body requirement of 3 rad/s \u2264 \u03c9 r \u2264 8 rad/s, with a damping factor of \u03b6 \u2248 0.7, and designed for the TMDP (t = 63 s). The achieved closed-loop natural frequencies for rigid body and engine were \u03c9 r,cl = 4.9 rad/s (rigid body) and \u03c9 e,cl 37.1 rad/s (engine), with damping factors \u03b6 cl = 0.75 and \u03b6 e = 0.64. The Bode plot for the elastic system without slosh is given in Fig. 4(a) for the time point under evaluation. It shows that the elastic mode may pose a problem when controlling high-frequency oscillations due to, for instance, turbulence. It is clear that perturbations will be amplified, while controlling an error in the pitch angle (by using the engine swivel angle). However, in case the deformations remain small, the problems will most likely stay limited. At its natural frequency of 37.3 rad/s, the bending mode spikes. The second bending mode spikes at a frequency around 105 rad/s, and will probably have marginal to no effect on the control. The situation changes drastically when slosh is included, as presented in Fig. 4(b). Besides the two low-frequency \"double spikes\" of the oxidiser (z s,lox ) and fuel motion (z s,f uel ) around \u03c9 = 4.4 rad/s, the sloshing has also a significant effect on all other states. In Sec. V.A a brief assessment of this effect is given."}, {"section_title": "IV. Observer Design", "text": "In general, the states of a flexible launcher with slosh masses can be grouped into measurable and estimated states. Typically, the rigid-body states are measurable through sensors, such as accelerometers and gyroscopes. Flexible-body states can often be compensated for through the application of structural notch (or bending) filters, 19 and might not require direct measurements, albeit additional accelerometer and/or gyroscope measurements can aid the estimation process of the mode shapes. Slosh states, on the other hand, are hard (not to say impossible) to measure, and have to be estimated by observers. As observer, it has been decided to develop a sliding-mode observer (SMO), which has shown to give good results. 20 Shtessel et al. apply sliding mode observers to estimate both flexible body and slosh modes of (a linear model of) Ares I. 21 These estimates are subsequently used to remove the undesirable dynamics from the measurements, and to successfully control Ares I with an enhanced PID controller. Following a similar approach as stated in Refs. 20, 22 and 23, the system dynamics will be split into a measurable component (index a) and an unmeasurable or estimated component (index r): To set up the methodology for observer design, for a first design and to serve as example, the state-space model discussed in the previous section is simplified, by only considering rigid-body rotation (defined by \u03b8 and q) with ideal engine dynamics and a single slosh mode c . The corresponding equations of motion can be derived from the model presented in the previous section, and are given by: The corresponding E, as defined in Eq. 8, and consequently, its inverse, are found to be which, with and u = \u03b5 T,c , yields for f a , b a , f r and b r : c It will become clear in the course of this section, that to increase the dimension of the problem by including the angle of attack, as well as the second slosh mode (since the LOX and RP-1 tanks are used simultaneously), deriving closed-form expressions will be a tedious, not to say impossible, task to carry out. For that case, a numerical representation is better suited, and will also be applied. However, for introducing the basic concept, derivation based on the simplified model has been chosen. where\u017c s,1 =\u017c s,1 has been added to f r to make up the full set of equations. With estimatesx a andx r of the measurable and unmeasurable states x a and x r , respectively, the SMO dynamics is given by\u1e8b x Here, both K and L r have dimension 2\u00d72, and m = |s It is noted that K is a diagonal matrix, whereas L r is a full matrix, implying that the slosh-state estimates contain contributions from both sliding surfaces, s 1 and s 2 . The switching function, s, is based on the error in the measurable states and is defined as The observer error dynamics, consisting of\u0117 a and\u0117 r , is easily obtained by subtracting Eq. (27) from Eq. 18\u0117 Taking the derivative of s, Eq. (28), and substituting Eq. (29a), it follows tha\u1e6b To ensure sliding, appropriate values for K need to be determined, which follows from the following Lyaponov function: Sliding is guaranteed whenV < 0, or, in the current situation, when s T\u1e61 < 0, This means that s i\u1e61i < 0 for i = 1,2. In other words, with \u03d1 i being positive. With\u1e61 i following from Eq. (29), and using the definition for m, i.e., m i = |s i | \u03be , the above criterion is written as where \u2206f a,i is the i th element of \u2206f a , and it is assumed that |\u2206f a,i | \u2264 F i , with F i being a positive constant. This means for Eq. (35): Sliding for s i \u2265 1 is guaranteed when k i \u2265 \u03d1 i + F i . For small values of s i , however, either \u03be should be chosen close to zero, or k i should be sufficiently large. 23 The second step in the observer-design process is to determine L r in Eqs. (27b) and (29b). During sliding, e a = 0 and remains so (\u0117 a = 0). By the equivalent control approach, it follows from Eq. (29a) that Km sign(s) = \u2206f a . The error dynamics for the reduced sub-system, Eq. (29b), is thus Linearising about e r = 0 yields\u0117  In principle, the matrices C a and C r include parameter uncertainties, of which the bounds can be found by considering, for instance, a 20% uncertainty in the slosh parameters m s,1 , 2 s,1 , \u03c9 s,1 , and \u03b6 s,1 , and possibly a 10% uncertainty in the vehicle-related parameters I yy , m, T , and D. On the contrary, having selected the damped mass-spring system, C a and C r are independent from the slosh states. This would not have been the case if a pendulum model was chosen to represent the slosh motion. Then, C a and C r would have been highly non-linear, and uncertainty bounds for the slosh states would have had to be determined. 20 Equations (37) and (39) substituted into Eq. (36) results i\u1e45 L r is now designed using a high-gain approach for fast convergence of the slosh-state estimates. By putting the closed-loop poles of the reduced-order observer |C r \u2212L r C a | in the left half of the s-plane, as a consequence stable error dynamics is assured. To show the workings of the SMO, we use the system dynamics as defined by Eq. 18, together with Eqs. (23)-(26), and implement the SMO according to Eqs. (27)-(28), with The rigid-body state is defined at TMDP, i.e., t = 63 s, with corresponding slosh parameters for the LOX tank, of which the slosh dynamics is (marginally) stable. We assume a system at rest, with perfect knowledge about the rigid-body state (\u03b8 = q = 0), but with initial estimation errors\u1e91 s,1 = -0.1 m/s and\u1e91 s,1 = 0.3 m . With a proper design, the observer should converge to\u1e91 s,1 =\u1e91 s,1 = 0. In Fig. 5 the state estimates are shown, as well as the sliding parameters s 1 and s 2 . In this example we have assumed perfect measurements of \u03b8 and q, albeit the estimates\u03b8 andq will include small errors, because their estimates include the errors in\u1e91 s,1 and\u1e91 s,1 , see Eq. (27a). Therefore, despite ideal measurements for x a , the sliding parameters, Eq. (28), will be non-zero. Figure 5(a) shows that it takes the SMO around 2 s to converge to zero errors, after which the observer is properly tracking the slosh states. If we were to feed back the estimates into an attitude control system (in this example, a simple full-state PD controller), the response in Fig. 5(b) is obtained. With a short-duration swivel oscillation of about 1 \u2022 (not shown here), a pitch angle of about 0.2 \u2022 is induced. This, in turn, gives rise to a small slosh-mass oscillation that is hard to damp out. Conclusion from this might be that any navigation system is given some time to settle before the actual mission starts.  Now that it has been established that in its simplest form the SMO observer works, a second design will focus on the problem at hand, i.e., a flexible launcher with an oxidiser and fuel tank that both exhibit slosh motion. Besides \u03b8 and q the rigid-body states include \u03b1, the engine dynamics is represented by\u03b5 T , \u03b5 T and \u03b5 T , and two elastic modes are considered (with states\u03b7 1 , \u03b7 1 ,\u03b7 2 , and \u03b7 2 . The RP-1 and LOX tanks give rise to the slosh states\u017c s,1 and z s,1 (RP-1), and\u017c s,2 and z s,2 (LOX). We assume x a = \u03b1 \u03b8 q T to be measurable states and to be estimated states. For now, the engine and flexible states are considered to be disturbances, i.e., the engine dynamics is assumed to be fast enough, and in a proper control-system design the flexibility effects could be compensated for by bending or notch filters. 24 Therefore, we will ignore them in the SMO design, but the effects will be taken into account in the simulations. The state-space model Eq. (9) can thus be written as: In the above equations, the individual sub-matrices of A, as well as B and E, are defined by Eqs. (13) through (17). . These parameters may not be known accurately, and the effect of this uncertainty is analysed in Sec. V.C. Moreover, the SMO has been developed under the assumption that each slosh mass behaves like a (known) damped mass-spring system. However, this may just be an approximation that is not valid for the actual slosh dynamics. This model discrepancy could potentially give rise to additional non-linear disturbances. The sensitivity of the observer to errors in the slosh parameters will therefore be addressed as well. In case the actual slosh motion is better represented by a damped pendulum, studying this effect is left as future work."}, {"section_title": "V. Results", "text": ""}, {"section_title": "A. Ideal Slosh Motion", "text": "To understand the effect of sloshing, we will first consider the situation where the (single) slosh mass is given an initial perturbation of z s,1 = 0.2 m, where a distinction will be made between the RP-1 (stable pole) and LOX (unstable pole) tank. The simulations need to be run with the originally defined PD controller, 6 because an open-loop simulation will lead to rapid divergent behaviour of the rigid-body states. The established gains were K p = 2.8 (on \u03b8) and K d = 1.9 (on q). As mentioned, the moment of maximum dynamic pressure (t = 63.5 s) has been selected for this analysis. In Fig. 6, the resulting responses are shown. From Fig. 6(a) it is clear that the slosh motion in the RP-1 tank is stable, although marginally damped, whereas the one in the LOX tank is unstable. Both slosh modes induce a pitch motion and corresponding swivel actions. For the RP-1 slosh, the pitch angle remains very small, but the relatively high frequency in the swivel angle is to be avoided, of course. In the case of the LOX slosh, even though the pitch-angle error will probably not (yet) pose a large problem, the fact that it requires up to a 1 \u2022 swivel angle (which is about 17% of the maximum deflection) can become an issue. As control responses go, this situation is definitely not favourable. A potential solution to this problem may be the design of a robust, possibly non-linear controller, but alternatively the feedback of the slosh states may improve the closed-loop response. Without trying to optimise the response, we have selected K p,s = 0.02 (on z s,1 ) and K d,s = -0.01 (on\u017c s,1 ) for the next run, assuming perfect knowledge about the slosh states. For the same initial condition as before, and selecting the RP-1 tank, because of it would be the dimensioning case, the result is shown in Fig. 7. The simple PD controller has no problem at all in stabilising the slosh motion, while keeping the error in \u03b8 well below 0.1 \u2022 . The commanded swivel angle is at most 0.2 \u2022 . It is noted that the pitch-angle error is more the result of the actuator action than induced by the slosh motion. The last response test that is performed is to study the effect of an attitude command on the slosh mass, while it is initially at rest. Two runs will be done, i.e., one with rigid-body state feedback only (the original PD controller), and one where the slosh states are fed back as well. The manoeuvre to be performed is a 2 \u2022 step command in pitch angle at t = 5 sec, and a release of this command after another 10 s. Figure 8 shows the results. In Fig. 8(a)     Step on pitch angle, without and with slosh-state feedback (LOX tank only). could be added to the state-space model, but the moment the full PD controller is used, one can see that at all times the slosh motion is very small. This might not be the case when large attitude changes are commanded, so it is something to consider for the future. Considering the pitch response, the slosh motion causes some overshoot and a (too) slow convergence to the set point. However, without proper slosh feedback, the pitch angle starts diverging and the swivel angle enters some form of bang-bang mode, i.e., switching between its minimum and maximum limit. With the above simulations it has been clearly demonstrated that knowledge about the slosh states z s,1 and\u017c s,1 is crucial for controller performance. This motivates the development of the sliding-mode observer, as discussed in the previous section. In the next Sec. V.B, the results of the nominal design of the SMO will be introduced. Model errors, imperfect knowledge about the rigid-body states, the inclusion of the angle of attack, in the observer design, and simulating the vehicle with engine dynamics and flexible modes will be covered in Sec. V.C."}, {"section_title": "B. Nominal Slosh Observer", "text": "For the model Eq. (40), introduced at the end of Sec. IV, an SMO is designed with the following parameters. The gain matrix K is tuned to diag(0.4, 0.4, 2.6), whereas the sliding constants are \u03be = (0.48, 0.62, 0.58) T . To make the error dynamics Hurwitz, the feedback matrix L r is defined as which gives the (stable) poles \u03bb 1 = -0.628, \u03bb 2 = -0.527, \u03bb 3 = -32.4 and \u03bb 4 = -32.5. The former two are linked to the slosh velocity, and will show much slower convergence than the slosh position. Further tweaking of L r may shift \u03bb 1 and \u03bb 2 further to the left, but from our observations this shift is limited. In anticipation to the upcoming analysis, small errors in the observer models drive the velocity poles closer to zero, or even shift them in the unstable, right-half plane. Improving the stability of the error dynamics should therefore be pursued at a later stage. To study the observer performance, the response to an initial estimate error ofx r = (0.3 m/s,-0.2 m,-0.2 m/s,0.5 m) T is simulated, whereas the actual slosh states are zero, will be simulated. The rigid-body states \u03b1, \u03b8, and q are assumed to come from ideal measurements. Figure 9 shows the time history of the estimation errors. As expected, convergence of the slosh-velocity estimates is quite slow, and the error converges to zero in about 10 s. The estimates of the slosh position converge much faster, i.e., in a few seconds. It is observed, though, that the LOX slosh-state errors do not converge to zero, but to a small non-zero value. After convergence, the estimates remain stable, as the model that forms the basis of the observer (f a , f r , b a , and b r ) is identical to the actual system. Of course, as mentioned earlier, this will normally not be the case and additional errors will be introduced. The initial errors in the slosh estimates would have a large impact on the control-system performance, and it is therefore crucial that the SMO is activated and initialised before the mission of the launcher begins. As was shown in Sec. V.A, the feedback of slosh states improves the controllability of the launcher. With the estimates of the ideal SMO, a pitch manoeuvre is simulated. The controller is activated after t = 50 s, and at t = 60 s \u03b8 c = 2 \u2022 is commanded for 15 s. The applied controller is a state-feedback controller, with the gains calculated with optimal control theory d . Finally, to minimise slosh excitation due to discrete command changes, a first-order command pre-filter is included in the pitch-angle channel, with transfer function  with time constant \u03c4 = 1.25 s. This value has not been optimised, but as it reduces the slosh excitation it serves its purpose for this paper. The resulting response is shown in Fig. 10. Activation of the SMO is shown as a minute spike at t = 50 s. The response to the step command is smooth, albeit a small oscillation of the slosh states remains. The controller cannot fully control the slosh states, as the system is a single input, multiple output system. However, the response is reasonable enough, especially since no additional damping through, for instance, baffles, is considered. The oscillation frequency of the slosh states is close to the eigenfrequency of the coupled rigid-slosh system, and cannot be countered by the controller: the swivel command is switching at the same frequency, albeit with a small amplitude. However, even this small-amplitude oscillation prevents a smooth damping of the slosh motion. Even after 45 s the oscillation has not yet fully damped out. To verify that the swivel oscillations are not induced by the observer, in Fig. 11 the errors in the slosh states have been plotted. It is clear that these errors are smooth and have converged to their steady state (zero for the RP-1 error states and a small offset value for the LOX ones). This means that the (ideal) observer is tracking the oscillations accurately. In the next section we will see how this changes for a less than ideal observer."}, {"section_title": "C. Robustness Analysis", "text": ""}, {"section_title": "Slosh Parameters", "text": "The model description in Sec. II shows that the damped-spring slosh-mass model has several parameters that determine its behaviour: the mass, m s , location with respect to the centre of mass, s , spring stiffness, k, and damping constant, c s . Both the simulation model and the model underlying the sliding-mode observer require values for these parameters. It may be obvious that in practise, these parameters are not accurately known. Moreover, the selected model in this paper is a damped mass-spring system, but an alternative mechanical model is the damped pendulum. Either one could be chosen as slosh model. There will be a discrepancy, though, when the slosh motion is simulated using a mass-spring system with Cartesian position and velocity as its states, whereas the observer is modelled according to a pendulum, with angular displacement and velocity as state variables. Feeding angular states to a controller that expects Cartesian states may lead to an unexpected response. In this section we will restrict ourselves to the uncertainty in the parameters of the mass-spring system, and leave the effect of model choice and other non-linear effects for future work. The results of the previous section were obtained with identical models for both simulation and observer, which showed as perfect behaviour once the observer had converged. For the two tanks involved, the parameters that will be varied are Initial runs showed that the behaviour of the closed-loop system appeared to be very sensitive to differences in these parameters between the simulation and observer model. On one hand it confirms the need for an additional observer to estimate these parameters, or that uncertainty bounds for the slosh states must be determined, as has been done by Bandyopadhyay et al. for their pendulum model. 20 On the other hand, it may lead to the conclusion that the PD controller is simply not robust enough to deal with (part of) these uncertainties. In the following, we will summarise the Monte-Carlo results of a 2% and 5% variation of each of the mentioned parameters. Total number of runs is 500, whereas the parameters are uniformly distributed. To compare the controller responses and the effect of sloshing, several performance metrics will be defined. The first one is the minimum attitude deviation of the launcher with respect to the guidance commands, whereas the second one is the swivel effort that is required to achieve this. These two objectives can be expressed as the integrated pitch-angle deviation and the integrated swivel angle (equivalent to, for instance, the total hydraulic power required), given by: A graphic representation of the above metrics is shown in Fig. 12(a), represented by the grey areas, for a 2 \u2022 step command in \u03b8, starting at \u2206t = 1 s with a duration of 14 s. For optimal controller performance, both individual areas should be as small as possible, which means that their numerical equivalent can be used to evaluate different controller designs. In the given example, Another metric can be the oscillatory behaviour of either state or control variable. Oscillations in the control may not only be energy expensive and a burden on the hardware, it could also lead to instabilities. Equivalently, oscillations in the slosh states gives an indication of the severity of the motion and potential hazardous situations. To detect oscillations or otherwise discrete changes in the controls, the cumulative moving standard deviation can be used. For a subset j of n s out of a total of N samples of an arbitrary control signal u, the moving mean is defined as\u0233 j = 1 ns j+ns\u22121 i=j u i . Here, j will run from j = 1+n s /2 to N -n s /2, so each subsequent subset will shift by only one sample. Let the squared deviation from this mean be defined as s u,j = (u j+ns/2 \u2212\u0233 j ) 2 , which represents the value at the midpoint of subset j. The cumulative standard deviation, F u , for subset j is then As an example, in Fig. 12(b) the oscillation pattern of the slosh velocity is shown, due to a poorly designed control system. The cumulative standard deviation increases more rapidly when a discrete jump occurs, or when there is an interval with persistent oscillations. As a metric, the grey area under the curve can be used, which, while minimised, would lead to a smoother behaviour. In this particular example, the numerical value is F zs = 35.6 m/s. Figures 13 and 14 show the results of the first Monte-Carlo batch. The small errors of up to \u00b12% do not affect the pitch-angle deviation too much, allthough there are some outliers in terms of control effort. These outliers show that even small errors in the observed slosh states may lead to quite some more control effort, but the controller can keep the attitude response close to its nominal value (which is shown in Fig. 10). The explanation of the increased control effort can be found in Fig. 14 (Fig. 10), in some 25% of the cases this is double or more. The oscillations of the liquid are not so much larger than those in the nominal case, but still enough to double the oscillatory \"energy\" in the swivel angle. The combination of a small amplitude, the particular oscillation frequency, and the inertia of the launcher, prohibits the swivel oscillation from being transferred to the pitch angle. The situation becomes quickly worse when the slosh-parameter errors become larger. Even though there is no loss of control, the results shown in Figs. 15 and 16 show a worse performance, for just a 5% error. As before, the pitch-angle deviation has not increased much, but it is at the expense of a much larger control effort. The controller is facing more and more problems to stabilise the RP-1 and LOX slosh, which oscillations adversely affect the swivel angle. The (maximum) integrated slosh position has more than doubled, whereas the oscillatory behaviour has even tripled. Going to larger errors will lead to loss of control for this particular controller and observer combination."}, {"section_title": "Engine Dynamics and Aeroelasticity", "text": "Having established the controller sensitivity to deviations in the observer model, the next step is to increase the dynamics of the problem. First, the engine dynamics -the swivel will be represented by a third-order system -and second, two flexible modes are added. Simulating the nominal configuration of the SMO, does   not yield a smooth response, though. The (minor) response delay due to the otherwise fast swivel is already enough to induce high-frequency, coupled oscillations between slosh modes and engine, and thus inducing oscillations in the pitch angle. This has been visualised in Fig. 17. Origin is a poor functioning observer, giving very large errors in the feedback signals. A preliminary attempt to make the controller more robust is to apply a standard, rigid-body Incremental Non-linear Dynamic Inversion (INDI) controller, which has been developed in a parallel study. 24 This type of controller makes use of actuator output and angular-acceleration measurement feedback, so the desired closed-loop dynamics does not come from explicit model following, but are the implicit result from closing the feedback loops. Limitation for the current study is that the slosh states are not part of the feedback signals, so effect induced by slosh oscillations are only compensated through the rigid-body response. Including this controller in the loop, using the estimated rigid body state from the SMO, a better response is obtained. The related performance metrics are listed in Table 1, and compared to those of the PD controller. Despite the same integrated pitch-angle deviation, the control effort has reduced by a factor of five. Also the oscillations in both \u03b8 and \u03b5 T have reduced significantly. The motion of the slosh masses has increased, though, although the velocity oscillations have reduced, meaning smaller perturbing accelerations.  Inspecting the oscillations of the slosh masses shows that the frequency has reduced significantly, and the masses are now oscillating with their natural frequencies. To get a feeling for the INDI response, we do one additional simulation, but now with the two flexible modes included. The response is almost identical to the previous case, with practically the same values of the performance metrics. The results are shown in Figs. 18 and 19. It is once more pointed out that the system is oscillating at a frequency close to the natural frequency of the slosh masses. From the results the coupling between rigid-flex-slosh modes is apparent. The system as a whole is poorly damped, and with the induced motion of the flexible body this may become an issue for the structure. Besides redesigning the INDI controller by including the slosh states in the feedback loops, an alternative option to improve the response and remove the oscillations could be to include notch filters in the feedback loops. This option has been studied for the flexible launcher without sloshing in Ref. 24, and could be extended to the current configuration. However, this is left as future work. "}, {"section_title": "VI. Conclusions and Recommendations", "text": "In this paper, the main focus was to design a slosh-state observer that can improve the attitude controller performance of a flexible, conventional launcher with non-linear engine dynamics. The flight-dynamics model of the rotational motion is a linearised state-space model of the pitch-plane motion, including engine dynamics, elastic modes, and slosh dynamics that can originate from multiple tanks and/or multiple modes. The slosh model is based on individual damped mass-spring systems, and has been modelled separately for the fuel and oxidiser tanks of the PacAstro launch vehicle. From the analysis of the slosh modes it has been concluded that only the first slosh mode is of importance. Strong coupling with the rigid-body and the flexible-body modes has been identified in the model. Stabilising the system with a simple PD controller and inspecting the gain and phase margins, shows that sloshing has a major effect and poses a problem for a standard proportional-derivative control system. A significant and increasing control effort is required to stabilise the vehicle. When the slosh states (position  and velocity of the slosh mass) are fed back, the performance improves drastically, which leads to the conclusion that information about the slosh states is indispensable and that these states should be fed back to the controller. A sliding-mode observer has been designed to estimate these slosh states. Development of such an observer for a simplified, two-state model is straightforward and leads to an analytical formulation for gain calculation and implementation, but one has to resort to numerical techniques to do so for higher-order systems. The current implementation of the observer is based on a rigid launcher with one or two slosh modes, coming from the RP-1 and LOX tanks of the first stage. The nominal performance of the observer, i.e., when simulation and observer model are identical in terms of slosh parameters (mass, eigenfrequency, location, and damping factor), is excellent. Convergence of the observer error dynamics is achieved in at most 10 seconds, so only a short initialisation time is required before activating the control system. Small oscillations of the slosh masses remain after a step response, with a frequency close to the natural frequency of the slosh masses. The PD controller cannot remove these, and the swivel commands exhibit some form of limit-cycle behaviour. A robustness analysis has been performed in two stages. First, the parameters underlying the slosh model have been varied for the simulation model, whereas the corresponding observer parameters are kept at their nominal values. The results show that the performance is very sensitive to these differences. With only a two percent variation, the rigid-body response may be unaffected, but outliers exhibit to a doubling of the control effort and slosh motion. With a 5% variation, though, the (maximum) integrated slosh position has more than doubled, whereas the oscillatory behaviour has even tripled. Rigid-body response is not so much affected, but quite a large number of outliers point to a significant increase in control effort, as well as strong fluctuations in control command. Including engine and flexible-body dynamics in the simulation model leads to a significant performance degradation of the observer, and resulting errors are too much for the PD controller to handle. Changing to a rigid-body Incremental Non-linear Dynamic Inversion (INDI) controller increases robustness significantly, but it exhibits a form of limit-cycle behaviour, because feedback of the slosh states is lacking. All results considered, the sliding-mode observer seems to be a potential candidate for estimating the slosh states, provided an additional estimator is included to observe the relevant slosh-model parameters. Changing the PD controller to an INDI controller will benefit the robustness, but adapting the latter to include slosh information seems a worthwhile extension. Moreover, including notch filters in the feedback loops to filter out any natural frequencies will improve the performance. From a modelling point of view, the slosh model should be changed by including the tank walls. Limits in the numerical integrator, i.e., when a slosh mass hits the tank wall the slosh velocity will be inverted and the position is limited to the tank diameter, will give a more realistic model. Finally, a final decision should be made whether a damped mass-spring system or a damped pendulum is the right model for slosh motion in cylindrical tanks, and how this choice will affect the observer model. Note that all locations are measured from the aft skirt of the launcher, positive towards the nose (payload). "}]