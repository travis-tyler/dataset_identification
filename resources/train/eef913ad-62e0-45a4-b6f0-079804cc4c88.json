[{"section_title": "Abstract", "text": "Abstract-We present a method that significantly improves magnetic resonance imaging (MRI) based brain tissue segmentation by modeling the topography of boundaries between tissue compartments. Edge operators are used to identify tissue interfaces and thereby more realistically model tissue label dependencies between adjacent voxels on opposite sides of an interface. When applied to a synthetic MRI template corrupted by additive noise, it provided more consistent tissue labeling across noise levels than two commonly used methods (FAST and SPM5). When applied to longitudinal MRI series it provided lesser variability in individual trajectories of tissue change, suggesting superior ability to discriminate real tissue change from noise. These results suggest that this method may be useful for robust longitudinal brain tissue change estimation.\nBrain imaging studies increasingly depend on the ability to accurately and consistently identify changes in tissue volumes over time from serial MRI. Many methods for assigning tissue labels to pixels in an individual MRI are applicable to this problem: such methods are applied separately to each individual MRI in a longitudinal series. Typically these approaches use automatic initialization (see e.g. [1, 2] ) together with the expectation-maximization (EM) algorithm [3] and Markov random fields (MRF) (see e.g. [4, 5] ) to estimate Bayesian maximum a posteriori (MAP) tissue labels [4, 6] that agree with prior knowledge of tissue appearance and are situated in a plausible spatial arrangement.\nComparatively little attention, however, has been paid to the problem of tissue segmentation consistency over time. In many cases, volumes of specific tissue compartments are expected to increase (e.g., gray matter in typicallydeveloping children) or decrease (e.g. gray matter in elders with Alzheimer's disease) steadily over time in any individual; methods that separately segment each image in a longitudinal series are not strictly required to enforce such plausibility. SIENA [7, 8] is one method that does attempt to enforce plausible longitudinal change, but it is aimed at reporting overall brain tissue loss rather than changes to *"}, {"section_title": "I. INTRODUCTION", "text": "Brain imaging studies increasingly depend on the ability to accurately and consistently identify changes in tissue volumes over time from serial MRI. Many methods for assigning tissue labels to pixels in an individual MRI are applicable to this problem: such methods are applied separately to each individual MRI in a longitudinal series. Typically these approaches use automatic initialization (see e.g. [1, 2] ) together with the expectation-maximization (EM) algorithm [3] and Markov random fields (MRF) (see e.g. [4, 5] ) to estimate Bayesian maximum a posteriori (MAP) tissue labels [4, 6] that agree with prior knowledge of tissue appearance and are situated in a plausible spatial arrangement.\nComparatively little attention, however, has been paid to the problem of tissue segmentation consistency over time. In many cases, volumes of specific tissue compartments are expected to increase (e.g., gray matter in typicallydeveloping children) or decrease (e.g. gray matter in elders with Alzheimer's disease) steadily over time in any individual; methods that separately segment each image in a longitudinal series are not strictly required to enforce such plausibility. SIENA [7, 8] is one method that does attempt to enforce plausible longitudinal change, but it is aimed at reporting overall brain tissue loss rather than changes to specific compartments (i.e., gray matter, white matter, and cerebrospinal fluid -CSF). In addition its performance has been shown to deteriorate in the presence of noise or MRI field non-uniformities [9] . Another approach uses a true \"4-D\" image framework to ensure that tissue classification of an image voxel is consistent with its neighbor locations in both space and time [10] . This is accomplished using warps to register images from all time points to a template, followed by segmentation that encourages both spatial and temporal consistency in labels. State-of-the-art MAP algorithms for tissue appearance and spatial arrangement do not scale well to segmentation problems involving many images in a series; thus, approaches of this type are forced to make approximations that amount to playing a tradeoff between temporal consistency and accuracy of segmentation at any given time point.\nIn this paper we propose that incorporating robust tissue boundary estimates into tissue segmentation of individual images in a longitudinal series can lead to greater plausibility in tissue change estimates. In an MRF model of tissue spatial arrangement, we use tissue boundaries estimated from edge operators to encourage differing tissue labels on opposite sides of a boundary. We compare this Gradient-based Segmentation (GSeg) method against two readily available and commonly used tools, SPM5 (http://www.fil.ion.ucl.ac.uk/spm/) [11] and FAST (http://www.fmrib.ox.ac.uk/fsl/) [5] , for segmentation performance on an individual synthetic image corrupted by varying degrees of noise, and on real longitudinal MRI series of elderly individuals. We hypothesized that incorporating boundary information into an MRF would enable greater robustness against noise and improved longitudinal consistency of tissue change estimates."}, {"section_title": "II. METHODS", "text": ""}, {"section_title": "A. Maximum a Posteriori (MAP) Algorithm", "text": "The image is defined as an array y of intensities, with one entry y i for each pixel i. A segmentation of the image is a corresponding array of labels x, such that each pixel label is drawn from a small set of K possible labels {L 1 , L 2 , ..., L K }.\nHere K will be 3 or 4, corresponding to CSF, gray matter, normal white matter, and optionally white matter hyperintensities. Given a conditional probability density p for the segmentation labels conditioned on the image intensities y, we seek an optimal labeling, x*, such that \n(2) The two components in equation (2) are the measurement model p( y | x ) and the prior model p(x). The measurement model requires that the intensity of every pixel assigned to a particular tissue class be drawn from a Gaussian distribution whose mean and standard deviation are estimated at the time of segmentation. The prior model assumes that x is a Markov random field (MRF) so that the prior probability of a tissue label x i at voxel i depends only on the labels of neighboring voxels. The prior model quantifies the degree to which x i and neighbors have a plausible assignment of labels, based on the number of neighbors whose labels agree with x i as well as an expected frequency of each possible label. It is expressed as a Gibbs distribution [4] of the form\nwhere Z is a normalizing constant, \uf064 is an indicator returning 1 if the condition inside the parentheses is true and zero otherwise, and \uf061 k measures the weight of belonging to tissue class k. The V c have the format\nwhere\nare functions depending on the tissue class labels of first-order and second-order neighbors, respectively, and the \uf062 coefficients are determined at each iteration [4] . We select the form of f 1 and f 2 to adapt the prior to the presence of edges, as described below.\nWe use an iterative EM optimization to interleave estimation of x* based on current \uf061 and \uf062 estimates and Gaussian intensity distribution parameters, with estimation of \uf061, \uf062, and Gaussian parameters based on the current x*[4]."}, {"section_title": "B. Adaptive Prior Model", "text": "Our prior model weights label differences between x i and its neighbors differently depending on the likelihood that a tissue interface passes near location i, as determined by the image intensity gradient magnitude. Far from tissue boundaries, we encourage homogeneous tissue neighborhoods (i.e. encourage all x j to be equal) by selecting In particular, far from edges both f 1 and f 2 take on this form:\nfor tissue class L j , where n(L j ) is the number of neighbors of voxel i that are labeled L j , and N is the total number of neighbors. It is minimal (negative) when all neighbors are of the same class L j as voxel i. Near edges, by contrast,\nThe first term of this function is minimized (zero) when exactly half of the pixels in the neighborhood are labeled L j . The second term is minimized when the product is zero, i.e. To select the format of the f functions at each voxel, we calculate the image gradient magnitude by convolving the image with derivative of Gaussian filters in the x, y and z directions (2.4 mm FWHM), calculating the Euclidean (sum of squares) gradient magnitude from the partial derivatives. We construct the histogram of gradient magnitude values and set a threshold for edge proximity to be the gradient magnitude where the maximum histogram peak occurs (i.e. the histogram \"mode\" or most frequent value of the gradient magnitude). Voxels whose gradient magnitudes are above this threshold are considered to be near edges and assigned the set of f functions (6); other voxels use the functions (5)."}, {"section_title": "C. Automatic Initialization using Template-Based Tissue", "text": "Masks Our EM procedure alternates between estimating voxel labels and estimating MRF parameters. We initialize the labels using template-based tissue probability maps generated in-house.Each tissue probability map is warped onto the native subject image via a high-dimensional Bspline warping [12] previously computed to match a normal elderly minimal deformation template [13] with the subject brain. When the warped probability masks are overlaid on the native brain image, an initial classification x is made labeling each voxel with the tissue class corresponding to the highest value among the three warped probability masks."}, {"section_title": "III. RESULTS", "text": "We compare the performance of our method against FAST and SPM5 using visual comparisons and a segmentation of the BrainWeb template. We then analyze the utility of the segmentations for measuring longitudinal tissue change. Finally, we illustrate the contributions of the adaptive prior to segmentation accuracy."}, {"section_title": "A. Comparisons Using the Synthetic Image Template", "text": "Each of the three methods were used to segment the BrainWeb [14] (http://www.bic.mni.mcgill.ca/brainweb/) template image at two levels of random Gaussian noise: 3% and 5%.\nVisual comparison of the BrainWeb segmentations is presented in Fig. 1 . Segmented tissue boundaries appear comparable at low noise levels (3%-5%) across all methods with the exception of brainstem segmentation for FAST (black arrow in row 2): at 5% it appears (erroneously) white. The GSeg method did a better job of representing small sulci and finger-like extensions of the white matter into gray, though possibly overstating sulcal CSF."}, {"section_title": "GSeg", "text": "FAST SPM Figure 1 . Segmentation of BrainWeb template at noise levels 3% (top row), 5% (bottom).\nFAST SPM Figure 2 . Comparison of segmentations of a single subject at baseline (top row) and one year scan (bottom)."}, {"section_title": "B. Statistical Analysis of Longitudinal Segmentation", "text": "We applied the three methods to brain MRI of 57 cognitively normal and 60 demented individuals from the ADNI study and compared one-year changes in gray matter, white matter, and CSF across methods [15] . Images from each individual's baseline, 6 month, and 1 year visits were segmented by each method. Fig. 2 shows baseline and oneyear results for a single subject. Methods were compared for within-person variation in tissue volumes over time. To assess within-person variation, for each segmentation method and tissue type a subject-specific linear regression was fit to the tissue volumes as a function of time, and the sum of squared residuals was recorded. Segmentations with lesser residuals may be able to quantify the true rate of change more precisely under an assumption of linear change, and thus may have greater utility for detecting true tissue change in longitudinal studies of brain aging.\nWe compared methods using a randomized block analysis of variance (ANOVA), with subjects as blocks, methods as fixed effects, and the logarithm of the sum of squared residuals as the outcome measure. Post-hoc pair wise comparisons between the methods were performed, with adjustments to the p-values using the Tukey Honestly Significant Differences (HSD) approach to account for multiple comparisons. Freidman's rank test and the corresponding rank-based multiple comparison adjustment were used if the assumptions of the ANOVA were not met by the data. Analyses were conducted separately for AD and Normal subjects and p<0.05 was considered statistically significant. For longitudinal gray matter change in AD subjects there was a significant difference between methods in within-person variation (Fig. 3 top, p<0 .01), with GSeg showing significantly less within-person variation than both FAST and SPM (p<0.05, adjusted) and FAST having intermediate variability between GSeg and SPM. In Normal subjects there was a significant difference between methods in within-person variability (Fig. 3 bottom, p<0 .05). SPM had significantly greater variability than GSeg (p<0.05 adjusted), but GSeg and FAST were not significantly different."}, {"section_title": "FAST", "text": ""}, {"section_title": "GSeg SPM", "text": ". Fig. 4 shows samples of segmentation of the BrainWeb template with 3% noise, using the adaptive prior (equations (5-6)) compared with a prior that favors homogeneous tissue neighborhoods everywhere [4] . Clear differences between the panels are visible. The boundary between lentiform nucleus and cortical gray is more clearly delineated in the right panel. The middle panel merges the two gray areas whereas the adaptive technique keeps them separated. Similarly, sulci in the vicinity of the insula show greater coherence in the right panel. IV. DISCUSSION Fig. 3 suggests that the GSeg method has achieved, on average, straight-line estimates of one-year longitudinal tissue change, unlike the other methods; this linear change may be more biologically plausible than nonlinear change, and therefore the GSeg method may be superior for quantifying longitudinal change. Examination of the single subject in Fig. 2 suggests that subcortical segmentation is a specific reason for its superiority. GSeg has a more robust and consistent representation of subcortical areas (thalamus and putamen) over time than either FAST or SPM5. Cortical details are also better represented in both GSeg and FAST than in SPM5. Fig. 4 suggests that the adaptive prior may be responsible for this performance advantage."}, {"section_title": "C. Contribution of Adaptive Prior", "text": "Our method does not simultaneously perform segmentation on a series of same-subject longitudinal scans. As discussed in the introduction, such true \"4-D\" techniques have tradeoffs of consistency over time vs. accuracy at single time points. Insead, our results have suggested that the adaptive edge-based technique, applied at single time points, results in improved segmentation detail which in turn gives improved consistency over images in a longitudinal series (Fig. 3) .\nThe method has some limitations. Without further processing the segmented image tends to be noisier due to false positives in edge detection. This requires a final \"speckle removal\" step in the segmentation algorithm. Another potential imitation is that incorrect warping during the automatic label initialization could cause misclassification which may not be corrected during the EM phase, leading to tissue segmentation errors. We have found that this has not been a significant issue in most images."}, {"section_title": "V. CONCLUSION", "text": "We have compared three methods of image segmentation for consistency of tissue labels over varying levels of noise on the BrainWeb template and also for consistency over three-time-point longitudinal scans of AD and Normal subjects in the ADNI database. Our proposed method uses automatic initialization and an adaptive prior to achieve more robust segmentation in the presence of noise, particularly at tissue boundaries. Our results have indicated that these components can improve the segmentation of longitudinal image series compared to FAST and SPM."}]