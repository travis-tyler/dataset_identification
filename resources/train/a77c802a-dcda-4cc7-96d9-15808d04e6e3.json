[{"section_title": "Abstract", "text": "Considering that causal mechanisms unfold over time, it is important to investigate the mechanisms over time, taking into account the time-varying features of treatments and mediators. However, identification of the average causal mediation effect in the presence of time-varying treatments and mediators is often complicated by time-varying confounding. This article aims to provide a novel approach to uncovering causal mechanisms in time-varying treatments and mediators in the presence of time-varying confounding.queryPlease check and confirm edit made in the article title. We provide different strategies for identification and sensitivity analysis under homogeneous and heterogeneous effects. Homogeneous effects are those in which each individual experiences the same effect, and heterogeneous effects are those in which the effects vary over individuals. Most importantly, we provide an alternative definition of average causal mediation effects that evaluates a partial mediation effect; the effect that is mediated by paths other than through an intermediate confounding variable. We argue that this alternative definition allows us to better assess at least a part of the mediated effect and provides meaningful and unique interpretations. A case study using ECLS-K data that evaluates kindergarten retention policy is offered to illustrate our proposed approach."}, {"section_title": "Introduction", "text": "Retention is a school policy that requires students to repeat a grade if they fail to make adequate progress. Recent studies using same-age comparisons have found negative effects of kindergarten retention on student math achievement among those students who are at risk for grade retention (Hong & Raudenbush, 2005 , 2006 Vandecandelaere, Vansteelandt, De Fraine, & Van Damme, 2016) . Vandecandelaere et al. (2016) demonstrated that this negative effect persists throughout primary education, although the effect attenuates over time. As a next step, it is important to investigate why kindergarten retention has a negative effect and how this adverse effect attenuates over time.\nIn this article we discuss a novel approach to causal mediation analysis with two time-varying treatments and mediators, in which we investigate causal mechanisms underlying the relationship The causal structural model used in the case study. Note Retention at K: Retention status at Kindergarten, Classmates: Classmates' math score, Year n: nth year of the study, and Math: math score.\nbetween the kindergarten retention policy and student math achievement. Figure 1 is a graphical representation of the model. The time-varying treatments are the retention status at kindergarten and year 3, and the time-varying mediators are classmate math ability measured at year 2 and year 4. The outcome of interest is student math achievement measured at the end of year 4. We hypothesize that grouping retained students with classmates who are one year younger may provide fewer chances to interact with the more advanced, promoted peers of the same age, thereby slowing down the retained students' learning. We specifically focus on the emerging mediation effect via classmate math ability one year after kindergarten retention to determine how the adverse effect of kindergarten retention attenuates over time.\nThe substantive causal questions examined in this article are 1. Does classmate math ability mediate the negative effect of kindergarten retention on math achievement during the first year after kindergarten retention? 2. Are there significant emerging mediation effects via classmate math ability one year after kindergarten retention? 3. Do the emerging mediation effects differ by retention status and/or by intermediate math score?\nThe first question can be answered by conducting a single-time-period causal mediation analysis. The second and third causal questions, which involve more than a single time period, have three methodological challenges to answer. First, in order to investigate causal mechanisms with two time-varying treatments and mediators, it is important to account for time-varying confounding variables in addition to pre-treatment covariates. For example, the math score measured at the end of year 2 may be an important intermediate confounding variable. The issue is that this intermediate math score is a posttreatment variable, which is affected by kindergarten retention status (treatment), and also confounds the relationship between future classmate math ability (mediator) and final math score (outcome). In the presence of a posttreatment confounding variable, the average causal mediation effect (ACME) and the average natural direct effect (ANDE) are not identified nonparametrically unless one assumes the absence of interaction effects in the mediator-mediator or treatment-mediator relationships with respect to the outcome (see, e.g., Avin, Shpitser, & Pearl, 2005; VanderWeele & Vansteelandt, 2014; Imai & Yamamoto, 2013) .\nHere, the ACME is the average effect of kindergarten retention on math achievement mediated by classmate math ability, and the ANDE is the average direct effect of kindergarten retention on math achievement, which is not mediated by classmate math ability. The inability to nonparametrically identify the ACME and ANDE prevents investigation of causal mechanisms in longitudinal studies unless one is willing to make strong linearity and no-interaction effect assumptions. Under these modeling assumptions, the mediation effect would be identified and estimable using the product of coefficients approach as in the SEM framework (De Stavola, Daniel, Ploubidis, & Micali, 2014) .\nSecond, the validity of results also depends on whether the ACME and ANDE are homogeneous or heterogeneous (see, e.g., Imai & Yamamoto 2013; VanderWeele & Vansteelandt, 2014) for heterogeneous effects; and Daniel, De Stavola, Cousens, and Vansteelandt (2015) for homogeneous effects). Homogeneous effects refer to a situation where every subject has the same constant effect, whereas heterogeneous effects allow for systematic or random variations of the effects. If effect homogeneity does not hold, we need to use a different strategy to identify ACME and ANDE. Therefore in order to estimate consistent and meaningful mediation effects from real data, it is crucial to understand differences in causal estimands (effects of interest) and the respective assumptions that are required to identify the causal estimands under homogeneous and heterogeneous effects.\nThird, the effect homogeneity assumption is unrealistic in many cases; it is therefore essential to appropriately account for heterogeneous effects. Imai and Yamamoto (2013) developed a sensitivity analysis in the context of multiple mediators that can be used under heterogeneous effects. The sensitivity analysis is designed to check the robustness of findings to potential violations of the no-interaction effect (in the treatment and mediator relationship) assumption under heterogeneous effects. However, generalizing their sensitivity analysis does not yield much information with respect to ACME and ANDE when time-varying confounding variables are present. This is because the corresponding sensitivity analysis depends on too many unknown sensitivity parameters (due to the added complexities of time-varying confounding variables).\nThe goal of this article is, therefore, to provide a comprehensive approach for investigating causal mechanisms with time-varying treatments and mediators that allow for time-varying confounding variables under both the homogeneous and heterogeneous effects assumption. Importantly, we suggest alternative definitions of ACME and ANDE that require fewer assumptions than the original definitions of ACME and ANDE. These alternative definitions provide insights regarding how the adverse effect of kindergarten retention attenuates over time, by fixing the effect via the intermediate math score. Our alternative definitions of ACME and ANDE also enable us to examine whether and how mediation effects vary with the level of the intermediate math score. Given the complex nature of causal mediation analysis with time-varying treatments and mediators, we provide practical suggestions for drawing meaningful conclusions from mediation analyses with real-life data.\nThe remainder of this article is organized as follows. We begin by providing a brief introduction to the data and our example. This is followed by introducing notation and definitions. Sections 4 and 5 provide a partial identification strategy and corresponding analyses of sensitivity to the alternative definitions of ACME and ANDE under homogeneous effects and heterogeneous effects, respectively. Then, we present a case study in which our proposed method is applied to the kindergarten retention study. The article concludes with a discussion."}, {"section_title": "Data", "text": "The Early Childhood Longitudinal Study, Kindergarten (ECLS-K) data provide representative information about a cohort of American children who attended kindergarten in 1998-1999 (1) K = kindergarten; G1-G3 = grade 1 through grade 3.\n(2) Descriptions for variables (T 1 , M 1 , L , T 2 , M 2 , and Y ) are given in Sect. 3. (Tourangeau, Nord, L\u00ea, Sorongon, & Najarian, 2009 ). The cohort was followed from kindergarten to the 8th grade. For ease of explanation, the 1998-1999 to 2001-2002 school years are referred to as year 1 to year 4. Table 1 shows the structure of the data. For example, if a student has never been retained at the end of year 1, s/he will be promoted to the first, second, and third grades in years 2, 3, and 4, respectively; and if a student has retained at the end of year 1, s/he will repeat kindergarten at year 2 and be promoted to the first, and second grades in years 3 and 4, respectively. Our sample includes 342 kindergarten retainees and 11,248 students who were promoted. As shown in Fig. 1 , retention statuses measured at the end of year 1 and year 3 serve as our timevarying treatments. The level of classmate math ability serves as our time-varying mediator and is measured by aggregating the math scores at the class level in years 2 and 4, except him/herself. Our final outcome is student math achievement measured at the end of year 4. Student math scores are calibrated by item response theory (IRT) and are vertically equated over time, which enables us to compare outcomes between those who are retained and promoted. Note that we compare students' vertically equated scores. The consequences of using vertically equated scores that are invalid with respect to underlying student ability are discussed in Steiner, Park, and Kim (2016) .\nPre-treatment covariates include individual demographic characteristics; previous learning experiences, cognitive, emotional, and social development at the student level; teacher years of experience; and teacher educational degree at the class level. At the school level, we include the proportion of minorities, teacher salary, public/private school, number of students in kindergarten, number of students retained, and percentage of students retained at school. We consider student math scores measured before kindergarten and year 2 as the time-varying confounding variable. Particularly, student math achievement measured at year 2 is the intermediate confounding variable that is affected by the kindergarten retention status and has an impact on future classmate ability and math score measurements.\nOur data have a hierarchical structure where students are nested within classes and schools. Although it is important to consider the hierarchical structure in estimating the mediation effects, it is very challenging with longitudinal data because class and school memberships changes over time. The intraclass correlation computed from our final outcome, student math achievement measured at the end of year 4, is 0.29, which indicates that the standard errors of estimates might be underestimated due to this hierarchical structure of the data."}, {"section_title": "Notation and Definitions", "text": "To begin, let T 1i \u2208 {0, 1} and T 2i \u2208 {0, 1} be the first-and second-time measured retention statuses for individual i, where T = 1 if retained and T = 0 if promoted. Let M 1i and M 2i be the \nA potential value of M 2 that would have\n) and the potential values of the first and second if t = t = t mediators under T 1i = t and T 1i = t , respectively. \nwhere \u03c9 represents the support of the potential outcome of Y and t, t and t \u2208 {0, 1}. Table 2 presents key potential outcomes that are used throughout.\nIn this notation, we first discuss the originally defined ACME and ANDE with two timevarying treatments and mediators and then introduce our alternative definitions of ACME and ANDE. There are several ways to decompose the total effect of kindergarten retention, but we focus on the following definitions of ACME and ANDE that are relevant to our causal questions."}, {"section_title": "Definitions of ACME and ANDE", "text": "The ACMEs via M 1 and via M 2 under t (\u03b4 M 1 (t), \u03b4 M 2 (t)) and the ANDE under t (\u03b6(t )) are respectively defined as\n(1)\nCausal structural model highlighting the ACME. a ACME via M 1 . b ACME via M 2 for t \u2208 {0, 1} and t = 1 \u2212 t. 2 The path-specific effects of \u03b4 M 1 and \u03b4 M 2 are highlighted in Fig. 2 . The ACME via M 1 (\u03b4 M 1 (t)) is the effect of kindergarten retention on student math score transmitted along classmate math ability in year 2. The ACME via M 2 (\u03b4 M 2 (t)) is the effect of kindergarten retention on student math score transmitted along classmate math ability in year 4, either directly or mediated by classmate math ability in year 2. Lastly, the ANDE \u03b6(t ) states the direct effect of kindergarten retention on student math score through neither of the mediators. The ACMEs via M 1 and via M 2 and ANDE are combined into the average kindergarten retention effect (\u03c4 ), which is defined as the expected change in student math achievement in response to a change from not retained to retained at kindergarten if everyone was not retained at year 3. In formal expression,"}, {"section_title": "t), and \u03b6(t ).", "text": "These path-specific effects shown in Eq. (1) have been defined and discussed in the multiple mediators context (see, e.g., Daniel et al. 2015; Imai & Yamamoto, 2013; Steen, Loeys, Moerkerke, & Vansteelandt, 2017; VanderWeele & Vansteelandt, 2014 ); yet, there has been little discussion on these path-specific effects in the context of time-varying treatments and mediators. Identifying 2 Following an inductive rule by Shpitser (2013) , the definition can be rewritten as,\n, and\nfor t \u2208 {0, 1} and t = 1 \u2212 t.\n3 Suppose that t = 1; then, we have\nThis is the same when t = 0. Causal structural model highlighting the ACME-l. Note T 1 : first treatment measurement, T 2 : second treatment measurement, M 1 : first mediator measurement, M 2 : second mediator measurement, Y : outcome, V : pre-treatment covariates, and L: time-varying confounding variable. a ACME-l via M 1 . b ACME-l via M 2 these path-specific effects in multiple mediators context shares some similar challenges such as a time-varying confounding or treatment-induced mediator and outcome confounding issue, which gives many implications to studies on time-varying treatments and mediators. Despite the similarity, a time-varying treatments and mediators case is often more complicated because of additional treatment variables and multiple time periods. Therefore, we propose alternative definitions that require less assumptions to be identified than these path-specific effects shown in Eq.\n(1)."}, {"section_title": "Alternative Definitions of ACME and ANDE", "text": "We propose alternative definitions of the ACME and ANDE in which the intermediate math score is fixed to a specific value L i = l (ACME-l and ANDE-l) as below.\nfor t, t \u2208 {0, 1}. The path-specific effects of \u03b4 M 1 (t, l), and \u03b4 M 2 (t, l) are highlighted in Fig. 3 . The alternative definition of the ACME via M 1 (\u03b4 M 1 (t, l)) is the effect of kindergarten retention on student math score transmitted by classmate math ability in year 2, after fixing the intermediate math score to L i = l. The ACME-l via M 2 and ANDE-l are interpreted in the same manner as the counterparts shown in Sect. 3.1 while fixing the intermediate math score to L i = l. These alternative definitions can be used both when L is continuous or categorical. With continuous L as in our example, we can fix L to a quantile, depending on researcher's judgment. With categorical L, we can fix L to each category. Holding L fixed should be interpreted as hypothetical intervention, not as conditioning or adjusting on the variable (Pearl, 2009) . This implies that the values of L are no longer determined by its parent variables (previously measured variables that affect L), and thus, no mediating effects are transmitted via L (see Fig. 3 ). As a result, the mediation effects defined in Eqs. (1) and (2) actually differ in terms of variables through which the effects are transmitted. For example, the ACME via\ndoes not include these paths because, after fixing L, its parent variables T 1 and M 1 no longer affect L (the corresponding arrows are gone).\nThe combined effect of ACME-l and ANDE-l can be interpreted as a controlled direct effect if T 1 , L, and Y represent treatment, mediator, and outcome variables, respectively. A controlled direct effect represents how much math scores at year 4 would change if math scores at year 2 were fixed at level L i = l in the entire population, but the kindergarten retention status was changed from not retained to retained. In formal expression,\nThis controlled direct effect for a fixed L = l is further decomposed into the ACME-l and ANDEl. The usefulness of this controlled direct effect becomes evident with the following example. Suppose that grouping with younger kids has a side effect of lowering self-esteem of retainees, and hence, intermediate confounding variables include self-esteem. The interest now is focused on whether kindergarten retention has an effect on the final math score, regardless of the indirect effects of kindergarten retention might have on the final math score by way of deteriorating self-esteem. It is because this controlled direct effect represents a stable kindergarten retention effect that is invariant to personal and social factors (such as gender, socioeconomic status, parent support, etc.) that may affect self-esteem.\nLikewise, the controlled direct effect (and subsequently, the ACME-l and ANDE-l) with our example, in which the intermediate confounding variable is the math score, allows us to learn about the mediating process by removing the effect transmitted through the intermediate math score. The alternative mediation effect (ACME-l) is now focused on whether kindergarten retention has an effect on the final math score via interacting with classmates, regardless of what indirect effects kindergarten retention might have via the intermediate math score. This removed indirect effect is the average kindergarten retention effect (T 1 ) on the intermediate math score (L) either directly or mediated by classmate math ability (M 1 ), which can be obtained from a single-time-period causal mediation analysis, being prolonged to the next time period (e.g.,\n. Hence, the alternative mediation effect can be regarded as the mediation effect that has emerged one year after kindergarten retention, considering that this alternative mediation effect was never captured in the single-time-period analysis (either by means of computing average direct effects or average mediation effects). This alternative definition is particularly informative in our case by identifying the effects that have emerged one year after kindergarten retention."}, {"section_title": "Identification and Sensitivity Analysis Under Homogeneous Effects", "text": "This section presents identification results for the alternative definitions of ACME and ANDE and provides a sensitivity analysis when effects across individuals are assumed to be constant. As previously discussed, the existence of intermediate confounding variables prevents identification of the ACME and ANDE. A simple solution would be to assume the absence of intermediate confounding, but this assumption is frequently unrealistic in practice. Therefore, recent studies on a time-varying treatments and mediators model attempted to solve this intermediate confounding issue. For example, VanderWeele and Tchetgen Tchetgen (2016) proposed the use of randomized interventional analogues of natural direct and indirect effects that are identified even when intermediate confounding is present (see \"Appendix A\" for more discussion on the randomized interventional analogues). Another approach, which was proposed by Bind, Vanderweele, Coull, and Schwartz (2016) , is to identify the ACME with exogenous treatments using generalized mixed-effects models. The model proposed by Bind and her colleagues requires the absence of treatment-mediator confounding; this absence can be achieved by using exogenous treatments or sequential randomization of treatments. Their proposed approach would not be applicable in our example, where the assumption is not met. Therefore, we focus only on ACME-l and ANDE-l instead of ACME and ANDE, respectively.\nFor the identification of ACME-l and ANDE-l shown in Fig. 3 , we apply the approach suggested by Daniel et al. (2015) , which introduces a set of sensitivity parameters under homogeneous effects to facilitate identification. First, the following sequential ignorability assumption is required to identify ACME-l and ANDE-l, up to a sensitivity parameter.\nfor any value of t, m 1 , m 2 , l, and v. In addition, we assume consistency and that L should include all time-varying confounding variables. Assumption A1 states that kindergarten retention status is ignorable given pre-treatment covariates. Assumption A2 states that student retention status in year 3 is ignorable given the observed first treatment status, first mediator value, pre-treatment covariates, and intermediate confounding variable. The first line of assumption A3 states that there is no unmeasured confounding in the M 1 \u2212 Y and M 1 \u2212 M 2 relationships. In our example, this implies that there is no confounding in the relationships between classmate math score in year 2 and final math score (M 1 \u2212 Y ) and between classmate math score in years 2 and 3 (M 1 \u2212 M 2 ), given the first treatment and pre-treatment covariates. The second line of assumption A3 states that there is no unmeasured confounding between the M 2 \u2212 Y relationship. This implies that there is no confounding in the relationship between classmate math score in year 3 and final math score given the treatment and mediator history, pre-treatment covariates, and intermediate confounding variable.\nUnder this sequential ignorability assumption,\nis identified up to a sensitivity parameter as follows.\nfor every m 1 , m 1 , m 2 , v, and l where t, t , t \u2208 {0, 1}. The proof is given in \"Appendices B and C.\" The boxed quantity in Eq. (4) is not identified because the conditional correlation between M 1i (t ) and M 1i (t ) given V i = v, which is denoted as \u03c1 M 1 , is not known. The issue here is that this correlation coefficient is not empirically determined because we never observe individual potential outcomes under different treatment statuses simultaneously. Therefore, this correlation is used as a sensitivity parameter that ranges from 0 (no correlation across two potential outcomes) to 1 (perfect correlation). Negative correlations are not considered because it is less likely that one potential mediator tends to decrease when the other potential mediator increases (or vice versa) after taking different treatment statuses and covariates into account. We can estimate the ACME-l and ANDE-l for a fixed value of \u03c1 M 1 using g-computation as below.\n1. Fit regressions for mediators and outcome models. Generate Y (t, 0, M 1i (t ), M 2i (t , 0, l), l) for t, t , t \u2208 {0, 1}, incorporating the results obtained from steps 2 and 3. Again, we put L i = l for every individual, rather than incorporating the predicted values of L. 5. Using the potential outcomes obtained from step 4, the ACME-l and ANDE-l are estimated by averaging over individuals. Calculate 95% confidence intervals using the bootstrap."}, {"section_title": "Generate", "text": "This g-computation approach is flexible in that the ACME-l and ANDE-l are estimable under both parametric and nonparametric settings. In a parametric setting, the sensitivity parameter, \u03c1 M 1 , is only required when interaction effects exist between two mediators (M 1 and M 2 ) with respect to the outcome. To see this, suppose that we have the following simple data-generating model for two potential mediators under different treatment statuses:\n, where \u03b1 and \u03b3 are constant regression coefficients, and U i is individual error. For notational simplicity, we did not include pre-treatment covariates and interaction effects between the treatment and the mediator in this data-generating model. However, the result does not change even after including pre-treatment covariates and interaction effects between the treatment and the mediator. Under this data-generating model, the interaction between the two potential mediators (M 1 (t ) \u00d7 M 2 (t, 0, M 1 (t), l)) with respect to the outcome requires a correlation between U 1i (t ) and U 1i (t) in order to be uniquely identified. This implies that sensitivity analysis is unnecessary under a parametric setting if one can assume homogeneous effects and no-interaction effects between two mediators with respect to the outcome."}, {"section_title": "Bias Formula Under Heterogeneous Effects", "text": "In this section, we relax the assumption that every subject has the same constant effect and allow for systematic or random variations of the effects. Specifically, we introduce how to accommodate additional bias that emerges under heterogeneous effects by means of sensitivity analysis, which was used in Imai and Yamamoto (2013) in the context of multiple mediators.\nWe begin by presenting the parametric data-generating model with heterogeneous effects, since this sensitivity analysis accommodating additional bias is model-specific. This means that sensitivity analysis may no longer apply if the data-generating model was different than what was proposed here. The causal diagram in Fig. 1 can be expressed as shown below, using the following linear structural equations with varying coefficients.\nwhere \u03b1 i , \u03b3 i , and e i are structural coefficients, and U i is an exogenous error for individual i. The structural coefficients' subscript i indicates that the effects are heterogeneous across individuals, and thus, each varying coefficient represents a random variable, rather than a constant value. While this model is flexible enough to accommodate individual heterogeneous effects and various interaction effects (in the T \u2212 M and M \u2212 L relationships), we assume no interactions in the mediator-mediator relationship, as in Imai and Yamamoto (2013) . Including the mediatormediator interactions while addressing effect heterogeneity is not impossible, but it increases the complexity of the bias formulas. Suppose now that we are interested in the ACME-l and ANDE-l and that we do not assume effect homogeneity. The bias is defined as the difference between the average effect estimate under the homogenous effects and the true effect under heterogeneous effects. In formal expression, l) ] is the expected estimate obtained as a result of assuming homogeneous effects, given assumptions A1-A3. Now, allowing for heterogeneous effects, the bias formulas for\u03b4 M 1 (t, l),\u03b4 M 2 (t, l), and\u03b6 (t , l) are given as follows.\nfor t \u2208 {0, 1}, t = 1 \u2212 t where \u03c3 e 7 = \u221a V (e 7i ), and \u03c1 M 2 indicates the correlation between e 7i and M 2i (t , 0, l). A proof is shown in \"Appendix D.\" This bias formula indicates that the ACME-l via M 1 is not affected by the effect heterogeneity. In contrast, the ACME-l via M 2 and ANDE-l will be biased if the effects are heterogeneous across individuals. The bias originates from these two random terms: 1) interaction effects between treatment and mediator across individuals (e 7i ), and 2) the potential value of the second mediator (M 2i (t , 0, l) ). The standard deviation of the potential second mediator can be consistently estimated by the sample counterparts, while the standard deviation of the varying coefficient (\u03c3 e 7 ) and the correlation between the two random terms (i.e., M 2i (t , 0, l) and e 7i ) are not empirically known. Therefore, these two unknown terms will serve as sensitivity parameters. The correlation indicates the direction of the bias, which determines whether the bias is upward or downward; and the standard deviation of the varying coefficient represents the amount of heterogeneity across individuals. Using these sensitivity parameters, we can examine the sensitivity of effect estimates in response to the change in these two unknown sensitivity parameters. Specifically, we can obtain the upper and lower bounds of \u03b4 M 2 (t, l) or \u03b6(t , l) for every assumed value of \u03c3 e 7 because the correlation \u03c1 M 2 is bounded to have values between \u22121 to 1. For example, the bias of\u03b4 M 2 (t, l) falls between 0.5\u03c3 e 7 and \u2212 0.5\u03c3 e 7 for a fixed value of \u03c3 e 7 if the standard deviation of the potential second mediator (\n) was 0.5, which can be obtained from a sample.\nFrom Eq. (6), we realize that the bias would have been zero if either \u03c1 M 2 = 0 (no correlation between e 7i and M 2i (t , 0, l)) or \u03c3 e 7 = 0 (a constant effect of e 7 ). This indicates that the ACME-l and ANDE-l are identified without sensitivity parameters if we can assume no-interaction effects in the T 1 \u2212 M 2 relationship (in addition to assuming no interactions in the M 1 \u2212 M 2 relationship) with respect to the outcome under heterogeneous effects. If the no-interaction-effects assumption is satisfied, the ACME-l via M 2 is identified as\n, using the product of coefficient approach.\nOne attractive feature of this alternative definition of ACME-l and ANDE-l is the generalizability to a model beyond two time periods. The bias formula for the ACME-l via M k (where k \u2208 K denotes a number of time periods) remains the same even when the model is extended beyond two time periods if the model follows the same model specification as in Eq. (5). See \"Appendix E\" for extending this bias formulas to a model beyond two time periods. C2RGSCAL   P1LEARN   P1SOCIAL  P2LEARN  P2SOCIAL  T1RARSLI  T1RARSMA T1RARSGE   T1LEARN  T2RARSLI   T2RARSMA T2RARSGE   T2LEARN   P1AGEENT   P1DISABL   P1CHLBOO  B1YRSKIN  B2YRSKIN   T2FLBHND   T2ABIL   S2PCTHSP   S2LOSLRY  S2HISLRY   P1SADLON  P2SADLON T1EXTERN   T1INTERN  T2EXTERN  T2INTERN   P1NUMSIB P2SOCIAL   T1RARSLI   T1RARSMA T1RARSGE   T1LEARN   T2RARSLI  T2RARSMA   T2RARSGE  T2LEARN  P1AGEENT   P1DISABL   P1CHLBOO   T2FLBHND   T2ABIL   med1   C4R4MSCL   race   P1SADLON  T1EXTERN  T1INTERN T2EXTERN   T2INTERN   P2HOMECM   S2LOSLRY   S2HISLRY "}, {"section_title": "Case Study", "text": "We illustrate the use of our proposed approach under homogeneous and heterogeneous effects with an empirical study about the mechanisms, underlying the relationship between kindergarten retention policy and final math score."}, {"section_title": "Assumptions and Models", "text": "As previously discussed, assumptions A1 and A2 in Eq. (3) are satisfied if the two retention statuses are sequentially randomized. Unfortunately, our data are non-experimental because researchers do not have control over retention decisions. Although we used an extensive set of pre-treatment covariates as shown in Sect. 2, the lack of control makes our study more sensitive to unobserved confounding. We carefully checked covariate balance and overlap between the treated and controlled units. As shown in Fig. 4 , covariate distributions between those who were retained and promoted are substantially different. The left and right plots of Fig. 4 indicate covariate imbalance by retention statuses measured in year 1 and 3, respectively. The X axis represents the standardized difference in covariate means, and the Y axis represents the covariates' variance ratio between treated and controlled units. Covariate balance would be given if the standardized mean difference were zero or very close to zero, and if the variance ratio were close to one. Figure 5 assesses the overlap between the treatment and control group with respect to the distribution of the propensity score logit. Again, the left and right overlap plot refers to year 1 and year 3, respectively. The figures show that the treatment group is more likely to be retained than the control group and this leads to a lack of overlap on both tails of the distributions.\nIn fact, the proportion of students who are retained in year 1 and in year 3 is approximately 3%, which demonstrates that retention is a highly selective process (Hong & Raudenbush, 2006) . The overlap between retained and promoted students is thus weak, as shown in Fig. 4 . As a result, causal inference for areas of non-overlap would require extrapolation, which restricts the credibility of conclusions (Imbens & Rubin, 2015) . To circumvent this issue, we trimmed our data based on the logit of propensity scores to achieve overlap and better covariate balance between the two groups. We trimmed observations that were outside of the limits constructed based on the logit of propensity scores: (min \u2212 0.05\u03c3 L P S ) and (max + 0.05\u03c3 LPS ), where min is the maximum of the treatment and control group's minima, max is the corresponding minimum of the two maxima, and \u03c3 LPS is the standard deviation of the logit of propensity scores. After trimming the data, we re-estimated the propensity scores (PSs) based on the remaining 286 kindergarten retainees and 4143 promoters. We obtained PS weights using the CBPS R package (Fong, Ratkovic, & Imai, 2014) . By means of generalized method of moments, the PS is estimated such that it maximizes the covariate balance as well as the prediction of the treatment assignment (Imai & Ratkovic, 2015) . After weighting, the covariate balance substantially improved, as shown in Fig. 6 . In year 1, all standardized mean differences are below the threshold of 0.25 except for one variable (percentage of students retained at school). In year 3, eight out of 42 variables had a difference larger than the threshold of 0.25, but none are larger than the threshold of 0.5. Figure 7 also shows the overlap between the treatment and control groups based on the trimmed data. In fact, trimming data is not only helpful to achieve overlap between the two groups, but it also restricts the analytical sample to children who are more homogeneous in terms of their retention probabilities. After trimming, the retention probability at kindergarten and in year 3 ranged from 3 to 98% and from 1 to 61%, respectively.\nRegarding assumption A3, we calculated Pearson's correlation between classmate ability and each covariate to examine whether there is a systematic relationship between them. From Figs. 8 and 9, it is clear that the correlations substantially reduce after weighting. In addition to A1-A3, we assume that L includes all exposure-induced confounding variables. In the context of our example this assumption implies that student math achievement at year 2 is the only timevarying confounding variable. This assumption is probably not very realistic and, unfortunately, not directly testable.\nGiven these assumptions, we use the same causal structural models as in Eq. (5) for mediators, time-varying confounder, and outcome models. Although the same regression models were used as shown in Eq. (5) in this article, researchers in practice need to make their own judgments about which interactions to include in their model. The impact of including interactions may differ depending on whether the effects are assumed to be heterogeneous or homogenous. If the effects are homogenous the approach of choosing a parsimonious model is reasonable (e.g., Daniel et al. (2015) ). However, this approach of choosing a parsimonious model may not be adequate to address heterogeneity. This is because the interaction effects may vary across individuals (and thus not zero) even when the interaction effect is not significantly different from zero on average. Therefore, a decision to include interaction effects should be based on theoretical knowledge\nPearson correlations with the first mediator before and after weighting. Est. = estimate, and 95% C.I. = 95% confidence interval. Table 4 .\nEstimates for ACME-l and ANDE-l with two time periods, by different level of L. Est. = estimate, and 95% C.I. = 95% confidence interval."}, {"section_title": "Results", "text": "In response to the first causal question given in the introduction, we begin by examining the results of the single-time-period causal mediation model using the intermediate math score as the outcome variable. Consistent with the previous studies, there is a negative effect of kindergarten retention on math score. Table 3 shows that students would have scored 7.7 points higher if they were promoted instead of retained, which is consistent with Hong and Raudenbush (2006) . In addition, a large fraction of the negative effect is via the ability level of classmates during the first year after kindergarten retention. The retained students would have scored 5.3 points higher had they been interacting with same-age peers. Promoted students would have scored 5.7 points lower had they been interacting with one-year-younger peers. Now our question centers on whether the emerging mediation effect via classmate math ability is still negative one year after the kindergarten retention (second and third causal questions). In order to answer this question, we computed effect estimates for ACME-l and ANDE-l, which are shown in Table 4 . From the left hand side, we present estimates, and upper and lower 95% confidence intervals for L = low and the same quantities for L = medium and L = high. Interestingly, the results indicate that some emerging mediation effects via classmate math ability became positive after 1 year. The mediation effect via classmate math ability in year 1 (\u03b4 M 1 (0, l)) for promoted low achievers is 4.37. This implies that the kindergarten retention effect on math score via classmate effects is strongly negative in the short term (1 year). However, a positive mediation effect appears in the long term (3 years), which was not captured in the single-timeperiod analysis. For both retained and promoted conditions, the positive effect would be stronger if students had a low intermediate math score as compared to a high score. The results also indicate that a negative mediation effect of kindergarten retention through the ability level of classmates in year 4 (\u03b4 M 2 (0, l)) persists even after removing the effect via the intermediate math score, although the magnitude of the effect is smaller. The negative mediation effects vary between \u2212 2.37 and \u2212 2.55 for the retained condition and between \u2212 2.12 and \u2212 2.33 for the promoted condition. For both retained and promoted conditions, the negative effect would be stronger if students had a high intermediate math score as compared to a low score.\nAllowing for heterogeneous effects, our sensitivity analysis suggests that the results on the ANDE-l and the ACME-l via M 2 are fairly responsive to the amount of heterogeneity across individuals. Figures 10 and 11 present sensitivity plots when the intermediate math score is fixed to L = low and L = high, respectively. The X axis indicates the amount of heterogeneity (SD of the varying coefficient on the treatment-mediator interaction), and the Y axis indicates the upper and lower bounds of the estimates. A dotted line indicates the estimate when homogenous effects can be assumed. As the amount of heterogeneity increases, the bias becomes larger. The 95% confidence intervals are shown in gray. About 0.20 SD and 0.12 SD of effect heterogeneity can change the sign of the estimates of the ANDE-l and the ACME-l via M 2 for the promoted condition."}, {"section_title": "Conclusion", "text": "In this article we proposed some extensions to causal mediation analysis with time-varying treatments and mediators and discussed their application in investigating the mechanisms under- lying the relationship between kindergarten retention and student math achievement scores. To overcome the limitations of existing causal mediation analyses with longitudinal data, we discussed a partial identification strategy (following Daniel et al. 2015) that identifies the mediated and natural direct effects up to some sensitivity parameters. In a sensitivity analysis the researcher can then assess the effects' robustness to a range of possible values of the unknown sensitivity parameters.\nIn addition, we discussed alternative definitions for ACME and ANDE for fixed values of the confounding intermediate variable. The alternative definitions fix the intermediate confounding variable at a certain value and thus investigate the mediation effect where the indirect effect via the intermediate confounding variable is blocked. That is, we only evaluate a partial mediation effect, the effect that is mediated by paths other than through the intermediate confounding variable. Evaluating the alternative ACME-l and ANDE-l at different values for the intermediate variable also allows for a useful investigation of effect heterogeneity. Though we cannot estimate the overall ACME and ANDE, we believe that the alternative versions of the effects are still valuable because they allow us to better assess at least a part of the mediated effect. As before, the alternative ACME-l and ANDE-l are only identified up to unknown sensitivity parameters. Corresponding sensitivity analyses can be used to assess the robustness of estimates under both homogeneous and heterogeneous effects.\nA drawback of the suggested mediation analyses is that they require the specification of unknown sensitivity parameters. However, if the effect estimates are rather insensitive to a broad range of parameter settings, valid conclusions about the direction of the effects are still possible.\nAnother limitation of the proposed analyses is that they allow for a single intermediate confounder only (as is also the case for the analyses suggested by Daniel et al. 2015) . For the alternative ACME and ANDE this limitation can be overcome by setting the entire vector of intermediate confounders to fixed values, but as more mediating pathways via intermediate confounding variables are blocked, partially identified effects become less meaningful. Thus, in practice researchers face a trade-off between restricting the meaningfulness of the alternative ACME and ANDE and making strong, probably implausible assumptions about the presence of intermediate confounders.\nThen, the potential outcomes derived from the above data-generating models are shown as below.\nConsider the following assumptions that are needed to identify ACME and ANDE.\nfor every m 1 , m 2 and v where t, t \u2208 {0, 1}. The first and second assumptions of (10) are satisfied as far as the first line of A3 (no unobserved confounding in M 1 \u2212 M 2 and M 1 \u2212 Y relationships) is met. However, the third assumption of (10) \nIt is because L is no longer affected by T 1 but is fixed to a certain value. Other assumptions in A1-A3 as well as the first two assumptions in (10) hold even after L is fixed to l."}, {"section_title": "C. Identification of the Alternative ACME-l and ANDE-l Under the Homogeneous Effects", "text": "First, we have\nfor every m 1 , m 1 , m 2 , v and l, where t, t , t \u2208 {0, 1}. The first equality is due to the law of total probability. The second equality is because the intermediate confounding variable is fixed to L i = l with the implications of \"Appendix B.\" The third equality holds because of A1-A3, which still hold after fixing L = l. The ACME-l and ANDE-l can be obtained after plugging this identification result to Eq. (2). This completes the proof."}, {"section_title": "D. Bias of\u03b4 M 2 (t, 0, l) Under Heterogeneous Effects", "text": "Note that this proof is an extension of the proof shown in Imai and Yamamoto (2013) . Based on the models shown in Eq. (5), \u03b4 M 1 (t, l) is identified as = E{(e 2i + t \u00b7 e 6i + l \u00b7 e 8i ) (M 1i (1) \u2212 M 1i (0))} = (e 2 + t \u00b7 e 6 + l \u00b7 e 8 ){E(M 1i |T 1i = 1) \u2212 E(M 1i |T 1i = 0)}\nwhere t \u2208 {0, 1}. \u2212 E{e 7i M 2i (t , 0, l)} = (e 5 + e 7 + l \u00b7 e 9 )E(M 2i |T 1i = 1, T 2i = 0, L i = l)\n\u2212 (e 5 + l \u00b7 e 9 )E(M 2i |T 1i = 0, T 2i = 0, L i = l)\nfor every t, t , and l and \u03c3 e 7 = \u221a V (e 7i ); and \u03c1 is the correlation between e 7i and M 2i (t , l). The second equality follows from assumption A1 (the first treatment is ignorable given covariates), which still holds after fixing L = l. The third equality is because e 5i +t \u00b7e 7i +l \u00b7e 9i is conditionally independent to M 2i (t, 0, l) under assumption A3, which still holds after fixing L = l. It is because e 2i + e 6i + l \u00b7 e 8i is same as Y i (t, 0, m 1 , m 2 , l) \u2212 Y i (t, 0, m 1 , m 2 , l) for every m 1 , m 2 , m 2 and l. The last equality is because of the fact that two random variables, e 7i and M 2i (t , 0, l), are not independent. This term, \u03c1 1 \u03c3 e 7 \u221a V (M 2i |T 1i = t , T 2i = 0, L i = l), indicates the covariance between the two random variables.\nAssuming homogeneous effects, one will simply obtain\u03b4 M 2 (t, l) = (e 5 + e 7 + l \u00b7 e 9 )E(M 2i |T 1i = 1, T 2i = 0, L i = l) \u2212 (e 5 + l \u00b7 e 9 )E(M 2i |T 1i = 0, T 2i = 0, L i = l) since e 7 is no longer a random variable. The bias given in Eq. (6) is obtained by calculating the difference between\u03b4 M 2 (t, 0, l) and \u03b4 M 2 (t, 0, l). Bias for \u03b6(t , 0, l) is computed using the fact that the bias of combined effect of \u03b4 M 1 (t), \u03b4 M 2 (t) and \u03b6(t ) is zero. This completes the proof."}, {"section_title": "E. Generalizability to an Extended Setting", "text": "One attractive feature of this alternative definition of ACME-l and ANDE-l is the generalizability to a model beyond two time periods. The bias formula for the ACME-l via M k (where k \u2208 K denotes a number of time periods) remains the same even when the model is extended beyond two time periods if the model follows the same model specification as in Eq. (5). This implies that the model should not include the interaction effects among mediators (e.g., M 1 \u00b7 M 2 ) or higher order terms of mediators (e.g., M 2 2 ). Given this model specification, the bias formula for the ACME-l via M 3 , for instance, is expressed as bias (\u03b4 M 3 (t, l) \nwhere \u03c3 e T 1 M 3 is V (e T 1 M 3 i ) in which e T 1 M 3 i is the interaction effect between T 1 and M 3 , and \u03c1 M 3 is the correlation between e T 1 M 3 i and M 3i (t , 0, l, l). This bias formula has the same form as Eq. (6), but the only difference is that the bias is due the interaction effect in the T 1 \u2212 M 3 relationship as compared to the interaction in the T 1 \u2212 M 2 relationship. This bias formula holds even when L k is affected by a previously measured time-varying confounding variable or L k itself affects the following mediators.\nHowever, this simple generalization to a model beyond two time periods only holds when the time-varying treatments measured after the first time period are all fixed as in our example (e.g., T 2 = T 3 = T 4 = \u00b7 \u00b7 \u00b7 = 0). If this does not hold, the bias formulas shown in Eq. (6) depend on more than two sensitivity parameters. To see this, suppose that T 2 is not fixed to zero. Then, bias(\u03b4(M 2 ) (t, t, l) \n, where e T 2 M 2 i is the interaction effect between T 2 and M 2 , and \u03c1 M 2 T 2 is the correlation between e T 2 M 2 and M 2 (t , t , l). This bias formula shows that interaction effects between T 2 and M 2 contribute additionally to the bias formula shown in Eq. (6). As discussed above, extending the proposed bias formulas to a more general time-varying treatments and mediators setting is not impossible. However, sensitivity analysis based on this extended bias formula becomes dependent on more than two parameters, which is undesirable when examining the sensitivity of effect estimates."}]