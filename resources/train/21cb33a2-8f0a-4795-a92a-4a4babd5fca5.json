[{"section_title": "Abstract", "text": "Improvements in medical imaging techniques have provided clinicians the ability to obtain detailed brain images of patients at lower costs. This increased availability of rich data opens up new avenues of research that promise better understanding of common brain ailments such as Alzheimer's Disease and dementia. Improved data mining techniques, however, are required to leverage these new data sets to identify intermediate disease states (e.g., mild cognitive impairment) and perform early diagnosis.\nWe propose a graphical model framework based on conditional random fields (CRFs) to mine MRI brain images. As a proof-of-concept, we apply CRFs to the problem of brain tissue segmentation. Experimental results show robust and accurate performance on tissue segmentation comparable to other state-of-the-art segmentation methods. In addition, results show that our algorithm generalizes well across data sets and is less susceptible to outliers. Our method relies on minimal prior knowledge unlike atlas-based techniques, which assume images map to a normal template. Our results show that CRFs are a promising model for tissue segmentation, as well as other MRI data mining problems such as anatomical segmentation and disease diagnosis where atlas assumptions are unreliable in abnormal brain images."}, {"section_title": "Introduction", "text": "Magnetic resonance imaging (MRI) is a neuroimaging method that can be used for visualization of brain anatomy with a high degree of spatial resolution and contrast between brain tissue types. Structural MRI methods have been used to identify regional volumetric changes in brain areas known to be associated with diseases such as Alzheimer's (AD), demonstrating the utility of such methods for studying diseases [26, 29] . In the context of Alzheimer's, structural MRI has identified associated cross-sectional differences and longitudinal changes in volume and size of specific brain regions, such as the hippocampus and entorhinal cortex, as well as regional alterations in gray matter, white matter and cerebrospinal fluid on a voxel-by-voxel basis [29] .\nWe focus on mining and extracting useful informa-tion from these structural MRI images. Many image techniques such as thresholding, region growing, statistical models, active-control methods and clustering have been previously used for medical imaging; for an in-depth review of MRI mining methods, please refer to Balafar et al. [4] . As pointed out in Balafar et al., thresholding methods by themselves are not ideal since distribution of intensities in medical images is quite complex. Probabilistic classification methods [7, 25] appear to be best suited for this complex task due to their ability to handle noise and ease of implementation.\nAt the other end of the spectrum are atlas-based segmentation methods that parcellate the MRI data into different anatomically relevant regions. For example, the Automated Anatomic Label (AAL) atlas 1 as implemented by WFU PickAtlas [20] , divides the MRI image into 116 clinically important regions. Ideally, effective MRI-based diagnosis and identification relies on a segmentation approach to be (1) robust to noise, (2) able to handle large variances in brain intensities and (3) subject-and disease-specific.\nWhile atlas-based brain warping works well for normal brains, it fails to capture the morphological changes that could result from brain diseases such as tumors, Alzheimer's, etc., [1, 2] . This is because atlas-based segmentation is not subject-or disease-specific; quite the contrary, all brains are segmented into the same set of regions, and assume normal characteristics for each region (i.e., that there is a one-to-one mapping to a template). This results in a decrease in shape variability i.e., it manifests in an inability to capture local shape and feature information, which is essential for discriminating between brains for diagnosis of diseases.\nThis issue is addressed in our work: our motivation is to find a discriminative machine-learning-based approach to segment brain images and detect abnormalities that could aid in classification of diseases from images. Recent work [22] on predicting the incidence of AD using EM-based segmentation combined with an ensemble method demonstrates that such an approach produces superior diagnostic performance when applied to structural MRI data. We further motivate our approach with another example that previews the work Figure 1 : Illustration of tissue segmentation task using one 2D slice from a sample 3D MRI. From left to right: Raw Image -the intensity values obtained from MR (i.e., the algorithm input); Ground truth -a manually segmented image classifying each voxel as white matter (white), grey matter (light grey), or cerebral spinal fluid (dark grey); CRF -the proposed algorithm in this paper; SPM8+, VBM8 -atlas-based baseline techniques representing current state-of-the-art methods in medical imaging.\npresented here, and highlights the need for moving away from atlas-based methods. Consider Figure 1 , which shows the results of using our probabilistic discriminative method against the standard method based on a Gaussian-mixture model (SPM) 2 [3, 9] and voxelbased morphometry (VBM) [2] for identifying important features (regions) when predicting Alzheimer's disease. First, it is evident that our approach more closely resembles the ground truth, and thus is more effective in isolating the gray matter and cerebrospinal fluid intensities from the brain images compared to SPM and VBM. Second, in the raw image in Figure 1 , there is a brain deformity in upper-right region. Mapping to a template atlas, however, assumes that each voxel in this deformed region maps to a voxel in a normal brain, even though it is more likely that this tissue is simply missing. Thus, SPM rounds out the image and erroneously fills it in with cerebrospinal fluid intensities while VBM transitions incorrectly from white matter to background.\nWhile several diverse paradigms exist for image segmentation, we focus on probabilistic models, as they have been used successfully in many image segmentations tasks. For example, Friedman and Russell [11] utilized probabilistic models to detect objects in motion in video images. In particular, Markov Random Fields (MRFs) [12] , a type of probabilistic graphical approach, have been applied to a wide variety of tasks including texture analysis and image restoration (a more thorough sampling of applications of MRFs for image analysis can be found in Li [18] ). MRFs have also been successfully applied to brain MRI segmentation [14, 30] and tissue classification [28] . MRFs, however, are a generative probabilistic model. That is, when our goal is to discriminate the tissue type of each voxel in a brain image, MRFs generate all the configurations of possible images as well as underlying tissue types, which can become extraordinarily inefficient.\nBuilding off this success, recent years have seen the emergence of Conditional Random Fields (CRFs) [16, 27] , which are a discriminative variant of MRFs; they have added the ability to model complex local dependencies in image-mining tasks, including labeling image regions on multiple scales [13] and object recognition [24] . In particular, Lee et al., [17] applied CRFs to a set of alignment-based features to perform braintumor segmentation for radiation-therapy target planning. CRFs have shown superior performance across many tasks as they directly optimize the classification task at hand (e.g., the possible configurations of tissue types given a fixed set of image intensities); for instance, the work of Kumar and Hebert [15] shows that CRFs outperform MRFs at modeling spatial dependencies across a diverse set of natural images. Inspired by these successes, we were motivated to develop a novel CRF-based segmentation approach for MRIs.\nThe key contributions of the paper are as follows: we (1) propose the first of its kind, fully-CRF-based framework for structural-MRI-image analysis (in particular for identification of relevant regions), and apply this to the task of volumetric segmentation for 3-dimensional data; (2) demonstrate the impact of the state-of-the-art algorithms for solving CRFs on MRI image analysis; (3) apply our approach to standard brain image repository data sets; and, (4) show that our approach generalizes across data sets, an important feature for developing efficient disease-and subject-specific approaches.\nThis paper is organized as follows: after reviewing the general CRF probabilistic model, we will present our methodology in the following section. Next, we present the results of comparing our method to 3 other standard methods for white matter(WM) tissue classification and grey matter(GM) tissue classification. We conclude by discussing possible future work directions."}, {"section_title": "Background", "text": "Probabilistic graphical models encompass a set of expressive techniques for modeling the structural dependencies between random variables using a graph. In this paper, we examine a specific graphical model known as Conditional Random Fields (CRFs) [16] (for a thorough overview of CRFs, see Sutton and McCallum [27] ).\nCRFs model a probability distribution over two sets of random variables x and y. Here, x represents the observed data, that is, the set of random variables representing evidence. For example, in a standard partof-speech (POS) task, x can represent the words in a sentence. The variables, y, represent the underlying phenomena to analyze; this is known as the set of latent, or hidden, random variables in the posed problem. In the sample POS task, y i \u2208 y encompasses the underlying part-of-speech tag for word i in the sequence. The data mining task is to find an assignment (or label)\u0177 i for each random variable y i that maximizes the conditional probability of y given the observed data, x:\nWe define a graph G = (V, E) where each variable indexed in y (i.e., y i \u2208 y) corresponds to one vertex i \u2208 V . Each edge e \u2208 E represents a pairwise connection between two hidden variables and encodes a dependence between the two variables. In our figures, we also add the observed variables x to the graph, and add corresponding edges connecting the evidence to the latent variables. CRFs assume the following Markov property on the graph, which is a key assumption of CRFs: each hidden variable y i \u2208 y, given evidence x and the value of it's neighbors N(y i ), is conditionally independent of all other hidden variables:\nNotice that the model is globally conditioned on all the evidence. This is in contrast to MRFs which add constraints requiring the evidence variable x i being conditionally independent given the label y i ."}, {"section_title": "Figure 2:", "text": "An example of conditional random field using a factor graph representation. The set of white nodes (e.g., yi) represents hidden variables that we wish to infer. The black nodes (e.g., x i ) represent sets of evidence variables. Each edge contains an edge potential (shown as white squares) that represent the encoded dependence between variables. Note that while CRFs do not require an imposed structure on the evidence data, our representation utilizes a local neighborhood of data for each hidden variable. Figure 2 shows a sample CRF graph model using a factor graph representation. While the CRF can be conditioned on all evidence data, x, we simplify to only consider a local neighborhood of evidence (e.g., the 3 words surrounding position i in POS tagging). Thus, each hidden variable y i has a corresponding set of evidence variables x i . Using the factor graph representation, we break our model into two sets of binary feature functions: f (y i , x i ) (i.e., the connection between the label of a hidden variable and its evidence data) and f (y i , y j , x i ) where e \u2261 (i, j) \u2208 E (i.e., the connection between the label at y i and y j ). To simplify notation, we will generalize the first set of features (i.e., add y j as a parameter that is ignored). This leads to the following formulation of a CRF, whose probability distribution of the latent variables can be conditioned on the evidence as\nand Z(x) is a normalization factor,\nThe variable k indexes each feature function in our set and \u03bb k is the weight learned for each feature f k ."}, {"section_title": "CRFs for MRI Image analysis", "text": "In this section, we outline our proposed method for identifying relevant regions from MRI images. presents the pipeline of the approach. The input to the algorithm is a CRF whose structure is predefined and a set of training examples in the form of MRI images and their corresponding tissue segmentations. Tissue segmentation here refers to classifying each tissue (voxel) as one of gray matter (GM), white matter (WM) and cerebral spinal fluid (CSF). Each MRI high (1.5mm) resolution image has about 3 million voxels. The CRF that is constructed would correspondingly have about 3 million hidden nodes (variables) each corresponding to a voxel in the MRI image. Figure 4 provides more details about how the CRF model corresponds to the input MRI. In our CRF model, each voxel has a corresponding hidden node y i and can take one of three values, y i = {WM, GM, CSF} representing white matter, grey matter and cerebrospinal fluid. We chose to model each voxel as being connected to 26 neighboring voxels (i.e., a 3 \u00d7 3 \u00d7 3 neighborhood around the voxel) with the result that each hidden node is connected to 26 other hidden nodes. Observations include the image intensity of each voxel, which is a function of the density of the underlying tissue type. We also included the mean intensities of the neighboring voxels and the Euclidean distance of the voxel to the center of the image as additional features. Associated with each voxel (and hidden variable) Y i is a set of observations x i that include its own intensity value, the average intensities of the 26 neighbors and the position of the voxel. Note that estimating the conditional distribution corresponds to estimating \u03bb for the feature set. Also note that the structure CRF for each image could be different due to different brain sizes, but they all share the same set of parameters due to the features being the same for each node in the CRF. Put another way, this means that while the CRF graph-model can be of different sizes due to differences in the brain sizes, the set of parameters to be learned for each of these CRFs is the same. This is evident in Figure 4 , which shows that each voxel type is the hidden node for the CRF, and the observed intensities along with the position become the observations for the CRF. While we show at most 8 neighbors (2D slice) for each node for brevity, recall that each node has 26 possible neighbors (3D volume).\nOur methodology proceeds in two phases: the training phase and the inference phase. The overview of our methodology is shown in Figure 5 ."}, {"section_title": "Training Phase", "text": "As mentioned earlier, while each CRF can potentially have varying numbers of nodes, the set of parameters (\u03bb) for all the images is the same. We employed the UGM package for learning the parameters of the CRF 3 ; this is because it is one of the few packages that can learn a CRF with a large number of parameters, and continuous evidence variables. The number of parameters learned for each CRF is 96, which corresponds to 64 edge features, 16 observation (node) features, and 16 boundary edge features. Thus, a possibly 3 million node CRF can be efficiently represented using 96 parameters; this is one of the main advantages of parameter representation via exponential functions.\nWe considered three CRF-training approaches: Figure 5 : Overview of CRF model training and inference. SGD and ICM stand for stochastic gradient descent and iterated conditional modes, respectively.\npseudo likelihood [5] , L-BFGS [19] and stochastic gradient descent. Because of the size of the graph, the memory requirement for learning using batch methods was prohibitively high. In our experiments, we found that using stochastic gradient descent performed the best compared to other training methods, and consequently employed learning with stochastic gradient descent. Recall that stochastic gradient descent is an online algorithm that iterates over each example, computing the gradient with respect to each example. It makes several passes over the training set before converging to the optimal parameters. We used a random ordering of the training images between each iteration. In our experiments, the number of iterations required for convergence was between 200 and 500 iterations. We employed loopy belief propagation (BP) [21, 23] as the inference algorithm for estimating the partition function during training and marginal probabilities during training. The only user-tunable parameter is the maximum number of iterations, and this value was set using 5-fold cross validation."}, {"section_title": "Inference Phase", "text": "Once the parameters of the CRF are estimated, the next step is to classify the tissue type at each voxel of the image. This problem is posed as obtaining the maximum a posteriori (MAP) estimate over the different voxels i.e., (3.5)\u0177 = arg max\nIn order to perform inference, we use iterated conditional models (ICM) [6] , which maximizes local conditional probabilities sequentially. The algorithm exploits the notion that neighboring voxels typically are of the same type (GM, WM or CSF) and that each voxel is corrupted with a given probability. Simply put, the aim of ICM is to minimize the within-segment variance by assigning each voxel a specific label, while taking the neighborhood information into account. Thus, a set of neighboring voxels with the same label type will form a \"segment\" within the image. To avoid reaching local minima, ICM can be used with restarts; we used 30 restarts in our experiments. We preferred ICM over loopy belief propagation for MAP inference because ICM is scalable and fast; additionally, the presence of restarts allowed avoiding local minimums that would otherwise occur due to the use of loopy BP."}, {"section_title": "Experimental Setup", "text": "Our experiments were designed to answer the following questions: Ideally, we would like to compare methods on an Alzheimer's data set (such as the ADNI study 4 ) in the disease prediction task. To our knowledge, there are no publicly available data sets with manual annotations for abnormal brain MRI images."}, {"section_title": "Data Sets Data was acquired from the Internet Brain Segmentation Repository (IBSR)", "text": "5 . IBSR provides two data sets, IBSR V1.0 and IBSR V2.0. IBSR V1.0 consists of 20 low resolution, normal brains. IBSR V2.0 consists of 18 high resolution 1.5mm T1-weighted scans. The scans have been spatially normalized through rotation only, and processed by the Center for Morphometric Analysis (CMA) AutoSeg bias field correction routines. Both data sets include manual tissue segmentations by experts, which was used as ground truth."}, {"section_title": "Comparative Algorithms", "text": "Other MRI analysis methods we compared against were SPM8 New Segment (SPM8+), VBM8, and FAST. Statical Parametric Mapping 8 (SPM8) is a software suite implemented in Matlab for MRI analysis. It includes two tissue segmentation methods, Segment and New Segment. New Segment differs from Segment in that is also classifies nonbrain tissues, and performs a post-registration cleanup using a Markov random field (MRF). As New Segment typically outperforms Segment [9] , we did not include results from Segment in this paper. For SPM8+, registration into MNI space was first performed using SPM8 coRegister. SPM8+ performs a full bias field correction and tissue segmentation using an atlas-based MAP method. SPM8+ outputs marginal probability maps for each tissue class; these were compiled using the maximum marginal probability given each voxel [3] . SPM8+ was performed using default segmentation parameters, a light bias field correction, and a cleanup MRF of strength 1.\nVoxel-Based Morphometry 8 (VBM) uses an atlasbased MAP method combined with partial volume estimation and denoising. VBM was performed using default SPM8 batch parameters. Maximum marginal probabilities for each voxel were used to compile a final segmentation. FAST is a fully automatic tissue segmentation framework within the FSL software suite. FAST version 5.0 was used.\nFAST performs segmentation using a hidden Markov Random field fitted through an expectation maximization algorithm while simultaneously performing bias field correction, outputting both tissue probability maps and a compiled final image [30] . The compiled image was used for evaluation."}, {"section_title": "Experiments", "text": "A tissue segmentation of the 18 IBSR V2.0 images was performed to evaluate the accuracy of the proposed model. Full leave-one-out cross validation, with a five-fold cross-validation tuning set was used. WM and GM results were compared against FAST, SPM8+, and VBM8. Classification of CSF was also performed, but not included (the reasons for this are explained at the end of this subsection). To demonstrate generalizability of the proposed method, a second test was performed using both IBSR V1.0 and IBSR V2.0. CRFs were trained only using the lower resolution IBSR V1.0 images, and then tested on the higher resolution IBSR V2.0 images.\nSegmentation accuracies were evaluated using the Dice coefficient [8] . The Dice coefficient is related to the Jaccard similarity index and F 1 -score in that they are all monotonic with respect to one another. The Dice index is a commonly used measure of segmentation accuracy in neuroimaging [9] . For two samples A and B, the Dice coefficient is defined as\nFor segmentation analysis this becomes (4.7) 2(T P ) (T P + F P ) + (T P + F N ) where T P is the true positive rate, F P is the false positive rate, and F N is the false negative rate. A Dice coefficient of 1 means that the given segmentation is exactly the same as the ground truth image, while a Dice coefficient of 0 means they are completely nonoverlapping.\nFinally, we mentioned earlier that the discrimination experiments for CSF were performed but not reported. This is because the IBSR V2.0 manual segmentations do not include certain types of CSF. This missing data causes all algorithms to perform at a Dice index less than 0.4, leading to anomalous results."}, {"section_title": "Results and Discussion", "text": "In this section, we present the results of the experiments. Figure 6 presents the Dice coefficient for the WM and GM regions respectively. For example, for the WM Dice coefficient, we averaged over all the voxels where the \"true\" label from the manual segmentation is WM. Higher values would indicate that the WM regions have been predicted more accurately by the model."}, {"section_title": "Comparison to Atlas-Based Methods", "text": "As shown in the figure, the proposed approach (denoted as CRF in the graphs) performs significantly better than the atlas-based methods (SPM8+ and VBM) for both WM and GM. Hence, Q1 can be answered affirmatively -the proposed approach is better than the atlas-based methods in isolating the WM and GM regions."}, {"section_title": "Comparison to Atlas-Free Methods", "text": "When compared to the state-of-the-art probabilistic atlas-free method (FAST), the CRF method is slightly worse in WM prediction and is slightly better in GM prediction, making its performance comparable to recent approaches for MRI segmentation. Hence, Q2 can be answered neutrally in that the methods are comparable. The key advantage of our method is that it can be easily implemented on any available (scalable) CRF implementation, and does not require specialized learning and inference modules or hardware. The FAST method is related to our method as they both use a hidden component for MRFs, but it is well-known that training CRFs is easier than training MRFs. It would be an interesting abnormalities, as mentioned in the introduction, our CRF method performs the best along with FAST when compared to atlas-based methods. In B, which is an image with areas of low average intensity due to scanning noise, the CRF method overestimated the gray matter compared to the other methods.\nfuture direction to explore the use of Gaussian mixture models (along the lines of FAST) for CRFs to gain improvements in performance. In addition, EM training did not do well in our method, compared to the stochastic conjugate gradient descent; in fact, it was an order of magnitude slower, while FAST employs EM for training its hidden MRF. Finally, it should be noted that our method entails very little domain-engineered knowledge (e.g., bias field correction, expert knowledge constraints, and the use of priors), which FAST and other methods do incorporate. One future direction would be to incorporate these features into the CRF model, which adds increased expressivity to the models. Our initial experiments avoid this as we seek to develop a general image analysis framework that can extend beyond tissue segmentation (e.g., classification of disease; anatomical segmentation).\nTo understand the performance of our method further, we consider two specific images and present the results in Figure 7 . The figure shows two brain images A and B, and the raw image is presented along with the ground truth. As can be seen in A, which has a mildly deformed brain structure, our proposed method and FAST appear to identify the white and gray matter regions correctly. However, the atlasbased methods are very general and are not sensitive to changes in brain structures; they breakdown in such methods. For example, VBM8 predicts some WM Figure 8 : Results of comparing CRF based approach when trained from the same IBSR V2.0 data set (yellow) and when trained on low-resolution IBSR V1.0 data set and evaluated on the high resolution data set(blue). The results are comparable with no statistically significant difference between the scenarios on both the gray matter and white matter predictions. The results are averaged over 5 runs.\nregions to be adjacent to the background region (which generally does not happen with most images). When predicting for B, however, because of B having a much lower intensity across the image in this slice when compared to A, our method predicts more GM than actually present in the image. We believe that this is due to the fact that our method models GM very well (as evidenced by the earlier experiment), but when the average intensity is on the lower side compared to the rest of MRI, it causes the method to predict more regions as GM. FAST does not experience this drop in accuracy as it incorporates corrections of these intensity inhomogeneities (generally termed bias field correction) in its framework. Exploring the reason for this mild over fitting remains an interesting future work direction."}, {"section_title": "Comparison Across Data Sets", "text": "To answer Q3, we trained the model on low resolution IBSR V1.0 images, and tested them on high resolution IBSR V2.0 images. We compared the results to simply training and testing on the high resolution IBSR V2.0 images. The results are presented in Figure 8 , where the former setting is presented in blue and the latter in yellow for both WM and GM prediction. For both tasks, the CRF method generalized quite well across the data sets, given that there is no statistical significance in the difference in performance between both settings. This allows us to answer Q3 affirmatively that the CRF method can generalize across multiple images quite effectively, even with no co-registration step between images."}, {"section_title": "Computational Costs", "text": "All tests were performed using a 4-core Intel i5-347OS 2.9 GHz processor and 31 GB of RAM. Each fold took approximately 30 minutes to decode new images after training (comparable to other methods). Training took approximately 40 hours to complete. It is important to note that when comparing run times, methods such as SPM or FAST have already been fully trained, and thus it is appropriate to only compare the time it takes the proposed method to decode new images."}, {"section_title": "Conclusion and Future Work", "text": "As far as we are aware, this is the first work on employing the highly successful framework of CRFs on per voxel based analysis for MRI images, specifically for predicting WM and GM regions in MRI analysis from voxel data. We have demonstrated that we could employ an CRF learner to learn a small number of parameters that are shared by different CRFs. The results were superior to that of atlas-based methods while being comparable to the state-of-the-art MRF based method. When compared to the MRF method, we employ no domain engineered features. We also demonstrated that the resulting classifier allowed for generalization across multiple resolution images.\nThe most logical next step is to begin to apply our framework to other MRI analysis problem. Anatomical segmentation has posed an especially challenging problem for atlas-free methods, as evidenced the most commonly used MRF based anatomical segmentation method still heavily relies on an atlas [10] . An interesting future direction would be to see if our method can perform atlas-free anatomical segmentation. Another powerful framework for multi-dimensional spatial image analysis is a special type of CRF called the Discriminative Random Field (DRF) method [15] . The key advantage of DRFs is that they allow for domain specific classifiers to model the potential functions. A related work employs support vector machine based classifier for capturing the observation potentials [17] to identity large tumors in MRI images. We on the other hand, consider voxel by voxel data for modeling the brain. It is an interesting direction to explore more expressive classifiers inside our potential functions. Another possible future work is considering and comparing other learning methods [27] for training the CRFs. Finally, using the results of the image analysis for direct prediction of events such as onset of Alzheimer's is an interesting and exciting future research possibility. We believe that the real impact of anatomical segmentation can be realized by combining their output with powerful classifiers."}]