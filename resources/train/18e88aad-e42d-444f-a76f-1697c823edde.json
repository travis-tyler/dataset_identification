[{"section_title": "Abstract", "text": "Abstract-Evaluating various algorithms for the inter-subject registration of brain magnetic resonance images (MRI) is a necessary topic receiving growing attention. Existing studies evaluated image registration algorithms in specific tasks or using specific databases (e.g., only for skull-stripped images, only for single-site images, etc.). Consequently, the choice of registration algorithms seems task-and usage/parameter-dependent. Nevertheless, recent large-scale, often multi-institutional imaging-related studies create the need and raise the question whether some registration algorithms can 1) generally apply to various tasks/databases posing various challenges; 2) perform consistently well, and while doing so, 3) require minimal or ideally no parameter tuning. In seeking answers to this question, we evaluated 12 general-purpose registration algorithms, for their generality, accuracy and robustness. We fixed their parameters at values suggested by algorithm developers as reported in the literature. We tested them in 7 databases/tasks, which present one or more of 4 commonly-encountered challenges: 1) inter-subject anatomical variability in skull-stripped images; 2) intensity homogeneity, noise and large structural differences in raw images; 3) imaging protocol and field-of-view (FOV) differences in multi-site data; and 4) missing correspondences in pathology-bearing images. Totally 7,562 registrations were performed. Registration accuracies were measured by (multi-)expert-annotated landmarks or regions of interest (ROIs). To ensure reproducibility, we used public software tools, public databases (whenever possible), and we fully disclose the parameter settings. We show evaluation results, and discuss the performances in light of algorithms' similarity metrics, transformation models and optimization strategies. We also discuss future directions for the algorithm development and evaluations.\nIndex Terms-Brain magnetic resonance imaging (MRI), deformable image registration, evaluation, registration accuracy."}, {"section_title": "", "text": "resent the same anatomical structures. Image registration, especially deformable image registration, is a fundamental problem in medical image computing. It is usually an indispensable component in many analytic studies, including studies aiming to understand population trends of imaging phenotypes, to measure longitudinal changes, to fuse multi-modality information, to guide computerized interventions, to capture structure-function correlations, and many others (two recent comprehensive surveys can be found in [1] , [2] ; various other surveys can be found in [3] - [9] ).\nThe past two decades have witnessed the development of many deformable registration algorithms. A comprehensive evaluation of different registration methods has thus become a research topic of interest. It is the basis for users to choose the most suitable methods for the problems at hand, and for algorithm developers to be better informed theoretically. A comprehensive evaluation is a fairly complicated problem, though. It oftentimes requires public databases, expert-labeling of ground truth regions/landmarks, a comprehensive evaluation protocol, careful tunings of parameters, considerable computational resources, and a proper choice of data to reflect certain registration challenges or to meet certain (pre-)clinical needs."}, {"section_title": "A. Literature on Evaluation of Algorithms in Brain MRI Registration", "text": "West et al. [10] evaluated 3 registration methods for multi-modal registration of the same subject undergoing neurosurgery, where the accuracy was measured on the fiducial markers. Hellier et al. [11] evaluated six methods (ANIMAL, Demons, SICLE, Mutual Information, Piecewise Affine, and the authors' own method) in a database containing brain MRI from 18 healthy subjects; they measured registration accuracy on expert-defined cortical regions. Yanovsky et al. [12] evaluated three methods (fluid and two variations of the authors' own methods, namely symmetric and asymmetric unbiased methods), in mapping brains during longitudinal scans for the detection of atrophy. They used 20 subjects from the ADNI database, and all images were preprocessed to exclude skull and dura. Yassa et al. [13] evaluated three methods (DARTEL, LDDMM, and Diffeomorphic Demons) in inter-subject registration of images especially at the medial temporal lobe, which is a crucial region for the study of memory. Christensen et al. introduced the NIREP project [14] , [15] , which in the first phase contains 16 publicly-available MR images, each having 32 expert-defined regions of interests (ROIs). They also defined 0278-0062 \u00a9 2014 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.\nSee http://www.ieee.org/publications_standards/publications/rights/index.html for more information.\na comprehensive set of evaluation criteria (including intensity-based variations, region-based overlaps, and transitivity errors). Based on these criteria they evaluated six methods (rigid, affine, AIR, Demons, SICLE, SLE) in [16] . Klein et al. in [17] evaluated 14 publicly-available registration tools for inter-subject registration of brain MR images. Four databases, each containing images of multiple subjects, were used. While it evaluated perhaps the largest number of registration tools so far, [17] only focused on skull-stripped, high quality, and single-site images from healthy subjects. To evaluate registration methods under more challenges, Klein et al. in another study [18] included both skull-stripped and raw images. Here, raw images refer to those acquired directly from scanner, prior to any image processing steps."}, {"section_title": "B. Need for a More Comprehensive Evaluation Study", "text": "While all the aforementioned studies provided insightful and informative evaluations, each study only tested registration methods in a specific task. For instance, for healthy subjects only (e.g., [11] , [13] , [16] , [17] ), for multi-modal fusion for pathological subjects only (e.g., [10] ), for skull-stripped images only (e.g., [12] , [13] , [17] ), for raw images only (e.g., [10] , [11] , [19] ), for skull-stripped and raw images only (e.g., [18] ), for single-site data only (e.g., [10] , [11] , [13] , [16] , [17] ), and for multi-site data only (e.g., [12] ). In addition, different evaluation studies included different registration methods for evaluation. Moreover, they used different parameter settings for a same registration method. As a result, the choice of registration algorithms seemed to be task-and database-dependent, and was sensitive to parameter settings.\nNevertheless, many of today's large-scale, pre-clinical and imaging-related studies present a wide variety of challenges-they may contain normal-appearing and/or pathology-bearing images; they may contain skull-stripped and/or raw images; and they may contain images acquired from single-and/or multi-institutions. Facing all these possible challenges, there is an increasing need for registration algorithms that are publicly-available, that can widely apply to various tasks/databases, that can perform relatively accurately and robustly, that can be easily used by people with varying expertise in image registration, and that are without much need for parameter tunings.\nWhile automatically and effectively tuning parameters for specific database/tasks is an important and active area of research (e.g., [20] - [24] ), having registration algorithms that can be widely applicable to many tasks/databases is a very desirable property. This need stems not only from the size of studies, but also from the rapidly increasing number of studies undertaken in, for instance, translational neuroscience. Due to the lack of ground truth, tuning parameters is a difficult task even for technical experts. Moreover, when images are acquired and processed in multiple collaborative institutions, having registration algorithms that perform robustly and consistently well with a fixed set of parameters becomes almost entirely necessary."}, {"section_title": "C. Overview and Contributions of Our Evaluation Study", "text": "Towards meeting this need, this paper evaluates 12 publiclyavailable and general-purpose registration algorithms, including an attribute-based algorithm and 11 other intensity-based algorithms. Our work built upon and significantly expands previous evaluation studies of the similar nature in many aspects. 1) Our work evaluated registration methods under various tasks and databases presenting a wide variety of challenges, rather than in a specific task containing specific challenges. We identified four typical challenges in inter-subject registration of brain MRI (as will be described in Section II). We chose seven databases, each containing images of multiple subjects, to represent some or all of those challenges. This helped reveal whether a registration method could be generally applicable and robust with regard to various challenges. 2) To reflect the robustness of registration algorithms especially in multiple large-scale translational studies involving various tasks/databases, we fixed the parameters for each registration method throughout this paper (i.e., task-independent parameter settings). Particularly, in all tasks/databases in this paper, we used the parameters as the ones reported in [17] whenever applicable. Using such parameter settings was because that the parameters had been \"optimized\" by authors/developers of each specific algorithm for the registration of skull-stripped, preprocessed and normal-appearing brain MR images, which is a typical task in the inter-subject registration [17] . We realize that this set of parameters might not be optimal for other databases/tasks (e.g., those containing raw images, pathology-bearing images, or multi-site images). However, having a fixed set of parameters is perhaps how those registration algorithms would be used or first tried in daily imaging-related translational studies, where heavy parameter tunings are not only tedious, but also less practical or reproducible. From another perspective, it would be preferable if some registration algorithms could apply widely and could perform consistently well in various tasks/databases giving a fixed set of parameters. To maintain reproducibility of our study, we used public databases wherever possible (six out of seven databases used in this paper are public); we included registration algorithms/tools that are publicly available; and we will fully disclose the exact parameter settings in Appendix B.\nThe rest of the paper is organized as follows. In Section II, we identify four typical challenges in the inter-subject registration of brain MR images. In Section III, we present the protocol to evaluate the accuracies of registration algorithms. In Section IV, we show the evaluation results. Finally, we discuss and conclude this paper in Section V."}, {"section_title": "II. TYPICAL CHALLENGES IN INTER-SUBJECT BRAIN MRI REGISTRATION", "text": "Brain images from different subjects may present one or more of the following challenges to registration.\nChallenge 1: Inter-Subject Anatomical Variability. Subjects may vary structurally ( Fig. 1 shows some examples) . Intersubject variability is a common challenge in many registration tasks investigating neuro-development, neuro-degeneration, or neuro-oncology. It is the main challenge against which registration methods were evaluated in the literature [13] , [15] - [17] . Fig. 1 . Four randomly-chosen subjects in the NIREP database (the top two rows) and four randomly-chosen subjects in the LONI-LPBA40 database (the bottom two rows). For each subject, both the intensity image and the expert-annotated ROI image are shown. Different colors represent different ROIs in each database. These two databases were used to evaluate how registration methods perform facing challenges arising from the inter-subject variability (Challenge 1).\nChallenge 2: Intensity Inhomogeneity, Noise and Structural Difference in Raw Images. In addition to inter-subject anatomical variability, images may suffer from intensity inhomogeneity (due to bias field), background noise, and low contrast. With skulls, ears, neck structures present in the raw images, subjects may also present larger deformations in those nonbrain structures compared to cortical structures (see Fig. 2 for example). Registration of raw images is necessary when 1) skull stripping is erroneous, so one has to work with the with-skull raw images; or 2) when registration itself is part of the skull-stripping step (e.g., in multi-atlas-based skull stripping approaches [19] , [25] ).\nChallenge 3: Protocol and FOV Differences in Multi-site Databases. Many of today's large-scale translational imagingrelated studies involve brain MR images acquired from multiple institutions. Since MR scanners, imaging protocols, and FOVs may vary from institution to institution, the acquired images may vary greatly. Especially when the FOV is different, which is not uncommon in multi-site databases, some images may contain structures that do not show up in other images (see Fig. 3 for an example). One can rely on experts to interactively crop images, so that images from various institutions cover roughly the same FOV. However, the manual cropping is labor-intensive, subject to intra-/inter-rater variability, and may become intractable for today's large-scale studies. Seeking a registration method that is relatively more robust to imaging protocol and FOV differences is therefore of interest.\nChallenge 4: Pathology-induced Missing Correspondences in Pathology-Bearing Images. Spatially normalizing a number of pathology-bearing images into a normal-appearing template space offers opportunities to understand the common Fig. 3 . Three-plane view of the intensity images and annotation images from three randomly-chosen subjects in the ADNI database. White color in the annotation images denotes the brain masks, and red denotes hippocampus masks. Blue contours in panel (a) point to the region that exists in one image, but does not exist in other images, due to the FOV differences in multiple imaging institutions. The ADNI database was used to represent Challenge 3 (on top of Challenges 1, 2). spatial patterns of diseases. Pathologies present in the patients' images, but not in the normal-appearing template. This poses the so-called missing correspondence problem (see Fig. 4 for example). An ideal registration approach should accurately align the normal regions (which do have correspondences across images), and relax the deformation in the pathology-affected regions, where no correspondences can be found [26] , [27] . Literature has suggested to either mask out the pathological regions from the registration process (i.e., the cost-function-masking approach [27] ), or, to simulate a pathological region in the normal-appearing template (i.e., the pathology-seeding approach [28] - [34] ). However, both approaches require a careful segmentation of the pathological regions, which in itself is not an easy or affordable task, especially in large-scale studies. It is ideal if a general-purpose registration algorithm, segmentation-free in itself, can perform well in pathological-to-normal subject registration. That is, without prior knowledge of the presence or the location of the pathologies, nor any partition of the pathological versus normal regions, it is ideal if a registration algorithm can find correspondences in places where correspondences can be found, while relaxing the deformation (or reducing the pathology-induced bias) in regions where correspondences can hardly be established."}, {"section_title": "III. EVALUATION PROTOCOL", "text": "In the following, Section III-A presents the databases we chose to represent these four challenges aforementioned in Section II. Then Section III-B briefly introduces the registration methods/tools we included in this evaluation. Section III-C elaborates parameter settings for all methods, with an emphasis on how to maintain the fairness, transparency, and reproducibility in our evaluation. Section III-D describes the criteria to measure registration accuracies."}, {"section_title": "A. Databases", "text": "Seven databases were used. Of them, six are publicly available. Specifically, we used two public databases to represent challenge 1 (Section III-A1); three public databases to represent challenge 2 (Section III-A2); one public database to represent challenge 3 (Section III-A3); and one in-house database to represent challenge 4 (Section III-A4). They are summarized in Table I and introduced in the following."}, {"section_title": "1) Databases Representing Challenge 1:", "text": "Two publiclyavailable and single-site databases, NIREP and LONI-LPBA40, were used to represent Challenge 1 (inter-subject variability). Both databases contain multiple normal subjects. Images in the two databases have been skull-stripped by neuroradiologists. Both databases contain T1-weighted (T1w) MR images (sequence parameters in Table I ). Neuroradiologists annotated those images into a number of ROIs (32 ROIs in the NIREP database and 56 ROIs in the LONI-LPBA40 database). The annotated ROIs are located in the frontal, parietal, temporal and occipital lobes, cingulate gyrus, insula, cerebellum, and brainstem. Note that, those ROIs were not used in the registration process; instead, they only served as references to evaluate the accuracy of registration (explained later in Section III-D1).\nThe detailed lists of those ROIs can be found in Appendix C. The detailed information about how ROIs were annotated can be found in [14] and [35] . Fig. 1 shows the intensity images and the corresponding expert-annotated ROI images from four subjects in the NIREP database and four subjects in the LONI-LPBA40 database. These databases were also used to evaluate the performance of registration methods in other similar studies (e.g., [15] , [17] ). Registration was carried out from every subject to every other subject in the same database. This removed any bias in the selection of source and target images in the registration. This led to 240 , or 210 , registrations in the NIREP, or LONI-LPBA40, database, for each registration method. Before registration, we removed the bias field inhomogeneity by the N3 algorithm (using the default parameters) [36] , and reduced the intensity difference between the two images by a histogram matching step.\n2) Databases Representing Challenge 2: Three public databases were used, containing raw brain MR images from multiple subjects. They were: BrainWeb, IBSR and OASIS databases. Specifically, the BrainWeb database [37] contains raw brain images of 20 healthy subjects. In each subject, every image voxel has been annotated as one of the 11 brain or nonbrain tissue types or structures: cerebrospinal fluid (CSF), gray matter (GM), white matter (WM), fat, muscle, muscle/skin, skull, vessels, around fat, dura matter, and bone marrow. Fig. 2 (a) presents two randomly-chosen subjects from the BrainWeb database, including their intensity images and the corresponding annotation images. We have randomly picked 11 BrainWeb subjects, leading to 110 pair-wise registrations for each registration algorithm. The IBSR database [38] consists of raw T1-weighted MRI scans of 20 healthy subjects from the Center for Morphometric Analysis at the Massachusetts General Hospital. In this database, the brain masks have been manually delineated by trained investigators for each subject. We randomly picked up 10 IBSR subjects, leading to 90 inter-subject registrations for each registration algorithm. Fig. 2(b) shows the raw intensity images and the corresponding brain masks of 2 randomly-chosen IBSR subjects. The OASIS database [39] contains cross-sectional T1-weighted MRI Data in young, middle aged, nondemented, and demented older adults, to facilitate basic and clinical discoveries in neuroscience. The brain masks were first generated by an automated method based on a registration to an atlas, and then proofread and corrected by human experts before the release. We randomly selected 10 OASIS subjects, leading to 90 inter-subject registrations for each registration algorithm. Fig. 2(c) shows the raw intensity images and the corresponding brain masks of 2 randomly-chosen OASIS subjects. Similar to those databases used for Challenge 1, the expert annotations were not used in the registration process; rather, they only served as references to evaluate registration accuracy, as we will explain later in Section III-D2.\n3) Database Representing Challenge 3: One example multi-site database is the ADNI database. ADNI, or Alzheimer's Disease Neuroimaging Initiative, is a large-scale longitudinal study for better understanding and diagnosing Alzheimer's Disease. It contains images acquired at 57 collaborative institutions or companies, all of which are publicly available. Different imaging sites used different MRI devices, imaging protocols, and FOVs. Registration among ADNI subjects is usually needed in the data preprocessing, or for the spatial normalization of subjects. This multi-site database has most of the challenges a multi-site database typically presents. Moreover, the ADNI protocol has now become a standard for the studies of aging and neurodegenerative disorders such as AD. Therefore, the performance on the ADNI database is of great importance for registration algorithms applied to data from older individuals and individuals with neurodegenerative diseases. We randomly selected the baseline images of 10 ADNI subjects, including three normal controls (NC), four mild-cognitive-impairment (MCI), and three AD subjects. For many subjects, the brain mask and hippocampus are available at the data release website. They were used in our experiments as the references to evaluate the registration accuracy. Fig. 3 displays the raw intensity images and the brain/hippocampus masks for three randomly-chosen ADNI subjects (1 CN, 1 MCI, and 1 AD subjects). Please note the presence of the inter-subject variability in the ventricle size, sulci, gyri, etc.; the image inhomogeneity, noise and large deformation; and especially the FOV differences due to the image acquisition in multiple imaging sites [e.g., the neck can be seen in (a) (highlighted by the blue contours), but is barely seen in (b)]. As in the previously-mentioned database, we performed all pair-wise registrations to avoid subject/template bias. This led to 90 registrations for each registration method."}, {"section_title": "4) Database Representing Challenge 4 (In Combination", "text": "With Challenge 1): An in-house database containing eight patients with recurrent brain tumors was used. T1-weighted images were collected with the image size 192 256 192 and the voxel size 0.977 0.977 1.0 mm . Images contain both the cavity, caused mainly by the blood pool after the resection of the original tumor, and the recurrent tumors. We registered those pathology-bearing images into a common T1-weighted MR image (i.e., the template), which was collected from a healthy subject (image size 256 256 181, voxel size 1.0 1.0 1.0 mm ). In this database, we have collected landmarks and ROIs annotated by two independent experts (HA and MB). Those landmarks and ROIs served as references for measuring the registration accuracy (the criteria to be presented in Section III-D4). Due to the HIPPA regulation (Health Insurance Portability and Accountability Act), the public release of this database is still an ongoing effort."}, {"section_title": "B. Registration Algorithms Included", "text": "Twelve general-purpose, publicly-available image registration methods were included in our study. They are summarized in Table II . We note that they are only a fraction of the large number of registration algorithms developed in the community. The pool can always be expanded to include other general-purpose algorithms (e.g., LDDMM [40] , elastix [41] , NiftyReg [42] , plastimatch [43] , etc.) and brain-specific methods (which often needs or incorporates tissue segmentation and/or preprocessing such as skull-stripping or surface construction, e.g., DARTEL [44] , HAMMER [45] , FreeSurfer [46] , Spherical Demons [47] , etc.). In general, we chose the 12 methods listed in Table II , because they represent a wide variety of choices for similarity measures, deformation models and optimization strategies, which are the most important components for registration algorithms (see Table II ). Out of those 12 registration methods, nine methods were included in a recent brain registration evaluation study [17] : flirt 1 [48] , fnirt 2 [49] , AIR 3 [50] , [51] , ART 4 [52] , ANTs 5 [53] , CC-FFD 6 [54] , SSD-FFD [54] , MI-FFD [54] , and Diffeomorphic Demons 7 [55] . In addition, we included DRAMMS 8 [56] , and two registration methods that were not included in study [17] . They are: (the nondiffeomorphic, or additive, version of) Demons [57] (with an ITK-based public software available), and DROP 9 [58] (a novel discrete optimization strategy that dramatically increases registration speed while maintaining high accuracy). For the completeness of this paper, more detail of these image registration algorithms can be found in Appendix A. And how their parameters were set will be presented in the next subsection (for the general rules) and Appendix B (for the detailed parameter values).\nNote that, while including a large number of registration algorithms/tools is preferable, including all available registration algorithms/tools seems less practical. We have included a number of the best performing methods (ANTs, ART, Demons, MI-FFD, etc.) as previously reported in [17] and several recent ones (DROP, DRAMMS) representative of new advancements in optimization strategies and/or similarity designs. Our focus, though, was not only on the number of algorithms/tools being included in this study, but more importantly on comprehensively evaluating registration methods in various tasks other than one or two specific tasks as in many previous evaluation studies. Doing so could provide an valuable insight to the generality, accuracy and robustness of registration algorithms/tools and an inspiration for future algorithm development. Some algorithms/tools were not included. One reason was that they were not included in [17] , and hence their best parameters were not reported on the same training databases that other methods used to optimize their parameters. We wanted to avoid the potential bias introduced by us selecting parameters of various algorithms, therefore we chose to use the optimal parameters sets whenever available in [17] . Moreover, some algorithms already had their closely-related methods included in our study. For example, LDDMM is in line with ANTs but does not have the symmetric design; elastix is an implementation of many transformation/similarity criteria, for which we have already had 12 methods in this paper to represent the variety; niftyReg and plastimatch are based on the GPU implementation of the MI-FFD algorithm, which has already been included in this study, and the GPU-implementation should be expected to improve the speed but not necessarily the registration accuracy. On the other hand, the evaluation framework in this paper is general to include, in the future, many other popular registration algorithms/tools."}, {"section_title": "C. Parameter Configurations for Registration Algorithms", "text": "We had the following two rules to set the parameters for each method.\n\u2022 Rule 1: We used the optimized parameters as reported in [17] whenever applicable. Those parameters were optimized by the methodology/software developers themselves on skull-stripped brain image databases that are similar to the ones we used in this paper (specifically, they used four databases-IBSR, LONI-LPBA40, CUMC, MGH-for training, which are similar to the databases we used in this paper, which also contain skull-stripped T1-weighted images from 1.5T scanners). We can treat those databases in [17] as the \"training\" database for the databases we used in this paper. For registration algorithms that were not included in [17] -DRAMMS, (Additive) Demons and DROP-we took the same logic: to optimize their parameters in, and only in, the task of registering skull-stripped images (the LONI-LPBA40 database specifically). The fact that this LONI-LPBA40 database was also used as one of the seven databases for \"testing\" in this paper is less of concern, since 1) the parameters of all other registration methods included in this paper were also optimized in the LONI-LPBA40 database and other similar skull-stripped databases (IBSR, CUMU, MGH databases) as reported in [17] ; and moreover, 2) in [17] , the registration methods seemed to be trained and tested in the same exact databases (IBSR, CUMU, MGH, LONI-LPBA40), while in our study, we only trained/optimized the registration methods in one skull-stripped database representing Challenge 1, and we tested all registration methods in six other unseen databases representing Challenges 1-4, respectively. \u2022 Rule 2: For each method, we fixed its parameters in all registration tasks. Put differently, we used the same parameters for a registration method, no matter it was used for skull-stripped brain images, raw brain images, multi-site data, or tumor-recurrent brain images. It should be admitted that the optimized parameters for skull-stripped brain MR images are not necessarily optimal for raw images or pathology-bearing images. However, using the same set of parameters has two advantages: 1) most users or algorithm-developers will start from the parameters that have already been optimized in normal-appearing, skull-stripped images (e.g., [18] , [59] - [63] ); 2) it helps reveal the generality of registration methods and their robustness levels facing various registration challenges. The second point is especially important, because a registration method that can successfully apply to a wide variety of registration tasks without the need for the task-specific parameter tuning should be desirable for the routine use in many large-scale pre-clinical research studies. Based on these two rules, we set the parameters which are disclosed in Appendix B of this paper."}, {"section_title": "D. Criteria to Measure Registration Accuracy", "text": "Having described the databases and registration methods in the previous sub-sections, this sub-section introduces the criteria to evaluate registration accuracy."}, {"section_title": "1) Criteria in Databases Representing Challenge 1:", "text": "We measured the accuracies of inter-subject registrations in the NIREP and LONI-LPBA40 databases by the Jaccard Overlap [64] between the deformed ROI annotations and the ROI annotations in the target image space. A greater overlap often indicates a more accurate spatial alignment. This was also the accuracy criterion used in many other evaluation studies such as [14] , [17] , [63] . Rohlfing in [65] demonstrated that, as long as the ROIs are localized (e.g., those (sub-)cortical structures), which is the case in the two databases we used, the regional overlap of ROIs is a faithful indicator of registration accuracy in various locations in the image space. Mathematically, given two regions and in a 3-D space, and given the volume of a region as defined by , the Jaccard overlap [64] between the two regions is defined as (1) Some other studies used the Dice overlap [66] , defined as . It should show the same trend and should be directly linked with the Jaccard overlap by . Therefore, reporting either one overlap metric should be sufficient for our purpose."}, {"section_title": "2) Criteria in Databases Representing Challenge 2:", "text": "In the BrainWeb database, the annotations of 11 relatively localized brain and nonbrain structures [see Fig. 2(a) ] were available. Therefore, we measured registration accuracy by the Jaccard overlap between the warped ROI annotations and the target ROI annotations. In the IBSR and OASIS databases, only the brain masks from raw brain images [see Fig. 2 (b) and (c)] were available. Since the brain mask is not a localized structure, the Jaccard overlap alone, according to [65] , might not be sufficient to represent the registration accuracy. Therefore, we used the 95-percentile Hausdorff Distance (HD) between the warped and the target brain masks as an additional accuracy surrogate. The HD between two point sets and is defined as (2) where is the Euclidean distance between the spatial locations of two points. The HD is symmetric to two input images, with a smaller value indicating a better alignment of brain boundaries. We used the 95th percentile other than the maximum HD, to avoid the influence of outliers, as suggested in [67] and [68] .\n3) Criteria in Databases Representing Challenge 3: Since the annotations of both the brain mask and the left and right hippocampi were available in the ADNI database, we used the Jaccard overlap between the warped and target ROIs to indicate the registration accuracy in this multi-site database-a higher overlap usually means a better spatial alignment of two images."}, {"section_title": "4) Criteria in Databases Representing Challenge 4:", "text": "The landmark and ROI annotations from two independent experts in the in-house brain tumor database enabled us to measure the registration accuracy in various locations. Specifically, we defined 4 zones in the entire image space, as can be seen in Fig. 5 . Those zones were defined by the distances to the abnormal regions. Therefore, they helped reflect how the existence of cavities and recurrent tumors influenced the registration accuracy in various regions of the image.\n\u2022 Zone 1: Abnormal region. Experts HA and MB together contoured the abnormal region that contains 1) the post-resection cavity and 2) the recurred tumor. Within this contour was what we defined as Zone 1, the abnormal region [see Fig. 5(a) ]. The experts referred to FLuid-Attenuated Inversion-Recovery (FLAIR) MR image for this contouring, because of its high sensitivity and specificity in delineating brain tumors [69] - [71] . Then they independently found the corresponding regions in the normal template image. We measured the accuracy of registration in Zone 1 by two metrics: 1) the average Dice overlap, and 2) the 95-th percentile Hausdorff Distance, between the algorithm-warped abnormal region and two rater-warped abnormal regions in the template space. A higher regional overlap and a smaller distance reflect a better alignment of two images in Zone 1.\n\u2022 Zone 2: Regions immediately neighboring the abnormal region. A 30 mm-wide band immediately outside the abnormal region was defined, by morphologically dilating the abnormal region mask agreed by the two experts in the patient's image space [see Fig. 5(a) ]. Anatomical landmarks were identified in this band, which served as the references to reflect the registration accuracy in the immediate neighborhood of abnormalities. One expert (HA) labeled 10 anatomical landmarks in Zone 2 within the patient image. The two experts then independently labeled the corresponding anatomical landmarks in the template space. The average Euclidean distance between the algorithm-calculated corresponding landmark locations and the rater-labeled corresponding landmark locations in the template space was used to measure the registration accuracy in Zone 2. Smaller landmark errors point to higher registration accuracy. The concept is depicted in Fig. 6 . Given a set of expert-annotated landmarks in the patient image, their corresponding landmark locations (independently by expert HA) and (independently by expert MB) in the template image, and the algorithm-calculated corresponding landmark locations also in the template image, we defined the inter-expert landmark errors (the length of the solid line in Fig. 6 ) as (3) and the algorithm-to-expert landmark errors (the average length of the dashed lines in Fig. 6 ) as (4) where is the Euclidean distance between two voxel locations.\n\u2022 Zone 3: Regions far away from the abnormal region.\nZone 3 was defined as all the normal regions outside Zone 2 [see Fig. 5(a) ]. We used landmarks to evaluate the registration accuracy in Zone 3. This could show how the recurrent tumor and the cavities have influenced registration in faraway normal-appearing regions. One expert (HA) labeled 40 anatomical landmarks in Zone 3. Then two experts independently labeled corresponding landmarks in the template space. Registration accuracy in this zone was measured by the average Euclidean distance between the algorithm-calculated corresponding landmarks and the rater-labeled corresponding landmarks in the template space. Smaller landmark errors point to higher registration accuracy in Zone 3.\n\u2022 Zone 4: Brain boundaries. The existence of cavities and recurrent tumors inside the patient image may even influence the alignment of the brain boundaries between the patient and the normal-appearing template images. To capture this influence, we measured the dice overlap and the 95th percentile Hausdorff Distance between the warped and the template brain masks. A higher dice overlap and smaller distance indicate a higher level of robustness of a registration algorithm with regard to the abnormality-induced negative impact."}, {"section_title": "IV. RESULTS AND ANALYSIS", "text": "In this section, we use four subsections to present the evaluation results in the databases representing the four aforementioned challenges. Fig. 7 shows the average Jaccard overlap over all ROIs in the NIREP and LONI-LPBA40 databases. A detailed table of Jaccard overlap per ROI can be found in Appendix C for all algorithms evaluated in this paper. Several observations can be made from this set of results."}, {"section_title": "A. Results in Databases Representing Challenge 1", "text": "1) DRAMMS and ANTs obtained the highest Jaccard overlaps in both databases. Between the two methods, DRAMMS had a slightly higher accuracy in the NIREP database ( for ANTs and for DRAMMS, ); whereas ANTs had a slightly higher accuracy in the LONI-LPBA40 database (\nfor ANTs and for DRAMMS, ). In both cases, the differences were tiny ( difference between the average Jaccard overlaps in the 0-1 scale). Following ANTs/DRAMMS were DROP, Demons and ART registration methods. Among these methods, ANTs and ART were included in the evaluation study [17] and were found to be the two most accurate methods. Our findings here showed a similar trend. In addition, the three methods-DRAMMS, DROP and (the nondiffeomorphic, or additive, version of) Demons, which were not included in [17] , showed highly competitive performances.\n2) Methods such as SSD-FFD, fnirt, DROP use intensity differences (SSD) as the similarity metric. On average, they had reasonable Jaccard overlaps. However, they also showed larger variations of regional overlaps, and therefore they were less stable in our experiments than those methods using CC, MI, or attribute-based similarity measures.\n3) The high degree of freedom allowed by a deformation mechanism (such as the FFD model as used in DRAMMS and the diffeomorphism LDDMM model as used in ANTs) is perhaps another factor contributing to the higher registration accuracy, compared to deformation mechanisms with relatively few degrees of freedom (such as fifth-order polynomials in AIR)."}, {"section_title": "B. Results in Databases Representing Challenge 2", "text": "For the three databases containing raw images, we had two scenarios-one focusing on the localized structures and tissue types throughout the image space (the BrainWeb database); and the second scenario focusing on the brain masks (the IBSR and OASIS databases), which is crucial for (multi-)atlas-based skull-stripping. Fig. 8 shows the average Jaccard overlaps of the 11 ROIs in the BrainWeb database. Several observations can be made."}, {"section_title": "Scenario 1. Registration Accuracy in Multiple Localized ROIs/Structures in the Raw Images:", "text": "1) DRAMMS, DROP and Demons obtained similarly high accuracies, followed closely by the ANTs and ART methods. These registration methods were also among the most accurate ones in registering skull-stripped brain images as shown in the previous sub-section.\n2) On the other hand, the average Jaccard overlap in various ROIs by the best-performing algorithm in this raw, Fig. 9 . Registration accuracy in raw brain images, in the IBSR and OASIS databases, as indicated by the Jaccard overlap (the first row) and 95th percentile Hausdorff Distance (the second row), between the warped and the target brain masks. This is Scenario 2 in the testing of registration methods facing Challenge 2 (intensity inhomogeneity, noise and structural differences in raw images). \"prctile\" in the title of the second subfigure means \"percentile\".\nwith-skull database (i.e., DRAMMS) was only around 0.32 ( Fig. 8) . Compared to the average Jaccard of 0.52-0.57 in registering skull-stripped brain images (Fig. 7) , this clearly underlined the increased level of difficulty in registering raw, with-skull brain images."}, {"section_title": "Scenario 2. Registration Accuracy in Brain Masks of the Raw Images:", "text": "In this registration scenario, we focused on the accuracy of registration in warping the brain masks, which is the basis for the atlas-based skull-stripping framework (e.g., [19] , [25] ). Fig. 9 shows the accuracies of three registration methods (ANTs, Demons and DRAMMS), which were forerunners in the results in Scenario 1. Several observations can be made.\n1) The Jaccard regional overlap and the 95th percentile Hausdorff Distance showed the same trend for aligning the brain masks-a higher Jaccard overlap corresponded to a smaller distance; 2) The ranking and the difference of methods seemed to be highly dependent on the database, especially the level of difficulty for registration in a database. In the OASIS database, which exhibits a lower level of inter-subject FOV differences and intensity inhomogeneity [as can be seen in Fig. 2(c) ], ANTs scored the highest accuracy, followed closely by Demons and DRAMMS. In the IBSR database, however, which exhibits a higher level of inhomogeneity, background noise and larger deformations, DRAMMS scored the highest accuracy, followed, with relatively bigger distances, by Demons and ANTs. 3) Overall, a Jaccard overlap of 0.75-0.93 could be expected for the brain masks when we registered raw, with-skull images within a same database. This should provide a promising starting point for (multi-)atlas-based skull-stripping (e.g., [19] , [25] ). On the other hand, one needs to be aware that the registration accuracy might decrease when images are from multi-site databases, usually with larger imaging and FOV differences (to be shown in the next subsection). "}, {"section_title": "C. Results in the Database Representing Challenge 3", "text": "Fig . 10 shows the overlap results averaged over all 90 pairwise inter-subject registrations in the ADNI database. Compared to the registration within the single-site database, the registration of raw images acquired from multiple imaging sites encountered an increased level of difficulty. Specifically, three observations can be made.\n1) DRAMMS and ANTs performed better than Demons in aligning the brain masks. They showed higher levels of robustness with regard to the FOV differences, the background noise and the presence of skull or other nonbrain structures.\n2) The presence of the skull, the background noise, and especially the FOV difference, in the ADNI multi-site database, had a clearly visible impact on the accuracy of aligning deep brain structures. When registering skull-stripped images from single-site databases such as in the LONI-LPBA40 database, ANTs, Demons and DRAMMS could align hippocampi at Jaccard overlaps around 0.6, and they differed by less than 0.05 Jaccard overlap on average (see Table V in Appendix C). However, when the raw images from the multi-site ADNI database were used, even the best-performing algorithms (DRAMMS and Demons as shown in Fig. 10 ) could only align hippocampi at Jaccard overlaps around 0.5 on average, and algorithms had greater differences in terms of the Jaccard overlaps they obtained. Another factor that caused the decrease in the accuracy and the increase in the differences among methods could be that those subjects in the ADNI database have highly variable degrees of neuro-degeneration (three normal controls, four MCI, and three AD subjects), and hence they have largely different ventricle sizes, atrophy patterns, and hippocampus sizes (see Fig. 11 for some examples of very difficult cases, which will be described in item 4 below). 3) Considering the quantitative results in all three regions (brain mask, left, and right hippocampi) in those with-skull raw images acquired from multiple institutions, DRAMMS showed the greatest promise. 4) Besides the quantitative results in the limited number of structures such as the brain masks and the hippocampi, the visual inspection of the registration results in the whole images could actually reveal much greater differences among registration methods. Fig. 11 shows some registration results from Demons, ANTs and DRAMMS in two pairs of subjects from the multi-site ADNI database. As pointed out by blue arrows in the figure, DRAMMS showed a clear advantage to align the largely different anatomies such as the ventricles. To capture this large difference, many algorithms may have to increase their search ranges. However, this usually requires considerable efforts for task-specific, or even individual-specific, parameter adjustments. Adjusting search ranges is a nontrivial research topic. It often requires specific theoretic designs [73] , or requires the introduction of anatomical landmarks [74] - [80] . The main difficulty is to effectively balance between capturing the large differences and capturing the local subtle displacements. Therefore, algorithms that can capture and balance between both, and do not require additional parameter adjustments, become favorable. Actually, in our recent studies that spatially normalized all ADNI subjects into a common template (from a normal control subject), a small portion of the Alzheimer's Disease (AD) subjects have unusually large ventricles than many other AD subjects. We considered a Fig. 11 . Demons, ANTs and DRAMMS registration results of two pairs of images having large anatomical variations especially in ventricles, mainly due to their different levels of neuro-degeneration. All subjects are from the multi-site ADNI database. Blue arrows point to some typical locations where registration results from three methods differ greatly.\nregistration \"failure\" if there were more than 5 mm errors in the ventricle boundaries (visually pronounced errors). Accordingly, the success rate was defined by # #\nCompared to the 80%-85% success rate by ANTs and Demons when used with the fixed sets of parameters, DRAMMS, also using a fixed set of parameters as in other cases, achieved a success rate of 96%, which was a clear improvement of registration accuracy in this large-scale multi-institutional database. "}, {"section_title": "D. Results in Database Representing Challenge 4", "text": "Fig . 12 shows the quantitative registration errors in the pathology-to-normal subject registration. As a reference, this figure also includes inter-expert errors between the two independent experts in Zones 1-3. A desirable registration should 1) accurately register the normal-appearing regions, where correspondences can be established (i.e., small landmark errors in Zone 2-3); 2) accurately align the brain boundaries (i.e., small 95%-percentile HD distances in Zone 4); and 3) map the pathological regions to the right location but relax the deformation within the pathological regions, where correspondences could hardly be established (i.e., high regional overlaps in Zone 1). In Fig. 12 , several observations can be made. 1) Two independent experts agreed with each other only at a 0.48 Jaccard overlap on average in the cavity and tumor recurrence regions (Zone 1). This reflected the difficulty, or the ambiguity, for the human experts to deal with the missing correspondences. Among the four methods evaluated, ANTs agreed with experts at the highest level (average Jaccard 0.40), followed closely by DRAMMS (average 0.37 Jaccard overlap). The 95th percentile Hausdorff Distances showed the same trend. Overall, experts showed better agreement between each other than between algorithms and experts. 2) In Zone 2 (the immediate neighborhood of the abnormal regions), the average landmark error was 4.1 mm between experts. Landmarks errors for DRAMMS, ANTs and Diffeomorphic Demons were similar (at 3.9, 4.1, and 4.4 mm, respectively), and also comparable to the inter-expert errors. 3) Further away from the abnormal regions, Zone 3 had larger landmark errors than Zone 2. The average errors were 5.3 mm between experts, 5.8 mm for DRAMMS, and 5.9 mm for ANTs. Diffeomorphic Demons and especially fnirt started to have larger landmark errors (6.6 and 9.6 mm on average). This difference may, in part, be attributed to the fact that DRAMMS used texture features and ANTs used correlation coefficient as similarity metric, which were perhaps more robust and reliable than the intensity difference which Demons and fnirt used as their similarity metrics. 4) Another interesting finding was in Zone 4 (brain boundary). Because of the sharp contrast between foreground and background in a skull-stripped image, the brain boundaries ought to be among the easiest parts to register. In the presence of pathologies, however, this was surprisingly not always the case. Fnirt, for example, had 11.1 mm as the 95th percentile Hausdorff Distance at brain boundaries, which meant registration failures in several cases. ANTs had, on average, 3.3 mm as the 95th percentile Hausdorff Distance in the brain boundary, which was even bigger than the average errors ANTs produced in the abnormal regions (2.1 mm). By carefully examining the output images, we found that this average boundary error by ANTs was mainly caused by misalignments in the boundaries close to the pathology sites in several cases. This showed Fig. 13 . Registration of a brain image with tumor recurrence to a normal brain template by DRAMMS, for a series of slices in the coronal view. This figures shows how the mutual-saliency mechanism (a spatial-varying utilization of voxels) helped DRAMMS in the pathological-to-normal subject registration scenario. Without segmentation, initialization, or prior knowledge, the automatically-calculated mutual-saliency map (d), defined in the target image space, effectively assigned low weights to those regions that correspond to those outlier regions (pointed out by arrows) in the source image (a). This way, the negative impact of outlier regions could be largely reduced; registration was mainly driven by regions that could establish good correspondences. Red arrows point to the post-surgery cavity regions. Blue arrows point to the recurrent tumors.\nthat the pathology regions may impact a wide area in ANTs registration. On the other hand, DRAMMS and Diffeomorphic Demons had the smallest boundary errors (1.8 and 2.2 mm, respectively). Both errors were smaller than those in the abnormal regions, indicating good alignments of the brain boundaries. This showed that the negative effect of pathological regions was more localized in DRAMMS and Diffeomorphic Demons registration algorithms, which should be desirable. It should be emphasized that general-purpose registration algorithms are usually not designed for registering pathologybearing images. Task-specific registration algorithms are often needed to segment and specifically deal with the pathology-affected regions. However, the fact that DRAMMS, as a general-purpose registration algorithm, performed stably and robustly in all Zones 1-4, highlighted the effect of using attributes to measure voxel similarities and to quantify voxelwise matching reliabilities. To better illustrate this, Fig. 13 shows a set of representative DRAMMS registration results (registration from a tumor-recurring patient's brain image to the normal-appearing brain template image). First, DRAMMS extracted high-dimensional Gabor texture attributes to represent each voxel. The attributes should be more informative than intensities in the search for correspondences. Moreover, at each voxel, DRAMMS automatically calculated a so-called \"mutual-saliency\" weight, also based on the attributes. The mutual-saliency quantified the chance of each and every voxel to establish a reliable correspondence between the two images. As Fig. 13(d) shows, the mutual-saliency map effectively identified outlier regions (dark blue), where correspondences could be hardly established. The identified outlier regions coincided with the recurrent tumor regions [as red arrows pointed out in panel (a)]. Note that, this was obtained without any segmentation, manual masking, or any prior knowledge of the presence or the location of the tumor recurrence. Being segmentation-free is a feature that differentiates DRAMMS from those task-specific cost-function-masking approaches or pathology-seeding approaches. As a result of this attribute-based similarity measurement and mutual-saliency weighting, the registration by DRAMMS was mainly driven by the regions where correspondences could be well established. This led to visually plausible results as shown in Fig. 13(c) ."}, {"section_title": "V. DISCUSSION AND CONCLUSION", "text": "In this last section, we first summarize the work and findings in Section V-A. Then, Section V-B discusses the theoretical differences among the registration algorithms included in this paper, which may, at least partly, explain the different performances among registration methods in our experiments. Section V-C discusses the limitations of the whole evaluation work and the future directions. Finally, Section V-D concludes this paper."}, {"section_title": "A. Summary of Work and Findings", "text": "This study evaluated several registration algorithms and their publicly-available software tools. Our evaluation had the features summarized below.\nFirst, compared to existing studies that evaluated registration algorithms in specific tasks and/or databases, our study utilized multiple databases to represent a wide range of challenges for the inter-subject registration. As Table I showed, the databases we included in this evaluation work covered a variety of imaging scanners (GE, Siemens, Philips), field strengths (1.5T, 3T), age groups, imaging FOVs, and imaging protocols (varying pulse sequence parameters). The purpose was to extensively evaluate the generality, robustness and accuracy of registration algorithms.\nSecond, our study found out that, in general, registration algorithms differed greatly in terms of their performances, when facing different databases or challenges. For skull-stripped images included in our study, ANTs and DRAMMS led to the highest overlaps of expert-annotated (sub-)cortical structures, followed by ART, Demons, DROP, and FFD. Whereas for more challenging tasks in databases containing raw, multi-site and pathology-bearing images, the attribute-based DRAMMS algorithm obtained relatively more stable and higher accuracies, followed closely by the intensity-based and symmetric ANTs registration algorithm."}, {"section_title": "B. Understanding the Differences Among Registration Algorithms", "text": "Registration algorithms differ in similarity metrics, transformation models, and the optimization strategies. Table II summarized the registration methods included in this paper, and more details can be found in Appendix A. Such differences are likely the major factors for their different performances in this paper.\nIn terms of similarity metrics, 11 out of 12 methods included in this paper measure the image similarity based on the gray scale intensities or intensity distributions. DRAMMS, on the other hand, measures the image similarity by a rich set of multi-scale and multi-orientation Gabor attributes. Intensities alone may not necessarily carry anatomical or geometric information of voxels. That is, voxels having similar or even identical intensities may belong to different anatomical structures. Consequently, a common challenge in intensity-based similarity metrics is how to effectively deal with matching ambiguities. Methods such as ANTs measure the similarity of two voxels by the correlation coefficient of intensities in local patches centered at those two voxels. The local patches carry, to some extent, the local texture or geometric information. Therefore, in our experiments they were relatively more robust to noise, partial volume effects and magnetic field inhomogeneities, compared to measuring the voxel-wise similarity using intensities alone. Attribute-based methods such as DRAMMS extend this to the explicit characterization of voxels by the high-dimensional, often more informative, texture or geometric attributes. This could reduce matching ambiguities, but at the cost of an increased computational burden. This observation has been documented in the literature by several research groups (e.g., [45] , [81] - [83] ). The generality and accuracy of DRAMMS in our experiments, especially its performances in raw, multi-site and pathology-bearing images, provided new evidence for using attributes to measure image similarities. On the other hand, there is also ongoing research on extending intensity-based similarity metrics (CC or MI) into more robust measures to reduce matching ambiguity for mono-and multi-modality registration [22] , [84] , [85] .\nAnother related issue is how image voxels are used when calculating the similarity between two images. Generalpurpose registration methods, such as most of the ones included in our study, often use all voxels equally to define the image similarity. On the other hand, DRAMMS introduced the notion of \"mutual-saliency.\" The central idea was to use all voxels, but at different levels of confidence as measured by the mutual-saliency metric. Specifically, those voxels having higher confidence to establish reliable correspondences were associated with higher mutual-saliencies (e.g., Fig. 13 ), and they were accordingly used with higher weights in calculating the image similarity. They were the main driving force for the registration. An immediate advantage was in the registration of pathology-bearing images such as shown in Fig. 13 . Without prior knowledge for tumor presence, or any prior tumor segmentation, DRAMMS examined voxels one by one and attached with each one of them a \"mutual-saliency\" number that reflected its ability to find correspondences. This way, the mutual-saliency map in Fig. 13(d) automatically and effectively found out a temporal lobe region that had difficulty to establish correspondences, and the location of this region agreed with that of the abnormal regions. By this, the deformation within the abnormal region was relaxed; the other normal-appearing regions were matched well, which drove the registration of the whole image. The idea of spatially-varying treatment of voxels has also been adopted in other registration approaches (e.g., [86] - [88] ), showing great promise in many challenging registration problems involving, for example, topology-changing tumor changes, pathology-induced outliers, and cardiac/lung motion-induced subtle changes.\nIn terms of the transformation models, the ones with more degrees of freedom typically led to higher registration accuracies in our experiments. For instance, the geometric cubic B-spline-based FFD transformation model as used in CC/MI/SSD-FFD, DRAMMS and DROP, and the velocity fields used in Demons and ANTs, could perhaps explain their relatively higher registration accuracies than other less flexible transformation models (e.g., the fifth polynomial as used in AIR). The symmetric feature as introduced in ANTs seemed to at least partly contribute to its accuracy and robustness. Specifically, in the pathological-to-normal subject registration, where two images differ greatly, ANTs had high accuracies in abnormal regions and in the immediately neighboring normal regions. This was perhaps due to the symmetric setting, which constrained both images to deform towards the \"hidden middle template\" between the two images. This way, a difficult inter-subject registration problem was decoupled into two relatively simpler subproblems. Such a symmetric setting is also advocated in many other approaches such as in the linear registration [89] and deformable registration [90] , [91] . Furthermore, the diffeomorphic setting in ANTs and Diffeomorphic Demons also contributed to the accuracy and robustness, since the regularization of the transformation in the diffeomorphisms seemed to account for the real-world anatomical deformations.\nWhen it comes to the optimization strategies, methods included in this paper used optimizers either in the discrete space (DRAMMS, DROP) or in the continuous space (all others). The discrete optimization helped to reduce the computational time to 3-5 min in DROP [58] , [92] , compared to 10-20 min in MI/CC/SSD-FFD, which have the same similarity metric and transformation model. Their accuracies were comparable in our experiments. Another interesting comparison in our experiments was the 30-50 min computational time of DRAMMS, which used a discrete optimizer on high-dimensional attribute-based similarities, versus about 1-1.5 h for ANTs, which used a continuous optimizer on patch-based correlation coefficient similarities. Both computational times were for a pair-wise registration of some typical brain images (e.g., image size 256 256 200), and on a Linux operation system with an Intel Xeon x5667 3.06-GHz CPU and a 16 GB memory. It should take another controlled study to further investigate the impact of the optimization strategies on registration accuracies. One thing to note is that many registration methods are able to be parallelized into GPU accelerations [93] - [95] ."}, {"section_title": "C. Limitations of Our Evaluation Study and Future Work", "text": "We also note some drawbacks of this study, and hence our future work.\nFirst, like many other studies [11] , [12] , [16] , [83] , [96] - [98] , this study was also conducted by the authors of one of the algorithms to be evaluated. Questions may naturally arise for the reproducibility and fairness in such comparative evaluations. We tried to address these questions when designing and conducting this study: 1) for reproducibility, we fully disclosed the parameters, used public databases whenever possible, and constrained our evaluation within publicly-available registration algorithms; 2) for fairness, we used the parameters suggested by the authors of the registration methods as reported by [17] , and all of those parameters were \"optimal\" in the registration of skull-stripped and preprocessed brain MR images. Not all self-conducted evaluation studies in the literature had these features, but we felt that it was really important to comply with these high standards in our study. Our future plan includes the participation in third-party-organized challenges, such as in [17] , [99] , and [100] .\nThe second point worth discussing in our study is that we fixed the parameters for each registration method. Two questions may arise: whether we should fix parameters and at which values we should fix the registration parameters. For the first question, we fixed registration parameters because the aim was to test whether some methods can be used in many large-scale, often multi-institutional, translational studies. This was a high standard and quite an ambitious aim that did not appear in previous evaluation studies. Facing many registration tasks and many databases, normal or pathological, single-or multi-site, in daily translational research, it is usually less practical to tune parameters for each specific task/database. Therefore, we fixed parameter values in our study. We note that this does not necessarily reflect a registration method's stability or sensitivity with regard to the parameter changes. Stability is another preferable feature of registration methods. To better reveal stability or sensitivity, a future study is needed to examine how registration algorithms perform over a wide range of parameter values. That is, to thoroughly investigate how registration accuracy changes when the values of registration parameters change. The difficulty lies in the determination of effective, often multivariate, parameter ranges, and the objective comparison of parameters (or parameter ranges) among different registration algorithms. For the second question-at which values we should fix the parameters, the parameter values we used in this paper were those optimal for one typical registration task. They were the values suggested by authors of the algorithms themselves, and hence most likely to be adopted by ordinary users, or to be tried in the first pass by algorithm developers. We note that they are not necessarily optimal for the other three tasks, nor necessarily optimal for the four tasks altogether. In the future, a more complete study may be needed to \"learn\" the (range of) parameter values that are best overall in the four tasks included in this paper. Highly sophisticated learning framework needs to be designed, such as [21] and its extensions. It will require a larger data size for training and testing, and the familiarization of the implementation details in each registration algorithm.\nIn our experiments, we used fewer images and fewer databases to represent Challenges 3-4 than Challenges 1-2. Specifically, only 10 ADNI subjects (three AD, four MCI, three NC), or 90 pair-wise registrations, were used to test registration methods against challenges arising in multi-site databases; and only eight patients with recurrent tumors were used to test registration methods against pathology-induced missing correspondences. Because of the relatively small data size, a decisive conclusion on how registration methods perform facing Challenges 3-4 may need to be deferred to future larger-scale studies. What we want to emphasize is that, although small in data size, those experiments were among the very first ones appearing in the literature to evaluate general-purpose registration methods in multi-site data and in pathological data. Therefore, those experiments could serve as a proof of concept that some registration algorithms may bear the potential to work reasonably well in those difficult cases. A future study with a larger data size is needed in this direction. Acquiring multi-site or pathological data, especially acquiring expert annotations of landmarks and/or ROIs on those data, is in itself a nontrivial problem.\nThe same as in studies [10] , [11] , [14] - [18] , [98] , expert-defined annotations of ROIs or landmarks served as references for the evaluation of registration accuracy in our study. One thing to note is that expert annotations may be subject to intra-/inter-expert variability, and may have a certain level of uncertainty or even errors. Therefore, a perfect and completely error-free registration algorithm may still present some minor errors in the current criteria to assess registration accuracy, because of the uncertainty in the expert annotation of landmarks or ROIs. Quantifying such uncertainty is another topic for future studies. To reduce the influence by the variability or uncertainty of expert annotations, we either used two independent experts in some databases, or used multiple databases for a specific task, where different databases were annotated by different experts to reduce the chances of systematic uncertainties or errors.\nIn our study, we only evaluated the accuracy of registration, which was what most previous studies did [12] , [17] , [96] - [98] . Some recent studies (e.g., [16] , [99] ) started to look at more comprehensive criteria including the registration smoothness. The argument was that, many registration algorithms might achieve a fairly high structural overlaps at very aggressive underlying deformations. Therefore, studies like [16] , [99] started to put registration accuracy in the context of registration smoothness, and evaluated both properties. Debates exist, though, for two reasons. First, whether the emphasis should be on the accuracy or on the smoothness is usually more dependent on the specific application. For instance, atlas-based segmentation frameworks may need a more aggressive registration to obtain higher structural overlaps; whereas on the other hand, population studies using voxel-wise statistics may need a smoother registration to better balance between the difference among individuals and the commonality within a population. Second, while the criteria for registration accuracy can be indicated on landmark errors or regional overlaps, the criteria for registration smoothness is relatively loosely defined. Some studies used Jacobian determinants [99] , [101] -negative Jacobian determinants indicating self-folding (i.e., nondiffeomorphism) should be penalized, as human organs deform smoothly. In the existence of cross-individual anatomical differences, whether the deformation should be strictly diffeomorphism remains a topic of debate. Plus, the computation of Jacobian determinants requires a numerical approximation of the continuum from the discrete image space, and usually varies by different software packages. Consequently, other studies (e.g., [14] - [16] , [89] , [102] ) used additional metrics such as the transitivity and the inverse consistency to measure the smoothness and diffeomorphism of deformation fields. Nevertheless, the wide adoption of those metrics needs more studies, and the balance between accuracy and smoothness seems a task-specific choice. This is another reason that our future studies need to thoroughly examine a range of parameter values to look at how registration accuracy and smoothness change as parameter values change, so that users may make a more informed choice about the algorithms, their implementation tools and a proper set of parameters for problems at hand.\nBesides registration accuracy or smoothness, a perhaps more important task for our future study is the utility of registration methods in various clinical applications. For example, in multi-atlas-based segmentation propagation, the most accurate registration for single-atlas registration may not necessarily achieve the highest overall segmentation accuracy. Choosing a proper registration methods or a proper set of registration parameters in this case is subject to other interleaved factors such as the label fusion. Another example is in the detection of atrophy or growth patterns, which is usually an important component in the study of neuro-degenerations [103] - [108] or neuro-development [109] - [112] . There, the most accurate or the most smooth registration may not be necessarily the optimal choice to decipher the subtle patterns [113] . Similar situations also occur for the brain extraction (e.g., [19] ), the quantification of longitudinal disease change (e.g., [83] , [114] ), and in cognitive neuroscience (e.g., [115] ). Therefore, much interest is in putting registration into the big picture of end (pre-)clinical goals and considering its interactions with other factors.\nTo further improve registration accuracy, one interesting topic is to utilize multiple registration methods in a meta-analysis framework, where one method may underperform or fail in a task/database/individual, but others may make up the loss. Several newly published articles supported this consensus process, or the so-called meta-registration process, such as [72] , [116] - [118] . Doshi et al. recently combined ANTs and DRAMMS in a multi-atlas labeling framework, resulting in a top-performing method in a MICCAI segmentation challenge [72] . Muenzing et al. recently combined ANTs, NiftyReg and DROP and showed a significant reduction of registration errors in pulmonary images [118] . These studies further underline the potentially synergistic value of various registration methods. Another interesting avenue for improving registration accuracy, especially when registration algorithms face several challenges from large anatomical variabilities or imaging device differences (e.g., 2-D ultrasound to 3-D MRI), is to better initialize general-purpose registration algorithms with anatomic or geometric landmarks. Several recent studies are in this direction, on how to accurately and automatically extracting useful landmarks [77] , [79] , [119] , and how to effectively combine landmarks and voxel-wise information in an elegant and practical framework [76] , [92] , [120] - [123] ."}, {"section_title": "D. Conclusion", "text": "In conclusion, this paper conducted a comparative evaluation of 12 publicly-available and general-purpose image registration methods, in the context of inter-subject registration of brain MR images. In contrast to existing works that evaluated registration methods in a specific task or a specific database, the emphasis of this work was on evaluating the generality, accuracy and robustness of registration methods in various inter-subject brain MR image registration tasks with various challenges involving multiple databases containing skull-stripped images, noisy and raw images, multi-site data, and pathology-bearing images. Our experiments showed that DRAMMS and ANTs gained relatively higher accuracy in skull-stripped images, followed by ART, Demons, DROP and FFD. DRAMMS showed a relatively higher accuracy when raw, multi-site or pathology-bearing data were involved. The main reasons might be 1) DRAMMS measures the similarity between voxels by a rich set of texture attributes while other methods by intensities; and 2) DRAMMS has the mutual-saliency mechanism to automatically quantify the matching reliability of voxels, and to use those highly reliable matching to drive the registration, while other methods use voxels equally. The fact that ANTs, ART, Demons, DROP, and SSD/MI-FFD performed relatively accurately among all intensity-based algorithms highlight the importance of 1) choosing image similarity metrics, such as correlation coefficient and mutual information, that are relatively more robust with regard to the noise, intensity inhomogeneity, and partial volume effects, and 2) choosing proper transformation models that are of sufficient degrees of freedom but well regularized by the diffeomorphism or even the symmetric design with regard to the two input images.\nOur future work will include the participations in thirdparty-organized grand challenges, the further investigation of registration performances with regard to changes of varying parameter values, and a more extensive evaluation by including more data, more registration methods, more comprehensive evaluation criteria, and especially more clinical-oriented applications. Another very interesting direction is to develop a meta-registration paradigm, where registration methods complement rather than compete with each other. This has the potential to bring accuracy, robustness, and generality to a new and higher level."}, {"section_title": "APPENDIX A SUMMARY OF THE 12 PUBLICLY-AVAILABLE METHODS INCLUDED IN THIS EVALUATION", "text": "Appendix A supplements Section III-B in providing more detail for the 12 publicly-available registration methods included in this evaluation study.\n\u2022 flirt. An affine transformation assumes that all voxels in the image move together with 12 degrees of freedom (dof) in a 3-D space. This includes three dof for scaling, three dof for translation, three dof for rotation, and three dof for shearing. The publicly-available FMRIB's Linear Image Registration Tool (flirt) [48] from FSL package is perhaps the most cited work for affine registration, as evidenced by more than 1500 citations in the Google Scholar search engine since its publication in 2001 (as of March 2013). The main contribution of flirt is in the optimization strategy. A global, multi-start and multi-resolution optimization strategy specifically for affine image registration problems was proposed. The fundamental idea is to combine a fast local optimization (Powell's conjugate gradient descent method [124] ) with an initial search phase. The flirt tool supports a variety of intensity-based similarity metrics, including Least Square Intensity Difference (LS), (Normalized) Correlation Coefficient ((N)CC) and (Normalized) Mutual Information ((N)MI). The flirt tool is publicly available at http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FLIRT. \u2022 AIR. The Automatic Image Registration (AIR) registration tool was developed by researchers (Woods et al.) at the University of California, Los Angeles (UCLA) in the 1990s [50] , [51] . AIR makes contributions in the deformation models. It models the deformation by second-, third-, fourth-and fifth-order nonlinear polynomials (30, 60, 105 , and 168 deformation parameters, respectively). To find the optimal values for the deformation parameters, AIR minimizes a cost function between the deformed image and the target image. Three different cost functions are supported in AIR. One is the ratio image uniformity (RIU).\nThe ratio of the intensity in the deformed image to the intensity in the target image is computed at each voxel location. The deformed and the target images are assumed to be aligned when the ratio is homogeneous (i.e., high mean value and low standard deviation) in the entire target image space. The second cost function is Sum of Square Difference (SSD) of image intensities. The SSD cost function assumes that the same anatomical structure in different images share the same intensity. Therefore, two images are aligned when the differences in their intensities are minimized. The third cost function is a variant of the second cost function, with some relaxation. Instead of assuming that the same anatomical structure shares the same intensity in different images, the third cost function assumes the same anatomical structure shares the same intensity with a global scaling factor. Therefore, it is a globally-weighted SSD cost function. To minimize the cost function, a numerical optimizer based on either Newton's method [125] or Levenberg-Marquardt method [126] is used. The AIR registration tool is publicly available at http://bishopw.loni.ucla.edu/air5/.\n\u2022 ART. The Automatic Registration Toolbox (ART) was developed by researchers (Ardekani et al.) at the Nathan Kline Institute for Psychiatric Research and in the New York University in 2005 [52] . It makes contributions in defining a new similarity metric. In the ART framework, each voxel is characterized by a high-dimensional feature vector, which is constructed by stacking the intensity values of all the voxels in the neighborhood. Compared with most voxel-wise methods which establish correspondences by the intensity at each voxel, ART establishes correspondences by the high-dimensional feature vector at each voxel. The similarity of two voxels is defined on their feature vectors as the inner-product of two vectors and an idempotent and symmetric matrix that removes the mean of the vector it pre-multiplies. ART is implemented in multi-resolution fashion. In the middle and low image resolutions, ART searches correspondences for all voxels in the target image. In the highest image resolution, ART only searches correspondences at those voxels whose gradient norms are in a certain upper percentile of the gradient magnitude histogram. The ART registration tool is publicly available at http://www.nitrc.org/projects/art/. \u2022 ANTs. The Advanced Normalization Tools (ANTs) was developed by researchers (Avants et al.) at the University of Pennsylvania in the 2000s [53] . It is based on the LDDMM algorithm [40] , but improves LDDMM's computational efficiency and introduces symmetry into the LDDMM framework. In particular, ANTs decomposes the diffeomorphic deformation into two symmetric components. The idea is that, instead of deforming one image into the space of the other image, which is usually not symmetric to the input images, ANTs simultaneously deforms two input images, each towards the \"midpoint\" image. Therefore, the formulation becomes symmetric to the input images. ANTs supports three intensity-based similarity metrics: SSD, which LDDMM uses; CC, which is used by default in ANTs; and MI. The gradient descent optimization strategy [127] is used to numerically find the optimal deformation in the above formulation. ANTs iteratively updates the transformation by a velocity field, which, subject to the symmetry constraints, is computed at each voxel by searching a most similar voxel in the other image, according to whichever similarity metric users choose (by default correlation coefficient). Then the velocity field is smoothed by Gaussian filters before incorporated into the total deformation. The ANTs registration tool is publicly available at http://stnava.github.io/ANTs/.\n\u2022 Demons and Diffeomorphic Demons. The Demons algorithm [57] , [128] considers deformable image registration as a nonparametric diffusion process. It introduces \"demons\" to push voxels to their correspondences according to the local intensity characterizations. Using intensity difference as the similarity metric, a force is computed from the optical flow equations to push voxels by some velocity that is iteratively added to the total displacement (initially zero). The total displacement is then smoothed with a Gaussian filter serving as regularizations of the deformation. In its original version [57] , the velocity field is simply added to the current deformation in each iteration, which may cause self-foldings in the deformation field and is hence not diffeomorphic. To solve this problem, the Diffeomorphic Demons was developed in [128] , by composing the deformation with the exponential of the velocity field. The Diffeomorphic Demons version has been shown to produce much smoother deformation (measured by Jacobians and Harmonic Energy of the obtained deformation) at an accuracy comparable to that of the original Demons [128] . In both approaches, the deformation is iteratively updated by a velocity field, which computes voxel-wise displacements according to a specific similarity metric; and the increment and the total deformation are smoothed by Gaussian filters to maintain smoothness. In this paper, both Demons and Diffeomorphic Demons are included in the evaluation. The Demons software (including Diffeomorphic Demons) is publicly available at http://www.insight-journal.org/browse/publication/154. \u2022 DRAMMS. Deformable Registration via Attribute Matching and Mutual-Saliency Weighting [56] is a general-purpose deformable registration algorithm. It makes contributions in defining a new similarity metric with two features. One feature is that it finds voxel correspondences based on high-dimensional Gabor texture attributes. The other feature is that it does not force each and every voxel to find its correspondences as most other general-purpose registration methods do. Rather, it weights voxels differently based on automatically detecting the ability of this voxel to establish correspondences between images. This way, the registration is mainly driven by voxels/regions that can establish reliable correspondences; at the same time, it can effectively reduce the negative impact of outlier regions if they exist. DRAMMS uses the cubic B-spline transformation model, as will be described later in the FFD algorithm. The DRAMMS software package is publicly available at http://www.cbica.upenn.edu/sbia/software/dramms/.\n\u2022 DROP. DROP is the implementation of a deformable image registration pipeline developed by researchers (Glocker et al.) at the Ecole Centrale de Paris, France, the Technische Universit\u00e4t M\u00fcnchen, Germany, and the University of Grete, Greece [58] . The main contribution of DROP is in the numerical optimization. Discrete optimization is, for the first time, introduced into the field of medical image registration, brining in significant speedup compared with other continuous optimizers such as gradient descent (8 min by discrete optimization versus 3 h 50 min by gradient descent for the same set of brain images, as reported in [58] ). DROP uses FFD as its deformation model (described later in this section), and supports 12 intensity-based similarity metrics: Sum of Absolute Differences (SAD), which is used by default, Sum of Absolute Difference plus Sum of Gradient Inner Products (SADG), Sum of Squared Differences (SSD), Normalized Correlation Coefficient (NCC), Normalized Mutual Information (NMI), Correlation Ratio (CR), Sum of Gradient Inner Product (SGAD), and others. The DROP registration tool is publicly available at http://www.mrf-registration.net/.\n\u2022 FFD and its variants (CC-/MI-/SSD-FFD). The free form deformation (FFD) model is a geometric transformation model that was introduced to image registration by [54] in 1999. Since then it has been widely used and cited for more than 2400 times in Google Scholar search engine (as of March 2013). In the FFD model, a regular grid of so-called \"control points\" is superimposed on top of the dense image lattice. A FFD model basically states that the movement of an image voxel is a smooth, cubic B-spline-based interpolation of the displacement of the control points surrounding this voxel. Therefore, the task of finding movements at each voxel was translated into finding the displacements at regularly-spaced control points. In contrast to voxels-based methods, FFD has three nice properties: 1) control points are regularly spaced in the image, providing guidance throughout the image domain; 2) deformation is smooth by the cubic B-spline-based interpolation; 3) landmarks moves by finding its own correspondences, whereas control point moves by finding the most possible corresponding patch for the image patch it controls, or represents. In the original work [54] , FFD was combined with normalized mutual information (NMI) similarity metric. It can be combined with several other similarity metrics, including correlation coefficient (CC) and sum of squared difference (SSD). In this paper, we used the IRTK software package, which is the original implementation of the FFD-based registration. NMI-FFD, CC-FFD and SSD-FFD were all included in the evaluation. The software is publicly available at http://www.doc.ic.ac.uk/~dr/software/.\n\u2022 fnirt. The FMRIB's Nonlinear Image Registration Tool (fnirt) was developed by researchers (Anderson, Smith, and Jenkinson) at the University of Oxford, Oxford, U.K., in 2007 [49] , [129] . The fnirt method uses Sum of Squared Differences (SSD) as the similarity metric, therefore it is only suitable for mono-modality image registration tasks. It implements the free form deformation (FFD) model. The deformation is regularized by the magnitude of the Laplacian of the deformation (also known as the bending energy of the deformation). The main contribution is in the optimization process [129] . The optimization is based on multi-resolution Levenberg-Marquardt strategy [126] . The registration is initialized and run to the convergence in the down-sampled images, generating a deformation field with low resolutions and a high regularization weight. The images and the deformation field from the first step are then up-sampled, with the regularization modified. And it is again run to the convergence. This is repeated until the required high-resolution and the required level of regularization is achieved. The fnirt registration tool is publicly available at http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/fnirt."}, {"section_title": "APPENDIX B PARAMETER SETTINGS FOR REGISTRATION METHODS", "text": "In Section III-C, we presented two rules to set the parameters for each registration method, in order to maintain fairness of the evaluation. Appendix B below provides the details of parameter settings for transparency and reproducibility in the evaluation.\n\u2022 flirt.\nwhere specifies all parameters. They are: .\n\u2022 CC-FFD.\n--where specifies all parameters. They are:\n. Note that, in [17] ; we set to increase smoothness of the deformation.\n\u2022 MI-FFD.\nThe usage is the same as in CC-FFD above, with the only difference being one item in : .\n\u2022 SSD-FFD.\nThe usage is the same as in CC-FFD above, with the only difference being two items in : .\n\u2022 fnirt."}, {"section_title": "APPENDIX C JACCARD OVERLAP FOR ALL ROIS IN THE NIREP", "text": "AND LONI DATABASES Table III shows Jaccard overlaps, averaged over all pair-wise registrations, in all 32 ROIs in the NIREP database. Methods that obtained highest average Jaccard overlap in each ROI are noted in bold texts. Similarly, Table V shows overlaps, aver-TABLE III  JACCARD OVERLAP FOR EACH OF THE 32 ROIS IN THE NIREP DATABASE,  AVERAGED AMONG ALL 240 REGISTRATIONS  . FOR EACH ROI,  BOLD TEXTS AND LIGHT-GRAY TEXTS INDICATE THAT THE CORRESPONDING  REGISTRATION METHODS OBTAIN THE HIGHEST AND THE SECOND HIGHEST  OVERLAP COMPARED TO OTHER REGISTRATION METHODS aged over all pair-wise registrations, in all 56 ROIs in the LONI-LPBA40 database. They provide more information than Fig. 7 especially on what level of accuracy we can expect for each of the ROI structure in inter-subject registration. For instance, hippocampus may have over 0.6 Jaccard overlap in inter-subject registration, while superior occipital gyrus may only have around 0.45 Jaccard overlap. "}]