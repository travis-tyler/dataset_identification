[{"section_title": "Abstract", "text": "Abstract. Medical image registration is one of the fundamental tasks in medical image processing. It has various applications in field of image guided surgery (IGS) and computer assisted diagnosis (CAD). A set of non-linear methods have been already developed for inter-subject and intra-subject 3D medical image registration. However, efficient registration in terms of accuracy and speed is one of the most demanded of today surgical navigation (SN) systems. This paper is a result of a series of experiments which utilizes Fast Radial Basis Function (RBF) technique to register one or more medical images non-rigidly. Initially, a set of curves are extracted using a combined watershed and active contours algorithm and then tiled and converted to a regular surface using a global parameterization algorithm. It is shown that the registration accuracy improves when higher number of salient features (i.e. anatomical point landmarks and surfaces) are used and it also has no impact on the speed of the algorithm. The results show that the target registration error is less than 2 mm and has sub-second performance on intra-subject registration of MR image real datasets. It is observed that the Fast RBF algorithm is relatively insensitive to the increasing number of point landmarks used as compared with the competing feature based algorithms."}, {"section_title": "BACKGROUND", "text": "Literature study showed that non-rigid medical image registration methods perform better and produce good results in case of deformable soft tissue than rigid registration. Rueckert et al. [13] have demonstrated the superiority of free-form deformations based on B-splines when compared to rigid and affine transformations applied to MRI breast images. Non-rigid registration techniques are usually divided into two broad categories: intensity based and feature based. Intensity based techniques directly operate on gray values but require optimization criteria like mutual information (MI) to find the best possible mapping. Such methods are accurate but computationally expensive. On the other hand, feature based techniques require to identify (manually or semi-automatically) the corresponding feature points, contours or even surfaces between images, to map one image onto the other.\nChui et al. [1] formulated feature-based non-rigid registration as a non-rigid point matching problem using points, contours and curves. They developed an algorithm called TPS-RPM (Thin Plate Spline -Robust Point Matching) along with thin-plate splines (TPS's) as the parameterisation of the non-rigid spatial mapping.\nLevin et al. [6, 7] developed a technique for improving the speed of the point landmarks based non-rigid registration using a standard PC based on the built-in fast tri-linear interpolation feature of off-the-shelf graphics cards available in market. They execute a thin-plate spline (TPS) based warp at discrete positions on a grid that overlays each slice of the image data and has a configurable size. Built-in interpolation capability of the underlying card is used to calculate the intensity values of the voxels of each grid cell. With a data set of 512 \u00d7 512 \u00d7 173 voxels and 92 manual point landmarks, they reduced the registration time from 148.2 seconds to 1.63 seconds using a brute force implementation of the grid based warp. However, the accuracy of the grid based approach was less than the corresponding brute force approach.\nAnother more recent example is the work by Lapeer et al. [5] . They adapted the method of Livne and Wright [8] and developed a point-based algorithm for fast medical registration using RBFs. They showed that the warp speed reduced to 0.54 s for a size 256 3 dataset (CT/MRI) of the Vanderbilt Database using 8-44 manually defined point landmarks. They also concluded that the most optimum and theoretically correct RBF function for 3D is the bi-harmonic spline instead of the 'popular' thin-plate spline (which is only optimal in 2D).\nUsually point-based methods are often used in SN systems for head and neck surgery by medical experts due to ease of identification of corresponding landmark features. Further, they use it as a similarity metric such as the Target Registration Error (TRE) to measure the registration accuracy. However, if more point landmarks are needed then it is more time consuming and becomes impractical. On the other hand, surface based registration uses more or sufficient number of points, but involves a pre-processing step (called segmentation) to extract corresponding surfaces and again results in consuming more processing time. Though, few point landmarks are required to run the registration algorithm, but the use of more ac-curately placed landmarks improves the registration accuracy much more and thus a hybrid approach of point-based and surface-based registration will be a good option to register two corresponding 3D surfaces or 3D volumes. This can be obtained by applying a point-based registration technique to a set of corresponding landmarks of two images or volumes obtained in the form of a few corresponding manual landmarks and a corresponding parameterized surface with the same number of points.\nThis paper presents a non-rigid feature based registration method aimed at preor intra-operative registration of medical images during surgical guidance. Therefore, the method needs to be fast enough for SG and having an acceptable accuracy i.e. less than 2 mm. The technique uses radial basis functions (RBFs), and more particularly the biharmonic spline (BHS), to define a non-linear mapping function between 3D images to be registered.\nThe presented registration method is a non-rigid point-based method [5] where the corresponding features are anatomical point landmarks and surfaces, the latter being generated by extracting corresponding curves from images to be registered using a semi-automatic method based on active contours and watersheds [4] . The extracted curves are then converted to 3D parameterized surfaces using a 3D surface generation [9] algorithm and a proper surface parameterization technique of Yoshizawa et al. [19] . Furthermore, the method is largely insensitive to the number of point landmarks used and has no effects on algorithm speed during the evaluation stage, i.e. execution time, as compared to similar methods. Accuracy of the registration should improve by using higher number of point landmarks during registration which is subject to accurate landmarks placement. Practically manual landmarks placement is not only time consuming during the registration process but also prone to errors. Therefore, we use two corresponding parameterized surfaces for the two volumes to be registered. Parameterized surfaces will not only increase the number of points but also minimize user involvement in landmarks placement and preparation. The rest of this paper describes the methods we used to obtain 3D curves, 3D surface generation and parameterization, the fast RBF technique and a comparative experiment of the fast RBF method with other feature-based non-rigid registration methods."}, {"section_title": "METHODS AND ALGORITHMS", "text": ""}, {"section_title": "Initial Contours (Curves) Extraction", "text": "Previously [5] , we use manual way to place single anatomical point landmarks in matching slices of both images to be registered. We found that increasing landmarks increased the accuracy of the registration. But this manual way is time consuming, prone to errors and also requires the knowledge of expert such as radiologist. To increase the number of point landmarks for the corresponding images to be registered, we extend our point based method to curve-based method; the latter uses the boundary curves. The corresponding curves (point sets) with sufficient number of points were extracted from the both images using two popular techniques: active contours; and watersheds. Both methods have certain limitations, i.e., the watershed technique is sensitive to image noise, causes over-segmentation and active contours suffer from initialization problems. The problem of over-segmentation in watersheds [4] was removed by using internal and external markers into regions of interest while the output of watersheds solves the active contour initialization. Both techniques overcome each other's limitations resulting into a smooth and accurate contour. The immersion-based watershed technique presented by Vincent and Soille [17] and extended by Lapeer et al. [4] to convert watershed boundaries into valid active contours using a boundary following algorithm was used. Once a boundary contour, which is piece-wise linear, is obtained, we resample each curve with a fine set of points (at pixel level) into a fixed and coarser set of points (at edgel level) by continuously reducing a given set of points into a two point set based on the computation of a mid point value. The resampling algorithm actually parameterises the input curves so they have the same number of points. This process is repeated to get sufficient number of curves for the surface generation of both datasets. The resultant set of corresponding boundary landmarks (curve) along each slice are triangulated to form a 3D surface for each dataset."}, {"section_title": "From Curves to 3D Surface Generation", "text": "First we build an initial 3D surface using the curves obtained from the slices and then parameterized to be used for registration. To get a surface mesh from two adjacent and parallel curves we apply the advancing-front algorithm [9] . It uses tiling to generate a mesh from a 3D set of points (curves). In order to get the internal mesh for the last curve which covers the ROI for the corresponding slice, we do calculate the mean position based on the boundary points of the last curve and every boundary point is connected simply to the mean position. Though this may give a fan triangulation (see Figure 1) , a remeshing algorithm (coming later) can automatically fill the boundary region with well-shaped triangles. Figure 1 shows an example of two triangulated MRI data sets of human heads downloaded from Vanderbilt database, which we think to register. Fan triangulation contains obtuse triangles and that is not good for the application like registration. Therefore, we need a proper reparameterization method for correspondence creation and also a suitable optimisation technique to minimize the aspect ratio of obtuse triangles."}, {"section_title": "3D Surface Parameterization", "text": "Surface Parameterisation (SP) is the process of dividing a 3D surface into subsurfaces (patches), followed by finding one-to-one mapping between each subsurface and a planar domain. It can also be referred to as surface flattening, because it maps a 3D surface into a flat (2D) surface. Most of the time surfaces of arbitrary and complex shapes such as a human head or brain are represented by a collection of Figure 1 . Corresponding mesh models after applying the advancing-front algorithm [9] to two adjacent and parallel curves obtained from MR-T1 dataset of Vanderbilt database. The mean point position of the last curve points is calculated and its triangulation with every point on the last curve is the point of maximum curvature of the ROI.\ntriangles and their mapping is piecewise linear. SP has various applications in computer graphics and geometric modeling, for example texture mapping, remeshing, surface repairing, and creation of regular and structured surfaces.\nThe concept of a SP has been extensively discussed in differential geometry, and Floater et al. [3] have presented a detailed survey about recent advances in it. SP is the process of finding a mapping function which converts a 3D surface to an equivalent 2D planar surface, i.e., it deforms a 3D surface in a continuous fashion to a planar domain. However, a better SP is the one which creates a smooth oneto-one mapping with a minimum deformation (metric distortion). Floater et al. [3] have further classified this mapping (SP) which can either be:\n\u2022 conformal, i.e., has no distortion in angles, or \u2022 equi-areal, i.e., has no distortion in areas, or \u2022 isometric, i.e., minimises some combination of angle distortion and area distortion.\nThe literature shows that a lot of work has been carried out on each of the above mapping methods used in SP. If a mapping is conformal and equi-areal then the mapping is isometric, i.e., it preserves distances, areas, and angles. Isometry is one of the most desirable properties of any parameterisation to be achieved during flattening, which means that a 3D surface after parameterisation should have all the features in their corresponding parameter domain as well. Moreover, isometric parameterisation exists only if a surface is locally 'flatable' (developable). But for our work with particular (targeted) applications, we found that minimising some combination of angle and area distortion [14, 19] (isometric parameterisation) which has the feature of reproduction, i.e., a surface will be reproducible (developable) if and only if the mapping used is bijective [3] , would be a better choice.\nThe work in this section is for targeted and specific registration applications where large deformations are involved, e.g. brain MR images. Surface parameterisation will develop a global surface based correspondence measure for two or more such images to be registered. Such a correspondence is produced through flattening (initial parameterisation) each surface to a common parametric domain, followed by distortion measurement in the initial parameterisation and an optimisation procedure that further improves the two surface's alignment in a spatial or parametric domain. We use a 2D square as a parametric domain in this work, but this can be extended to any other domain (sphere, cylinder, torus) based on the target application and shape of the object. The technique, we use for flattening the 3D surface is based on the efficient low-stretch parameterisation method of Yoshizawa et al. [19] , which is a global parameterisation method and has both features of minimising angles and areas distortion. We then optimise the initial parameterisation (correspondence) obtained through Yoshizawa et al. [19] by using our proposed parameterisation technique given below."}, {"section_title": "Our Parameterisation Approach", "text": "Our proposed parameterisation method consists of three steps. First, it parameterises the 3D surface using the algorithm by Yoshizawa et al. [19] and creates an initial parameterisation. Second, it re-meshes the flattened mesh using a regular triangular grid followed by an optional surface adjustment. The third step takes the initial parameterisation [19] as an input and gradually improves it using reparameterisation. A logical flow diagram of our proposed surface parameterisation approach is given as follows:\n3D image surface \u2193 Build initial parameterisation \u2193 Resample the surface with a regular grid \u2193 Adjust the surface using 3D-back projection (optional) \u2193 Surface smoothing via reparameterisation\nThe three steps of the proposed parameterisation approach are explained below: i) Initial parameterisation. Our initial parameterisation approach is based on the flattening [2] and stretch minimisation [19] method. During research experiments on meshes it was observed that the method of Yoshizawa et al. [19] is preferred for global parameterisation of large and complex meshes such as Figure 2 . Left (original MR image) and right (deformed MR image); both are the corresponding 2D flattened meshes after applying the initial parameterisation algorithm [19] to the 3D meshes given in Figure 1 . The deformation is visible from the curves structure in the mesh.\nthe one shown in Figure 1 . It is not only a fast and efficient technique but it also produces a parameterised mesh while trying to reduce production of obtuse triangles. Obtuse triangles will impact the registration results (TRE) directly, if not avoid or reduce them to a certain extent. Figure 2 shows the 2D plane meshes on a unit square generated after applying the initial parameterisation method [19] . The connectivity of the flattened 2D mesh is the same as that of the original 3D mesh. All the coordinates (i.e. both x and y) of the flattened mesh are normalized and in the range [0, 1] .\nii) Resampling (remeshing ) using a structured 2D grid. After flattening of the 3D mesh, we need to rebuild the original 3D surface from the flattened mesh coordinates. The resampling will generate a new 3D surface with proper coordinates to be used to the established correspondence representation of two or more surfaces. As we want to increase the number of points and distribute them uniformly to the original surface, we create a regular and triangular 2D grid G r of an arbitrary n \u00d7 n size instead of the flattened one. For example a 2D regular triangular grid of size 30 \u00d7 30 (see Figure 4 first row with two grids of size 30 \u00d7 30) is used to represent and rebuild the original 3D meshes of Figure 1 . The size of the grid is configurable and set by the user. This particular grid of size 30 \u00d7 30 will create exactly 900 landmarks and will be used during the registration process.\nIn order to get the corresponding 3D point for each vertex of the 2D grid, we use the barycentric coordinates of the corresponding parametric triangle in the parametric domain to calculate the corresponding 3D positions for each vertex of G r . For example, to get the 3D coordinates of a point p (x ,y ,z ) \u2208 3 having a corresponding point u \u2208 2 in a parametric triangle (u 1 , u 2 , u 3 ) with barycentric coordinates (\u03bb 1 , \u03bb 2 , \u03bb 3 ), this can be mapped (\u03c6) as:\nwhere \u03bb 1 , \u03bb 2 , \u03bb 3 \u2265 0, and \u03bb 1 + \u03bb 2 + \u03bb 3 = 1. x, y, and z represent the 3D coordinates of the corresponding 3D triangle to which the point p belongs. It is a piecewise linear map and its inverse is represented as u i : 3 \u2192 2 . The mapping used during resampling is visualised in Figure 3 . Figure 3 . A barycentric mapping of given point u in a certain parametric triangle (u 1 , u 2 , u 3 ) with barycentric coordinates (\u03bb 1 , \u03bb 2 , \u03bb 3 ), which corresponds to a point p (x ,y ,z ) \u2208 3 through a parameterisation P After replacing each vertex position of G r by a corresponding 3D position, we get a new 3D mesh with a uniform and equivalent number of points for each of the two corresponding meshes of Figure 1 . Figure 4 shows the corresponding a) regular meshes, b) resampled and c) meshes flattened back to 2D using reparameterisation. The discrepancies in c) show that the parameterisation itself introduces errors which are visually apparent from the differences in comparing the original a) 2D grid with the one c) flattened back to 2D after reparameterisation. Images in row b) show the corresponding resampled meshes of the meshes shown in Figure 1 after sampling by a regular grid. Now, we have two new meshes (row b) with the same number of points and with a known and established one-to-one correspondence between their points. The corresponding points can be used onward for training and test purposes during registration.\niii) Reparameterisation: Reducing triangle obtuseness. We start with an initial parameterisation U 0 and then improve it further to U 1 . . . U opt by reparameterisation. We stop the optimisation procedure when an optimum value in a) b)\nterms of minimum distortion (stretching error) over the whole mesh is obtained. We observed that the first optimisation step already improves the quality of mesh parameterisation. Figure 5 shows the parameterisation result of the mannequin head model and an MR-T1 dataset surface. It is clear from the third image in first and second row of Figure 5 that the first step (U 1 ) has better results as compared to U 0 due to reparameterisation, and also the triangles have better aspect ratios. Similarly, Figure 6 further demonstrates that the reparameterisations (U 1 , U 2 , U 3 ) produce triangles of better aspect ratios as compared to initial parameterisation [19] (U 0 ).\nThe total stretching error measured quantitatively during initial parameterisation (U 0 ) and reparameterisations (U 1 , U 2 , U 3 , U 4 ) is shown in Table 1 for each model. It shows that after the first step (U 0 ) the stretch converges to a constant value, hence we stop the optimisation process. c) Figure 4 . The first row a) shows the two regular grids of size 30 \u00d7 30 each, the second row b) corresponds to the resampled meshes of Figure 1 using the grids in the previous row, whereas the third row c) shows the corresponding 2D meshes of row b) flattened back to 2D using the same algorithm. The discrepancies in c) in comparison to a) show that the parameterisation itself introduces errors. Table 1 . Row one and two show the total stretch for mannequin head and MR-T1 surface models during the initial parameterisation U 0 and reparameterisation U 1 , U 2 , U 3 , and U 4 , respectively"}, {"section_title": "The Fast Radial Basis Functions Method", "text": "The Radial Basis Function (RBF) method is one of the most widely used technique to approximate or interpolate data scattered in more than one dimensions. The purpose of interpolation is to approximate a real-valued function f (x) over a finite set of values f = (f 1 , . . . , f N ) at the distinct points X = {x 1 , . . . , x N } \u2282 R d . In similar situation, one chooses an RBF, s(x), for representing such approximations, normally of the following general form: Figure 5 . The images from left to right of both rows show the corresponding meshes of a mannequin head model and an MR-T1 dataset surface before and after (first and second image in both rows) the initial parameterisation [19] (U 0 ) while the last three images (U 1 , U 2 , U 3 ) represent the meshes after applying the proposed reparameterisation technique three times to the initial parameterisation U 0 . For the MR-T1 dataset, the last four surfaces show the image data and mesh together. Figure 6 . The same sequence as in the bottom row of Figure 5 but displayed in mesh format only where p(x) is a polynomial, \u03bb i is a real-valued weight 1 , \u03c6 is the (radial) basis function and x \u2212 x i = r is the Euclidean distance between x and x i . So, an RBF might be defined as a weighted sum of a radially symmetric basis function, added together with a polynomial term.\nThe basis function \u03c6 can take several forms, but three of them have a common property of minimizing specific quantities of energy [10] , which makes them suitable for use in 2D and 3D non-rigid medical image registration techniques. Rohr [10] further shows that the biharmonic spline (BHS): \u03c6(r) = r and the thin-plate spline (TPS): \u03c6(r) = r 2 log r, both minimize a bending energy potential of order two in 3D and 2D space, respectively. Thus to warp 3D image data, the BHS is therefore the choice to be preferred. Lapeer et al. [5] confirmed its theoretical optimality in 3D as shown by Rohr experimentally.\nLapeer et al. [5] rewrite Equation (2) without the linear polynomial part for sake of clarity, and extend it to 3D for evaluation of i = 1 . . . m evaluation points/voxels (targets) represented by the target vector x i , after having found the spline parameters \u03bb j for j = 1 . . . n landmarks represented by the source (landmark) vector y j :\nLivne and Wright [8] describe a new technique for fast multilevel evaluation of RBF expansions. The main idea of the fast RBF technique is to accurately represent a smooth RBF, \u03c6, on a regular and coarser grid with few nodes as compared to the full voxel set of the image data, and thus the expensive summation in Equation (3) needs to be applied to these few nodes only. The rest of the voxel values can finally be computed using a less expensive formulation based on the values determined for the surrounding nodes. Unlike the grid based approach by Levin et al. [7] , those are the RBF coefficients that are interpolated within the grid and not the intensity values of the voxels. The main principle behind the fast RBF method is to encapsulate the source (landmarks) and target (voxel) points in two new separate and corresponding uniform grids of size H. The new uniform grids overlap the old landmark and voxel sets respectively, which results into a two stage conversion process of the RBF in Equation (3) . The first stage is to calculate the level H expansion coefficients replacing the original source points (landmarks) with their corresponding grid points by using a centered p th order tensor product interpolation:\nwhere j = 0, 1, . . . , n and for dimension k = 1, 2, 3: j . The second stage replaces the original target points (i.e. voxels) with their corresponding grid points using the same approach:\nwhere i = 0, 1, . . . , m, J = (J 1 , J 2 , J 3 ), and for dimension k = 1, 2, 3:\u03c3 i . The so called anterpolation method is used to properly distribute the known RBF coefficients \u03bb(y j ) at each landmark position to the surrounding nodes of grid Y. More detail of the fast RBF method in 1D and 2D, and 3D can be found in [8] and [11] , respectively."}, {"section_title": "Performance Metric", "text": "The following two performance metrics were used to access the accuracy of our method:\nTarget Registration Error (TRE): It is the RMS error between the homologous validation landmarks after registration. The distance between every corresponding pair of points of the two meshes (surfaces) is calculated to determine how close and well registered the surfaces are. The closer the registered surfaces, the better the registration. This distance is calculated as an RMS error between the corresponding test landmarks after the registration process.\nNormalized Mutual Information (NMI): As the NMI metric (Studholme et al. [16] ) is suited to both mono-modal and multi-modal scenarios, we use this metric for image similarity measurement. It is the overlap invariant, and has an optimal and minimum value of 2.0 and 1.0, respectively."}, {"section_title": "EXPERIMENTAL RESULTS", "text": "After getting the corresponding surfaces (set of 3D points) of a pair of images, we fit the spline to the corresponding training landmarks to get the transformation matrix and spline parameters (weights) for final registration and validation (using the test landmarks). A quantitative experiment has performed, to show that the fast RBF method is insensitive in terms of speed to an increasing number of accurately placed landmarks in the form of corresponding surface points. Further, it is also shown that the increasing number of accurately placed landmarks improves the registration accuracy as well. For this purpose, six different competing methods are tested:\n1. Brute force (non-optimized) RBF -applying a standard software based method which applies the spline model to each voxel in the data set without any optimisation. This method is considered to be the gold standard in terms of accuracy.\n2. Brute force (non-optimized) RBF with hardware acceleration -the same algorithm as before but implemented on the GPU (Graphics Processing Unit) which enables a significant speedup due to its parallel processing capabilities.\n3. Fast RBF method -the software-based optimised algorithm as described in Section 2.4. In our previous work [5] , it is observed that optimal value for the H parameter in the model is 0.025.\n4. Fast RBF method with hardware acceleration -the previous method implemented on the GPU.\n5. The grid approach by Levin et al. [7] with two different grid sizes.\n6. The FFD (free form deformation) based non-rigid registration algorithm of Rueckert et al. [13, 15] implemented in IRTK (The Image Registration Toolkit) [12] , is used to compare the results of our proposed Fast RBF method with the state-of-art technique IRTK using NMI (for multi-model image registration), warp time and as well as visual assessment in the form of difference images. In FFD based registration, we set the initial control point spacing to 25.6 mm and run up to three levels in a coarse-to-fine fashion, where level 1 represents the coarsest level and level 3 represents the finest (optimised) level.\nTo evaluate the speed-optimized algorithms which use hardware acceleration, i.e. 2., 4. and 5., in terms of accuracy, the brute force algorithm 1. is considered as the gold standard. This is because current GPU's, despite being significantly faster than CPU's, only have 32 bits for floating point representation, whereas CPU's have 64 bits, what affects the accuracy of the warp. The experiments were run on computer under the Windows XP operation system. The hardware in the computer included: Intel Core 2 Quad 6600+ CPU; 3 GB of DDR2 RAM; and an NVIDIA GeForce 8800GTX Graphics Card with 768 MB memory."}, {"section_title": "Non Rigid Image Registration Using Real Datasets", "text": "The MR datasets of three subjects of the ADNI database (adni.loni.ucla.edu) were used and resampled to 256 3 with 1 mm slice thicknesses. These datasets were used to test intra-patient point based non-linear registration from the original dataset to its natural deformed version (see Figures 11 to 13 , columns 1 and 2 of all rows). We ran our experiment with an increased number of landmarks by using first a few anatomical point landmarks followed by a combination of surface points with few manual anatomical point landmarks. This way the increase in point landmarks represents more and more deformations in corresponding images and will eventually improve the registration results. During the experiment, we used the BHS spline rather than TPS, due to its suitability for 3D non-rigid medical image registration in terms of speed and accuracy, as shown in [5] .\nResults of the different registration algorithms with ADNI datasets are given in Table 2 . Table 2 . Results after applying the BHS basis function for non-rigid registration of the MR-T1 ADNI datasets of the same subject taken at different time points. 25 point landmarks were used for training and 25 for validation in the first part of the table. In the second part of the table, 450 surface based landmarks were used for training, while another 450 surface based point landmarks were used for validation, plus an additional 25 manually placed point landmarks were used. The third part is similar to the second part but the number of training and validation landmarks are both increased to 800. The last part (last three rows) of the table shows the results after applying the multilevel free form deformation (FFD) non-rigid registration algorithm of Rueckert et al. [13, 15] implemented in IRTK (The Image Registration Toolkit) [12] . The FFD based results are calculated after different levels of registration, i.e. level 1, 2, and 3. All tests were run over 5 subjects. All the values show the averages along with standard deviation in brackets. Second column shows the evaluation, i.e. warp time of the RBF in seconds. The third column shows the NMI. The next column shows the %NMI as compared to the Brute-Force Software and used as the golden standard. The fifth and final column shows the TRE in mm which is evaluated on the validation landmarks -note that the latter is the same for all methods as its calculation is based on the same BHS model."}, {"section_title": "BHS (\u03c6(r) = r)", "text": ""}, {"section_title": "RESULTS AND DISCUSSION", "text": ""}, {"section_title": "Quantitative Results: ADNI Datasets", "text": "Let us first have a look at the evaluation time of different algorithms. The second column in Table 2 shows that the evaluation time of the Fast RBF method (both software and hardware versions) is only marginally affected by increasing the number of landmarks with a factor of almost 20, unlike all other methods which are proportionally more affected. In comparison to IRTK, the evaluation time of the Fast RBF hardware accelerated method is in subseconds, while IRTK takes approximately 240, 888, and 3 700 seconds during level 1, 2 and 3, respectively, using each dataset. Thus, the evaluation time of the Fast RBF method in hardware is significantly less dependent on the number of landmarks used than for competing methods, and it is substantially faster than the IRTK method as well as the other competing algorithms. The final column in Table 2 shows the TRE in mm which is evaluated on the validation landmarks. It should be noted that the TRE is the same for all methods as its calculation is based on the same BHS model. The average TRE with 475 landmarks is slightly worse, however the standard deviation is substantially smaller despite being measured over a much larger set of validation points illustrating a statistically more significant result. Similarly, the average TRE with 825 landmarks is decreasing with the increase in number of landmarks from 475 to 825. The table shows that the average TRE for 825 landmarks is 1.48 mm, which is better than when using 25 (1.63 mm) and 475 (1.81 mm) landmarks. Number of Landmarks Figure 8 . Effect of the number of landmarks on NMI of each warping algorithm landmarks created using parameterisation are more consistent than the manually placed anatomical point landmarks. Furthermore, there are no statistically significant differences (p >> 0.10) between TRE's of the upper and middle part of the Table 2 (t = \u22120.643, dof = 8, p = 0.54), as well as between the upper and lower part of the Table 2 (t = \u22120.471, dof = 8, p = 0.65) but the TRE's of the middle and lower part of the Table 2 (t = 2.471, dof = 8, p = 0.038) has significant difference based on a two-tailed t-test p value (i.e. p < 0.05). Looking at the accuracy using the NMI metric (third column of Table 2) , we see virtually no loss in accuracy for the Fast RBF method in software as compared to the gold standard (brute force software) and when implemented in hardware, its accuracy is better than the brute force hardware implementation. The NMI of the larger landmark sets (475 and 825) is better than when using just 25 landmarks. The IRTK method shows slightly better results in term of NMI with increment of deformation levels (level 1 to level 3), but this is due to local support features of FFD based registration. The difference images in Figures 11 to 13 (see last column in all rows) also justify this. As can be seen from the difference images, where the local regions are aligned slightly better using the IRTK algorithm than the proposed Fast RBF method which is based on global support RBFs (the BHS function). This problem of Fast RBF could likely be removed by using locally constrained RBFs [18] . Figure 8 indicates that the NMI of the Fast RBF hardware and software based algorithms is almost the same with both sets of landmarks, i.e. 475 and 825, which is better than using a few (25) manual point landmarks only 2 . Figure 9 . Effect of the number of landmarks on %NMI of each warping algorithm, compared against the non-optimised 'Brute force' software based method (gold standard)\nThe %NMI metric shows the performance of the optimised techniques in comparison to the non-optimised 'Brute force' software based method (gold standard). Figure 9 shows tha %NMI drawn against the number of landmarks. This suggests that the fast RBF method implemented in hardware exhibits the highest correspondence (99 % +) as compared to the brute force implementation. The main reason of the loss in accuracy is due to the single floating point precision capability of the GPU used."}, {"section_title": "Visual Results: ADNI Datasets", "text": "The following figures show the results for visual assessment and comparison with IRTK. Figure 10 represents the corresponding triangulated parameterised (red and green) meshes before (separately) and after (fused) the registration experiment. Images in the last row of Figure 10 show the deformation vectors between the corresponding vertices of the two meshes before (leftmost) and after (center and rightmost) the registration experiment. These vectors are visualised through color coding from blue to red in ascending order of deformation. The vectors in the center and right most image show the TRE error (as a displacement) between the validation landmarks before and after the registration process.\nFigures 11 to 13 show arbitrarily selected transverse slices from the full resolution MR ADNI datasets. The first two images of the first row of each figure show the original dataset and its natural deformed version before registration, whereas the last two images show corresponding registered and absolute difference images after the Figure 10 . The first two images in the first row show the corresponding triangulated parameterised (red and green) meshes and the last image shows their combination before the registration experiment. In the last image, a white displacement line is drawn between every two corresponding vertices of the two meshes. The second row from left to right shows the images of the above row by using colored surfaces. The third row from left to right shows the fused meshes and surfaces after the registration experiment. Images in the last row show the deformation vectors between the corresponding vertices of the two meshes (leftmost) before and (center and rightmost) after the registration experiment. These vectors are visualised through color coding from blue to red in ascending order of deformation. The vectors in the center and rightmost image shows the TRE error (as a displacement) between the validation landmarks before and after the registration process.\nregistration experiment performed with our method (Fast RBF). Row 2 corresponds to the registered and absolute difference images after the registration experiment performed with IRTK at level 1 and 3, respectively. The first three images in some rows show the corresponding training and validation (red and blue) landmarks before registration, and after (red, blue and green, respectively) registration. Figure 11 . All the rows from left to right show arbitrarily selected transverse slices from the full resolution MR datasets (ADNI database). The first two images of row 1 illustrate the original and naturally deformed MR image before registration, while the last two images show corresponding registered and absolute difference images after the registration experiment performed with our method (Fast RBF). Row 2 corresponds to the registered and absolute difference images after the registration experiment performed with IRTK at level 1 and 3, respectively. The first three images in some rows show the corresponding training and validation (red and blue) landmarks before registration, and after (red, blue and green, respectively) registration."}, {"section_title": "CONCLUSION", "text": "In this article, we have presented the Fast RBF non-rigid registration method for medical imaging data using anatomical point landmarks and optimised parameterised surfaces, respectively. We have seen that the increase in the number of landmarks affects both accuracy and evaluation time. The number of point landmarks increased from anatomical point landmarks to a surface which represents an image deformation field better than the standalone anatomical point landmarks. The hardware implementation of the algorithm to run the evaluation part of the algorithm in less than a second using standard computer with a latest graphic card.\nThe evaluation (warp) time of both the hardware and software implementation of the Fast RBF algorithm is clearly less susceptible to the number of point land- Figure 12 . For each image block: Both rows show arbitrarily selected transverse slices from the full resolution MR datasets (ADNI database). The first two images of row 1 illustrate the original and naturally deformed MR image before registration, while the last two images show corresponding registered and absolute difference images after the registration experiment performed with our method (Fast RBF). Row 2 corresponds to the registered and absolute difference images after the registration experiment performed with IRTK at level 1 and 3, respectively. Figure 13 . For each image block: Both rows show arbitrarily selected transverse slices from the full resolution MR datasets (ADNI database). The first two images of row 1 illustrate the original and naturally deformed MR image before registration, while the last two images show corresponding registered and absolute difference images after the registration experiment performed with our method (Fast RBF). Row 2 corresponds to the registered and absolute difference images after the registration experiment performed with IRTK at level 1 and 3, respectively. marks used as compared to the other tested competing methods. It is considered that the use of more accurately placed point landmarks using surface parameterisation and reparameterisation improves its accuracy and makes the algorithm more favourable for IGS applications where both speed and accuracy are critical. We presented experiments on real medical datasets with a larger non-rigid deformation, for example MR images of the brain. It was observed that Fast RBF in software and hardware outperforms the feature-based methods both in terms of speed and accuracy, whilst performs a little bit less well in accuracy (when expressed in terms of NMI) than the FFD based method, which is due to iterative nature of the FFD."}]