[{"section_title": "INTRODUCTION", "text": "Coronaviruses are a family of viruses that can cause illnesses such as the common cold, severe acute respiratory syndrome (SARS) and Middle East respiratory syndrome (MERS). In December 2019, a new coronavirus was first identified in Wuhan, China. The virus is now known as severe acute respiratory syndrome coronavirus 2 (SARS-CoV-2), while the disease it causes is called coronavirus disease 2019 (covid-19), a highly infectious respiratory disease 1 . In March 2020, the World Health Organization (WHO) declared the covid-19 outbreak a global pandemic 2 . According to the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University (JHU) 3 , there have been more than 12 million confirmed cases and the pandemic has already caused over 550,000 casualties.\nSymptoms of covid-19 vary in severity from having no symptoms at all (being asymptomatic) to having fever, cough, sore throat, general weakness, fatigue, muscular pain and loss of smell. In the most severe cases it can lead to severe pneumonia, acute respiratory distress syndrome (ARDS), possibly precipitated by cytokine storm, multi-organ failure, septic shock, and blood clots, which can lead to death [4] [5] [6] [7] [8] [9] . The time from exposure to onset of symptoms is typically around five days, but may range from two to fourteen days 10 .\nThe preferred method of diagnosis of covid-19 is by real-time reverse transcription polymerase chain reaction (rRT-PCR) from a nasopharyngeal swab 11, 12 . PCR permits, especially in a few hours, the \"acellular cloning\" of a DNA fragment through an automated system, which usually takes several days with standard techniques of molecular cloning. PCR is widely used for diagnostic purposes to detect the presence of a specific DNA sequence in a biological fluid. It's use from a sample obtained from a nasal swab is generally considered the gold standard for covid-19 diagnosis and has been used as the main tool to control the pandemic 13 .\nHowever, PCR is still prone to errors as covid-19 detector 14, 15 , its precision varying according to the quality of the biological sample obtained 16, 17 . Furthermore, PCR is difficult to be performed routinely on all the population due to its technical requirements 18 and shortages of test strips was experienced in many countries 19 . Therefore, researching other possibilities is clearly worthwhile.\nIn this context, perhaps the two more prominent alternatives are the use of two \"everyday tools\" such as chest X-Ray imaging and Computed Tomography (CT). These are widely used by clinicians worldwide to diagnose all sorts of respiratory diseases and viral infections affecting the respiratory system. Given the high tropism of covid-19 for respiratory airways, identification of lung involvement in infected patients can be relevant for treatment and monitoring of the disease. Using these widely used tools has its advantages, especially because of their readiness to be applied in most centers, which is a key factor considering that timely diagnosis of covid-19 is of adamant importance both for the patient's successful treatment and to control the pandemic spread [20] [21] [22] [23] [24] .\nResearchers have already looked at the use of both techniques during covid-19 pandemic [25] [26] [27] [28] [29] [30] . Each seems to have in principle its advantages over the other. CT is supposedly more precise, while X-Ray is more practical and can be very useful especially in emergency settings due to the existence of portable devices.\nIn this study, we wanted to evaluate how well current state-of-the-art Artificial Intelligence (AI) methods could detect covid-19 from patients showing some symptoms using both X-ray and CT chest medical images in a completely automated manner. Of course, pathological findings found through these techniques cannot be specific to the type of virus causing the pathology. Covid-19 is a type of viral pneumonia caused by the SARS-CoV-2 virus, and has many things in common with other types of viral pneumonia and infections such as influenza, H1N1, SARS or MERS. Therefore, strictly speaking, by using only the image without any other clinical information of the patient, these methods cannot confirm whether a patient is infected by covid-19. They can only detect whether the patient has a viral pneumonia. But since during the ongoing covid-19 pandemic most viral pneumonia is caused by SARS-COV-2, detecting these cases quickly in an automated manner can be beneficial. The information provided by the AI methods could be combined with all the other information regarding the patient (clinical history, symptoms, closeness to other covid-19 cases, etc.) to reach a more informed decision 31 .\nWe developed new AI methods and evaluate their performance to judge their usefulness for dealing with the ongoing pandemic. We are by no means the first to attempt detecting covid-19 from chest CT scans and/or X-Ray images using AI methods. Since the beginning of the covid-19 outbreak there has been a rush to test novel methods, and many prior approaches have been proposed [32] [33] [34] [35] [36] [37] [38] [39] [40] [41] [42] [43] [44] [45] [46] [47] . We do not claim explicit novelty; but we do offer a careful and fair evaluation on a large set of patients from different centers (especially for X-Ray images). Furthermore, we directly test for the first time if AI methods are capable of separating a viral infection from a bacterial one through the incorporation of tuberculosis patients to the study.\nFinal X-Ray AI model evaluated here will be incorporated into an online platform (www.quantuscovid19.org). The platform is being developed using Transmural Biotech's long experience and know-how on how to deploy AI methods through Software-as-a-service platforms complying with clinical regulations. Therefore, it will effectively transfer the technology here reported to any professional and/or researcher who desires to make use of it."}, {"section_title": "XRay data", "text": "Five different sources were used. Two different sources provided covid-19 infected lungs: covid-19 Image Data Collection 48 and Covid Data Save Lives 49 (COVIDDSL). Then, we also downloaded U.S. National Library of Medicine Tuberculosis Datasets 50 and TB_portals 51 , both containing bacterial tuberculosis chest X-ray images.\nAs stated in the Introduction, the AI methods cannot distinguish covid-19 from other viral infections. However, they should be able to distinguish viral infections from other type of infections, such as bacterial ones. To put these theoretical notions to test, we added bacterial tuberculosis patients to the study. We chose tuberculosis given its importance worldwide (it can actually be considered another pandemic in many countries), availability of images online and also since it can serve as a good baseline for the potential of covid-19 detection, considering that tuberculosis detection from X-Ray images is more established [52] [53] [54] [55] .\nFrom all these sources we downloaded also all healthy lung images available. Finally, to have more healthy images, we added a random subset of ChestX-ray8 56 dataset (10,000 random healthy lung images). In all cases only Anterior-Posterior or Posterior-Anterior views were used, discarding all lateral images. In the case of covid-19 suspicious patients, we only retained those with a confirmed positive PCR record in the two weeks prior to the image acquisition date. Table 1 shows the number of patients and X-Ray images from each. A total of 9,841 patients were included in the study, with a covid-19 prevalence of 17.6% (1,733/9,841) and a Tuberculosis prevalence of 8.2% (810/9,841). In average each patient had 2.03 X-Ray images available, for a total of 20,024 images. Demographical information such as age, gender, etc. was not used in this study. The reasons are three-fold: 1) this data was available only from a handful of patients, 2) To avoid overfitting due to dangerous data correlations and 3) to test the power of AI image analysis on its own. Images from these sources were already provided after a pre-processing done by the dataset authors: clinical image headers were removed for anonymization, and images converted to either as Portable Network Graphics (PNG) or Joint Photographic Experts Group (JPEG) images. The exception was COVIDDSL 49 , which was provided using original Digital Imaging and Communications in Medicine (DICOM) format images. These images were automatically processed in a similar fashion to the other datasets, removing the image header and converting them to PNG format after adequate conversion to 8-bits. Figure 1 Power sampling 57 was used to establish the N necessary to validate a model with at least 90% detection rate considering the prevalence of the data (17.6%) and error rates of type I below 5% and type II below 10%. The result was N=548. Although this condition could have been met using only 5% of the data for testing, we performed a 66%/33% training/test split for fairness and to have a large test set. Therefore, 3,528 patients were used for testing and the remaining (6,313) for training. Resulting prevalences on the test set were 23.3% (823/3,528) for covid-19 and 7.6% (269/3,528) for Tuberculosis."}, {"section_title": "CT Scan data", "text": "Data from two different sources was used: the COVID-CT-Dataset 58 and the covid-19 Image Data Collection 48 . From these, only patients having at least one axial CT image were used. Table 2 shows the number of patients and CT scan images from each source. A total of 363 patients were included in the study, with a covid-19 prevalence of 53% (191/363). In average each patient had 1.92 CT scan images available, for a total of 700 images. Demographical information such as age, gender, etc. was again not used in this case, the reasons being the same as those stated above for X-Ray images.\n. CC-BY-NC-ND 4.0 International license It is made available under a is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity."}, {"section_title": "(which was not certified by peer review)", "text": "The copyright holder for this preprint this version posted July 17, 2020. ChestX-ray8 56 -\nThe copyright holder for this preprint this version posted July 17, 2020. Power sampling 57 was used to establish the N necessary to validate a model with at least 90% detection rate considering the prevalence of the data (53%) and error rates of type I below 5% and type II below 10%. The result was N=115. To satisfy this condition, a 66%/33% training/testing split was chosen, leaving 121 patients for testing and 242 for training.\nThe copyright holder for this preprint this version posted July 17, 2020. . https://doi.org/10.1101/2020.07.16.20155093 doi: medRxiv preprint for each class. For each patient, if the patient had more than one image, we averaged the output probability scores of the AI method and used this number as final score for the patient.\nThe copyright holder for this preprint this version posted July 17, 2020. . All methods were trained and applied using Transmural Biotech AI platform. All statistical analysis was then performed using Matlab (Mathworks, USA). All the methods mentioned above (once trained) were applied to all test available images, storing the output estimation (probability score). Whenever several images of the same patient with the same study date were available, the average estimation from all images was used.\nThe scores were used to draw Receiver Operator Characteristic (ROC) curves and compute full Area Under the Curve (AUC) with their 95% Confidence Intervals. Then, the ROC curves were used to establish the optimal cutoff points as those maximizing accuracy. Detection rate, false positive rate (FPR), positive and negative predictive values (PPV and NPV) and positive and negative likelihood ratios (LR+ and LR-) were calculated with their 95% Confidence Intervals (estimated using bootstrapping on the test set) using these cut-off points.\n. CC-BY-NC-ND 4.0 International license It is made available under a is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.\nThe copyright holder for this preprint this version posted July 17, 2020. . https://doi.org/10.1101/2020.07.16.20155093 doi: medRxiv preprint Figure 4 shows the Confusion Matrix and ROC curves for covid-19 and tuberculosis detection from X-Ray images using the testing patients (N=3,528, covid-19 Prevalence 23.3%, Tuberculosis Prevalence 7.6%). Global accuracy on the three classes (healthy, covid, tuberculosis) was 97.5%, with a 97.0+-0.9% average class-accuracy. AUC was 99.5%+-0.1 for covid-19 and 99.7%+-0.1 for tuberculosis. In comparison, the detection of tuberculosis had very similar results, with a detection rate of 96.7% for a false positive rate of 1.0%. PPV was 89.3% and NPV 99.7%. . CC-BY-NC-ND 4.0 International license It is made available under a is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.\nThe copyright holder for this preprint this version posted July 17, 2020. Figure 6 shows the ROC curve for covid-19 detection from CT scans using the testing patients (N=121, covid-19 prevalence 53%). AUC was 90.9%+-0.8%. Table 4 shows the detailed metric scores at the optimal accuracy cut-off point computed from the ROC curve. The CNN was capable of detecting 90.6%+-1.2% of the covid-19 infected patients, while incurring in a . CC-BY-NC-ND 4.0 International license It is made available under a is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.\nThe copyright holder for this preprint this version posted July 17, 2020. . https://doi.org/10.1101/2020.07.16.20155093 doi: medRxiv preprint 24.6%+-1.5% False positive rate. PPV was 80.6%+-2.6% and NPV 87.8%+-1.6%. This scenario would have implied that of the 64 patients tested that actually had covid-19, the CNN would have successfully detected 58, leaving 8 undetected, and on the other hand it would have falsely flagged 14/121 patients as having covid-19.\nThe copyright holder for this preprint this version posted July 17, 2020. . https://doi.org/10.1101/2020.07.16.20155093 doi: medRxiv preprint\nThe copyright holder for this preprint this version posted July 17, 2020. . pandemic, helping to detect covid-19 infected patients when a PCR test is not available, or helping to detect a fraction of the patients missed by the PCR itself in a first test."}, {"section_title": "Figure 1. Chest X-Ray Scan image examples.", "text": "In both data sources the CT scan images were already processed and directly provided as Portable Network Graphics (PNG) images. Figure 1 shows some image examples from both datasets.\n. CC-BY-NC-ND 4.0 International license It is made available under a is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity."}, {"section_title": "AI-based automatic image classification", "text": "Several Deep Learning (DL) 59 Convolutional Neural Networks 60 classifiers were benchmarked using Transmural Biotech AI platform. However, for simplicity and given the similarity in the accuracy of many of these models we report only the performance of the best performing model, which used Inception 61 as backbone architecture.\nThe net was first trained following the original author's guidelines on ImageNet Large Scale Visual Recognition Challenge 62 . Then, the net was fully retrained (allowing changes to the entire network) using our training data, changing the dimension of the last layer to output the probability for each class in each task (3 classes in X-Ray, 2 classes for CT Scans). After training, the net was deployed and applied to the test images, outputting full probability scores . CC-BY-NC-ND 4.0 International license It is made available under a is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity."}, {"section_title": "CNN training details:", "text": "The model was trained using Transmural Biotech's AI online platform. The Inception classifier was trained following the original author's guidelines using softmax cross-entropy loss and adam optimizer. 10% of the training set was used as validation set. The first training using ImageNet images was performed for 90 epochs with a 5 epoch warm-up. Then, two CNN were trained, one for each task (X-Ray and CT Scans) on the training data for a maximum of 15 epochs, early stopping if loss on validation set was not improved for 5 consecutive epochs. Learning rate was adjusted using a cosine decay starting at 1e-4. Batch size was 64 and weight decay was 0.9. To improve learning, data augmentation was used during training. At each batch, images were randomly flipped, cropped between 0-20%, translated from 0-10 pixels and rotated between [\u221215; 15] degrees. No data augmentation was used during testing to assure that output was always the same given the same image and to avoid altering the original image."}, {"section_title": "AI automatic X-Ray lung segmenter", "text": "In the case of X-Ray, additionally, since enough training images were available, prior to the classifier, an automatic lung segmenter was also developed. Using a random subset from the classification training patients, (1,100 images), we manually delineated both lungs in the X-Ray image using Transmural Biotech's Graphical User Interface (GUI) online program. Then, we used 1,000 images to train a CNN segmentation network using our online AI platform and the remaining 100 images to test the model. Once trained, the net was capable of segmenting lungs from the 100 test chest X-Ray images with an average Jaccard index of 90.1%. Example automatic lung segmentations are shown in Figure 3 .\nThese automatically generated lung masks were then provided to the Inception classifier both during training and testing. This effectively means that the classifier will use only lung pixels to perform the classification."}, {"section_title": "X-Ray lung segmenter details:", "text": "We used a DeepLab model 63 and training was performed in a similar fashion as the Inception classifier, using Transmural Biotech's AI online platform. "}, {"section_title": "Statistical analysis", "text": ". CC-BY-NC-ND 4.0 International license It is made available under a is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity."}, {"section_title": "Figure 6. ROC curve for covid-19 detection from CT Scans (N=121 Patients, covid-19", "text": "Prevalence 53%).The yellow X marks the optimum cut-off point in terms of Accuracy. . CC-BY-NC-ND 4.0 International license It is made available under a is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity."}, {"section_title": "Main findings", "text": "State-of-the-art AI methods to detect covid-19 in chest X-Ray images and CT scans were developed and evaluated on patients from multiple centers and institutions. Results suggest that covid-19 afflicted patients showing first symptoms can be detected using both medical imaging tools with detection rates of 90% for reasonable false positive rates.\nX-Ray images were clearly the more promising of the two. The AI method developed included an automatic lung segmenter and automated detection reached an AUC of 99% on the 3,528 patients tested (823 of which having covid- 19) . This translated in a detection rate of 96.4% at 1.0% false positive rate and NPV of 98.9%. The AI was also perfectly able to distinguish the viral infection caused by covid-19 from a bacterial infection such as tuberculosis, for which it obtained an AUC of 96%, in line with previously results from tuberculosis large studies 52 .\nIn the case of CT scans, results were also promising although both the number of patients tested and the method's accuracy were lower. The AI method developed was able to reach an AUC of 90.9% on the 121 patients tested, 54 of which had covid-19. This translated into a detection rate of 90.6% at 24.6% false positive rate, with a NPV of 87.8."}, {"section_title": "Clinical implications", "text": "Repeated RT-PCR from nasal swabs, the current gold standard for covid-19 detection, is not perfect (no test ever really is). While it's undoubtedly a very precise test (extremely low false positive rates), prior systematic reviews reported varying detection rates between 63% and 98% 17, 64 . The main reasons for these variations are the quality of sampling, the stage of the disease the day of the test, the degree of viral multiplication and the different prevalence of the disease in each center 65, 66 . Due to these variations, it has been proposed to combine repeated PCR with clinical history, history of contact with other covid-19 patients and findings from either chest CT scans and/or X-Ray 31 .\nResults on CT scans are preliminary due to the low number of patients tested. On the other hand, X-Ray results were obtained on a large pool of patients from different centers and therefore are more promising. The new AI method developed extracts information from chest X-Ray automatically, making the process both easier and quicker compared to the evaluation of images by an expert radiologist.\nThe high detection rate and NPV reported on the 3,528 patients tested makes the X-Ray method suited to help in patient management during the covid-19 pandemic, since it could help reduce the number of false negatives. The method was tested only on symptomatic patients showing first signs of affection in the lungs. The degree of affection or symptoms needed before the method is able to detect covid-19 in a patient remains unclear. However, considering the many reported limitations of PCR discussed above, reducing false negatives in symptomatic patients through a fast and non-invasive procedure could prove useful.\nAt Transmural Biotech, we have a long experience and know-how of how to deploy AI methods through Software-as-a-service platforms complying with clinical regulations. The X-ray method will be integrated into an online platform (www.quantuscovid19.org), making it available to any professional. The combination of the information provided by this method with all other patient information can undoubtedly help clinicians worldwide during the covid-19\n. CC-BY-NC-ND 4.0 International license It is made available under a is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity."}, {"section_title": "Strengths", "text": "This study has several strengths. We have performed the study combining patients from several sources, each of which was in turn constructed using patients from different centers. This means that the data used is inherently multi-center and multiple equipment and operators were responsible for the acquisition of the images, giving more credibility to the results. Furthermore, we have carefully separated patients to train and test methods, and established the number of test patients using power sampling. This resulted in \"fair\" train/test splits and moderated sized test sets. Moreover, we evaluated methods simulating a real application, where if several images are acquired for each patient all of them are incorporated into the analysis. Another strength worth noting is that we used all data available (as long as clinical outcome was confirmed through a positive PCR), refraining from manual filtering of images and/or patients based on dubious quality criteria that cannot be checked by a third party for correctness. We tested both CT scans and X-Ray images with a common methodology, to establish virtues and defects of each for covid-19 detection. Finally, for the first time, we demonstrated that AI methods seem to be able to distinguish between viral infections and bacterial infections (covid-19 vs tuberculosis)."}, {"section_title": "Limitations", "text": "We acknowledge a number of limitations. We were not involved in data acquisition; we trusted the data as it came and weren't able to double-check clinical outcomes of the images. Therefore we cannot be entirely sure of the correctness of the data used. However, these were either public sources widely used by the scientific community, or sources collected in large clinical institutions, so the assumption that data is correct is not entirely senseless. Another limitation is the varying prevalence regarding covid-19 patients found in the datasets used, which undoubtedly difficult a direct comparison of results. Finally, all covid-19 patients evaluated were patients showing symptoms and had lungs affected; it is unclear whether the methods evaluated could be used to detect asymptomatic patients. Larger studies are needed in order to better evaluate the limits of the AI methods proposed."}, {"section_title": "Conclusions", "text": "To conclude, state-of-the-art computational AI methods from both chest CT scans and chest X-Ray images showed promising results. Of the two, X-Ray seemed to be better suited to be used as screening tool during the covid-19 outbreak, providing detection rates >95%. This method could help to manage patients better in case access to PCR testing is not possible or to detect patients missed in a first round of PCR testing. It will be made available through a new platform (www.quantuscovid19.org). These results merit further evaluation and we hope to start larger studies with collaborating centers."}]