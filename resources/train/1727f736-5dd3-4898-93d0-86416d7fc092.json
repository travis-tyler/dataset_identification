[{"section_title": "Abstract", "text": "The versatile uses and excellent soft tissue distinction afforded by magnetic resonance imaging (MRI) has led to the development of many MR-compatible devices for MRI-guided interventions. This paper presents a fully pneumatic MR-compatible robotic platform designed for neurosurgical interventions. Actuated by nonmagnetic pneumatic piston-cylinders, the robotic platform manipulates a five degree-of-freedom active cannula designed for deep brain interventions. Long lines of tubing connect the cylinders to remotely located pressure sensors and valves, and MRI-compatible optical sensors mounted on the robot provide the robot joint positions. A robust, nonlinear, model-based controller precisely translates and rotates the robot joints, with mean steady-state errors of 0.032 mm and 0.447 deg, respectively. MRI-compatibility testing in a 3-Tesla closedbore scanner has shown that the robot has no impact on the signal-to-noise ratio, and that geometric distortion remains within recommended calibration limits for the scanner. These results demonstrate that pneumatic actuation is a promising solution for neurosurgical interventions that either require or can benefit from submillimeter precision. Additionally, this paper provides a detailed solution to the control problems imposed by severe nonlinearities in the pneumatic system, which has not previously been discussed in the context of MR-compatible devices."}, {"section_title": "Introduction", "text": "Magnetic resonance imaging offers several advantages for image-guided interventions in comparison to other imaging modalities such as ultrasound, X-ray fluoroscopy, and computed tomography. Providing excellent soft tissue distinction through a wide variety of contrast methods, MRI does not expose the patient or clinicians to radiation. Additionally, because MRI is a threedimensional modality, the orientation of image slices can easily be modified with no need to reposition the patient or imaging equipment [1, 2] .\nHarnessing these benefits, MRI-guided interventions have the potential to reduce invasiveness and increase accuracy of a procedure, thereby improving patient outcome. Particularly amenable to MRI guidance are needle-based interventions such as biopsy, brachytherapy, ablation, electrode placement, and deep brain stimulation. Already, some of these treatments have been clinically demonstrated with MRI guidance. For instance, using MR thermometry for thermal dose monitoring, MRI-guided laser ablation has been performed for prostate cancer as well as for epileptogenic foci and metastatic brain tumors [3] [4] [5] . However, many interventions cannot yet employ MRI guidance because clinician access to the patient is substantially limited by the confined space of a closed-bore diagnostic scanner.\nMR-compatible robotic systems are a promising solution to this problem, and development of such devices began during the 1990s, with the first robotic platform reported in 1995 by Masamune et al. [6] . Using six piezoelectric motors, the robot positioned a needle for stereotactic neurosurgery, but the motors substantially degraded the MRI image quality. In the years that followed, designs for MR-compatible robots attempted to avoid this problem by locating the piezoelectric motors farther from the imaging volume or by electromagnetically isolating the motor drives from the scanner room. However, many of these devices still produced unacceptable levels of signal noise that precluded manipulator actuation during MR imaging, as described in a 2007 review by Tsekos et al. [1] .\nSeveral robotic systems employing piezoelectric motors inside high-field scanners have been reported to have little to no negative effect on image quality [2, [7] [8] [9] . Quite recently, Su et al. reported a very small loss in signal-to-noise ratio (SNR) of 2% during simultaneous imaging and servoing of piezoelectric motors; nonharmonic motors were selected for reduced noise and the commercial motor driver boards were replaced with custom, low-noise drivers [2] . Clinical use of piezoelectric-driven robotic systems has also been demonstrated. Pfleiderer et al. reported clinical testing of a piezoelectric robotic system with a manual biopsy gun for breast lesion diagnosis [7] . Pandya et al. reported several tumor resections using NeuroArm, two MRI-guided, piezoelectricallyactuated arms each of seven degrees of freedom [9, 10] .\nNonetheless, in regards to MR-compatibility, fluid power actuators have the advantage over their piezoelectric counterparts of being able to completely eliminate the need for electric and magnetic components in the scanner room [2] . The creators of INNOMOTION, an MR-compatible robotic system commercially available in Europe, used piezoelectric motors in an early version of the robot. However, reduction in image quality and the risk of inductive heating led the team to an improved design with pneumatic piston-cylinders, engineered for safety and controllability through high dynamic and low static friction characteristics [11] . In other research efforts, pneumatic piston-cylinders have been used in several MRI-guided needle placement robots designed to diagnose and treat cancers of the prostate and breast [12, 13] . Robots employing intrinsically fail-safe pneumatic stepper mechanisms have demonstrated successful image-guided interventions in pig abdomens and canine prostates [14, 15] . MRI-guided needle placement for prostate biopsy and brachytherapy has been clinically performed with robots actuated either by a one-axis pneumatic needle drive or fully manually [16, 17] .\nPrecision control of pneumatic piston-cylinders is a difficult task due to the nonlinear compressibility of the working fluid. The actuator dynamics are third order in terms of piston position, since the input to the typical 5-port/4-way control valve is a mass flow rate, which leads to rate of change in chamber pressure and volume. Ning and Bone demonstrated that a nonlinear model-based controller outperforms a linearized model-based approach [18] . Similarly, Chillari et al. compared the performance of several pneumatic position control methods, and concluded a nonlinear approach is preferable to PID control [19] . Advancing the development of nonlinear, model-based controllers, Richer and Hurmuzlu introduced a detailed mathematical model for the actuator-valve system dynamics [20] . Using this model, Zhu and Barth achieved 0.05 mm accuracy using a composite adaptive and sliding mode force controller for an industrial robot [21] . In research related to the work presented here, Comber et al. achieved 0.006 mm steady-state error using model-based sliding mode control [22] . This control was for a single translational stage in the absence of cannula interaction forces or kinematic stage coupling implemented through rod locks. This prior work is now extended to include these considerations.\nTo the authors' best knowledge, this paper presents the first fully pneumatic robot to be designed for neurosurgical interventions. This is also the first pneumatic robot specifically designed to control a steerable needle; a prior device with similar objectives used piezoelectric actuators [23] . Section 2 describes the mechanical design of the robotic platform to manipulate this active cannula, which is a continuum robot made from concentric precurved elastic tubes (see Refs. [24, 25] and references therein as overviews). A model-based, nonlinear controller for the pneumatic actuators is presented in Sec. 3. In Sec. 4, experimental results demonstrate precision positioning of the robot base joints, and conclusions are provided in Sec. 5."}, {"section_title": "Mechanical Design of Robot", "text": "The design of an MR-compatible robot presents several challenges. Acceptable materials and actuators for the device are strictly limited to nonferromagnetic and primarily nonmetallic choices due to the static and changing magnetic fields of the MR scanner. Additionally, the robot must be sufficiently compact to fit inside the scanner with the patient. To satisfy these restrictions while ensuring a high level of accuracy and robustness in the robot mechanisms, pneumatic piston-cylinders known to be MR-compatible were selected, as depicted in Fig. 1 . A five degree-of-freedom active cannula was designed for deep brain ablation procedures (the robot provides a tube that can deliver a fiber laser or a variety of other thermal ablation probes), and a robotic platform to manipulate the cannula was designed and built, as shown in Fig. 2. 2.1 Pneumatic Actuator With Fail-Safe Rod Lock. MR-compatible pneumatic piston-cylinders were selected as actuators. In comparison to hydraulic actuation, advantages of pneumatics in surgery include easy integration into existing instrument air facilities in hospitals and no mess for small leaks in the pneumatic system. In comparison to many piezoelectric motors, pneumatic actuators allow for robot servoing during MR imaging because they are free from electrical presences. The actuators (Airpot Anti-Stiction Airpel model E9 nonmagnetic piston-cylinders) comprise a glass cylinder with 9.30 mm (0.366 in.) bore, graphite piston, graphite rod seal, and plastic components. A brass piston rod and mount are the only metallic parts. Rated to 690 kPa (100 psi) gauge, the actuator provides a maximum force of 46.8 N (10.5 lbf).\nBuilding on the rod lock concept of Fischer et al. [12] , we designed a new type of fail-safe rod lock that is easy to manufacture by rapid prototyping, and facilitates tuning of the locking force. Figure 1 depicts a cross-sectional view of the rod lock fastened to the head of the piston-cylinder. In the fail-safe state, a wave spring (Smalley part no. CS062-M2) presses a 0.125 in. (3.18 mm) aluminum Dremel collet against a washer with a beveled inner surface. Inserted between the cylinder head and the collet teeth, the beveled washer provides a way to adjust the clamping force of the collet on the piston rod; that is, the wave spring preload force is adjusted by slightly increasing or decreasing the distance to which the cylinder head is threaded into the rod lock body. Upon pressurization of the chamber formed by two sliding seals and the collet-carrying plunger, the collet disengages from the beveled washer. Unequal cross-sectional areas of contact between the plunger and the sliding seals provide a net force to the plunger, further depressing the wave spring and releasing the collet. The rod lock exhibited optimal performance at 85 psi gauge (590 kPa), with plunger movement of approximately 1 mm from the engaged to disengaged position of the lock. The rod lock body, cap, plunger, and beveled washer were rapid prototyped of air-tight material, Krypton Green by Polyjet. Using the Polyjet technology allowed for smooth, fine surface finish with close tolerances; this was necessary to achieve good performance with the sliding seals. The material was selected for its ruggedness and high strength properties. The sliding seals were lightly lubricated to reduce friction and wear, and sharp edges on the Dremel collet were sanded to prevent sticking and wearing against the beveled washer."}, {"section_title": "Active Cannula Design.", "text": "A three-tube active cannula was designed with a specific clinical application in mind, namely, a back-of-the-skull approach for needle-based ablation of temporallobe epileptogenic foci. Thermal ablation of the hippocampus was selected as a specific objective, since hippocampal sclerosis is the primary cause of temporal-lobe epilepsy [26, 27] . However, the modular nature of the robotic platform would easily accommodate active cannulas designed for other percutaneous interventions. Common to all active cannulas is the fundamental concept whereby a desired curved trajectory is obtained by telescoping and rotating the bases of the concentric, precurved tubes relative to one another.\nFor the three-tube design, the active cannula comprises an outer relatively stiff tube (potentially made of a metal like titanium, though this tube could also be nitinol) and two inner tubes of superelastic nitinol. The inset in Fig. 2 shows the degrees of freedom of the cannula. The outer titanium tube provides a first degree of freedom for an initial insertion depth up to 177.8 mm (7 in.). The middle tube, made of nitinol, is precurved at its front end to a curvature specified using the patient's preoperative MRI. During the procedure, this tube would first be rotated within the titanium tube to a desired orientation and then translated beyond the tip of the titanium tube. The innermost, nitinol tube is designed to mimic a straight, flexible ablation probe. To manipulate a device of this kind, a total of three translations and two rotations are required from the robotic platform."}, {"section_title": "Translational Mechanism", "text": "Design. The three translational stages of the robot were designed and built by a novel configuration for piston-cylinder actuators. Conventionally, the cylinder is fixed while the piston and rod translate. However, the space limitations of the scanner gantry aperture led to a compact design in which the piston rod is fixed and the cylinder translates. As shown in Fig. 2 , the first translational stage, for insertion of the titanium tube, comprises two linear plain bearings (Igus part no. FJUM-01-30) and an acrylic plate (T1) to which the titanium tube is rigidly fixed. To the rear side of this sliding plate the rod lock and cylinder head are rigidly fixed, and the free end of the piston rod is rigidly fixed to the stationary front plate of the robot frame. Manufacturing by laser cutter enabled precision alignment of all axes. Two carbon fiber guide shafts of diameter 30 mm, precision machined to \u00c00.1 mm tolerance, provide a low friction surface for translation of the linear plain bearings. Additionally, the shafts provide structural rigidity to the stationary frame of the robot. The low friction behavior of the translational mechanism aids in precision control. The length of the linear bearings was carefully selected to ensure no binding of the sliding plate would occur due to the cantilever position of the actuating force axis relative to each bearing axis.\nThe second and third translational stages are designed similar to the first; each comprises an acrylic plate to which two linear bearings are mounted to translate the plate along the pair of guide shafts. The second stage translates the middle, precurved nitinol tube, and the third stage translates the innermost nitinol tube. To translate the second stage, a piston-cylinder is mounted with the rod lock and cylinder head fixed to the rear side of sliding plate\n, and the free end of the piston rod fixed to sliding plate T2.\nThus, the three translational stages of the robotic platform are kinematically coupled together. As plate T1 translates forward, it pulls plates T2 and T3 along with it. Similarly, additional forward translation of plate T2 (with plate T1 locked stationary) pulls plate T3 forward as well. As the three sliding plates collapse together, the actuators for translations 1 and 2 pass through clearance holes in plates T2 and T3. The stroke lengths of the three actuators for translations 1, 2, and 3 are, respectively, 7 in (178 mm), 3 in (76.2 mm), and 3 in (76.2 mm)."}, {"section_title": "Rotational Mechanism Design.", "text": "To rotate the base of each of the two nitinol tubes, identical linear-to-rotary transmissions were designed and built for each, as shown in Fig. 3 . The rotational mechanism (R1) for the middle, precurved nitinol tube is mounted to the front side of plate T2. Similarly, the rotational mechanism (R2) for the innermost nitinol tube is mounted to the front side of plate T3. Each transmission comprises a timing belt stretched taught between two grooved pulleys of pitch diameter 19.1 mm. A two-piece belt clamp made of ABS plastic couples the free end of the piston rod to the timing belt, such that the pulleys rotate as the piston rod translates across the taught portion of the belt. The transmission ratio is 6.00 deg rotation per mm of piston displacement. A maximum torque of 447 mN \u00c1 m is achievable, and the maximum angular displacement of the pulley is 400 deg.\nThe grooved pulley closest to the piston-cylinder rotates a custom-made aluminum shaft to which the nitinol tube is mounted using an aluminum Dremel collet. This tube clamping design can accommodate various cannula tube diameters by interchanging collets. The aluminum shaft is hollow to permit the ablator and cooling catheter to run along the inside of the active cannula. The shaft is supported by two ball bearings with glass balls and polyetheretherketone (PEEK) raceways (Igus part no. B626A7G). The bearing housings are made of ABS plastic and acrylic parts. The second grooved pulley is mounted to a solid shaft, which also supports a rotary encoder disk for optical position sensing of the piston displacement."}, {"section_title": "Robot Controller", "text": "Using sliding mode control (SMC) theory, a robust, nonlinear controller for the MR-compatible piston-cylinder was developed and first tested for a one degree-of-freedom needle insertion, as described by Comber and Barth [28] . The controller was later implemented on the five degree-of-freedom platform and preliminary results were reported in Refs. [22, 29] .\n3.1 Design of Model-Based Sliding Mode Control. Due to unknown friction forces in the robot mechanisms as well as nonlinear behavior in the pneumatic system, namely the pressure dynamics and the mass flows through valve orifices, SMC was an appropriate choice for achieving submillimeter accuracy. Here, a brief derivation of the control law is presented. Referring to Fig. 4 , the equation of motion for the sliding plate is given by\nwhere P 1;2 and A 1;2 are the pressures and active cross-sectional areas of chambers 1 and 2, and atmospheric pressure is P atm . A 5-port/4-way spool valve was selected to control the actuator. For this type of actuator-valve system, a thorough derivation of the gas dynamics model can be found in Ref. [24] . These dynamics include the thermodynamics of the compressible gas in either cylinder chamber as well as the mass flow through the valve orifice. Since a surgical intervention must be a safe, relatively slow procedure, a low bandwidth is sufficient and preferred for the controller. Therefore, the pressure dynamics are assumed to behave isothermally. From the mathematical model described in Ref. [24] , the time derivative of each chamber pressure _ P i ; i \u00bc 1; 2, is given for the isothermal case by\nwhere R is the specific ideal gas constant, T the ambient temperature, and V i the actuator chamber volume, including all dead volumes downstream of the valve.\nTo provide a single output from the control law to the spool valve, the mass flows _ m i into the actuator chambers are expressed as the product of valve orifice area A v and area-normalized mass flow W i , as follows:\nThe area-normalized mass flows are given by Eqs. (4)- (7), where P u and P d are the pressures upstream and downstream of the valve orifice and P s is the supply pressure\nThe derivation of Eqs. (6) and (7) assumes isentropic flow through a thin-walled plate. Choked flow occurs when the pressure ratio of P d over P u is less than or equal to the critical ratio constant C r . For the isothermal case, the temperature T of the flow is equal to ambient. The ratio of specific heats is k \u00bc c p =c v and C f is the dimensionless discharge coefficient dependent on valve orifice geometry.\nA suitable SMC control law was formulated by choosing a third-order sliding surface acting on the integral of the position error e \u00bc x \u00c0 x d , where x d is the desired position of the actuator. Equation (8) defines the sliding surface s, in which the desired closed-loop poles of the error dynamics are introduced as \u00c0k.\nThe system dynamics are third-order in position, and the affine control variable A v appears by taking the time derivative of Eq. (1) and substituting in Eq. (2) to obtain\nTo achieve stable error dynamics, the Lyapunov candidate function V \u00bc 1 2 s 2 was chosen, and its time derivative, _ V \u00bc s _ s, was set equal to a negative definite function of choice. The function _ V desired \u00bc \u00c0g s \u00c1 sat\u00f0s=/\u00de is a desirable choice because it forces the s dynamics and hence the error dynamics to exhibit a smoothly decaying behavior. This behavior is described by Eq. (10), which was obtained by equating _ V to _ V desired . The saturation function sat\u00f0s=/\u00de is bounded at 61; g is the positive-valued robustness constant of choice and / the boundary layer.\nEquations (11)- (13) present the SMC control law, obtained by taking the time derivative of Eq. (8), setting the result equal to Eq. (10), and substituting in Eq. (9). In Eq. (11), velocity was introduced by noting that _\nThis SMC control law ensures Lyapunov-stable closed-loop error dynamics for the robot controller.\n3.2 Controller Electronics. Implementation of the modelbased sliding mode controller requires position and pressure Fig. 3 . The optical encoder modules are known to be MRcompatible [12] .\nFor position control of each actuator, there is one 5-port/4-way proportional spool valve (Festo part no. MPYE-5-M5-010-B). Using manufacturer data, the mass flow discharge coefficient C f for these valves was determined to be 0.2939 [28] . Charging and exhausting of the rod locks is accomplished by a valve manifold (Festo part no. 10 P-10-4 C-MP-V-Z) containing 5-port/2-way valves (Festo part no. CPV10-M1H-5LS-M7). In the de-energized state, the 2-way valve exhausts the rod lock for safety; thus, the rod lock is only pressurized when the 2-way valve is energized. Pressure feedback for the five actuators is provided by ten pressure transducers (Festo part no. SDE-16-10 V); there is one additional transducer to measure supply pressure (Festo part no. SPTW-P10R-G14-VD-M12). Transmission lines (polyurethane tubing, 4 mm I.D., 6 mm O.D.) connect the rod locks and pistoncylinders to remotely located valves and pressure sensors. These 3-m long pneumatic lines can adequately separate the valves and pressure sensors from the scanner yet are not so long as to introduce non-negligible line dynamics.\nThe model-based sliding mode controller was created using MATLAB Simulink, which compiles and runs as C code on an xPC target machine. The target PC houses two data acquisition boards, and is designed to be located outside the scanner room. Double-shielded 5-meter long cables route the encoder signals from the robot to the target PC. Two 25-pin D-sub doubleshielded cables connect the pressure sensors and valves to a break-out board that connects to the PC. These D-sub connectors will be used in future experiments to connect through the scanner room patch panel."}, {"section_title": "Experimental Results", "text": "Following the manufacture of the robotic platform and the development of the model-based, SMC position control, actuation of the robot base joints was demonstrated. The MR-compatibility of the robot was also verified. Table 1 . Figure 5 demonstrates that the controller for the first translation is capable of tracking a square wave of 90 mm peak-topeak amplitude, with a 2% settling time of 0.8 sec, mean steadystate error of 0.027 mm, and maximum overshoot of 0.006 mm (the encoder resolution). From a controls perspective, the square wave response is a good benchmark for controller performance, but a less aggressive trajectory would be desirable for surgical applications. Thus, for all five DoFs, the controller was tested for endpoint positioning with a velocity of 16 mm/s between endpoints. Additionally, the desired trajectory was filtered by a second-order low pass filter at 1 Hz to achieve smooth transitioning between start and stop. During actuation of any given DoF, the remaining actuators were held stationary by their respective rod locks, thereby precluding the introduction of unwanted disturbances to the controller.\nEndpoint to endpoint positioning for the first translation is shown in Fig. 6 along with two close-ups of the transition from transient to steady-state response. Inset A corresponds to needle insertion and inset B needle retraction. Note that the controller for the first translation sees the total mass of all three sliding plates (4 kg), as only the rod lock for the plate 1 actuator is disengaged during this operation. Figure 7 shows endpoint to endpoint positioning for the second translation. Here, plate 2 position is the change in position of plate 2 relative to plate 1, such that full retraction of the precurved cannula tube corresponds to 0 mm. Thus, inset A in Fig. 7 shows the precurved tube extending an arc length of 37 mm beyond the tip of the stiff outer tube, while inset B shows precurved tube retraction to a 7 mm arc length beyond the stiff tube tip. A substantial amount of friction is present due to the curved portion of the second tube rubbing against the inner wall of the stiff outer tube. Figure 7 demonstrates that the SMC controller can compensate for this unknown friction force. Endpoint to endpoint positioning for the third translation is shown in Fig. 8 , with plate 3 position defined as the change in the position of plate 3 relative to plate 2. Thus, full retraction of the simulated ablator probe (tube 3) corresponds to 0 mm in Fig. 8 . Figures 9 and 10 demonstrate angular position control for the first and second rotational stages. During rotation of the precurved tube, the curved portion is entirely inside the stiff outer tube. This condition is the most demanding on the controller, as torsional interaction occurs between the precurved tube and outer tube. The controller can handle this behavior, as shown in Fig. 9 . A summary of the mean and maximum steady-state errors for endpoint to endpoint positioning of each base joint is provided in Table 2 . No overshoot occurred."}, {"section_title": "MR-Compatibility", "text": "Testing. Preliminary MR-compatibility testing of the robotic platform was done, primarily to verify that the small quantities of metals on the robot do not degrade SNR by eddy currents. The robot was placed inside a Philips 3 T Achieva scanner, with the front plate of the stationary robot frame directly behind the head coil. Four 3D images of an fBIRN phantom were acquired, both without and with the robot present. The imaging sequence was T1 weighted with FFE gradient echo and a voxel size of 2 \u00c2 2 \u00c2 2 mm. SNR was calculated for each data set as the ratio of the sum of the signal means over the sum of the signal standard deviations. SNR without the robot was 52.3 and SNR with the robot was 52.7.\nThe SNR results suggest that the calculated SNR is only meaningful to two significant figures, as it would not make sense that the SNR is 0.4 higher with the robot present. The SNR results do show that the metallic presences on the robot do not produce SNR-degrading eddy currents.\nAdditionally, MRI images of an ADNI phantom were taken with and without the robot adjacent. Analyzed by a third party service for MR distortion and image quality, the results indicated a maximum distortion of less than 1.3 mm along any dimension, which was within the recommended calibration limits for the particular MRI scanner used for this test."}, {"section_title": "Conclusions", "text": "The design and control of an MR-compatible precision pneumatic active cannula robot has been presented. A sliding mode controller for each of the robot's 5 DoF was formulated and implemented. The three translational DoFs exhibited positioning accuracies better than 100 lm, and the two rotational DoFs exhibited accuracies better than 1 deg. Based on the kinematic model of a similar active cannula presented in Ref. [30] , these base-level positioning errors result in no greater than 0.78 mm cannula tip positioning error; this is smaller than the voxel size of most MR imagers. The MR compatibility of the robot was tested in a Philips 3 T Achieva scanner and displayed no measurable effect on the SNR of an fBIRN phantom. Image distortion tests with an ADNI phantom indicate a maximum distortion of 1.3 mm. Future work includes cannula tip placement experiments and integration of the robotic platform with the MRI scanner. Scanner experiments will focus on providing both real-time feedback of the active cannula location as well as thermal dose monitoring of the ablator using MR thermometry."}]