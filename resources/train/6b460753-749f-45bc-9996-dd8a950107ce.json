[{"section_title": "Abstract", "text": "Surface mapping methods play an important role in various brain imaging studies from tracking the maturation of adolescent brains to mapping gray matter atrophy patterns in Alzheimer's disease. Popular surface mapping approaches based on spherical registration, however, have inherent numerical limitations when severe metric distortions are present during the spherical parameterization step. In this paper, we propose a novel computational framework for intrinsic surface mapping in the Laplace-Beltrami (LB) embedding space based on Riemannian metric optimization on surfaces (RMOS). Given a diffeomorphism between two surfaces, an isometry can be defined using the pullback metric, which in turn results in identical LB embeddings from the two surfaces. The proposed RMOS approach builds upon this mathematical foundation and achieves general feature-driven surface mapping in the LB embedding space by iteratively optimizing the Riemannian metric defined on the edges of triangular meshes. At the core of our framework is an optimization engine that converts an energy function for surface mapping into a distance measure in the LB embedding space, which can be effectively optimized using gradients of the LB eigen-system with respect to the Riemannian metrics. In the experimental results, we compare the RMOS algorithm with spherical registration using large-scale brain imaging data, and show that RMOS achieves superior performance in the prediction of hippocampal subfields and cortical gyral labels, and the holistic mapping of striatal surfaces for the construction of a striatal connectivity atlas from substantia nigra."}, {"section_title": "Introduction", "text": "Surface mapping methods play an important role in various scientific discoveries from tracking the maturation of adolescent brains ( Gogtay et al., 2004 ) , mapping gray matter atrophy patterns in Alzheimer's disease (AD) , to studying early prenatal and postnatal brain development ( Li et al., 2013; Nie et al., 2010 ) . The backbone of surface mapping methods is the computational technique that establishes detailed one-to-one correspondences across different brain surfaces. In this work, we propose a novel computational framework for establishing surface correspondences in the Laplace-Beltrami embedding space ( Rustamov, 2007 ) . Our method is intrinsic to surface geometry, can * Corresponding author.\nE-mail address: yshi@loni.usc.edu (Y. Shi) . 1 Data used in preparation of this article were obtained from the Alzheimer's Disease Neuroimaging Initiative (ADNI) database (adni.loni.usc.edu). As such, the investigators within the ADNI contributed to the design and implementation of ADNI and/or provided data but did not participate in analysis or writing of this report. A complete listing of ADNI investigators can be found at: http://adni.loni.usc.edu/ wp-content/uploads/how _ to _ apply/ADNI _ Acknowledgement _ List.pdf incorporate various anatomical features, and is generally applicable to both cortical and subcortical structures.\nTo map brain surfaces from different subjects, both volumebased and surface-based registration methods have been developed. Using popular volume-based registration methods such as the Demons ( Vercauteren et al., 2009; Thirion, 1998 ) , and large deformation diffeomorphic metric mapping (LDDMM) ( Beg et al., 2005 ) , nonlinear maps can be computed between image volumes and thus obtain correspondences across different brain structures, but such methods may not accurately align the surface geometry. With LDDMM, sophisticated surface matching methods ( Vaillant and Glaun\u00e8s, 2005; Vaillant et al., 2007; Durrleman et al., 2009; Qiu et al., 2009; Charon and Trouve, 2013; Rekik et al., 2016 ) were further developed by deforming the ambient space, i.e., the 3D volume. In this approach, the surface correspondences are not optimized directly but rather obtained once the deformation is completed. The surface-based registration methods, on the other hand, optimize the detailed correspondences directly and utilize more of the intrinsic geometry on the surface instead of the 3D image space. This is in essence most related to the novel method we develop in this work, where we use intrinsic geometry that is Fig. 1 . A conceptual comparison of (A) the conventional method based on spherical registration and (B) the proposed metric optimization framework in the Laplace-Beltrami embedding space. In both (A) and (B), M 1 and M 2 denote the brain surfaces in the image space. In (A), M 1 and M 2 denote their spherical maps, and \u02dc u 1 and \u02dc u 2 denote the maps between the spherical maps of both surfaces. In (B), M 1 and M 2 denote the LB embeddings of M 1 and M 2 , and \u02dc u 1 and \u02dc u 2 denote the maps between their LB embeddings. The fundamental advantage of the metric optimization framework in (B) is that there is no extra distortion induced by the parameterization process, and all the metric changes are induced to match the two surfaces. On the other hand, the spherical mapping process in (A) introduces large metric distortions purely for the parameterization step, which can lead to large errors in the final maps.\nisometry invariant to optimize surface correspondences. Previous surface mapping methods usually relied on parameterizing the surfaces with a canonical 2D domain such as the unit sphere ( Fischl et al., 1999; Gu et al., 2004; Tosun and Prince, 2008; Davies et al., 2010; Yeo et al., 2010; Wang et al., 2012 ) . After that, nonlinear warping was applied in this 2D domain to optimize the correspondences by matching anatomical or geometric features. This is the most widely used computational framework for popular tools such as FreeSurfer ( Fischl et al., 1999 ) and FSL ( Robinson et al., 2014 ) , or entropy-based particle systems ( Paniagua et al., 2012 ) . There are, however, still fundamental numerical limitations with this framework. By mapping surfaces to a unit sphere that is drastically different from the original surface, large metric distortions are inevitable, which in turn will compromise the accuracy of all downstream calculations such as the numerical evaluation of gradients for nonlinear registration. To overcome such limitation in spherical registration ( Fig. 1 ) , we propose a novel surface mapping framework based on the Laplace-Beltrami (LB) spectrum of anatomical surfaces, which has recently been successfully applied to various shape analysis tasks such as classification ( Reuter et al., 2006; Lai et al., 2009; Konukoglu et al., 2013; Wachinger and Reuter, 2016 ) , matching ( Reuter et al., 2009; Shi et al., 2009 ) , and topological modeling ( Shi et al., 2008; 2013 ) , and graph-based surface mapping ( Lombaert et al., 2013a; 2013b ) , where the graph Laplacian was used to compute the spectrum and match corresponding features on cortical surfaces. Using the eigen-system of the LB operator on triangular meshes, a novel embedding space was proposed for performing shape analysis ( Rustamov, 2007; Lai et al., 2010 ) . The fundamental advantage of this embedding space is that it is isometry invariant, which eliminates the metric distortion induced by conventional parameterization on unit sphere. Based on the equivalence of isometry and the minimization of the spectral-l 2 distance in the LB embedding space proposed in Lai et al. (2010) , we developed a novel surface mapping algorithm previously via conformal metric optimization on surfaces (CMOS) ( Shi et al., 2014 ) . One limitation of the CMOS approach, however, is that it only computes conformal maps and cannot incorporate rich geometric and anatomical features in the mapping process. To perform feature-driven surface mapping in the LB embedding space, we will develop in this paper novel algorithms to realize Riemannian metric optimization on surfaces (RMOS). Our new RMOS method is based on the equivalence of diffeomorphism and pullback metrics. Given any diffeomorphism between two surfaces, the pullback metric defines the isometry between two surfaces. For triangular meshes, the Riemannian metrics are weights defined on the edges and they fully determine the heat kernel on the triangular meshes ( Zeng et al., 2012; Goes et al., 2014 ) . Since the LB eigen-system is completely determined by the Riemannian metric, we can thus pose the computation of a diffeomorphism as a problem of finding the proper metric that minimizes an energy function in the LB embedding space. Unlike the conformal maps that have limited degree of freedom ( Gu et al., 2004 ) , we can easily incorporate the matching of desirable features during the RMOS process. For numerical implementation, our method iteratively updates the Riemannian metric on edges of triangular meshes to realize surface mapping in the LB embedding space. There is thus no need of worrying about numerical difficulties such as the flipping of triangles or self-intersection.\nIn our experimental results, we apply RMOS to map three critical neuroanatomical structures -the hippocampus, cortex, and striatum, and compare its performance with spherical registration. Large-scale datasets from the Alzheimer's Disease Neuroimaging Initiative (ADNI) ( Mueller et al., 2005 ) will be used in our hippocampal experiments. For the mapping of hippocampal surfaces, we use curvature features to drive the surface mapping process, and show that RMOS can achieve superior performance than spherical registration in predicting the subfield labels computed from the high resolution T2-weighted MRI from ADNI. For cortical surface mapping, the LONI Probabilistic Brain Atlas (LPBA40) ( Shattuck et al., 2008 ) that consists of manually delineated cortical labels from 40 subjects will be used for validation. We demonstrate that our RMOS algorithm can generate better overlap of cortical labels than spherical registration. Using twenty subjects from the Human Connectome Project (HCP) ( Essen et al., 2013 ) , we also demonstrate RMOS on the holistic mapping of the striatal surfaces by comparing the performance of two types of vectorized features in constructing a substantia nigra (SN)-striatum connectivity atlas: anatomical neighboring context (ANC) ( Gahm and Shi, 2017 ) and structural connectivity to cortical areas.\nA preliminary version of this work appeared in conference papers ( Gahm and Shi, 2016; , where the focus was on quick application of the RMOS for surface mapping of specific subcortical structures such as the thalamus and striatum without a quantitative evaluation using large-scale data. Here we present the RMOS algorithm with more thorough algorithmic details and completely novel experimental results for the extensive validation of the RMOS mapping algorithm on both cortical and subcortical structures.\nThe rest of the paper is organized as follows. In Section 2 , we introduce the mathematical background of LB embedding and Riemannian metric optimization. After that, we propose the RMOS framework and develop the numerical algorithms for energy minimization in Section 3 . Experimental results will be presented in Section 4 , where we compare the RMOS and spherical registration for the surface mapping of the hippocampus, cortex and striatum on large-scale data from ADNI, LPBA40 and HCP. Finally, conclusions will be made in Section 5 .\nnotations for its angles and metrics on each edge are shown.\nposed in Rustamov (2007) :\nwhere \u03bb n and f n denote the n th eigenvalue and eigenfunction, respectively. Based on the gradients of the matrices Q and U w.r.t. the metric W , we can also calculate the gradients of the LB embedding w.r.t. the metric. To compute the gradients of f n and \u03bb n w.r.t. a metric element w i \u2208 W , we take the derivative on both sides of Eq. (1) :\nFollowing the numerical recipe in Nelson (1976) , we calculate from Eq. (4) the gradient of \u03bb n w.r.t w i as:\nand the gradient of f n w.r.t. w i as the solution of an underdetermined equation:\nwhere we denote\nIn summary, we developed the numerical algorithm for the computation of the gradient of the LB eigen-system w.r.t. the Riemannian metric on a triangular mesh. This paves the way for the development of metric optimization algorithms that can compute surface maps in the LB embedding space while aligning anatomical or connectivity features."}, {"section_title": "RMOS-based surface mapping in the LB embedding space", "text": "With the aim of computing diffeomorphic surface maps that can effectively match the rich anatomical and functional features of brain structures, we develop the general RMOS framework for surface mapping in this section. Let us consider two brain surfaces as Riemannian manifolds:\nfines the inner product of vectors on the tangent plane at p . Let u : M 1 \u2192 M 2 be a diffeomorphic map from M 1 to M 2 . Following the definition of diffeomorphism in differential geometry, we can map two vectors x 1 and x 2 on the tangent plane of p \u2208 M 1 onto the tangent plane of u (p) \u2208 M 2 and denote them as du ( x 1 ) and du ( x 2 ). We can then define the inner product of x 1 and x 2 as the inner product of du ( x 1 ) and du ( x 2 ) using the metric g 2 ( u ( p )) at u (p) \u2208 M 2 , which is called the pullback metric for M 1 induced by the map u . For every possible diffeomorphism from M 1 to M 2 , we can thus induce an isometry between M 1 and M 2 via the pullback metric. Since the LB spectrum of a surface is completely determined by its Riemannian metric, the LB spectrum of M 1 generated by the pullback metric will match the LB spectrum of M 2 . The pullback metric induced from a diffeomorphism shows mathematically the existence of Riemannian metrics that can align the LB embedding of M 1 and M 2 . With the proposed RMOS framework, our goal is to search for the Riemannian metric that can minimize their distance in the LB embedding space while matching anatomical features, which will in turn produce the diffeomorphic maps between the two surfaces."}, {"section_title": "Energy function", "text": "Let W 1 and W 2 denote their Riemannian metrics, i.e., the edge weights of two triangular meshes M 1 and M 2 , respectively. We denote u 1 : M 1 \u2192 M 2 as the map from M 1 to M 2 and u 2 :\ndenote the L feature functions on each surface (see Section 3.3 ). We define an energy function for feature-driven surface mapping with RMOS:\nwhere E F is the data fidelity term for matching given features, E R is the regularization term, and \u03b3 is the weight between the two terms. In this paper, we define the data fidelity term with an l 2 energy as:\nThis energy is symmetric w.r.t. both surfaces. It penalizes the mismatch between the original and mapped features. We define the regularization term as:\nwhere N 1 ,i and N 2 ,i are the sets of edges in the neighborhood (directly connected to the i th edge), m 1, i and m 2, i are the total numbers of the neighbor edges, and w 1, i and w 2, i ( \u02c6 w 1 ,i and \u02c6 w 2 ,i ) are the optimized metric (the standard metric induced from R 3 , respectively) on the edge of M 1 and M 2 . This term constrains the changes of metric ratios to be smooth."}, {"section_title": "Optimization algorithm", "text": "We develop an iterative metric optimization algorithm to minimize the energy function and compute the surface maps. Given the metrics W 1 and W 2 at each iteration, we compute the eigensystems of M 1 and M 2 up to the K th order and denote them\nOne of the common problem in constructing the LB embedding is the sign ambiguity of the eigenfunctions since there are 2 K possible combinations of signs for the K eigenfunctions. A combination of the spectral-l 2 distance and a multi-scale strategy was used in Shi et al. (2014) to resolve sign ambiguity. With feature-driven surface maps, we pick the sign combinations of the eigenfunctions that minimize E F as the initial embedding. Let 1 and 2 denote the set of eigenfunctions for M 1 and M 2 , respectively, after removing the sign ambiguity. The LB embeddings of the two surfaces are then denoted as\n(M 2 ) . In the embedding space, the maps are \u02dc u 1 :\nTo minimize the energy function E F via metric optimization, we first construct a coarse correspondence, which we call a \u03b2-map, that transforms the energy into distance measurements in the embedding space. Let \u02dc u\nWe initialize the \u03b2-maps as the nearest point maps in the LB embedding space. After that, they are iteratively updated along the gradient descent direction in the tangent space of the meshes as follows: the \u03b2-maps, we convert the data fidelity term E F into the distance energy E F in the embedding space defined in Shi et al. (2014) :\nwhere the matrices U 1 and U 2 are defined in Eq. (2) with the metrics. Using the gradients of the LB eigen-system w.r.t. the Riemannian metrics derived in Section 2 , we can compute the gradient of the energy w.r.t. to each element of the metrics. For example, the gradient of E F w.r.t. w 1, i \u2208 W 1 is shown:\nBy iteratively updating the metrics toward the gradient descent direction of E F , we deform the LB embedding of a surface toward its \u03b2-map, thus achieving the goal of minimizing the original energy in Eq. (8) .\nTo minimize the energy E R w.r.t. the metric W 1 and W 2 , we rewrite Eq. (9) in a matrix form:\nand compute the gradients of E R as:\nwhere D 1 and D 2 are initially given and fixed because the mesh connectivity does not change during the optimization process. By combining the gradients of E F and E R , we obtain the final gradient descent direction to update the metrics as follows:\nwhere \u03b3 is the weight between E F and E R .\nFor the Riemannian metrics defined on the edges of triangular meshes to be valid, they also need to satisfy the triangular inequality on each face of the meshes. To meet this requirement, we use Rosen's gradient projection method for linear constraints ( Rosen, 1960 ) , which projects the search direction onto the subspace tangent to any active constraints of triangular inequality. The active constraints are updated after every iteration of the metric optimization. For a triangle T l as illustrated in Fig. 2 , we choose\n, where the parameter sets the boundary band width. For all experiments in this paper, we set = 0 . 9 . At each iteration, we assume there are r active constraints among a total of m edges on a mesh M h (h = 1 , 2) . These active constraints are represented as an m \u00d7 r matrix N h whose columns are the gradients of the constraints ( \u22121 , 0, or +1 ). A projection matrix P h is then defined as:\nwhere I is the m \u00d7 m identity matrix. For numerical efficiency, we calculate P h using the QR factorization of N h :\nwhere Q 2, h is the matrix consisting of the last m \u2212 r rows of the Q factor matrix of N h . Given the gradient descent direction dW h / dt computed in Eq. (15) , we use P h ( dW h / dt ) as the projected gradient descent direction to minimize E . In summary, the overall algorithm for surface mapping with RMOS at a given eigen-order is listed in Algorithm 1 . To establish Algorithm 1 RMOS at a given eigen-order K . "}, {"section_title": "Input", "text": "Compute the gradient projection matrices P 1 and P 2 for the constraints of triangular inequality; 9: Update the metric W h with the projected gradients\n10: Repeat Steps 2-9 until convergence of E;\n11: Return the final maps \u03bc 1 and \u03bc 2 after Steps 2 and 3.\ncorrespondences of the eigenfunctions between different surfaces before the iteration process, we search for the optimal embedding from possible sign combinations of the eigenfunctions as well as possible switching of the order of the eigenfunctions as done in CMOS ( Shi et al., 2014 ) . To map the surfaces at the maximum eigen-order K max specified by a user, we typically follow CMOS' multi-scale strategy that starts with a low eigen-order K init and gradually increases the eigen-order to reach the maximum eigenorder K max . When we increase the eigen-order, the LB embedding and mapping results from the previous eigen-order are used as the initialization. The final maps are obtained via composition of the embeddings and the maps in the embedding space computed at the maximum eigen-order."}, {"section_title": "Anatomical and connectivity features for RMOS-based mapping", "text": "The RMOS framework is flexible and can take general features to guide surface mapping in the LB embedding space. In this work we will demonstrate RMOS-based surface mapping using curvature features, and vectorized features of anatomical contextual information and connectivity. For the hippocampus and cortex, we will use the mean curvature (MC) to drive the surface mapping process, where the MC is computed on volume-normalized surfaces. For more challenging structures such as the striatum, we will use vectorized features that can better encode anatomically critical information than curvature features. One type of vectorized features is based on anatomical neighbor context (ANC) information that characterizes the geometric relation between neighboring brain structures. Given a surface M and its C neighboring brain structures, we define the ANC feature at each vertex of M as a vector of normalized distances to these neighboring structures. Let d i ( i = 1 , 2 , \u00b7 \u00b7 \u00b7 , C) denote the distance transform of the i th ( i = 1 , \u00b7 \u00b7 \u00b7 , C) neighboring structure. Then, for each vertex V j \u2208 M , its ANC is defined as: By normalizing each distance transform by its maximal value on the surface, we make the ANC feature invariant to scale differences. Another type of vectorized features that may guide RMOS to achieve high-quality mapping is defined using brain connectivity. With the advance of human connectome research, there are great interests in computing brain surface maps with connectivity features ( Gutman et al., 2014; Jiang et al., 2015 ) . To define connectivity features on a surface, we first generate fiber tracts using probabilistic tractography with fiber orientation distributions (FODs) reconstructed from the multi-shell diffusion MRI data from HCP ( Tran and Shi, 2015 ) . Then we select multiple target regions that are topographically connected to different parts of the surface. For each target region, we define the connectivity at each vertex of the surface as the number of tracts that pass through the vertex neighborhood and reach the target region. Then we normalize the connectivity map to each target region by its maximal value on the surface, and form the vectorized feature of the connectivities at every vertex of the surface. Compared with local features derived from curvatures, the connectivity features as well as the ANC features help establish neuroanatomically more meaningful maps.\nThese rich features also boost our ability in resolving the sign and order ambiguities of the LB eigen-system, which is a critical step in shape analysis using the LB spectrum. During each step of the multi-scale strategy in Shi et al. (2014) , we compute the feature energy E F in Eq. (8) with the nearest point map in the embedding space to better estimate the right combination of the eigen- functions between two different surfaces. This will help search for the optimal embedding in addition to the minimum spectral distance between the surfaces."}, {"section_title": "Experiments", "text": "In this section, we present experimental results to demonstrate the RMOS surface mapping algorithm and compare its performance with spherical registration on large-scale data from the ADNI 2 and on the LPBA40 data. More specifically, we used T1-weighted and high resolution T2-weighted MRI scans from 380 subjects in ADNI, and the T1-weighted MRI of 40 subjects from LPBA40, and the connectome imaging data of 20 HCP subjects. The FreeSurfer segmentation results were used to extract the hippocampus masks from ADNI data in our experiments, and the mesh reconstruction method from the MOCA tool 3 was applied to compute a genus zero representation of the hippocampus. Cortical surfaces from the LPBA40 data were reconstructed using the method in Shi et al. (2013) . Hippocampal and cortical surfaces were resampled to 1K vertices ( \u223c 2K edges) and 10K vertices ( \u223c 20K edges), respectively, before running the surface mapping experiments. We also demonstrate RMOS mapping of the striatum using vectorized ANC and connectivity features to generate a surface-based connectivity atlas from 20 HCP subjects. Following the holistic approach of striatal mapping ( Gahm and Shi, 2017 ) , we obtained masks of the left striatum by merging the caudate, putamen and accumbens nuclei segmented out from T1-weighted MRI by FSL, and generated striatal surfaces with 1K vertices and 1996 edges using MOCA.\nThe RMOS method started with the standard metric induced from R 3 , and iteratively updated the Riemannian metric until no more decrease of the energy could be achieved. In the experiments on hippocampal and striatal surfaces, we started with the eigenorder at 10 and iteratively increased the eigen-order by 5 until it reached 30 (and 60, respectively), where a maximum of 200 iterations was set at the final eigen-order. For cortical surface mapping, 2 Data used in the preparation of this article were obtained from the Alzheimers Disease Neuroimaging Initiative (ADNI) database ( adni.loni.usc.edu ). The ADNI was launched in 2003 as a public-private partnership, led by Principal Investigator Michael W. Weiner, MD. The primary goal of ADNI has been to test whether serial magnetic resonance imaging (MRI), positron emission tomography (PET), other biological markers, and clinical and neuropsychological assessment can be combined to measure the progression of mild cognitive impairment (MCI) and early Alzheimers disease (AD). For up-to-date information, see www.adni-info.org .\n3 https://www.nitrc.org/projects/moca _ 2015\nwe fixed the eigen-order at 6 with a maximum of 200 iterations. For the selection of the regularization parameter, we used an adaptive approach that dynamically changes \u03b3 at every iteration such that the maximum gradient magnitudes of E F and E R have a constant ratio \u03b3 , which we fixed as 0.1 in all our experiments. The RMOS computational process took about 2.5, 4, and 18 hours on a 16-core 2.6-GHz Intel Xeon CPU (multi-threading enabled) with maximal memory consumption around 900MB, 2GB, and 20GB for hippocampal, striatal, and cortical surfaces, respectively."}, {"section_title": "Hippocampal mapping with curvature feature", "text": "In the first experiment, we demonstrate the RMOS algorithm and compare its performance with spherical registration on mapping a pair of left hippocampal surfaces from the ADNI data. The mesh representation of the hippocampal surfaces colored with their MC are shown in Fig. 3 (A) and (B) . While the RMOS algorithm is symmetric with respect to both surfaces, we will reference one surface as the source and the other one as the target surface for convenience in our description. The two surfaces are clearly nonisometric, which leads to large differences in their LB eigenfunctions. For example, we show in Fig. 4 (A) and (B) the 5th and 7th eigenfunctions of both surfaces. The drastically different color patterns clearly illustrate the need of metric optimization if we want to match these two surfaces in the LB embedding space.\nTo visualize the results of RMOS, we first calculated a map of metric changes as the ratio of the optimized metric with respect to the original edge length. After that, we interpolated this map of metric changes onto the vertices for visualization on the surfaces as shown in Fig. 4 (C) and (D) . With the optimized metrics, we can see the eigenfunctions of both surfaces become very well matched as plotted in Fig. 4 (E) and (F) . From the optimized LB embeddings, we calculate the detailed surface maps as the pointwise correspondences in the embedding space. To visualize these maps, we projected the source surface onto the target surface, and pulled back MC from the target surface to the source surface as shown in Fig. 3 (C) and (D) . We can see that RMOS is able to match the anatomical features very well while preserving the regularity of the mesh structure. To quickly demonstrate the improvement achieved by RMOS as compared to the CMOS algorithm ( Shi et al., 2014 ) , we applied the CMOS algorithm to the two hippocampal surfaces with the same eigen-order of 30 and 200 iterations. Using the CMOS map, we pulled back the MC features from the target surface onto the source surface and plotted the result in Fig. 3 (E) . The pullback labels from the target surface to the atlas surface with RMOS and spherical registration are shown in (C) and (D), respectively. Box plots of the Dice coefficients that measure the overlap of the pullback labels from each subject and the atlas surface labels with maps from RMOS and spherical registration are shown in (E) and (F), respectively. Three main labels are used. Sub: subiculum + parasubiculum + presubiculum; CA1: CA1 + HATA; CA2/3/4: CA2/3 + CA4 + GC-DG + fimbria + fissure. The results from different patients groups (Normal, EMCI, LMCI, and AD) are also plotted separately. (For interpretation of the references to colour in this figure legend, the reader is referred to the web version of this article.)\nWe can see that the CMOS method failed to accurately align the anatomical features of these two hippocampal surfaces, which is not surprising since no curvature feature was used in the CMOS algorithm.\nAs a comparison, we also applied spherical registration to map these two surfaces with the same MC feature. We combined two popular tools to achieve spherical registration of hippocampal surfaces. First we applied the SPHARM-MAT tool ( Shen and Makedon, 2006 ) to compute the spherical map of hippocampal surfaces and rigidly align them on the unit sphere. The spherically mapped surfaces are shown in Fig. 5 (A) . The large and irregular metric distortions are easily visible and indicate the challenges for downstream spherical registration. After that, we ran FreeSurfer's mris_register ( Fischl et al., 1999 ) to perform nonlinear registration on the sphere. The final maps between the hippocampal surfaces were computed by combining the spherical map and the nonlinear registration on the sphere. Similar to the RMOS results, we also projected the source surface onto the target surface with the map from the spherical registration, and pulled back MC from the target surface to the source surface as shown in Fig. 5 (B) and (C). From Fig. 5 (B) , we can observe severe distortions are present in several parts of the projected mesh, which might explain the inaccuracy in the matching of the anatomical features as shown in Fig. 5 (C) (compared to Fig. 3 (A) and (D) ). For a more quantitative evaluation of the mesh distortion during hippocampal mapping, we also calculated the ratio between the length of correspond- ing edges of the source mesh and its projection onto the target surface. The distributions of the edge length distortion ratio from the RMOS and spherical registration are plotted in Fig. 5 . Taken together, RMOS clearly achieved superior performance with better matching of anatomical features and less metric distortion."}, {"section_title": "Prediction of hippocampal subfields", "text": "In the second experiment, we evaluate the performance of the proposed RMOS algorithm and the conventional spherical registration approach in the prediction of hippocampal subfields. For this purpose, we used the data from a pilot project in ADNI 2 that collected both T1-weighted and high resolution T2-weighted MRI from 380 subjects (105 normal controls (NC), 132 early mild cognitive impairment (EMCI), 92 late mild cognitive impairment (LMCI), and 51 patients with AD). All hippocampal surfaces were generated from FreeSurfer segmentation using only the T1-weighted MRI. In our experiments, the left hippocampal surfaces from the 380 subjects were used. The MC was used as the feature to drive both the RMOS and spherical registration methods that map an atlas surface (source), which was randomly selected from the 380 subjects, to every other surface (target) as shown in Fig. 6 (A) and (B) . For both mapping methods, the same parameters and experimental setups as used in Section 4.1 were applied to this large-scale experiment.\nSegmentation of the hippocampal subfields was generated from the high resolution T2-weighted MRI using a tool included in FreeSurfer 6.0 ( Iglesias et al., 2015 ) at the same time of T1-weighted MRI reconstruction. Then we projected the subfield label volume onto the hippocampal surface by assigning the label of the closest voxel to each vertex on the surface. Using the maps from the atlas surface to each subject surface, we pulled back the subfield labels of each subject to the atlas surface. Fig. 6 (C) and (D) shows an example of the pullback labels from one subject surface (B) to the atlas surface (A) with the maps computed by RMOS and spherical registration, respectively. We can clearly see that the pullback labels with the RMOS map agreed much better with the labels on the atlas surface in Fig. 6 (A) . For quantitative evaluation of the performance of both surface mapping methods in the prediction of subfield labels, we computed the Dice coefficient (DC) between the pullback and atlas labels. As shown in Fig. 6 (A) and (B), several labels have scattered distribution that are unstable across subjects. We thus used three combined labels for our calculation of the DCs including Sub: subiculum + parasubiculum + presubiculum; CA1: CA1 + HATA; CA2/3/4: CA2/3 + CA4 + GC-DG + fimbria + fissure. For these three combined subfield labels, box plots of the DCs are shown in Fig. 6 (E) and (F). We can see that RMOS produced much higher DCs than the spherical registration method. Overall RMOS results generated a median DCs of 0.9 for the Sub and CA1 region, and 0.86 for the CA2/3/4 region. There was no statistically significant difference across the disease groups in terms of the DC. This shows that the RMOS method is able to align the subfields very well without using the high resolution T2-weighted MRI."}, {"section_title": "Validation of cortical surface mapping", "text": "In this experiment, we compare the performance of RMOS and spherical registration on mapping cortical surfaces using data from the LPBA40 atlas ( Shattuck et al., 2008 ) . For each of the 40 subjects from the LPBA40 atlas, we extracted the left cortical surface, decimated it to 10K vertices, and projected the 24 manually delineated gyral labels onto the surface as shown in Fig. 8 . One randomly selected cortical surface was chosen as the atlas and its maps to all other surfaces were computed with RMOS and spherical registration. We computed the overlap of the gyral labels on the atlas surface and other subject surfaces to evaluate the performance of RMOS and spherical registration in aligning cortical anatomy. The RMOS algorithm was driven by the MC of each surface. The atlas surface (source) and one subject surface (target) are shown in Fig. 7 (A) and (B) , respectively. Using the maps computed by RMOS, we projected the atlas surface onto the target surface ( Fig. 7 (C) ), and pulled back the MC from the target surface to the atlas surface ( Fig. 7 (D) ). For spherical registration, with the same decimated cortical surfaces, we first computed a spherical map for each surface using FreeSurfer's mris_inflate and mris_sphere to generate projection of the surface onto the unit sphere as shown in Fig. 7 (E) and (F) . Then we ran mris_register from the atlas sphere to the subject spheres using the same MC features with no addi- Fig. 8 . Validation of cortical mapping algorithms with manual labels from the LPBA40 atlas. Each cortical surface has 24 manually delineated gyral labels. Lateral and medial view of (A) the atlas surface, and (B) one of the subject surfaces. The pullback labels from the target surface onto the atlas surface with RMOS and FreeSurfer's spherical registration are shown in (C) and (D), respectively. (E) Box plots of the Dice coefficients (DCs) between the pullback labels from each subject and the corresponding labels on the atlas surface with maps from RMOS and spherical registration are shown in (E). Labels with significantly different DCs between the two methods are marked with one asterisk ( p -value < 0.05) or double asterisks ( p -value < 0.005).\ntional features such as the sulcal depth, and computed the surface maps as the point-wise correspondences on the spheres. The pullback MC from the target to the source sphere and the pullback MC from the target to source surface by the spherical registration map are shown in Fig. 7 (G) and (H), respectively. By comparing the pull-back MC generated by the RMOS ( Fig. 7 (D) ) and spherical registration of FreeSurfer ( Fig. 7 (H) ) with the original MC of the atlas surface ( Fig. 7 (A) ) , we can see that the results from spherical registration have significant mismatch, particularly on the precentral and postrcentral areas (highlighted by the dashed ellipsoids in Fig. 7 (D) and (H) ).\nFor the quantitative comparison of the RMOS and spherical registration algorithm, we pulled back the cortical labels from all subjects using these surface maps to the atlas surface and compared their overlap with the corresponding label of the atlas surface. Note that we did not use sophisticated cortical labeling algorithm such as label fusion ( Shi et al., 2014 ) and Markov random field (MRF) ( Fischl et al., 2004 ) . The raw overlap measure will serve as the prediction accuracy of gyral labels purely based on the surface maps. For each of the 24 regions, we computed the DC between the atlas label and the pullback labels from all other subjects generated the RMOS or spherical registration. The box plots of the DCs of each region and surface mapping method are shown in Fig. 8 (E) . For each region, we also performed a t -test to compare if the difference of the DCs from RMOS and spherical registration is significant. Among the 24 cortical areas, RMOS achieved significantly better performance ( p -value < 0.05) in 16 areas as marked with asterisks on the axis of the box plots in Fig. 8 (E) . In particular, the improvements of RMOS as compared to spherical registration are highly significant in 9 of the 16 cortical regions as marked with double asterisks in Fig. 8 (E) that include the precentral and postrcentral areas we highlighted in Fig. 7 (D) and (H). In all other regions, RMOS also achieved slightly higher or similar level of accuracy as compared to results from spherical registration."}, {"section_title": "Striatal surface mapping with vectorized features", "text": "In this experiment, we demonstrate the RMOS algorithm on the holistic mapping of striatal surfaces with vectorized features which can be more powerful than curvature features in encoding anatomically critical information. Striatum is an essential part of the cortico-striatal-thalamo-cortical (CSTC) network that connects the cortex and other basal ganglia structures including substantia nigra (SN) ( Shepherd, 2013 ) . Conventional morphometry studies typically divide the striatum into three parts: the caudate, putamen, and accumbens nuclei ( Muralidharan et al., 2014; Mamah et al., 2016 ) . Recent connectivity research ( Tziortzi et al., 2014; Jaspers et al., 2017 ) and animal studies ( Burgui\u00e8re et al., 2013 ) , however, indicate that striatum functions do not follow such subdivisions and it is more natural to map the striatum as a holistic structure ( Gahm and Shi, 2017 ) . With the holistic approach, we applied both the ANC and cortical connectivity features described in Section 3.3 to drive the RMOS algorithm to map the striatal surfaces and compare their performance in studying the connectivity between SN and striatum.\nBrain imaging data from 20 HCP subjects were used in this experiment. For each subject, we first extracted the left striatal surfaces from the T1-weighted MRI, and then manually delineated a mask of the SN for constructing SN-striatum connectivity. We computed the ANC features with respect to the three neighbor structures: the lateral ventricle, insular cortex and pallidum ( Gahm and Shi, 2017 ) . We also generated on each striatal surface the connectivity feature maps to seven cortical regions: orbitofrontal (medial only), middle/inferior-frontal, superior-frontal, precentral, parietal, occipital and temporal cortices using probabilistic tractography based on FODs reconstructed from the multi-shell diffusion MRI data ( Gahm and Shi, 2016; . With the FOD-based tractography, we also generated an independent SN-striatal connectivity map on each striatal surface with SN as the seed and striatum as the target region ( Fig. 9 (A) ).\nThen we computed the first set of RMOS maps between one reference striatal surface and the other 19 striatal surfaces using the three ANC features plus the MC feature. A second set of RMOS maps between the reference surface and the other 19 surfaces were computed with the connectivity features plus the MC feature. The same regularization parameters were used in the computation of both sets of RMOS maps. For RMOS maps computed with each type of features, the SN connectivity map on each surface was pulled back to the reference surface. At every vertex on the reference surface, we thus have a vector of 20 SN-striatal connectivity values, which was then binarized with a threshold (0.1). The probabilistic SN-striatum connectivity atlas is defined at each vertex on the reference surface as the summation of the binarized connectivity values divided by the total number of subjects. The probabilistic atlases of SN-striatum connectivity built with ANC-driven and connectivity-driven RMOS are shown in Fig. 9 (B) and (C), respectively, where the probabilistic atlas were thresholded at 50% to show the most concentrated connections. It is observed that SN is strongly connected to the dorsal striatum while there is little connection to the ventral striatum. More importantly, the atlas built with ANC-driven RMOS is comparable to that built with RMOS purely using connectivities to other cortical areas. This shows that the ANC features derived solely from T1-weighted MRI is able to guide the RMOS algorithm to achieve comparable mapping of anatomical regions without connectivity features from multi-shell diffusion MRI, which is not always available in clinical imaging research."}, {"section_title": "Discussion and conclusion", "text": "In this paper we developed a novel computational framework for feature-driven surface mapping in the LB embedding space. The key idea in our method is the iterative optimization of the Riemannian metric on mesh edges to enable the matching of LB embeddings and associated anatomical features from different surfaces. Compared with conventional methods based on spherical registration, the main advantage of performing surface mapping in the LB embedding space is that there is no significant parameterizationinduced distortion. All the metric deformation computed by the RMOS algorithm is for establishing the detailed correspondences across subjects, thus eliminating unnecessary distortions in classic parameterization.\nNote that the motivation of surface mapping in the LB embedding space was that ideally there is no metric distortion during embedding. In practice we used a finite number of eigenfunctions in our numerical optimization for computational efficiency. Following Shi et al. (2014) , we determined the number of eigenfunctions as a trade-off between embedding quality and computational cost by considering the metric distortion as a function of the number of eigenfunctions. As demonstrated in our experiments, such approximations can still generate high quality surface maps that outperform existing methods based on spherical registration. The ultimate value of surface mapping methods for brain imaging research also depend on the accurate segmentation of the brain structures under study. Errors in segmentation results can no doubt affect the downstream surface mapping algorithms, such as the correct alignment of brain structures on the sphere or the resolution of sign ambiguity in the proposed RMOS algorithm. With fast advances in MRI technology (higher resolution at 7T) and learningbased image segmentation, we anticipate more accurate segmentation tools will be available and further enhance the usability of surface-based mapping methods. In our cortical mapping experiments in Section 4.3 , triangular meshes of 10K vertices were used, which were obtained by decimating the cortical surfaces generated by FreeSurfer. At this resolution, we showed that improved gyral labeling can be achieved with the proposed RMOS algorithm. For future work, we will focus on improving the computational efficiency of the RMOS algorithm with techniques such as multi-threading and GPU programming, and apply it to map cortical surfaces with higher spatial resolution.\nWhile we demonstrated the RMOS algorithm on cortical and two subcortical structures: hippocampus and striatum, the mapping framework is general and applicable for other anatomical structures. In our future research, we will apply the RMOS algorithm to map brain structures with various structural and functional connectivity features. We will also conduct more extensive validation experiments on large-scale brain imaging studies of various patient populations to further our understanding of this general framework."}]