[{"section_title": "Abstract", "text": "We consider analysis of dependent functional data that are correlated because of a longitudinal-based design: each subject is observed at repeated time visits and for each visit we record a functional variable. We propose a novel parsimonious modeling framework for the repeatedly observed functional variables that allows to extract low dimensional features. The proposed methodology accounts for the longitudinal design, is designed for the study of the dynamic behavior of the underlying process, and is computationally fast. Theoretical properties of this framework are studied and numerical investigation confirms excellent behavior in finite samples. The proposed method is motivated by and applied to a diffusion tensor imaging study of multiple sclerosis. Using Shiny (Chang et al., 2015) we implement interactive plots to help visualize longitudinal functional data as well as the various components and prediction obtained using the proposed method."}, {"section_title": "Introduction", "text": "Longitudinal functional data refer to data consisting of functions (such as profiles or images) observed repeatedly for each subject at multiple instances, often visit times. Examples of such data include the Baltimore Longitudinal Study of Aging (BLSA), where daily physical activity count profiles are observed for each subject at several consecutive days (Xiao et al., 2013; Goldsmith et al., 2014) ; and the longitudinal diffusion tensor imaging (DTI) study, where modality profiles along well-identified tracts are observed for each multiple sclerosis (MS) patient at several hospital visits (Greven et al., 2010) . As a result of an increasing number of such data, longitudinal functional data analysis has received much attention recently; see for example Morris et al. (2003) ; Morris and Carroll (2006) ; Baladandayuthapani et al. (2008) ; Di et al. (2009) ; Greven et al. (2010) ; Staicu et al. (2010) ; Chen and M\u00fcller (2012) ; Li and Guan (2014) .\nOur motivation comes from the longitudinal DTI study, where the objective is to study the evolution of the MS disease as given by the dynamics of the modality profiles along the corpus callosum tract of the brain. By \"modality profile\" we mean measurements of a particular type of water diffusivity characteristics that are recorded at a fine grid of locations along the tract; the modality we focus on here is fractional anisotropy (FA). The change in the FA profiles along the corpus callosum over hospital visits is informative of the progression of the MS disease, and thus a statistical model for FA profiles, which incorporates longitudinal dependence, has the potential to be a very useful tool in practice. In this paper we propose a modeling framework that captures the process dynamics over time and also provides prediction of a full FA trajectory at a future visit.\nCurrently available methods for analysis of longitudinal functional data mainly separate into two categories, based on whether or not they account for the actual time of subject's repeated visit, say T ij for the jth visit of subject i. However, most existing methods, including those that incorporate T ij , cannot be used to predict a complete response trajectory at an unobserved (future) visit. For example, while Greven et al. (2010) used a functional linear mixed model framework to model the process dynamics linearly in T ij , their approach is not able to provide prediction of a full trajectory at a future visit. To the best of our knowledge, the only available modeling approach that provides such prediction is Chen and M\u00fcller (2012) . Specifically, their proposed model, henceforth denoted CM, is Y ij (s) = \u00b5(s|T ij ) + k\u22651 \u03be ik (T ij )\u03c6 k (s|T ij ), where Y ij (\u00b7) is the jth repeated trajectory response measured at time T ij , \u00b5(\u00b7|T ij ) is the mean response function at T ij , \u03c6 k (\u00b7|T ij ) is the kth leading direction at T ij , and \u03be ik (T ij ) = {Y ij (s|T ij ) \u2212 \u00b5(s|T ij )}\u03c6 k (s|T ij )ds is the corresponding coefficient, which depends on T ij . Though providing future prediction, CM makes the understanding of the process dynamics over visit times, T ij , challenging. Additionally, the numerical investigation of CM in finite samples is restricted to the case when the sampling design for T 's, at which the functional response is observed, is dense or moderately sparse, as well as when the response curves are observed with white noise measurement error that has small magnitude relative to the variation of the response (Chen and M\u00fcller (2012) ). However, an important limitation of CM is its heavy computational cost; its rigorous study in diverse practical situations is almost impossible.\nIn this paper we focus on the case where the sampling design of T 's is sparse (hence sparse longitudinal design) and the sampling design of s's is dense (hence dense functional design). We provide a novel parsimonious modeling framework to (i) easily study the longitudinal dynamics of the functional response over visit times, and (ii) predict a full trajectory at a future visit. We propose the following model for the response curve Y ij (\u00b7):\nfor s \u2208 S and T ij \u2208 T , where \u00b5(\u00b7, T ij ) is an unknown smooth mean response corresponding to T ij , X i (\u00b7, T ij ) is a smooth random deviation from the mean that varies over time T ij , and ij (\u00b7) is an error process with zero-mean and unknown covariance function. We assume that the bivariate processes X i 's are independent and identically distributed (iid), the error processes ij 's are iid and furthermore are independent of X i 's. For identifiability we require that X i comprises solely the random deviation that is specific to the subject; any repeated time-specific deviation is viewed as part of ij . Here {\u03c6 k (s)} k are orthogonal basis functions in L 2 [0, 1] and \u03be ijk = \u03be ik (T ij ) are the corresponding basis coefficients that have zero-mean, are uncorrelated over i, but correlated over j; the notation, \u03be ik (T ij ), is to show that this correlation may depend on T ij . We assume that the set of visit times of all subjects, {T ij : i, j}, is dense in T . Full model assumptions are given in Section 2. The class of model (1) is rich and includes many existent models, as we now illustrate. (i) If \u03be ik (T ij ) = \u03b6 0,ik + T ij \u03b6 1,ik for appropriately defined random terms \u03b6 0,ik and \u03b6 1,ik , model (1) can be represented as in Greven et al. (2010) . (ii) If cov(\u03be ik (T ), \u03be ik (T )) = \u03bb k \u03c1 k (|T \u2212 T |; \u03bd) for some unknown variance \u03bb k , known correlation function \u03c1 k (\u00b7; \u03bd) with unknown parameter \u03bd, and n = 1, model (1) resembles to Gromenko et al. (2012) and Gromenko and Kokoszka (2013) for spatially indexed functional data. (iii) If \u03be ik (T ij ) = l\u22651 \u03b6 ikl \u03c8 ikl (T ij ) with eigenfunctions \u03c8 ikl (T )'s and the corresponding coefficients \u03b6 ikl 's, then model (1) is similar to CM when \u03c6 k (\u00b7|T ) = \u03c6 k (\u00b7) for all k and t.\nThe model proposed in Chen and M\u00fcller (2012) is, in fact, closely related to model (1), but with one fundamental difference. Model (1) uses a time-invariant basis function, {\u03c6 k (\u00b7)} k , while Chen and M\u00fcller (2012) use a time-varying basis function, {\u03c6 k (\u00b7|T ij )} k . This key difference actually leads to the major advantages of the modeling framework proposed in this paper. First, by using a time-invariant basis function, the basis coefficients, \u03be ik (T ij ), extract the low dimensional features of these massive data with complex dependence structure. The longitudinal dynamics is emphasized only through the time-varying coefficients \u03be ik (T ij ) of (1), and thus this perspective makes the study of the process dynamics easier to understand. Second, the estimation approach of CM requires to obtain eigenbasis functions {\u03c6 k (\u00b7|T ij )} k at each T ij , by employing functional principal component analysis (FPCA) multiple times; our method requires to obtain only one set of basis functions, {\u03c6 k (\u00b7)} k . As the set {T ij : i, j} is dense in T , their estimation method involves a rather complex implementation and is computationally burdensome. In contrast, our method has computational advantages; the estimation is based on two dimensional smoother, which is faster than the three dimensional smoother required by the methods of Chen and M\u00fcller (2012) .\nUsing time-invariant basis functions has many appealing advantages. However, selecting a time-invariant basis is nontrivial. One option is to use a pre-specified basis but it brings along the challenging issues of deciding which basis to use, as well as of selecting the optimal number of basis functions. Data-driven basis is another option though there is no obvious way to select it. Here we propose to determine {\u03c6 k (\u00b7)} k using an appropriate marginal covariance operator \u03a3(s, s ) = T c((s, T ), (s , T ))g(T )dT , where c((s, T ), (s , T )) is the covariance function of the process, X(s, T ), and g(T ) is the sampling density of T 's. In Section 2 we show that the proposed basis, {\u03c6 k (\u00b7)} k , has optimal properties with respect to some appropriately defined criterion. From this view point, the model representation (1) is optimal. The idea of using the eigenbasis of the pooled covariance has been discussed recently in Jiang and Wang (2010) and Pomann et al. (2013) for the case of independent functional data.\nThe rest of paper is organized as follows. Section 2 introduces the proposed modeling framework. Section 3 describes the estimation methods and implementation. The methodology is studied theoretically in Section 4 and then numerically in Section 5. Sec-tion 6 discusses the application to the tractography DTI data. The paper concludes with a brief discussion in Section 7."}, {"section_title": "Modeling longitudinal functional data", "text": "Let [{T ij , Y ij (s r ) : r = 1, . . . , R} : j = 1, . . . , m i , ] be the data for the ith subject, where Y ij (\u00b7) is the jth profile recorded at visit time, T ij for subject i, and each profile is observed at the fine grid of points {s 1 , . . . , s R }. For notation simplicity we use the generic index s instead of s r and refer to s by 'functional argument'. We assume that, for each subject i, the number of observed curves, m i , is relatively small, and the visit times, {T ij } j are random in a closed and compact interval, T . It is assumed that the set of time points of all subjects, {T ij : for all i, j}, is dense in T ; we call the generic time T by 'longitudinal argument'. Without loss of generality, we set S = T = [0, 1]. Now consider model (1) where our primary goal is to model the complex covariance function of the random process X i (s, T ij ) = X ij (s); we use this notation interchangeably. In our exposition it is helpful to represent the noise process ij (\u00b7) as the sum of two well identified components: one square integrable smooth component 1,ij (s), which has a covariance function \u0393(s, s ) = cov{ 1,ij (s), 1,ij (s )} that varies smoothly over s, s \u2208 [0, 1] and a white noise component 2,ij (s) with covariance cov{ 2,ij (s), 2,ij (s )} = \u03c3 2 if s = s and 0 otherwise; only the component 1,ij (s) is relevant for the nontrivial process dependence.\nLet c((\nbe the covariance function of the process X i (\u00b7, \u00b7) and g(\u00b7) be the sampling density of T . Define the marginal covariance function induced by X i 's by \u03a3(s, s ) = c((s, T ), (s , T ))g(T )dT ; in Section 4 we show that \u03a3(s, s ) is a proper covariance function (Horv\u00e1th and Kokoszka, 2012) . Denote by\nand its induced marginal covariance is \u039e(s, s ) = \u03a3(s, s ) + \u0393(s, s ). Let {\u03c6 k (s), \u03bb k } k be the pair of eigenfunctions and eigenvalues from the spectral decomposition of \u039e(s, s ), where {\u03c6 k (\u00b7) : k} forms an orthogonal basis in L 2 [0, 1] and \u03bb 1 \u2265 \u03bb 2 \u2265 . . . \u2265 0. Using arguments similar to the standard FPCA, the eigenbasis functions {\u03c6 k (\u00b7) : k = 1, . . . , K} are optimal in the sense that they minimize the following weighted mean square error:\nand \u03be W,ijk are not necessarily uncorrelated over k. Here \u03be ik (T ij ) = X i (s, T ij )\u03c6 k (s)ds and e ijk = 1,ij (s)\u03c6 k (s)ds are specified by the definition of W i ; for fixed k these terms are mutually independent due to the independence of the processes X i and 1,ij . For each k, one can easily show that, \u03be ik (\u00b7) is a smooth zero-mean random process in L 2 [0, 1] and is iid over i; by an abuse of notation in what follows we use interchangeably \u03be ik (T ij ) = \u03be ijk . Furthermore e ijk are zero-mean iid random variables over i, j; denote by \u03c3 2 e,k their finite variance. The above representation allows us to recover the latent signal X i (\u00b7, T ij ) and\nThe main difference between the proposed work and Chen and M\u00fcller (2012) is the use of the marginal covariance function, \u03a3(s, s ); CM use the conditional covariance function \u03a3(s, s |T ). The proposed approach reduces computational burden substantially, by avoiding the three dimensional covariance function and the spectral decomposition of \u03a3(s, s |T ) at every T . Also using time-invariant basis functions is critical in reducing the dimensionality of the data in a way that captures the dependence over visit time; the longitudinal dependence (over T ) can be studied through \u03be ijk = \u03be ik (T ij )'s.\nOne way to model the dependence of the basis coefficients, \u03be ijk , is by using common techniques in longitudinal data analysis; for example by assuming a parametric covariance structure. As we discussed in Section 1, this leads to models similar to Greven et al. (2010) ; Gromenko et al. (2012) ; Gromenko and Kokoszka (2013) . We consider this approach in the analysis of the DTI data, Section 6. Another approach is to assume a nonparametric covariance structure and employ a common functional data analysis technique. We detail the latter approach in this section.\nSpecifically, for each k \u2265 1 denote by\nUsing the Karhunen-Lo\u00e8ve (KL) expansion, we represent \u03be ik (\u00b7) as:\nwhere \u03b6 ikl have zero-mean, variance equal to \u03b7 kl , and are uncorrelated over l. By collecting all the components, we represent the model (1) as\nIn practice we truncate this expansion. Let K and L k 's such that Y ij (s) is well approximated by the following truncated model based on the leading K and k L k respective basis functions\nThe truncated model (4) gives a parsimonious representation of the complex dependent longitudinal functional data; it allows the study of its dependence through two sets of eigenfunctions: one dependent only on s and one only on visit times, T ij . This approach involves two main challenges: first, determining consistent estimators of the orthogonal basis functions \u03c6 k (\u00b7)'s, and second estimating the covariance functions G k (\u00b7, \u00b7) of the time-varying coefficients \u03be ik (T ), when the quantities W i (s, T ij )'s are not directly observable."}, {"section_title": "Estimation of model components", "text": "Next we discuss estimation of all model components: Section 3.1 describes the estimation of the mean function. Section 3.2 presents the estimation of the marginal covariance function and of the eigenfunctions \u03c6 k (\u00b7)'s, and Section 3.3 presents the estimation of the time-varying basis coefficients \u03be ik (\u00b7)'s. Prediction of Y i (s, T ) is detailed in Section 3.4."}, {"section_title": "3.1", "text": "Step 1: Mean function \u00b5(s, T )\nIn this paper we estimate the mean function, \u00b5(s, T ), using bivariate smoothing via bivariate tensor product splines (Wood, 2006) \n's, and \u03b2 is the vector of unknown parameters, \u03b2 q 1 q 2 's. The bases dimensions, d s and d T , are set to be sufficiently large to accommodate the complexity of the true mean function, and roughness of the function is controlled through the size of the curvature in each direction separately, i.e.\nThe penalized criterion to be minimized is\nwhere \u03bb s and \u03bb T are smoothing parameters that control the trade-off between the smoothness of the fit and the goodness of fit. The smoothing parameters can be selected by the restricted maximum likelihood (REML) or generalized cross-validation (GCV). It follows that the estimated mean function \u00b5(s, T ) = B(s, T ) T \u03b2. While this method is a very popular smoothing technique of bivariate data, other available bivariate smoothers can be used to estimate the mean \u00b5(s, T ); for example, kernelbased local linear smoother (Hastie et al., 2009) , bivariate penalized spline smoother (Marx and Eilers, 2005) and the sandwich smoother (Xiao et al., 2013) . The sandwich smoother (Xiao et al., 2013) is especially useful in the case of very high dimensional data for its appealing computational efficiency, in addition to its estimation accuracy."}, {"section_title": "3.2", "text": "Step 2: Marginal covariance. Data-driven orthogonal basis\nOnce the mean function is estimated, let Y ijr = Y ijr \u2212 \u00b5(s r , T ij ) be the demeaned data. We use the demeaned data to estimate the marginal covariance function induced by W i (s, T ij ), \u039e(s, s ) = \u03a3(s, s ) + \u0393(s, s ). The estimation of \u039e(s, s ) consists of two steps. In the first step, a raw covariance estimator \u039e(s, s ) is obtained; the pooled sample covariance is a suitable choice, if all the curves are observed on the same grid of points:\nBecause we assume that each observation, Y ijr , is observed with white noise, 2,ij (s r ), the 'diagonal' elements of the sample covariance, \u039e(s r , s r ), are inflated by the variance of the noise, \u03c3 2 . In the second step, the preliminary covariance estimator is smoothed by ignoring the 'diagonal' terms; see also Staniswalis and Lee (1998) and Yao et al. (2005) ) who used similar technique for the case of independent functional data. In our simulation and data application we use the sandwich smoother (Xiao et al., 2013) . To ensure the positive semi-definiteness of the estimator any negative eigenvalues are zero-ed. The resulting smoothed covariance function, \u039e(s, s ), is used as an estimator of \u039e(s, s ). In Section 4, we show that \u039e(s, s ) is an unbiased and consistent estimator of \u039e(s, s ) in two settings: 1) the data are observed fully and without measurement errors, i.e. ij (s) \u2261 0 and 2) the data are observed fully and with measurement error of type 1,ij (s), i.e ij (s) \u2261 1,ij (s).\nLet { \u03c6 k (s), \u03bb k } k be the pairs of eigenvalues/eigenfunctions obtained from the spectral decomposition of the estimated covariance function, \u039e(s, s ). The truncation value K is determined based on pre-specified percentage of variance explained (PVE); specifically, K can be chosen as the smallest integer such that\n\u03bb k is greater than the pre-specified PVE (Di et al., 2009; Staicu et al., 2010) ."}, {"section_title": "3.3", "text": "Step 3: Covariance modeling of the longitudinal varying components\nds be the projection of the jth repeated demeaned curve of the ith subject onto the direction \u03c6 k (\u00b7) for k = 1, . . . , K. Since Y ij (s), is observed at dense grids of points {s r : r = 1, . . . , R} in S for all i and j, \u03be W,ijk will be approximated accurately through numerical integration. It is easy to see that the version of \u03be W,ijk that uses \u00b5(s, T ij ) in place of \u00b5(s, T ij ) and \u03c6 k (s) in place of \u03c6 k (s) converges to \u03be W,ijk with probability one, as R diverges. The time-varying coefficients \u03be W,ijk are proxy measurements of \u03be ijk = \u03be ik (T ij ) and will be used to study the process dynamics. Estimation of their covariance is important as it describes the process temporal dependence but also because it allows prediction at unobserved time points T \u2208 [0, 1]. One alternative is to stack the coefficients \u03be W,ijk over k and study the time-dependence of the resulting K-dimensional vector. We take a simpler way and study the temporal dynamics separately for each k.\nLet {(T ij , \u03be W,ijk ) : j = 1, . . . , m i } i be the 'observed data' that will be used to estimate the temporal covariance. A possible approach is to assume a parametric model for the latent temporal covariance, such as AR (1) or a random effects model framework; such approach would be preferable when there are very few curve measurements per subject and the longitudinal design is balanced. We discuss random effects model for estimating the longitudinal covariance in the data application. Here we consider a more flexible approach and estimate the covariance nonparametrically. Specifically, recall that G k (T, T ) = cov{\u03be ik (T ), \u03be ik (T )} and our framework as described in (2) is common for modeling discretely observed functional data: \u03be W,ijk = \u221e l=1 \u03b6 ikl \u03c8 kl (T ij ) + e ijk where \u03b6 ikl are random variables with zero mean and \u03b7 kl variances, {\u03c8 kl (T ), \u03b7 kl } l are the pairs of eigenfunctions and eigenvalues of the covariance G k , and e ijk 's are iid with zero-mean and variance equal to \u03c3 2 e,k . Though we do not observe \u03be W,ijk 's we use the proxy \u03be W,ijk 's and estimate G k by employing FPCA techniques for sparse functional data (Yao et al., 2005) .\nFor completeness we summarize the approach below. Following Yao et al. (2005), we first obtain the raw sample covariance,\nKernel-based local linear smoothing (Yao et al., 2005) or penalized tensor product spline smoothing (Wood, 2006) can be used at this step. The diagonal terms { G ik (T ij , T ij ) : i, j = j } are removed because the noise e ijk present in the proxy \u03be W,ijk leads to inflated variance function. Let { \u03c8 kl (\u00b7), \u03b7 kl } l be the pairs of eigenvalues/eigenfunctions of the estimated covariance surface, G k (T, T ). The truncation value, L k , is determined based on pre-specified PVE; using similar ideas as in Section 3.2. The variance \u03c3 2 e,k is estimated from the difference between the variance along the diagonal, or a smooth estimator of the raw diagonal terms, and the predicted covariance for Yao et al. (2005) discusses an alternative that dismisses the terms at the boundary when estimating the error variance. Once the basis functions {\u03c8 kl (\u00b7)} L k l=1 , eigenvalues \u03b7 kl 's, and error variance \u03c3 2 e,k are estimated, the above model framework can be viewed as a mixed effects model and the random components \u03b6 ikl can be predicted using conditional expectation and a jointly Gaussian assumption for \u03b6 ijk 's and e ijk 's. In\ne,k \u03b4 jj , for \u03b4 jj = 1 of j = j and 0 otherwise, and \u03be W,ik is the m i dimensional column vector of \u03be W,ijk 's. The predicted time-varying coefficients corresponding to a generic time T are obtained as\nYao et al. (2005) proved the consistency of the estimators of the model components and the predicted score trajectories when \u03be W,ijk 's are observed directly. In Section 4 we extend these results to the case when the proxy \u03be W,ijk 's are used instead, and when the observed curves Y ij (\u00b7) are fully observed and the measurement error is of the type ij (s) = 1,ij (s); i.e. the data are observed with smooth error."}, {"section_title": "Step 4: Trajectories reconstruction", "text": "We are now able to predict the full response curve at any time point T in[0, 1] by:\nwhere"}, {"section_title": "Implementation using available softwares", "text": "An important advantage of the proposed approach is that its implementation can be carried using available software.\nStep 1. Estimate the smooth mean function \u00b5(s, T ) using the sandwich smoother (Xiao et al., 2013 ) (the fbps function in R (R Core Team, 2014) package refund (Ciprian Crainiceanu et al., 2014) ) or using the penalized tensor product spline smoothing (the gam and te functions in R (R Core Team, 2014) package mgcv (Wood, 2011) ).\nStep 2. Estimate the smooth covariance function \u039e(s, s ) with the demeaned data (dense design) using the sandwich smoother (Xiao et al., 2013) and get the eigenfunctions \u03c6 k (s) using the fpca.face function in the refund package (Ciprian Crainiceanu et al., 2014) . The default option of this function also provides \u03be W,ijk 's.\nStep 3. For each k, carry out FPCA of {T ij , \u03be W,ijk : i, j}. There are several available options for implementation: fpca.sc function in the refund package (Ciprian Crainiceanu et al., 2014) and fpca.mle and fpca.pred functions in the FPCA package (Peng and Paul, 2009; James et al., 2000) in R. Alternatively one can use the FPCA function (Yao et al., 2005) in the MATLAB (MATLAB, 2014) package PACE (Yao et al., 2005) available at http://www.stat.ucdavis.edu/PACE/.\nStep 4. Determine the predicted trajectories using equation (8)."}, {"section_title": "Theoretical properties", "text": "We discuss now the asymptotic properties of the model components estimators and the predicted trajectories. Our study is based on the assumption of a sparse longitudinal design (modest number of repeated curve measurements per subject) and dense functional design; this requires new techniques than the ones commonly used for theoretical investigation of repeated functional data (such as Chen and M\u00fcller (2012) ). Throughout this section we assume that response trajectories, Y ij (\u00b7)'s, have zero-mean and are observed fully as a function over the domain, S = [0, 1]. Section 4.1 discusses the main theoretical results when data, Y ij (s)'s, are observed without error, i.e. ij (s) \u2261 0 for s \u2208 [0, 1]. Section 4.2 extends the findings to the case when the observed data are corrupted with a smooth error process ij (s) \u2261 1,ij (s); i.e. there is no white noise measurement error. The proofs of the results are sketched in the Appendix and described to greater detail in the Supplementary Material. Section 4.3 discusses on how to relax some of the assumptions. For clarity, throughout this section we use S and T to distinguish between the domains for the functional argument and longitudinal one, respectively.\nWe assume that the bivariate process X i (s, T ij ) is a realization of a true random process, X(s, T ), with zero-mean and smooth covariance function, c((s, T ), (s , T )) = cov{X(s, T ), X(s , T )}, which furthermore satisfies some regularity conditions.\nwhere S and T are compact sets.\n(A2.) The sampling density g(T ) is continuous and sup T \u2208T |g(T )| < \u221e.\nWe first verify that the marginal covariance, \u03a3(s, s ), is a proper covariance function (Horv\u00e1th and Kokoszka, 2012, p.24) . Under the assumptions (A1.) and (A2.), the marginal covariance function,\nis positive definite, and (iii) have eigenvalues satisfying that \u221e k=1 \u03bb k is finite."}, {"section_title": "Response curves measured without error", "text": "Assume that there is no error ij (s) \u2261 0 and thus\nWe first show that \u03a3(s, s ) is an unbiased estimator of the true marginal covariance, \u03a3(s, s), and then we prove that it is a consistent estimator. The following assumptions are important in our theoretical development.\nConditions (A3.) and (A4.) regard the moment behavior of the latent process X and are commonly used in functional data analysis (Yao et al., 2005; Chen and M\u00fcller, 2012) . Theorem 1 gives the asymptotic properties of the marginal covariance estimator \u03a3(s, s ).\nIf the additional assumption (A4.) holds, then we have that\nwhere\nBy the consistency result (9) and Theorem 4.4 and Lemma 4.3 of Bosq (2000, p.104) , it follows that the eigen-elements of \u03a3(s, s ) are consistent estimators of the corresponding eigen-elements of \u03a3(s, s ), if the eigenvalues are neither crossing nor the same.\nwhere \u03bb k is the kth largest eigenvalues of \u03a3(s, s ). Assume that 0 < a k < \u221e and \u03bb k > 0 for all k (No crossing or ties among eigenvalues).\nCorollary 1 Under the assumptions (A1.),(A2.), (A4.), and (A5.), for each k\nNext, we focus on the estimation of the covariance that describes the longitudinal dynamics. If \u03be W,ijk 's were available to estimate the covariance function,\n, then the consistency of the model components follows trivially from the FPCA properties developed in Yao et al. (2005) . However, \u03be W,ijk 's are not directly observed; instead available are the proxy time-varying coefficients\nWe first show the uniform consistency of \u03be W,ijk , then use this result to show that the estimator of G k (T ij , T ij ) based on \u03be W,ijk is asymptotically identical to that based on \u03be W,ijk . Consistency results of the remaining model components follow directly from Yao et al. (2005) . The uniform consistency of \u03be ijk requires sup j,s |Y i (s, T ij )| to be bounded almost surely, and this is ensured by assuming (A6.). The Gaussian assumption (A8.) is needed for the consistency of \u03b6 ikl obtained using the PACE method of Yao et al. (2005) .\n(A6.) E sup s,T |X(s, T )| a \u2264 M a for a constant, M > 0, and an arbitrary integer, a \u2265 1; This is equivalent to assume that X(s, T ) is absolutely bounded almost surely.\nwhere \u03b7 kl is the lth largest eigenvalues of G k (T, T ). Assume that 0 < b kl < \u221e and \u03b7 kl > 0 for all k and l (No crossing or ties among eigenvalues).\n(A8.) \u03b6 ikl and e ijk are jointly Gaussian.\nTheorem 2 Under the assumptions (A1.), (A2.), (A4.) -(A6.), for each k\nand\nas n diverges. In fact a stronger result also holds, namely the uniform convergence of\nCorollary 2 Under the assumptions (A1.), (A2.), (A4.) -(A8.), for each k and l the eigenvalues \u03b7 kl and eigenfunctions \u03c8 kl (\u00b7) of G k (\u00b7, \u00b7) satisfy\nas n diverges. Uniform convergence of \u03c8 kl (\u00b7) also holds:\nwhere\nThe consistency results for all model components imply consistency of the predicted trajectories given in equation (8).\nas n, K and L k 's diverge."}, {"section_title": "Response curves measured with smooth error", "text": "Assume next that the response curves are observed with smooth error ij (s) \u2261 1,ij (s), and thus Y ij (s) = X i (s, T ij ) + 1,ij (s) for s \u2208 S and smooth error process 1,ij (\u00b7) \u2208 L 2 (S). The main difference from Section 4.1 is that the sample covariance of Y ij (s) is an estimator of \u039e(s, s ) = \u03a3(s, s ) + \u0393(s, s ), not of \u03a3(s, s ); as a result we denote the sample covariance of\n. One can show, using similar arguments as earlier, that \u039e(s, s ) is an unbiased estimator of the marginal covariance function, \u039e(s, s ). Moreover similar arguments can be used to show the pointwise consistency as well as the Hilbert-Schmidt norm consistency of \u039e(s, s ).\na for a constant, M > 0, and an arbitrary integer, a \u2265 1; this is equivalent to assume that (s) is absolutely bounded almost surely. \nThe proofs of these results are detailed in the Supplementary Material.\nAs the smooth error process 1,ij (s) is correlated only along the functional argument, s, and 1,ij (s) are iid over i, j it follows that the theoretical properties of the predictions -of the time-varying coefficients and the response curve -hold without any modification."}, {"section_title": "Extensions", "text": "The theoretical results presented in this section are based on the assumption that data Y ij (s)'s are observed (i) fully, (ii) without white noise, 2,ij (s) \u2261 0 for all s, and (iii) have mean zero. These assumptions are made for convenience, and they can be relaxed as we now explain.\n(i) The assumption that Y ij (s)'s are observed fully, as a continuous function, is quite common in theoretical study involving functional data; see for example Cardot et al. (2003 Cardot et al. ( , 2004 ; Chen and M\u00fcller (2012) among many others. One possibility to bypass this assumption is to use the corresponding smooth trajectories instead. (ii) Suppose that the profiles Y ij (\u00b7)'s are observed on dense grids of points and the measurements are additionally corrupted with white noise. Zhang and Chen (2007) showed that by smoothing each profile using local linear smoother, the true de-noised curves are recovered with asymptotically negligible error, in the case of independent curves. Another possibility to handle white noise is to use ideas similar to Yao et al. (2005) . In Section 5 we illustrate numerically the effect of white noise on the performance accuracy. (iii) Finally, the theoretical properties of the model components estimators remain valid, when the mean function is non-zero and a consistent mean estimator is available; Chen and M\u00fcller (2012) had considered this problem and showed that under suitable assumptions such consistent mean estimator can be obtained using bivariate smoothing."}, {"section_title": "Simulation study", "text": "We conduct a simulation study to investigate the finite sample performance of the proposed modeling approach. The performance is evaluated in terms of estimation accuracy for the main model components, in-sample and out-of-sample prediction accuracy, and computational time. Whenever applicable we compare our results to available alternatives such as Chen and M\u00fcller (2012) .\nWe generate N sim = 1000 samples from model (1) with\n, where \u00b5(s, T ) = 1 + 2s + 3T + 4sT , and \u03c6 1 (s) = 1 and \u03c6 2 (s) = \u221a 2sin(2\u03c0s). The grid of points for s is the set of 101 equispaced points in [0, 1]. For each i, there are m i profiles associated with visit times, {T ij : j = 1, . . . , m i }; T ij 's are randomly sampled from 41 equally spaced points in [0, 1]. The random coefficients \u03be ik (T ) are generated from various covariance structures as detailed below. Errors are generated from ij (s) = e ij1 \u03c6 1 (s) + e ij2 \u03c6 2 (s) + 2,ij (s), where e ij1 , e ij2 and 2,ij (s) are mutually independent with zero-mean and variances equal to \u03c3 2 e,1 , \u03c3 2 e,2 and \u03c3 2 , respectively. The white noise variance, \u03c3 2 , is set based on the signal to noise ratio (SNR),\nWe consider the following experimental factors: Case 1. covariance structure of the time-varying components: (a) non-parametric covariance (NP):\nis a Gaussian process with mean zero, variance \u03bb k and auto-correlation function corr{\u03be ik (T ),\niid \u223c GP (4.5, 0.9) and \u03be i2 (T )\niid \u223c GP (3, 0.5).\nNote that regardless of the generating models for \u03be ik (T ), we have that var{\u03be ik (T )}dT is equal to 4.5 and 3 for k = 1, 2 respectively. Case 5. number of subjects: (a) n = 100, (b) n = 300, and (c) n = 500\nFor each generated sample of size n we form a training set and a test set. To determine the test set we randomly select 10 subjects from the sample. The test set is formed by collecting these subjects' last functional observation; hence the test set contains 10 curves. The remaining functional observations for the 10 subjects and the data corresponding to the remaining subjects in the sample form the training set. Our model is fitted using the training set and the methods outlined in Section 3. To be more specific, the bivariate mean function, \u00b5(s, T ), is modeled using 50 cubic spline basis functions obtained from the tensor product of d s = 10 basis functions in direction s and d T = 5 in T . The smoothing parameters are selected via REML. The finite truncations K and L k 's are all estimated using the pre-specified level PVE = 0.95.\nEstimation accuracy for the model components is evaluated using integrated mean squared errors (IMSE): specifically, for the bivariate mean function IMSE( \u00b5) =\n{ \u00b5 i sim (s, T ) \u2212\u00b5(s, T )} 2 dsdT /N sim , and for the univariate eigenfunctions IMSE( \u03c6 k ) =\nThe prediction performance is assessed through the accuracy in predicting the time-varying model components, \u03be ik (T ), and in predicting the response curve, Y i (s, T ). For the former assessment we use the insample integrated prediction errors (IPE) defined as IPE(\u03be k ) ="}, {"section_title": ". For the later assessment we use the in-sample IPE (IN-IPE) defined as IN-IPE(Y ) =", "text": "where Y * ij (s) is the true signal, i.e. without measurement error ij (s). Also we use the out-of-sample IPE (OUT-IPE) defined as OUT-IPE(Y ) =\nis the true signal in the test set. The results are based on N sim = 1000 simulations.\nIn terms of estimation performance and prediction of \u03be ik (T ) there is no alternative approach. On the other hand, in terms of model prediction error and prediction of a subject's future curve there are two possible alternatives. One is the CM model of Chen and M\u00fcller (2012) . However due to the high computational expense required by their method, we have to restrict our comparison to few scenarios only: m i \u223c {8, . . . , 12} number of repeated curves per subject, Case 3(b), and SNR = 1. The approach of Chen and M\u00fcller (2012) requires specification of several kernel bandwidths; due to the increased computation burden we use the pre-specified bandwidth h = 0.1 in smoothing both the mean and covariance functions. Even with these adjustments there is an order of magnitude difference in the computational cost (when n = 100 the method of Chen and M\u00fcller (2012) takes approximately 984 seconds, while our approach takes about 7 seconds). As well, we also used the pre-specified level PVE = 0.95 to be consistent with our approach. A second alternative approach for prediction of a subject's future visit trajectory is a rather na\u00efve approach: let the future prediction equal the average of all previously observed profiles for that subject. For example, the na\u00efve predictor of a profile of some subject in the test set is equal to the average of all profiles available in the training set for the corresponding subject. Table 1 shows the results for different covariance models for \u03be ik (T ), different number of repeated curve measurements per subject, different SNRs, complex error process, and varying sample sizes; basically the results for Case 1 (a)-(c), Case 2(a)-(b), Case 3 (b), Case 4 (a)-(b), and Case 5 (a)-(c). The analogous results corresponding to trivial covariance structure of the error process (white noise) are included in Table S1 of the Supplementary Material. The performance of the proposed estimation (see columns for \u00b5, \u03c6 1 , and \u03c6 2 of this table) is slightly affected by the covariance structure of model com-ponents describing the dynamic behavior, \u03be ik (T )'s, and the number of repeated curve measurements per subject, but in general is quite robust to the factors we investigated. As expected the estimation accuracy improves with larger sample size; see the 3 \u00d7 3 top left block of IMSE results corresponding to n = 100, n = 200, and n = 500. The results corresponding to white noise measurement error are consistent with these observations.\nTo describe the prediction performance we consider both the prediction of \u03be ik (T )'s and the prediction of the curve responses; consider columns labeled \u03be 1 , \u03be 2 , IN-IPE and OUT-IPE of Table 1 . As expected the underlying covariance structure of \u03be ik (T )'s does affect the prediction accuracy. In our investigation it seems that the exponential covariance structure (Exp) is most challenging; this most likely is due to the (very) large correlation coefficients used \u03c1 1 = 0.9 and \u03c1 2 = 0.5, which result in high temporal dependence even for the observations that are furthest apart T = 0 and T = 1, as T \u2208 [0, 1]. Increasing the level of signal relative to the magnitude of noise (SNR) does improve the results somewhat. More importantly, when the error process has trivial covariance structure, the prediction accuracy is greatly improved. The results also show an interesting finding: increasing the number of repeated curve measurements m i has a greater effect on the accuracy than increasing the sample size n. This observation should not be surprising, as with larger number of repeated measurements the estimation of the covariance of the longitudinal process \u03be ik (T )'s improves and as a result superior prediction.\nHere is a summary of the comparison between the proposed method and available alternatives. As already pointed out, the comparison with CM is limited by the computational expense involved. In interest of space the results are presented in Table S4 of the Supplementary Material: they show that the prediction using CM is more sensitive to the covariance structure of the underlying time-varying coefficients and that the accuracy can be improved by up to 50% by the proposed approach. As expected, the na\u00efve approach (results presented in the columns labeled IN-IPE naive and OUT-IPE naive of Table 1 ) is very sensitive to the covariance structure of the latent longitudinal components, \u03be ik (T ). When the correlation structure is simple (random effects model, REM, and exponential dependence, Exp) it yields much better results compared to when the correlation is more complex (nonparametric, NP). Not surprisingly, in all the cases studied the prediction accuracy is inferior to the proposed method. Table 2 provides insights into the how the computational time of our method scales with the number of subjects; for completeness the computational time is studied for all the cases in Tables S2 and S3 of the Supplementary Material. The overall conclusion is that the proposed approach provides an improved prediction performance over the existing methods in a computationally efficient manner."}, {"section_title": "DTI application", "text": "Diffusion tensor imaging (DTI) is a magnetic resonance imaging technique, which is crucial in the diagnosis and progression assessment of various neuro-pathological diseases that affect brain white matter. Specifically, DTI provides different measures of water diffusivity along brain white matter tracts; its use is instrumental especially for brain tracts where the diffusion is sensitive to any alteration of the tissues in the tract, like the ones caused by multiple sclerosis (MS), or white matter diseases more generally (see Alexander et al. (2007) , Basser et al. (1994) , Basser et al. (2000) , Basser and Pierpaoli (2011) ).\nIn this paper we focus on studying a commonly used DTI measure -fractional anisotropy (FA) -along the corpus callosum tract in MS patients. FA of the water diffusion ranges from zero to one, with zero being the perfect isotropic diffusion in all directions. The DTI study involves 162 MS patients observed at between one and eight hospital visits; the total number of visits for all patients is 421 with mean and median equal to 2.599 and 2 visits per patient, respectively. At each visit, FA is measured at 93 equispaced discrete locations along the corpus callosum tract, and thus can be viewed as a typical densely-sampled functional data. The data contains a total of 39 missing values; however, no modification is needed as the proposed method is not sensitive to mild missingness.\nOur main objective is twofold: (i) to understand the dynamic behavior of the FA profile in MS patients over time and (ii) to make accurate predictions of the FA profile for the observed subject's future visit. Various aspects of the DTI study have been also considered in Greven et al. (2010) , Goldsmith et al. (2011 ), Staicu et al. (2012 and Pomann et al. (2013) . In particular Greven et al. (2010) used an earlier version of the study consisting of data from fewer and possibly different patients and a different registration technique. They studied the dynamic behavior of FA over time; however, their method cannot provide prediction for an already observed patient of the FA profile at their next hospital visit. Our method quantifies the longitudinal changes in FA over time using a parsimonious model framework and provides accurate prediction of the full response profile at patient's future visit. The results have the potential to shed lights on the understanding of the MS progression over time as well as its response to treatment.\nTo start with, for each subject we define the hospital visit time T ij by the difference between the reported visit time and the subject's baseline visit; thus T i1 = 0 for all subjects i. Also the resulting values are scaled by the maximum value in the study so that T ij \u2208 [0, 1] for all i and j. The sampling distribution of the visit times is right-skewed with rather strong skewness; for example there are only few observations T ij 's close to 1. The strong skewness of the sampling distribution of T ij 's has serious implications on the estimation of the bivariate mean \u00b5(s, T ); a completely nonparametric bivariate smoothing would results in unstable and highly variable estimation. This is probably why Greven et al. (2010) first centered the times for each patient i, {T ij : j = 1, . . . , m i }, and then standardized the overall set {T ij : i, j} to have unit variance. However, such subject-specific transformation of T ij 's loses interpretability. In particular, while such transformations are appropriate for understanding the complex dynamics of these data they may not be suited for prediction at unobserved times. Specifically, it is not clear what type of transformation to apply to a future visit time of a subject, in order to predict the response profile at the respective future time -and this is crucial for our analysis.\nOne way to bypass this challenge is to assume a simpler parametric structure along the longitudinal direction, T , for the mean function; based on the exploratory analysis we assume linearity in T . Specifically we assume the varying coefficient model \u00b5(s, T ij ) = \u00b5 0 (s) + \u03b2 T (s)T ij , where \u00b5 0 (\u00b7) and \u03b2 T (\u00b7) are unknown, smooth functions of s. We model \u00b5 0 (\u00b7) and \u03b2 T (\u00b7) using a penalized univariate cubic spline regression with 10 basis functions; the smoothing parameters are estimated using REML. Plots of the estimated mean, \u00b5(s, T ) = \u00b5 0 (s) + \u03b2 T (s)T , and the estimated slope function, \u03b2 T (s), are given in Figure S1 of the Supplementary Material. The estimates seem to indicate that the population-level mean of FA, \u00b5(s, T ), does not change much over longitudinal time, T ; in other words the estimated slope function, \u03b2 T (s), is very close to zero. We use bootstrapping of the subjects to quantify the variability of the slope function estimator.\nIn particular, pointwise confidence band is constructed as 2.5% and 97.5% quantiles of the bootstrap estimates at each location of the tract, s, and the joint confidence band is constructed as given in Crainiceanu et al. (2011) using B = 1000 bootstrap samples. As shown in Figure 1 the joint confidence band contains zero for all s.\nThe observation that the mean of FA profile varies very little over time is in agreement with prior literature; for example see Greven et al. (2010) who used a different data set with subjects observed also over a relatively short time frame. To gain more insight into this direction we consider a formal test to see whether \u00b5(s, T ) varies over time; using our mean model assumption this is equivalent to testing the null hypothesis that the slope function is null, H 0 : \u03b2 T (s) = 0 against the alternative H A : \u03b2 T (s) = 0 for some s \u2208 [0, 1]. We inspire from the ideas discussed in Park et al. (2015) to carry out the testing procedure.\nLet the test statistic be Q = \u03b2 T (s) 2 ds -the norm of the slope estimator. To approximate its null distribution, we use bootstrap of the residuals as described next. First, estimate the mean function by assuming the model \u00b5(s, T ) = \u00b5 0 (s) + \u03b2 T (s)T and under working independence; let Q obs = \u03b2 T (s) 2 ds be the observed test statistic using numerical integration. Second, construct the bootstrap sample as Y boot ij\nThird, obtain B bootstrap datasets, by bootstrapping with replacement from the above set; take B = 1000. For each data set we fit the above mean model and calculate the bootstrap test statistic, denoted by Q b , where b indexes for bootstrap dataset. Fourth, approximate p-value by 1000 b=1 I(Q b > Q obs )/1000, where I is an indicator function. The null distribution of Q is shown in Figure S2 of the Supplementary Material. The procedure yields p-value = 0.206, which does not provide significant evidence to reject the null hypothesis that the mean function is constant over time. In light of this, we assume a T -invariant mean model \u00b5(s, T ) = \u00b5 0 (s) for the rest of the data analysis; the estimated \u00b5 0 (s) is shown in Figure 1 .\nWe focus next on studying the variability in the data, and on using this variability to inform future prediction of a subject's full trajectory. After demeaning the data, we estimate the marginal covariance and obtain the eigenbasis functions; using the preset level P V E = 0.95 results in K = 10 eigenfunctions. Figure 2 shows the leading 3 eigenfunctions that explain in turn 62.69%, 8.37% and 6.77% of the total variance, respectively; the rest of the estimated eigenfunctions are given in Figure S4 of the Supplementary Material. As shown in Figure 2 , a positively loaded first eigenfunction corresponds to a mean profile that is lower than the overall mean for all s, and the opposite for a negatively loaded one.\nWe initially use a nonparametric approach to estimate the longitudinal covariance of \u03be ik (T )'s for k = 1, . . . , 10. Preliminary results (not shown here) indicate a simpler covariance model, which is the model we will present. More specifically, assume a random effects model \u03be ik (T ij ) = b 0ik + b 1ik T ij , where var(b lik ) = \u03c3 2 lk for l = 0, 1 and cov(b 0ik , b 1ik ) = \u03c3 01k . The fitted time-varying coefficient functions, \u03be ik (T ), for k = 1, 2 and 3 are shown in Figure  3 , and the rest are shown in Figure S5 of the Supplementary Material. The estimated timevarying coefficient functions corresponding to \u03be i1 (T ) suggest some longitudinal changes, but their signs remain the same across visit times except few cases with a relatively small magnitude. Overall, it implies that an individual mean profile tends to stay lower than the overall mean across all visit times if the first eigenfunction corresponding to that individual is positively loaded at baseline, and vise versa. In contrast to \u03be i1 (T ), the estimated basis coefficient functions corresponding to the second eigenfunction, \u03be i2 (T ), are mostly constant across visit times and imply little changes over time.\nOne advantage of using a simpler, parametric model is that one can consider more formal testing about longitudinal effects. We consider this idea next, and study separately the null hypotheses, H 0k : \u03c3 2 1k = \u03c3 01k = 0 for k = 1, . . . , 10 using the proxy data \u03be W,ijk = {Y ij (s) \u2212 \u00b5 0 (s)} \u03c6 k (s) as the 'observed' data. Bonferroni correction is used to appropriately account for multiple testings; specifically, we use the adjusted significance level, \u03b1 adj = 0.05/10 = 0.005, for testing each hypothesis such that familywise error rate is \u03b1 = 0.05. Likelihood ratio test (LRT) and its null distribution as approximated by the mixture chi-squares are used for each hypothesis, H 0k . With the adjusted significance level, \u03b1 adj , we reject the null hypotheses, H 0k , for k = 1, 3, 4, and 5, with p-values less than 0.001. We conclude that there is nontrivial longitudinal dynamics of FA. To the best of our knowledge, this is the first attempt to carry out a formal testing for longitudinal changes in functional observations over time.\nFigure 3: Estimated time-varying coefficients \u03be ik (T ) for k = 1, 2 and 3 using REM Finally, we assess the goodness-of-fit and prediction accuracy of our final model. For the goodness-of-fit we use the in-sample integrated prediction error (IPE): IPE=\n, and Y ij (s)'s are the observed curve data. We compare our results with two other competitive approaches: Greven et al. (2010) and Chen and M\u00fcller (2012) . The square root of the in-sample IPEs are 2.31 \u00d7 10 \u22122 for our model, 2.66 \u00d7 10 \u22122 for Greven et al. (2010) , and 3.76 \u00d7 10 \u22122 for Chen and M\u00fcller (2012) . For all of three approaches we use the same mean function estimate,\u03bc(s, T ) =\u03bc 0 (s), and the same pre-specified level PVE = 0.95; for Chen and M\u00fcller (2012) we use the pre-set bandwidth h = 0.1.\nTo assess the prediction accuracy we use leave-the last-curve-out integrated prediction error:\n(s) is the predicted curve for the ith subject using the fitted model based on all the data less the m i th curve of the ith subject. Specifically, for each of 106 patients with more than one hospital visits, we remove the FA measurements taken at the last hospital visit from the dataset; the obtained dataset is used to fit the proposed model and predict the removed curve measurements. Figure 4 shows such predicted curves Y\n(s) obtained using our model and the naive model for three randomly selected subjects' FAs at their last visits. The alternative methods are Chen and M\u00fcller (2012) and the naive approach described in Section 5. The square root of the leave-the last-curve-out integrated prediction errors are 3.48 \u00d7 10 \u22122 for our model, 8.71 \u00d7 10 \u22122 for Chen and M\u00fcller (2012) , and 3.52 \u00d7 10 \u22122 for the na\u00efve approach. Surprisingly, the naive estimation has relatively good prediction performance, and better than Chen and M\u00fcller (2012) . Nevertheless these results confirm that, in this short term study of MS, there is a small variation of FAs within subjects over time. Figure 4 : Predicted values of FA for the last visits of three randomly selected subjects; actual observations (gray); predictions using our model (black solid) and using the naive approach (black dashed)"}, {"section_title": "Discussion", "text": "In this paper we propose a novel parsimonious modeling framework for repeatedly observed functional data, due to a longitudinal design. Accounting for the dependence within the subject as well as for the longitudinal design is crucial for making full prediction at future visits, or assessing the dynamics of the underlying process over time. However, current methods either ignore the dependence or are too complicated and computationally intensive.\nUsing Shiny (Chang et al., 2015) we implemented interactive plots to help visualize longitudinal functional data as well as the various components and prediction obtained using the proposed method; these tools will shortly be accessible on GitHub. R code for illustrating the procedure is publicly available at http://www4.stat.ncsu.edu/~staicu/ software/MLFD_Rcode.zip\nthe first equality is obtained by using a different way of counting the summands of \u03a3(s, s ), and the second one by multiplying and diving by D.\n, where by an abuse of notation T denotes the random variable with sampling distribution g(T ). Here we defined Take the latter problem and study first the covariance of V d and V d . We have:\nUsing Theorem 5.3 (Boos and Stefanski, 2013) , we obtain that \u03a3(s,\nas n diverges; where the latter expression is equal to \u03a3(s, s )."}, {"section_title": "Hilbert-Schmidt norm consistency", "text": ", where {e v : v \u2265 1} is any orthonormal basis. Define the sample covariance operator associated with \u03a3(s, s ) as follows:\nUnder the assumptions (A1.), (A2.), and (A4.), we have that the following sequence of ine/equalities are true:\n2 s (using Equation (2.2) from Horv\u00e1th and Kokoszka (2012, p.22 "}, {"section_title": "Proof for Theorem 2", "text": "First we show that for each k\nas n diverges.\nWe have that the following sequence of inequalities hold:\n(by Cauchy-Schwartz ineq.)\nwhere sup j,s Y i (s, T ij ) is absolutely bounded almost surely under the assumption (A6.) and \u03c6 k (\u00b7) \u2212 \u03c6 k (\u00b7) s converges to 0 as shown in Corollary 1 that is proved in the Supplementary Material. This concludes the first part of the proof.\nRecall that G k (T, T ) = cov{\u03be il (T ), \u03be ik (T )} is the true covariance. It is already shown in Yao et al. (2005) the uniform consistency of its local linear estimator, G W,k (T, T ), when G W,k (T, T ) is obtained with \u03be W,ijk 's; specifically, G W,k (T, T ) is obtained by the local linear smoothing of { G W,ik (T ij , T ij ) = \u03be W,ijk \u03be W,ij k : j = j }. Here we show a similar result when the local linear estimator is obtained with \u03be W,ijk instead of \u03be W,ijk .\nThe sample covariance of \u03be W,ijk 's is as follows: By the uniform consistency of \u03be W,ijk given in Equation (18), the local linear estimator, G k (T, T ), obtained by smoothing {(T ij , T ij ), G ik (T ij , T ij ) : i = 1, . . . , n, j = j } is asymptotically equivalent to the local linear estimator, G W,k (T, T ), obtained by smoothing G W,ik (T ij , T ij )'s. Furthermore as G W,k (T, T ) is shown to be a uniformly consistent estimator (Yao et al., 2005) , the uniform consistency of G k (T, T ) follows. Furthermore the Hilbert-Schmidt norm consistency is implied by the uniform consistency."}, {"section_title": "Proof for Conjecture 1", "text": "In the following we prove the consistency of the predicted trajectory, Y i (s, T ), for the case when \u03be W,ijk 's are uncorrelated over k. This is basis of our intuition for Conjecture 1.\nTo show the consistency of the predicted trajectory, Y i (s, T ) = \nas K diverges. Because all terms in Equation (20) are non-negative and the summation of those terms converges to 0, it is implied that each term also converges to 0 as K diverges. And by Markov inequality, E \u221e k=K+1 \nas n, K and L k 's diverge."}]