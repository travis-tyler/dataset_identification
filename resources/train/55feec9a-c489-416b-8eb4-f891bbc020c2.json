[{"section_title": "Abstract", "text": "Abstract. Real-world settings often do not allow acquisition of highresolution volumetric images for accurate morphological assessment and diagnostic. In clinical practice it is frequently common to acquire only sparse data (e.g. individual slices) for initial diagnostic decision making. Thereby, physicians rely on their prior knowledge (or mental maps) of the human anatomy to extrapolate the underlying 3D information. Accurate mental maps require years of anatomy training, which in the first instance relies on normative learning, i.e. excluding pathology. In this paper, we leverage Bayesian Deep Learning and environment mapping to generate full volumetric anatomy representations from none to a small, sparse set of slices. We evaluate proof of concept implementations based on Generative Query Networks (GQN) and Conditional BRUNO using abdominal CT and brain MRI as well as in a clinical application involving sparse, motion-corrupted MR acquisition for fetal imaging. Our approach allows to reconstruct 3D volumes from 1 to 4 tomographic slices, with a SSIM of 0.7+ and cross-correlation of 0.8+ compared to the 3D ground truth."}, {"section_title": "Introduction", "text": "Physical as well as physiological constraints on tomographic image acquisition (e.g. motion) often prohibit the acquisition of high resolution volumetric images that are commonly used for morphological examinations and diagnosis. Acquisition of high resolution images requires a fixed period of time where the patient is asked to remain still, this is often not possible in cases such as fetal imaging. Motion during this period causes scanned slices to become incoherent and corrupt. Long periods of CT scans also impose high levels of exposure to ionising radiation. Single slice or sparse acquisition can often be mentally extrapolated to a 3D mental map by experienced physicians. However, it relies on years of experience and training, thus the need to perform sparse reconstruction arises. In this paper, we address both the need to perform sparse reconstruction, as well as creating mental maps of anatomies.\nExtrapolation of 3D volumes have advantages for tracking and interventional applications. Tracking, e.g. methods such as freehand ultrasound, can benefit the sonographer greatly by providing an extrapolated 3D volume for better spatial reference. Furthermore, iterative image-based motion compensation methods needs a good initial target, which is often not possible to obtain if the subject is awake and constantly in motion during image acquisition. Thus, the need to extrapolate a full 3D volume from very sparse amount of slices is highly desirable.\nWe leverage Bayesian Deep Learning (BDL) and environment mapping to generate full volumetric anatomy representations derived from none to a few conditioning slices. In contrast to commonly used Conditional Variational AutoEncoders (C-VAE), our model leverages traditional statistical methods where the conditioning variable is not fixed or restricted. This therefore enables us to perform reconstruction of normative structures, extrapolate sparse image acquisition and create mental maps of anatomies. Contrary to previous approaches of sparse reconstruction, as detailed in the related work section below, our method can also produce probabilistic mental representations of the anatomy and anatomical context in question to aid diagnosis and therapy.\nRelated Work: Sparse reconstruction of anatomical structures has been the topic of extensive work as a method to reduce cost and, e.g., exposure to ionising radiation for patients and doctors alike. Early approaches included deformable statistical models [5] to set a prior to the reconstruction process. More recent approaches have been adopting neural networks and deep learning to perform sparse reconstruction. Cerrolaza et al. [1] uses a hierarchical C-VAE, where given three standard plane views from a 2D ultrasound scan of a fetal brain, to reconstruct the 3D segmentation mask of the fetal skull. Similarly [17] use a Convolutional Auto-Encoder to construct a shared latent space between 2D and 3D images to aid the reconstruction of a 3D image. In addition [3] perform an inter-domain sparse reconstruction as they perform segmentation of 3D volumes based on 2D sparse data inputs. In the field of natural images [2] suggested an iterative technique of refining the 3D reconstruction as the model is given more views. Finally in [12] used stereoscopic reconstruction to achieve 2D to 3D segmentation reconstruction.\nContribution: We introduce a method to generate missing slices, via BDL, by sampling from a distribution on the image manifold, which is conditioned on sparse scanned slices as context. We restructure the Conditional BRUNO [11] architecture, and train the model to learn a mental map of a specific region of interest or anatomy. The novel aspect of our work is that conditional image generation is not achieved by commonly used C-VAE architectures, but instead through Normalising Flows [14] and statistical modelling such as Student's tprocess. This is applied to generate patient specific dense medical volumes, and evaluated on three different data-sets. To generate patient specific dense medical volumes, we query the model by performing a dense sweep of all possible pose positions, while conditioning the model on sparsely sampled context slices from the patient. The method is evaluated on three data-sets and we demonstrate its application for motion correction in fetal brain MRI.\nBackground: Generative Models are used to model probabilistic distributions, p(x), of a data-set, X, such that x \u2208 X in some high-dimensional space X . The model can then be used to generate new samples, such as images, that follows the same probabilistic distribution. New samples are seeded by a latent variable, a vector often denoted z in some high-dimensional space Z, and are sampled according to some Probability Density Function (PDF) p(z). Given a fixed deterministic function, f (z; \u03b8), parameterised by \u03b8 in some high-dimensional space \u0398 and f : Z \u00d7 \u0398 \u2192 X , the aim is to optimise \u03b8 such that samples of z from p(z), and subsequently f (z; \u03b8), will be similar to x with high probability. Formally, this can then be written as:\nThe most commonly used distribution, also known as the prior, for the latent space is a Gaussian, with a mean of zero and unit variance (N (0, 1) ). An important component of the modelling process is defining a bijector, which is an invertible fixed transformation function that maps one data space to another. f , defined above, can be used to map the complex distribution of the input data space to the z latent space. The distribution of modelled image space can then be written as: X \u223c N (f (z; \u03b8), \u03c3 2 I). As the probability integral is highdimensional and complex, a neural network can be used to learn f . Therefore it is possible to use gradient descent (or any other optimisation technique) to perform max \u03b8 i log(p \u03b8 (x i )), which aims to find an optimal set of parameters \u03b8, for the fixed deterministic function f (z; \u03b8).\nSuch mappings can be achieved through methods such as Variational AutoEncoders (VAEs) [10] or Generative Adversarial Networks (GANs) [7] . The encoder and decoder component of the VAE models the forward and inverse of the bijector function, but are learned separately. In GANs, only the fixed function from latent z space to data space is learned. RealNVP [4] and Masked Autoregressive Flow (MAF) [13] , however, are bijectors that are fully invertible. The same weights are used for both forward and inverse transformations.\nConditional Generative Models, such as C-VAEs [16] , Generative Query Network (GQN) [6] , or BRUNO [11] , generate new samples based on a predefined condition such that for each possible value of c there exists a p(z); p(x|c) = p \u03b8 (x|z)p \u03b8 (z, c)dz. For this particular task, c is a set of images that are sparsely acquired, and is not bound by quantity. This requires the set of images in the condition being exchangeable, i.e. the joint probability is invariant to permutation of the images. For any permutation, \u03c0; p(x 1 , x 2 , ..., x n ) = p(x \u03c01 , x \u03c02 , ..., x \u03c0n ). Random variables are often independent and identically distributed (iid), and iid random variables are always infinitely exchangeable. However, the converse is not always true, an infinitely exchangeable sequence is not necessarily iid. Bruno de Finetti's theorem therefore states 'a sequence of random variables (x 1 , x 2 , ..., x n ) is infinitely exchangeable iff for all n; p(\nThe stochastic process is then defined; p(x n |x 1:n\u22121 ) = p \u03b8 (x n |z)p \u03b8 (z|x 1:n\u22121 )dz."}, {"section_title": "Method", "text": "In the proposed framework, the Conditional BRUNO architecture is restructured and trained to build mental maps of medical volumes using 2D slices, x, with their corresponding pose parameter, v, that represents the slice's location in 3D space. Similar to a GQN, the data-set is of the form D = {(x k n , v k n )}, where n \u2208 {1, 2, ..., N } and k \u2208 {1, 2, ..., K}. N is the number of high resolution 3D volumes and K is the number of 2D axial slices of the volumes. During training, can be any sample from the observed anatomy in contrast to defined samples in, e.g., C-VAEs.\nM random image-pose pairs, are sampled from a particular volume. Each m \u2208 M is a particular observation, with the collective being denoted as a sequence. M \u2212 1 observations from the sequence are used as contexts, with the remaining image-pose pair being used as the query pose and target image.\nEach individual context (i.e. image-pose pair) in a sequence is passed through a Conditional RealNVP [4] , which is the bijector of the model. The affine coupling layer uses Convolutional Neural Networks (CNN), and learns the mapping of the input image distribution to a Gaussian prior. The mapping is conditioned on the pose, and is made possible by augmenting the input image with the pose vector as an additional input variable. This CNN can be of any structure, for simplicity, a simplified ResNet was used. As the RealNVP component is trained on a Gaussian prior, the output variables should therefore be Gaussian distributed. This can then be modelled by classical statistical methods such as Student's t-distribution, T P. To achieve exchangability, i.e. the conditioning context set is invariant to the number and order of the contexts, a na\u00efve approach would be to simply perform sum/average operation similar to [18] . Alternatively, a Recurrent Neural Network (RNN) update scheme [11] , can also be used, where the covariance matrix of the conditional image set is made to be simple (i.e. the diagonal is parameterised by \u00b5, with upper and lower triangle parameterised by \u03c3), each image therefore has an identical mean and variance to one other.\nDuring testing, the number of context image-pose pairs is not required to be the same as the number as used during training, due to the property of exchangeability. Intuitively speaking, as more context images are supplied, the predicted image should look more similar to the target image. Contexts are first passed through the RNN to set up the distribution at the condition by updating the mean and variance, from which the samples can then be drawn. Each sample, drawn from this distribution, is then passed though the inverse Conditional RealNVP, whilst being conditioned on the query pose.\nTo create a dense 3D volume from very sparsely sampled 2D slices, a trained BRUNO model is queried with a dense sweep of all possible pose positions within the same Field-of-View (FoV) as training. The sparse sampled 2D slices, along with the corresponding pose, are therefore supplied as contexts for the model. Multiple samples can then be drawn from the trained distribution as possible hallucinations of the missing slice. Alternatively, it is also possible to take the mean image (i.e. average of infinite samples). With no contexts supplied, samples are drawn from the prior distribution. This can be used to create organ and/or volume atlases and for manual model validation, as the trained distribution is an average of all training volumes. Patient specific missing slices and extrapolated anatomy can be generated if context images are supplied. Samples are then drawn from the posterior as the distribution is conditioned on the contexts."}, {"section_title": "Experiments and Results", "text": "To validate the trained model, high resolution 3D volumes from the test set are decomposed into individual 2D slices with their corresponding one-hot pose vector. A sparse set of slices (between 1 to 10) are used as contexts. The model is then queried with the pose vectors, the generated slices are then compared to the target image using Cross-Correlation (CC) and Structural Similarity Index (SSIM). CC measures the similarity of pixel-wise intensities, whereas SSIM uses a combination luminance, contrast and structure to assess the image quality.\nThe first set of experiments used brain MRI and thorax CT images. 85 healthy brains were selected from the Alzheimer's Disease Neuroimaging Initiative (ADNI) database. These were split 70 for training and 15 for validation, with K = 120 axial slices extracted from the middle 75% portion of the brain. The CT images were split 50 for training and 8 for validation, with K = 100 axial slices extracted from the middle 50% portion of the scan volume. Both data-sets are isotropic with spacing of 1mm \u00d7 1mm \u00d7 1mm. Each 2D slice, x, are of size 218 \u00d7 218 for MRI brain and 200 \u00d7 200 for CT thorax, and are further down-sampled to 64 \u00d7 64. An additional isotropic fetal brain MRI data-set, with spacing of 1mm \u00d7 1mm \u00d7 1mm, was used for Initial Experiments and Exp2. 270 brains ranging from 40 to 43 Gestational Age (GA) were selected; split 250 for training and 20 for testing. K = 80 axial slices were then extracted from the middle 65% of the brain, each 2D slice of size 160 \u00d7 160 is further down-sampled to 64 \u00d7 64 for training and inference.\nThe pose is formulated as one-hot vector of length K, to represent the slice number of the scan stack. For all experiments, M = 9; a sequence of eight imagepose pairs are used as context, with the 1 remaining as query pose and target image. Contexts are randomly sampled from the entire stack during training phase. However, during testing, the contexts are strategically selected so that they cover an approximate even distribution across the scan stack. For each query pose, 100 samples were drawn from the posterior distribution and compared to the target image using SSIM and Cross-Correlation. An average is then taken across all slices for a volume average, and further averaged across all test subjects."}, {"section_title": "Initial Experiments", "text": "To compare with existing baseline models, GQN and C-VAE architectures were used to build mental maps using the Fetal brain data-set. Both GQN and C-VAE models have been trained with 4 context image-pose pairs. As official code for the Generative Query Network have not been published, a reputable public reimplementation [8] was used instead. The implementation has been validated to be correctly functioning, as it has been successfully tested on several, but simple, official GQN data-sets. Performance however was not able to match the results published by DeepMind, as the architecture for the DRAW-LSTM was not disclosed. Only the baseline architecture was used.\nA na\u00efve Conditional Variational AutoEncoder was also implemented as a baseline. The architecture follows the structure of a standard U-Net [15] , but without skip connections, and with 4 scaled resolutions and 2 convolutional layers at each resolution. It has also been formulated such that the input is a pose vector, the condition is a set of encoded context images, and the output is the generated image. Contexts are first passed through a tower encoder network, same as the GQN, to encode each image-pose pair in latent representation. All Contexts are then averaged together in latent space to maintain order invariance. During inference, the latent vector z is sampled from a unit Gaussian distribution to feed the generator whilst being conditioned on contexts as well as queried pose.\nBoth models were not able to achieve satisifiable results, as seen in Figure 2 . Due to the complex nature of the brain structure, the GQN model was not able to generalise, and predicted static for all slices. The generated images by the C-VAE model seem to resemble an average of all input context slices with variational noise on top. The experiments also shown that the models do not easily converge, as the latent distribution is far from the prior distribution as measured by the KL divergence. This is notably evident with the GQN, where the KL divergence in the generator module is often very high. Images generated by either method are corrupt."}, {"section_title": "Exp1: ADNI MRI and Thorax CT", "text": "The first set of experiments were used to evaluate the performance of the BRUNO architecture. Tables 3a and 3b shows the average SSIM and Cross-Correlation of the generated dense sampled volume compared to the original high resolution volume across all test subjects. 4 experiments were ran with increasing number of contexts; 1, 3, 5 and 9. The contexts selected are sparsely spread to maximise the coverage across the dense volume. In Table 3a and 3b it can be seen that as the number of contexts increases, the reconstructed volume becomes closer to the ground truth volume in similarity. Figure 3c shows the average SSIM of each slice across all test subjects for ADNI and Thorax data-sets. A distinct peak in SSIM is perceivable where a query slice aligns with a supplied context slice. This confirms the notion that conditional contexts correctly steer the posterior to a particular part of the distribution. High SSIM for ADNI 0 to 20 and 100 to 120 are the edge cases, where a majority of the content are background. The inverse is the case for thorax, where slices approaching top and bottom have high variability in structure, thus reducing the SSIM."}, {"section_title": "Context Images", "text": ""}, {"section_title": "Exp2: Fetal Brain Template Volume", "text": "The second set of experiments has evaluated the usefulness of the proposed approach for fetal MRI reconstruction: State-of-the-art iterative image-based reconstruction methods, e.g. Slice-to-Volume Reconstruction (SVR) [9] , often require a good initialisation volume for the initial target registration. In clinical setting, especially in fetal MRI, volumes are often motion corrupted if the fetus is awake and constantly moving during image acquisition. Neighbouring slices of the volumes are therefore incoherent and in disarray. In this experiment, BRUNO is used to create the initial registration target volume for 2D to 3D fetal brain reconstruction. During fetal MRI, a few images are often acquired in parallel (usually four, spatially far apart images, at once). These image batches can be used as conditional contexts for BRUNO. Due to fast parallel acquisition, the slices can be assumed to be aligned and motion free.\nAs with the first set of experiments, the performance of BRUNO is evaluated with varying context slices. In total, there are 80 slices in the dense fetal brain volume. Table 4a below shows the number of contexts, with the corresponding slice numbers, that is used during inference. Table 4b shows the SSIM and CC of average reconstructed SVR initialisation volumes. Like as in the first experiments, as the number of context images increase, the average SSIM and Cross-Correlation increases. Distinct peaks in SSIM are also present where a query slice approaches a supplied context slice."}, {"section_title": "Number of Contexts", "text": "Slice Number, k (K = 80) Fetuses can move up to 20mm [9] when active. For SVR, a Gaussian average is taken of all acquired stacks to be used as the initial registration target. If motion is too severe this initialisation volume will not be sufficient for subsequent iterative reconstruction. To simulate motion, high resolution reconstructed volumes are synthetically motion corrupted to be used as a base line. Three orthogonal stacks are made with 10mm of random motion in translation only. On average, the SSIM of Gaussian averaged volumes motion corrupted volumes compared to the original high resolution volume is 0.297. Depending on the robustness of the SVR algorithm used, reconstruction may, or may not, be possible. A BRUNO generated volume is made by densely and repeatedly sampling all possible pose positions, with the final volume being an average of all sampled slices. Only four context images are used. The generated volume was able to achieve an SSIM of 0.679 compared to the original high resolution volume, this is shown in Figure 6 . . For motion compensation of fetal and neonatal MRI, averaged template volumes (a) from all acquired slices (several 100) are used to initialise SVR [9] . Only four images were used (b) from an image batch that has been acquired in parallel, (common in fetal and neonatal MRI, i.e. without motion corruption between the four images). A C-VAE is not able to predict a template volume from these four images (c), while our approach using BRUNO predicts a reasonable volume (d) compared to the ground truth (e)."}, {"section_title": "Conclusion and Discussion", "text": "This paper introduces the idea of using Deep Neural Networks and Bayesian Deep Learning to build mental maps of anatomy of various medical volumes. A conditional generative model, based on the BRUNO architecture, is trained on existing high resolution 3D volumes. It can be used to create patient specific volumes by densely querying all possible pose positions, whilst conditioned by a few existing slices that are used as contexts. Exp1 shows that BRUNO is able to reconstruct MRI brain volumes with an SSIM of 0.7 and Thorax volumes with an SSIM of 0.8 compared to the original high resolution ground truth. Exp2 shows a specific use case for BRUNO to generate initial target volumes for 2D to 3D fetal brain MRI reconstruction. Future work will be to investigate further into the framework, and improve image quality generation as well as to introduce more Degrees-of-Freedom (DoF). In the current implementation, BRUNO is able to successfully traverse single DoF, and is applicable for use cases such CT and MRI. Increased DoF, with added rotations and translations, can be particularly valuable for modalities such as freehand ultrasound, with applications for Reinforcement Learning and 3D scene exploration."}]