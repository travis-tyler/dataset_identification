[{"section_title": "Abstract", "text": "The desire to train complex machine learning algorithms and to increase the statistical power in association studies drives neuroimaging research to use ever-larger datasets. The most obvious way to increase sample size is by pooling scans from independent studies. However, simple pooling is often ill-advised as selection, measurement, and confounding biases may creep in and yield spurious correlations. In this work, we combine 35,320 magnetic resonance images of the brain from 17 studies to examine bias in neuroimaging. In the first experiment, Name That Dataset, we provide empirical evidence for the presence of bias by showing that scans can be correctly assigned to their respective dataset with 71.5% accuracy. Given such evidence, we take a closer look at confounding bias, which is often viewed as the main shortcoming in observational studies. In practice, we neither know all potential confounders nor do we have data on them. Hence, we model confounders as unknown, latent variables. Kolmogorov complexity is then used to decide whether the confounded or the causal model provides the simplest factorization of the graphical model. Finally, we present methods for dataset harmonization and study their ability to remove bias in imaging features. In particular, we propose an extension of the recently introduced ComBat algorithm to control for global variation across image features, inspired by adjusting for population stratification in genetics. Our results demonstrate that harmonization can reduce dataset-specific information in image features. Further, confounding bias can be reduced and even turned into a causal relationship. However, harmonziation also requires caution as it can easily remove relevant subject-specific information."}, {"section_title": "Introduction", "text": "Is it possible to predict the dataset that a brain scan is coming from based on image-derived measures like volume or thickness? Initially, we may guess that it should be impossible. On second thought, we may notice that it depends on the datasets we are comparing. If one dataset only contains adolescent subjects and another one only * Corresponding Author.\nAddress: Waltherstr. 23, 81369 M\u00fcnchen, Germany; Email: christian.wachinger@med.unimuenchen.de * * Data used in preparation of this article were obtained from the Alzheimer's Disease Neuroimaging Initiative (ADNI) database (adni.loni.usc.edu) . As such, the investigators within the ADNI contributed to the design and implementation of ADNI and/or provided data but did not participate in analysis or writing of this report. A complete listing of ADNI investigators can be found at: http://adni.loni.usc.edu/wp-content/uploads/how_ to_apply/ADNI_Acknowledgement_List.pdf Data used in the preparation of this article was obtained from the Australian Imaging Biomarkers and Lifestyle flagship study of ageing (AIBL) funded by the Commonwealth Scientific and Industrial Research Organisation (CSIRO) which was made available at the ADNI database (www.loni.usc.edu/ADNI). The AIBL researchers contributed data but did not participate in analysis or writing of this report. AIBL researchers are listed at www.aibl.csiro.au. subjects older than 60 years of age, it should be possible to distinguish them due to the association of imagederived measures with age. But next to demographics, are there unique signatures in each dataset that would facilitate identifying the source of an image? We will demonstrate that the source dataset can indeed be identified with much higher accuracy than would be expected from basic demographics of the participants. Hence, not only subject-specific, but also imaging site-specific information is implicitly encoded. This is insofar surprising as we are working with image-derived measures, which should only relate to the underlying neuroanatomy of the subject and not to the imaging site, where the scan was acquired.\nColloquially, this phenomenon is referred to as dataset bias. In statistics, bias refers to a systemic deviation from the true, possibly unknown, underlying quantitative parameter that is being estimated. In a typical neuroimaging study, various types of bias can be present that can alter the conclusions one deduces from this study. In the first step, individuals have to be enrolled into the study. If subjects do not faithfully represent the overall population one wants to study, i.e., one obtains a non-random sample of a population, conclusions will be biased. This is referred to as selection bias. For instance, selection bias is present if the study recruits particular target groups, e.g., young adults or patients with a particular disease. While such a selection may be related to the study objective and therefore done on purpose, there are also hidden, unintended factors like the over-representation of more educated participants (Smith and Nichols, 2018 ) that would yield biased estimates with respect to the overall population.\nAfter enrollment, subjects will undergo magnetic resonance imaging. Prior studies on inter-scanner variability have already noted that there is a strong dependence of the acquired image on magnetic field strength, manufacturer, gradients, pulse sequences and head positioning (Jovicich et al., 2009) . While standardization efforts are undertaken for instance by the ADNI (Jack et al., 2008) , variations related to the scanner remain (Kruggel et al., 2010) , and it is even questionable if a further standardization is in the manufacturer's interest. Even when assuming a faithful image reconstruction, scans often undergo various image analysis steps to derive summary statistics that depend on the algorithm being used. The choice of segmentation and registration algorithms can cause varying results, also subject to the input, potentially affected by motion artifacts, voxel sizes, and image noise. Therefore, neuroimaging data is unavoidably subject to various types of measurement biases.\nOnce data has been collected and processed, usually image-derived measures are related to disease status or outcomes of a neurocognitive test to determine which brain structures are responsible for the observed outcome. It is important to remember that, in general, regression analysis can only establish correlation, but not causation. Association, unlike causation, is a symmetric relationship: two variables X and Y are associated, regardless of whether X causes Y , or Y causes X. Only under exchangeability, correlation implies causation (Hernan and Robins, 2020) . A common violation of exchangeability is the presence of confounding. For example, consider you want to study causes of Alzheimer's disease (AD). Analyses of the data show a high correlation between gray hair and AD, which may na\u00efvly lead to the conclusion that gray hair causes AD. However, the observed correlation between gray hair and AD is only due to a person's age. Therefore, the association between gray hair and AD is confounded by the common cause age. This form of bias is known as confounding bias.\nDataset bias is becoming pivotal as neuroimaging is joining the ranks of a \"big data\" science with more and larger datasets becoming available (Smith and Nichols, 2018) . Large sample sizes are required for a number of applications in neuroimaging, such as association studies in imaging-genetics, or training complex machine learning models -in particular in deep learning. As outlined above, sources of bias are plentiful and depend on the research question and the data that is used to answer it. For this reason, neuroimaging data is usually collected with a particular research question in mind, and inclusion crite- ria are tailored to answering this particular question as unbiased as possible, e.g., by randomization or collecting information on possible confounders. Therefore, pooling data from studies that have been designed with different research questions in mind, will likely lead to bias in a machine learning model trained on this data. In contrast, if a model would be truly unbiased on a population level, it would naturally generalize to other datasets.\nIn this article, we study bias in neuroimaging data. To this end, we combine data from 17 large-scale studies, presented in section 2. First, we propose Name That Dataset, i.e., the prediction of the dataset that a scan is part of, as an experiment to detect inter-dataset bias in section 3. Second, we take a closer look at confounding bias in section 4 and present a method for distinguishing between causal and confounded statistical relationships in a single dataset using causal inference. As we do not know all potential confounders, we work with a model that assumes an unobserved confounding variable. Third, we discuss methods for dataset harmonization as a means of reducing bias in the data in section 5 and present an extension that accounts for global variation across features. Finally, we present results for dataset prediction on harmonized data, brain age prediction with harmonization, and the impact of harmonization on two causal models in section 6. An earlier version of this work has been presented at a conference (Wachinger et al., 2019) and is extended in this article with more datasets, details, experiments, and the addition of harmonization. "}, {"section_title": "Neuroimaging Data", "text": "We work on MRI T1 brain scans from 17 large-scale public datasets:"}, {"section_title": "Adolescent", "text": "Brain Cognitive Development (ABCD) (Casey et al., 2018) , 2. Autism Brain Imaging Data Exchange (ABIDE) I+II (Di Martino et al., 2014) , 3. Attention Deficit Hyperactivity Disorder (ADHD200) (Milham et al., 2012) , 4. Alzheimer's Disease Neurimaging Initiatie (ADNI) (Jack et al., 2008) (for up-to-date information, see www.adni-info.org), 5. Australian Imaging Biomarkers and Lifestyle Study of Ageing (AIBL) (Ellis et al., 2009 ), 6. Center for Biomedical Research Excellence (CO-BRE) (Mayer et al., 2013) , 7. Consortium for Reliability and Reproducibility (CORR) (Zuo et al., 2014) , 8. Genomic Superstruct Project (GSP) (Buckner et al., 2012) , 9. Healthy Brain Network (HBN) (Alexander et al., 2017) , 10. Human Connectome Project (HCP) (Van Essen et al., 2013) , 11. IXI Dataset, 1 12. Open Access Series of Imaging Studies (OASIS) crosssectional sample (Marcus et al., 2007) , 13. MIND Clinical Imaging Consortium (MCIC) schizophrenia sample (Gollub et al., 2013) , 1 http://brain-development.org/ixi-dataset/ 14. Nathan Kline Institute -Rockland Sample (NKI) (Nooner et al., 2012) , 15. Parkinson Progression Marker Initiative (PPMI) (Marek et al., 2011), 16 . UK Biobank Imaging (UKB) (Miller et al., 2016) .\nAll datasets were processed with FreeSurfer (Fischl et al., 2002) version 5.3. We keep only one scan per subject from longitudinal or test-retest datasets. After exclusion of scans with processing errors and incomplete meta-data, scans from 35,320 subjects remained. Fig. 1 illustrates the age distribution per dataset together with the number of sites. Table 1 presents an overview of demographics per dataset. The ABCD and UKB datasets stand out as the largest datasets, which introduces a sever class imbalance for the dataset prediction experiment in section 3. Hence, we downsampled ACBD and UKB data to obtain a sample size close to the next largest datasets. We preserved the heterogeneity of the datasets by ensuring that all imaging sites are included in the subset. For UKB, we marked subjects with psychiatric diseases and cancer in the head as diseased. For ABCD, the diagnostic information is highly complex as mental health of adolescents is investigated in general, so that we have not encoded it for this study."}, {"section_title": "Name That Dataset", "text": "In order to detect the impact of dataset bias, we play the game Name That Dataset on neuroimaing data that was originally proposed by Torralba and Efros (2011) on natural images. The task is to predict the dataset D an MRI scan is coming from solely based on image-derived measures Y , where we use volume and thickness. A random forest classifier is trained for the prediction Y \u2192 D, where we use default settings from the R package by Liaw et al. (2002) . 2 If dataset bias would be absent, we would expect a prediction accuracy close to random chance, which would be 5.9% for 17 datasets; taking unequal dataset sizes into account, it would be 7.8%. As additional reference, we report the results of a classifier trained on age and sex alone, which can achieve higher accuracy than random chance as datasets focus on specific parts of the population. In the experiments, we split data into training and testing sets with stratified sampling by dataset to ensure that each dataset is accordingly represented. Fig. 2 illustrates the performance for classifying images into one of 17 datasets from volume and thickness measures, and their combination. We mainly report results on healthy controls to exclude disease-specific effects that could potentially ease classification; for the combination of volume and thickness we also show results for including diseased subjects, indicated as '(w/ Disease)'. In this experiment, we vary the amount of training data from 0.1% to 70%. The classification accuracy widely improves as the training set increases, particularly for the image features. The highest accuracy of 71.5% is achieved by the combination of volume and thickness measures, which perform better than each of them alone. Except for the 0.1% training set size, volumes have a higher accuracy than thickness measures; for 70% training, the difference in accuracy is 7.9%. The accuracy after the inclusion of diseased patients 2 500 trees, mtry is square root of number of variables is slightly lower compared to healthy subjects, as shown for the combination of volume and thickness. The classifier with age and sex reaches 37.9% accuracy, which is well above random and therefore hints at selection bias. Yet, compared to over 70% accuracy for image features, there must be another source of bias that cannot be explained by basic demographics, such as measurement and confounding bias.\nFrom the confusion matrix in Fig. 2 , the high classification accuracy (diagonal elements) indicates that datasets possess unique, identifiable characteristics. In addition, we can see that datasets with a similar population result in higher confusion, e.g., between ABCD, ABIDE I+II, and ADHD200. Single-site datasets, like HCP, that have strict inclusion criteria and imaging protocols show almost no confusion with any of the other datasets. In contrast, multi-site datasets like CORR that also cover a wide age range, show high confusion with other datasets. Also for UKB, with its large size and age distribution, we observe confusion with other datasets, although scans were only acquired at two sites with the same scanner.\nThe lesson learned from this experiment is that even when working with image-derived values that represent physical measures (volume, thickness), substantial bias in datasets remains, despite techniques like atlas renormalization (Han and Fischl, 2007) were employed to improve consistency across scanners. Of course, much of the bias can be attributed to the different goals of the studies, like the inclusion of subjects from different age groups. However, even when focusing on datasets that cover a similar X < l a t e x i t s h a 1 _ b a s e 6 4 = \" D G u E t W 1 B Z y 2 y U p N h O B Q s K R M t P z M = \" > A A A C 6 n i c b V J N j 9 M w E H X D 1 7 J 8 7 c K R S 0 S F x G m T o E X A b Q U c O C 6 I b i u 1 1 c p x p o l V f 0 T 2 e F d V 1 L / A g Q s g r v w g r v w b p t k c N i 0 j W X p + 8 2 y / G U 9 e K + k x T f 8 O o h s 3 b 9 2 + s 3 d 3 / 9 7 9 B w 8 f H R w + P v M 2 O A E j Y Z V 1 k 5 x 7 U N L A C C U q m N Q O u M 4 V j P P l + 0 1 + f A H O S 2 u + 4 K q G u e a l k Q s p O G 6 o W Z 5 P z g + G 6 V H a R r w L s g 4 M W R e n 5 4 e D P 7 P C i q D B o F D c + 2 m W 1 j h v u E M p F K z 3 Z 8 F D z c W S l z A l a L g G P 2 9 a s + v\nx c U H A p C 7 L Q U I v e g u 5 r l C w r 7 G t e b W u E l k V f k r W S a w Z 0 U C i d v S S 2 r a d J R p 5 M J q J y N B K S m + R D 1 3 + f j K 1 b J p + h t o 4 2 m i q z / b u 4 K i 1 V W + k d u v Y Q 6 B 9 t A W u a g W z 7 x 3 f B 2 c u j j P C n 4 + H J u 2 4 a 9 t h T 9 o y 9 Y B l 7 z U 7 Y R 3 b K R k y w i n 1 l 3 9 m P S E X f o p / R r y t p N O j O P G G 9 i H 7 / A 1 8 K 8 l g = < / l a t e x i t > < l a t e x i t s h a 1 _ b a s e 6 4 = \" D G u E t W 1 B Z y 2 y U p N h O B Q s K R M t P z M = \" > A A A C 6 n i c b V J N j 9 M w E H X D 1 7 J 8 7 c K R S 0 S F x G m T o E X A b Q U c O C 6 I b i u 1 1 c p x p o l V f 0 T 2 e F d V 1 L / A g Q s g r v w g r v w b p t k c N i 0 j W X p + 8 2 y / G U 9 e K + k x T f 8 O o h s 3 b 9 2 + s 3 d 3 / 9 7 9 B w 8 f H R w + P v M 2 O A E j Y Z V 1 k 5 x 7 U N L A C C U q m N Q O u M 4 V j P P l + 0 1 + f A H O S 2 u + 4 K q G u e a l k Q s p O G 6 o W Z 5 P z g + G 6 V H a R r w L s g 4 M W R e n 5 4 e D P 7 P C i q D B o F D c + 2 m W 1 j h v u E M p F K z 3 Z 8 F D z c W S l z A l a L g G P 2 9 a s + v\nx c U H A p C 7 L Q U I v e g u 5 r l C w r 7 G t e b W u E l k V f k r W S a w Z 0 U C i d v S S 2 r a d J R p 5 M J q J y N B K S m + R D 1 3 + f j K 1 b J p + h t o 4 2 m i q z / b u 4 K i 1 V W + k d u v Y Q 6 B 9 t A W u a g W z 7 x 3 f B 2 c u j j P C n 4 + H J u 2 4 a 9 t h T 9 o y 9 Y B l 7 z U 7 Y R 3 b K R k y w i n 1 l 3 9 m P S E X f o p / R r y t p N O j O P G G 9 i H 7 / A 1 8 K 8 l g = < / l a t e x i t > < l a t e x i t s h a 1 _ b a s e 6 4 = \" D G u E t W 1 B Z y 2 y U p N h O B Q s K R M t P z M = \" > A A A C 6 n i c b V J N j 9 M w E H X D 1 7 J 8 7 c K R S 0 S F x G m T o E X A b Q U c O C 6 I b i u 1 1 c p x p o l V f 0 T 2 e F d V 1 L / A g Q s g r v w g r v w b p t k c N i 0 j W X p + 8 2 y / G U 9 e K + k x T f 8 O o h s 3 b 9 2 + s 3 d 3 / 9 7 9 B w 8 f H R w + P v M 2 O A E j Y Z V 1 k 5 x 7 U N L A C C U q m N Q O u M 4 V j P P l + 0 1 + f A H O S 2 u + 4 K q G u e a l k Q s p O G 6 o W Z 5 P z g + G 6 V H a R r w L s g 4 M W R e n 5 4 e D P 7 P C i q D B o F D c + 2 m W 1 j h v u E M p F K z 3 Z 8 F D z c W S l z A l a L g G P 2 9 a s + v\nx c U H A p C 7 L Q U I v e g u 5 r l C w r 7 G t e b W u E l k V f k r W S a w Z 0 U C i d v S S 2 r a d J R p 5 M J q J y N B K S m + R D 1 3 + f j K 1 b J p + h t o 4 2 m i q z / b u 4 K i 1 V W + k d u v Y Q 6 B 9 t A W u a g W z 7 x 3 f B 2 c u j j P C n 4 + H J u 2 4 a 9 t h T 9 o y 9 Y B l 7 z U 7 Y R 3 b K R k y w i n 1 l 3 9 m P S E X f o p / R r y t p N O j O P G G 9 i H 7 / A 1 8 K 8 l g = < / l a t e x i t > < l a t e x i t s h a 1 _ b a s e 6 4 = \" d j G g 4 r O o s X 4 p X I x I l 4 L z 6 K M z E S U h T i q / g e l d G 3 6 E f 0 8 0 Y Y D T Y n n o l e R L / + A g E s 7 0 A = < / l a t e x i t > < l a t e x i t s h a 1 _ b a s e 6 4 = \" T c a d j c R k 4 b x X X 1 l 5 U M / f R X H U j v 8 = \" > A A A C 6 n i c b V J N b x M x E H W W r 1 K + W j h y W V E h c e r u I l X A D Q k O H A s i T a Q k q m z v Z N e K P 1 b 2 u F W 0 y l / g w A U Q V 3 4 Q V / 4 N k 2 0 k u g k j W X p + 8 2 y / G Y 9 o t A q Y 5 3 8 G y Y 2 b t 2 7 f 2 b u 7 f + / + g 4 e P D g 4 f n w U X v Y S h d N r 5 s e A B t L I w R I U a x o 0 H b o S G k V i 8 W + d H F + C D c v Y z L h u Y G V 5 Z N V e S 4 5 q a C j E + P z j K j / M u 0 l 1 Q b M A R 2 8 T p + e H g 9 7 R 0 M h q w K D U P Y V L k D c 5 a 7 l F J D a v 9 a Q z Q c L n g F U w I W m 4 g z N r O 7 C p 9 T k y Z z p 2 n Z T H t 2 O s n W m 5 C W B p B S s O x D t u 5 N f m / 3 C T i / P W s V b a J C F Z e P T S P O k W X r i t P S + V B o l 4 S 4 N I r 8 p r K m n s u k f r T e 0 U 4 t 0 A u A l U S g F p q K 6 z b a Q 3 8 Y u m j h k t V k o W W W v Q G T F + j V V V j X 3 O y r Z F G l X 1 J 0 U m u G T B R o / L u k t i u n j Y b B j K Z y d r T S C h u s / e b / o d s 5 P w i + w S N 8 7 Q x V J n r 3 8 V 1 5 a j a 2 u z Q T Y B I / + h K W N E M F N s / v g v O X h 4 X h D / + G w a 2 x 5 6 y Z + w F K 9 g r 9 p Z 9 Y K d s y C S r 2 R f 2 j X 1 P d P I 1 + Z H 8 v J I m g 8 2 Z J 6 w X y a + / N n D x 0 g = = < / l a t e x i t > < l a t e x i t s h a 1 _ b a s e 6 4 = \" T c a d j c R k 4 b x X X 1 l 5 U M / f R X H U j v 8 = \" > A \nx 3 f B 2 c u j j P C n 4 + H J u 2 4 a 9 t h T 9 o y 9 Y B l 7 z U 7 Y R 3 b K R k y w i n 1 l 3 9 m P S E X f o p / R r y t p N O j O P G G 9 i H 7 / A 1 8 K 8 l g = < / l a t e x i t > < l a t e x i t s h a 1 _ b a s e 6 4 = \" \nx 5 6 y Z + w F K 9 g r 9 p Z 9 Y K d s y C S r 2 R f 2 j X 1 P d P I 1 + Z H 8 v J I m g 8 2 Z J 6 w X y a + / N n D x 0 g = = < / l a t e x i t > < l a t e x i t s h a 1 _ b a s e 6 4 = \" T c a d j c R k 4 b x X X 1 l 5 age range, we observe a high accuracy, e.g., ABIDE I and II. While we are not aware of previous attempts to Name That Dataset, our results echo concerns raised in previous studies. In an ENIGMA study with over 15,000 subjects on brain asymmetry (Guadalupe et al., 2017) , it was reported that dataset heterogeneity explained over 10% of the total observed variance per structure. In ADNI, which has an optimized MPRAGE imaging protocol across all sites (Jack et al., 2008) , the intra-subject variability of compartment volumes for scans on different scanners was roughly 10 times higher than repeated scans on the same scanner (Kruggel et al., 2010) . Similarly, Wachinger and Reuter (2016) reported a drop in accuracy for Alzheimer's disease prediction when training and testing on different datasets.\nIn one of the largest studies to date, we have examined bias across 17 neuroimaging datasets. Our experiments for Name That Dataset demonstrated that the dataset can be predicted with more than 70% accuracy. In comparison, a classifier that operates on age and sex stays below 38%. This is evidence that image features contain, next to subject-specific information, also rich dataset-specific information. While we are not aware of previous work on predicting the dataset from neuroimaging data, prior studies have reported the high intra-subject variability across scanners, no matter whether FreeSurfer (Jovicich et al., 2009) , FSL (Nugent et al., 2013; Suckling et al., 2012) , or BrainVisa (Shokouhi et al., 2011) were used for segmentation, which is also pointing to scanner-specific information in the data.\nInstead of predicting the dataset, a similar experiment would be to predict manufacturer or magnetic field strength of a scan. We believe that dataset prediction offers two advantages. First, there is a severe class imbalance with almost 80% of scans acquired on a Siemens scanner and 84% on 3.0T, yielding already high classification accuracies with na\u00efve approaches. Second, there are more nonbiological effects than just manufacturer and field strength that impact a scan; by using the dataset as label, we can lump them all together, without explicitly knowing them. However, we also need to account for biological variation between datasets, which could be considered as a lower bound for the classification accuracy, as we would like to retain this information. In our experiments, we used the classification on the variables age and sex for this purpose. Another alternative to Name That Dataset would be to Name That Imaging Site. With 210 sites in our data, this would substantially increase the complexity of the classification task and complicate the interpretation of results with the confusion matrix. In addition, there is a wide variation in the size of sites, ranging from a few subjects per site to more than 1,000 for HCP. Hence, Name That Dataset is the most reasonable choice in our experiments, but operating on sites could be an attractive alternative in other situations."}, {"section_title": "Telling Causal from Confounded with Causal Inference", "text": "In the previous section, we have established that there is correlation between a feature vector y, derived from MRI scans, and the dataset D the scan belongs to, by estimating the probability P (D = d | Y = y) via a random forest classifier. While this has yielded useful insights, it only provides a measure of statistical dependence, which alone is insufficient to determine causal structures of confounding bias."}, {"section_title": "Confounding Bias in Causal Inference", "text": "Here, we want to study bias in a more principal manner by looking at confounding bias in a causal inference framework. Generally, it is challenging to infer cause and effect from observational data, as this normally requires randomized controlled trials (Pearl, 2000) . The problem is that it is difficult to determine whether a variable X causes Y or whether both variables have a common cause Z. If X and Y share the cause Z, then confounding is present and Z is referred to as confounder, as illustrated in Fig. 3 . Because there is an open backdoor path between X and Y , it is unclear if an association between X and Y results from the causal effect X \u2192 Y or from the path with the common cause X \u2190 Z \u2192 Y . The extreme cases would be the purely causal setting without confounding X \u2192 Y , illustrated in Fig. 3 (right) and the purely confounded setting, where the correlation between X and Y is entirely due to common cause Z, illustrated in Fig. 3  (middle) .\nFor inferring causality, one of the core assumptions is causal sufficiency, i.e., we know all potential confounders. This assumption is often violated in practice, since we do not know all potentially relevant factors nor do we have data on them, yielding spurious inferences. Even if they would be known, they would not be available in all publicly available neuroimaging datasets. Consequently, we consider a recently proposed approach for causal inference by Kaltenpoth and Vreeken (2019) that assumes an unobserved confounding variable. The method explicitly models the hidden confounder with probabilistic PCA, which allows comparing the causal X \u2192 Y and confounded model X \u2190 Z \u2192 Y to conclude whether the relationship is causal or confounded. Next, we will present the details of the approach."}, {"section_title": "Assumptions for Inferring Causality with Unknown", "text": "Confounders We consider samples from the joint distribution P (X, Y ) over two statistically dependent continuous-valued random variables, where X can be multivariate and Y is univariate. The aim is to determine whether it is more likely that X causes Y , or that there exists an unobserved random variable Z that is the cause of both X and Y . Inferring causal relations from observational data is only attainable under specific model assumptions. A general assumption in causal inference is that the data distribution can be represented as a causal directed acyclic graph that satisfies the Markov factorization property: conditioned on its parents (direct causes), each variable is independent of its nondescendants (Pearl, 2000) . In addition, faithfulness and the previously mentioned assumption of causal sufficiency are required. Faithfulness implies that if X is independent of Y , there is no direct influence between the two in the underlying graph (Pearl, 2000) . While faithfulness is a strong condition, it is generally reasonable. Establishing causal sufficiency is more problematic in practice.\nOur approach incorporates the algorithmic Markov condition (AMC) (Janzing and Scholkopf, 2010) , which states that if X causes Y , the factorization of the joint distribution P (X, Y ) in the true causal direction has a lower Kolmogorov complexity than in the anti-causal direction. Together with causal sufficiency, this allows to identify the true causal network as the least complex one. Although the AMC generally relies on causal sufficiency, Kaltenpoth and Vreeken (2019) proposed to integrate the confounder as a latent variable Z. This approach allows for computing whether confounding is present, without explicitly knowing the confounder or having data on it, which is very relevant in practice.\nA remaining challenge for estimating the AMC is the evaluation of the Kolmogorov complexity as it is not directly computable. To this end, the minimum description length (MDL) principle provides a statistically wellfounded approach to approximate Kolmogorov complex-ity (Gr\u00fcnwald, 2007) . Considering model class M and a fully Bayesian formulation, the code length function L is computed as\nwhere P (M ) is a prior on the model class M."}, {"section_title": "Causal and Confounded Models", "text": "Now that we established the theoretical foundation of our work, we need to define two factorizations of P (X, Y )one for the causal and one for the confounded scenario -to decide whether the relationship between X and Y is indeed causal or not. Figure 3 illustrates the two factorizations we consider here:\n1. causal: P (X, Y ) = P (Y |X)P (X|Z)P (Z), which is represented by a linear regression model, 2. confounded: P (X, Y ) = P (Y |Z)P (X|Z)P (Z), which is estimated by probabilistic PCA (Tipping and Bishop, 1999) .\nTo emphasize that X and Z can be multivariate, we continue with X and Z. The complexity under the causal model can be estimated by minimum description length\n(2)\nThe complexity of the confounded model is estimated by\nwhere the confounders Z and the principal axes W are estimated using probabilistic PCA (Tipping and Bishop, 1999) . Note that we do not require that the confounders are known or measured; since we marginalize over Z, we only need to specify its dimensionality k. To compare the causal (X \u2192 Y ) and the confounded model (X \u2190 Z \u2192 Y ), we compute\nIf the causal model better describes the data than the confounded model, we obtain \u2206(X, Y ) > 0 -the more positive, the more confident we are. If instead \u2206(X, Y ) < 0, the roles are reversed. As \u2206 is dependent on the size of the dataset, we also consider the normalized version 1 N \u2206, with N denoting the number of subjects.\nWe estimate the complexity of both models by computing (2) and (3) using a no-U-turn sampler (Hoffman and Gelman, 2014) with four chains and 3,000 samples each (half of which are used for burn-in) as implemented in PyStan 2.19.0 (Carpenter et al., 2017) . We experienced instability estimating the complexity using variational inference as proposed by Kaltenpoth and Vreeken (2019) ."}, {"section_title": "Data Harmonization", "text": "In the previous sections, we described methods for identifying confounding bias. Here, we want to study whether methods for harmonizing neuroimaging datasets can effectively reduce bias. Harmonization of multi-site data aims to remove unwanted variability associated with scanner and site when pooling data. We refer to such unwanted variation as non-biological variation to distinguish it from biological variation about the subject, which we want to retain. Harmonization can be performed at multiple stages: by specifying a strict acquisition protocol, by normalization in image processing, or by adjusting image-derived features before data analysis. Here, we will focus on harmonization at the feature stage, as we cannot influence the acquisition anymore and we are using FreeSurfer for the image analysis, which already has a sophisticated normalization pipeline.\nWe will discuss several existing methods for harmonization in the following and present a novel extension. Table 2 summarizes the different harmonization models and the corresponding variable updates. First, we need to specify on which level we want to harmonize features. For multisite datasets, the obvious choice is to harmonize scans with respect to imaging site. Based on your initial motivation for Name That Dataset, an alternative would be to harmonize with respect to image source (dataset). We will evaluate both in our experiments, but focus on imaging site in the following description."}, {"section_title": "Harmonization only based on imaging sites", "text": "A na\u00efve approach for harmonizing across imaging sites is Z-score normalization. Consider an image-derived measurement Y ijf for imaging site i, subject j, and feature type f . After computing the mean\u03bc if and standard deviation\u03c3 if for each imaging site and feature, the fea-\nwhere subject j was scanned at site i. Z-score normalization is a standard procedure in statistics, simple to compute, but might remove information that is required for downstream tasks, such as disease prediction. Consider one imaging site with only young subjects and another one with only old subjects, both sites will have the same mean after the normalization, which for structures like the ventricles is inadequate (Scahill et al., 2003) .\nAs second harmonization approach controls for sitespecific effects by computing residuals. To this end, site becomes a regressor in a linear regression and the feature's harmonized value is the residual:\nwhere \u03b1 f is the average measure for the reference site, \u03b3 if is an additive imaging site effect, and \u03b5 ijf is the variance. The parameters can be estimated by solving the corresponding ordinary least squares problem."}, {"section_title": "ComBat Harmonization", "text": "As an extension of the previous model, Fortin et al. (2018) proposed harmonization of cortical thickness measures based on Combining Batches (ComBat) (Johnson et al., 2007) from gene expression analysis. ComBat adds a site-specific scaling factor \u03b4, yielding a model that adjusts for additive and multiplicative effects. In addition, Com-Bat uses empirical Bayes for inferring model parameters, which assumes that model parameters across features are drawn from the same distribution. Hence, model parameters are not estimated independently per feature anymore, which can be helpful with small sample sizes, but also assumes that parameters across features are homogeneous.\nAccounting for imaging site can help in removing unwanted variation in the data, but at the same time it may have the detrimental effect of removing relevant information. For instance, we would like to keep subject-specific information due to biological variability. We add the vector k to the model to indicate variables, whose influence we would like to keep after harmonization. In our experiments, we use sex and a linear and quadratic age term to account for non-linear aging effects. The model is\nwith the multiplicative imaging site effect \u03b4 if and vector of regression coefficients \u03b2 f . The harmonized value is computed as\nThe linear model can also be adapted to accommodate variables to keep k, as shown in Table 2 ."}, {"section_title": "Harmonization for non-biological variability with", "text": "ComBat As a novel extension, we propose to add the vector r to the model that contains variables that relate to nonbiological variability, which we would like to explicitly remove from the features. The updated ComBat model is\nwith the vector of regression coefficients \u03b6 f . The harmonized values are\n(11) Known effects about non-biological variability that we would like to remove are, for instance, the scanner manufacturer (MF) or the magnetic field strength (MFS). However, we believe that there are also unknown effects that increase variability among sites, which we did not collect explicitly. Hence, we propose to adapt an approach that is common in genome-wide association studies (GWAS). A major concern in GWAS is population stratification, i.e., the existence of subpopulations in the sample. To account for population stratification in the analysis, the addition of principal components (PC) to the regression model has been proposed in EIGENSTRAT (Price et al., 2006) . Principal components are computed on all genetic markers and therefore capture overall variation. Following this idea, we compute principal components across all image features on the whole dataset to capture generic variation that is not specific to a single brain feature. Such an approach is only beneficial if the neurological process we are studying is believed to only affect a few brain structures. As variables for the vector r, we are therefore considering manufacturer and magnetic field strength, together with the principal component."}, {"section_title": "Results", "text": "We first present results for Name That Dataset on harmonized features, brain age prediction, and a comparison of causal and confounded models with and without harmonization. Fig. 4 shows the results of Name That Dataset, when the different harmonization techniques were applied. We use volume measures, healthy subjects and 70% training data for these experiments. Imaging site is used in all linear and ComBat models, further augmented with biological variables age and sex. Next, we add non-biological variables that we would like to remove, namely manufacturer (MF), magnetic field strength (MFS), and principal component (PC). As noted above, all models that include age have a linear and quadratic aging term."}, {"section_title": "Name That Dataset with Harmonization", "text": "While we want to lower the accuracy for predicting the dataset, we also want to keep relevant information. As a measure for the latter, we use the fact that ventricles grow with age while atrophy of the hippocampus increases. We compute the Spearman's rank correlation of lateral ventricles and hippocampus volumes with age, to account for the non-linear relationship between the volume of brain structures and age. The objective of this experiment is to validate whether relevant information is retained in the image-derived measurements after harmonization. If biologically relevant information is retained, we should get a positive correlation for lateral ventricles and a negative correlation for hippocampus volume. Both volumes are considered relative to the intracranial volume. A trivial solution that would impede predicting the dataset would be to set all variables to constant values, however, this would also remove all relevant information. Classification accuracies of a random forest are depicted in fig. 4A for the original brain measures, Z-Score normalized, and five different variable combinations for the linear and ComBat model.\nOverall, we observe that ComBat is superior to the linear model in this experiment, which indicates the benefit of not only having an additive but also a multiplicative imaging site effect in the model. Z-Score normalization leads to a steep decrease in classification accuracy from 69% to 43%, but also the correlation with age is almost entirely removed (figs. 4B and C). Hence, not only dataset-specific information, but also relevant biological information, is removed. We observe a similar result for harmonization by residuals based only on imaging site, where ComBat yields a lower classification accuracy than the linear model (42% vs. 54%). Adding age and sex increases the classification accuracy, which is expected when adding these variables to the residuals computation. The corresponding ComBat model is closest to the model used by Fortin et al. (2018) and results in an accuracy of 50% and a change in the correlation with age of 0.04. With our extension of including additional variables to remove (MF, MFS, PC), the accuracy decreases to 45% for ComBat, while at the same time strengthening the correlation with age (0.62 and -0.38). However, whether the effect of MF and MFS is removed does not change the results for neither the linear model nor ComBat. Finally, we note that all classification accuracies are well above 37.9%, which we reported earlier for the dataset classification task with age and sex, indicating that the features retain dataset-specific information after harmonization. Fig. 5 shows harmonization results for using dataset instead of imaging site as grouping variable. Since Name the Dataset tries to identify the dataset a scan is part of, it seems natural to harmonize with respect to dataset. The figure shows the results for Z-Score normalization, together with the linear and ComBat models that include all variables (age, sex, MF, MFS, PC). With a classification accuracy of about 50% for ComBat, this is well above the results for using imaging site. Z-Score normalization and the linear model yield accuracies of about 60%, where the former again removes almost all correlation with age. We can therefore conclude that operating on the level of imaging site is leading to better results than operating on the dataset level. This indicates a high heterogeneity within the included multi-site datasets and the necessity for modeling site-specific variations."}, {"section_title": "Results on Brain Age Prediction", "text": "In a further experiment, we evaluate brain age prediction (Franke et al., 2010; Cole and Franke, 2017; Becker et al., 2018) , i.e., the prediction of a person's age from a brain MRI scan, across datasets. The prediction of the brain age is of interest as it was demonstrated that brain age relates to cognitive aging and that the difference to the chronological age is associated to neurodegenerative diseases. A prerequisite for age prediction is sufficient data to cover the full age range of interest, which often requires combining data from multiple datasets. However, site-specific characteristics may cause unwanted variation between training and testing sets, as well as heterogeneity in the training set, which can deteriorate prediction results. Hence, we examine whether harmonization of the image features can decrease the error. Age prediction is a multivariate regression task, for which we use random forest regression on brain volumes. We only select healthy subjects for this experiment. We use a leave-one-dataset-out scheme for the evaluation, i.e., one dataset is selected as test set and the remaining 16 datasets are used for training. Fig. 6 shows a boxplot of the mean absolute error in age prediction for the raw measurements, and the harmonized measurements with Com-Bat and ComBat with PC, respectively. The reduction in age prediction error between raw image measures and both harmonization approaches is statistically significant with p < 0.05; the difference between the two harmonization techniques (p = 0.47) is not."}, {"section_title": "Results on Causality with Harmonization", "text": "We estimate the causal inference model in two experiments. In the first one, we select the ADNI dataset and set Y to the Alzheimer's Disease Assessment Scale Cognitive Subscale 13 (ADAS) score. ADAS is one of the age, age squared, sex, and the following brain volumes that have previously been associated with dementia: hippocampus, amygdala, lateral ventricles, inferior lateral ventricles, and third ventricle (Apostolova et al., 2012) . The model complexities for causal and confounded models, together with the difference \u2206 for the raw volume measurements is reported in Table 3 . Next, we evaluate different harmonization methods for the volume measures, where we focus on ComBat. Only using site, or site in combination with age and sex yields similar results to the raw measures. The inclusion of PC yields a higher difference, and therefore points towards a less confounded model. Additionally adding ADAS in the harmonization to the variables to keep (k), leads to the least confounded model.\nIn the second experiment, we want to include all datasets in the study. To this end, we set Y to age and X to the following brain volumes: hippocampus, lateral ventricles, amygdala, inferior lateral ventricles, third ventricle, putamen, pallidum, caudate, thalamus proper, cerebellum cortex, cerebellum white matter, and brain stem, together with sex. The results per dataset are shown in Fig. 7 , where we present the normalized \u2206 for better comparison across datasets. Next to the results on raw image measures, we also report results for the harmonization with ComBat. As variables, we use (i) site, age, sex, (ii) site, age, sex, PC, and (iii) site, age, sex, MF, MFS, PC. For (i), which corresponds to the original proposal of Com-Bat, we observe similar values to the raw measures. After including PC, we observe a substantial increase in \u2206 for almost all datasets. Notably, for NKI and OASIS, the dif-ference gets positive, which indicates a causal relationship. To investigate this further, we plot L ca for NKI and OA-SIS in the inlet in Fig. 7 , which shows the large drop in complexity for the causal model after harmonization with PC. With the complexity of the confounded model changing only little, it is the change of the causal model that yields the positive \u2206 and therefore evidence for a causal relationship."}, {"section_title": "Discussion", "text": ""}, {"section_title": "Dataset Harmonization", "text": "We have investigated several techniques for dataset harmonization and evaluated wether they can reduce the accuracy of predicting the dataset or whether they can yield a causal relationship. Harmonization is a trade-off between removing unwanted variation, likely associated to scanner, and keeping relevant information about the research question. Hence, we need to be cautious when harmonizing image features. As shown in our results for Name That Dataset, Z-score normalization and the harmonization with imaging site only can drastically decrease the classification accuracy. However, the low correlation of age with hippocampus and ventricles volumes after harmonization illustrates that all of the biologically relevant information has been removed too. Adding more supervision to the process is therefore necessary, which we achieved by adding variables whose association we want to keep in the data (e.g. age and sex). Results from our correlation analyses with age show the effectiveness of such an approach, but also that the dataset prediction accuracy increases compared to only using site.\nAs a novel contribution to harmonization, we proposed to add variables to the model, whose influence we would like to remove. In particular, we proposed to compute principal components across all image features, and add them as variables to remove. This approach is inspired from GWAS, where principal components across genetic markers are added to a model of association to account for stratification of the population. In contrast, we use principal components in a regression model to harmonize imaging data by computing the residuals. Next to PC, our technique can also be used to explicitly remove the effect of measured variables; we studied scanner manufacturer and magnetic field strength. In combination with imaging site as grouping variable, their removal had only small impact. This is most likely due to manufacturer and field strength being constant within an imaging site, so that the information provided by these variables is already accounted for by imaging site. Manufacturer and field strength have a stronger influence on the results when dataset is used as grouping variable.\nThe prediction of the brain age is a typical example, where the combination of multiple dataset is required to cover a wide age range in the training dataset. The results of our leave-one-dataset-out experiment demonstrated that harmonization yields a significant reduction in the age prediction error. As age prediction has been proposed as a diagnostic biomarker for many disease, like AD, HIV, and schizophrenia (Cole and Franke, 2017) , accounting for dataset bias may further increase its sensitivity.\nFor the computation of residuals in the harmonization, we worked with linear regression models and ComBat, where ComBat has an additional site-specific scaling factor and uses empirical Bayes for inference. Throughout all our experiments, we noticed advantages of ComBat in comparison to the linear model. This confirms previous results from Fortin et al. (2018) for harmonizing cortical thickness measures with ComBat also for the harmonization of volume measurements. We have focused on harmonization approaches that operate on image-derived features, while previous approaches harmonized image intensity values to make them comparable across studies, including histogram matching (Ny\u00fal et al., 2000) , WhiteStripe (Shinohara et al., 2014) , and RAVEL (Fortin et al., 2016) ."}, {"section_title": "Causal Inference for Identifying Confounding", "text": "Confounding bias can lead to spurious correlations and therefore wrong conclusions about cause and effect. The assumption of causal sufficiency, i.e., knowing all confounding variables, is often violated in practice. Hence, we presented a causal inference framework that considers unknown confounders. It is based on determining whether a confounded or causal relationship is more likely. We believe that this can present an interesting new analysis for neuroimaging data, e.g., for evaluating methods for harmonization or bias reduction.\nOur results indicate that most relationships that we investigated were confounded rather than causal. This is unsurprising, given the inherent complexity of neuroimaging studies related to scanning, image analysis, and study design. On the positive side, techniques for harmonization can reduce confounding and, in some cases, even yield causal relationships. For both causal experiments, we noted clear advantages for including PC in ComBat. Another observation for the experiment on the ADNI dataset is the positive effect of including the target variable, in this case ADAS, as variable to keep in the harmonization. Prior studies on confounding bias in neuroimaging (Dukart et al., 2011; Linn et al., 2016; Rao et al., 2017) have mainly focused on confounding within a dataset, with age and sex as potential confounders, but not across datasets.\nAs mentioned earlier, inferring causality from observational data is challenging and only feasible under certain assumptions as stated in section 4. As usual, these assumptions only provide an approximation of the real world. Even worse, there is no ground truth or manual assessment available, which could be used to compare to and compute an error estimate from. As such, results need to be interpreted with caution and in light of the incorporated prior knowledge. Yet, the ability to assess confounding in the model can be very helpful, not just for the development of harmonization tools, but more generally for inferring knowledge from neuroimaging studies."}, {"section_title": "Conclusion", "text": "Bias is a complex and challenging topic in neuroimaging that will become more prevalent in the future with the translation of results in the clinic and the surge of mega-analyses. Based on data with more than 35,000 individuals, we have demonstrated that simply pooling scans from distinct studies can introduce substantial bias that would be passed on to a machine learning model trained on the pooled data. First, we showed that it is possible to correctly identify the dataset that a scans is part of with more than 70% accuracy. Second, we introduced a novel approach for differentiating causal from confounded relationships based on causal inference. Importantly, the confounder was modeled as unknown variable, which is helpful in complex neuroimaging studies, where the assumption of causal sufficiency is challenging to fulfill. Third, we studied multi-site harmonization techniques and evaluated their effectiveness of reducing bias. We have proposed a harmonization method that extends ComBat for the inclusion of additional variables to remove, where the integration of principal components, to capture generic variation, led to the best results.\nOverall, we believe that the growing amount of medical images necessitates novel methods for handling bias in datasets and image-derived features. As bias is in its core a causal concept, methods from the growing field of causal inference may be particularly promising to yield new insights.\nwriting of this report. This manuscript reflects the views"}]