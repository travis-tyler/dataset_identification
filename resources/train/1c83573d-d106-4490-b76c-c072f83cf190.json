[{"section_title": "Abstract", "text": "Abstract-In this paper, we propose a novel way to produce voxel-based irregularity age map (IAM) for brain magnetic resonance image (MRI) to identify white matter hyperintensities (WMH) on scans with mild vascular pathology. Age map is a term used in computer graphic field that reveals age/progression of defected areas in images' texture. In this work, age map is used to reveal the age of irregularity of brain tissue (i.e., hyperintensities). Age map of WMH is useful because it shows not only the probability of voxels to be WMH but also the scale in the progression of voxels to become WMH. Our approach is fully automatic and unsupervised with little to none human interaction. We evaluated our approach using brain MRI data obtained from the Alzheimers Disease Neuroimaging Initiative (ADNI) database and visually compared the results with those obtained from the public toolbox Lesion Segmentation Toolbox (LST). We also evaluated our proposed approach on images from 10 different subjects using Dice similarity coefficient (DSC).\nWhite matter hyperintensities (WMH) are regions in brain magnetic resonance image (MRI) that appear brighter than the other regions in the T2-Fluid Attenuation Inversion Recovery (FLAIR) MRI sequence. WMH are features found in many brain pathologies such as stroke, multiple sclerosis (MS) and dementia/Alzheimer's Disease (AD). Specifically, it is believed that WMH are associated with the progression of dementia [1] [2] . Because of that, producing age map of WMH is beneficial and important to track the progression of brain pathologies.\nIn past years, there have been many attempts to develop WMH segmentation tools where most of works use machine learning algorithms. Support vector machine (SVM) [3] , ran dom forest (RF) [4] and convolution encoder network (CEN) [5] are some supervised machine learning methods that have been studied for automatically segmenting WMH. However, supervised methods are limited to the availability of labelled data, which is very time consuming to produce and highly dependent on physician or expert's delineation. To avoid the aforementioned dependencies, unsupervised methods have We propose a novel way to extract irregularity age map that shows age of voxels as hyperintensities instead of probability of voxels being hyperintensities. The irregularity age map proposed in this paper is a map where each brain voxel has value from 0 to 1 to indicate a scale in the progression of irregularities, i.e., hyperintensities, from their minimal up to their maximal intensity degree. In this age map, brighter intensities are indicated with higher value (i.e., close to 1) than the others (i.e., close 0). This differs from probability maps where each voxel has a probability value to indicate whether the voxel is WMH or not. This approach is derived from a previously published computer graphic work [8] , where they extract the age map to indicate weathered area of some texture images.\nAge map calculation and generation have some benefits compared to other approaches. Firstly, the age map calculation and generation do not need hyperintensities to be labelled, which are very tedious and expensive to produce. Secondly, the age map of MRI shows all irregularities inside the brain, not only one from a specific brain pathology. In this work, we use hyperintensities as irregularities of MR images. However, it is possible to generate age maps for different irregularities such as lacunar lesions or traumatic injuries. This paper is organised as follow. Section 1 discusses some backgrounds of this study. Section 2 discusses related work and overview of our proposed approach. Section 3 explains step-by-step on how irregularity age maps are calculated and generated. Section 4 and Section 5 show some results for visual observation and its discussions. Section 6 draws conclusions of this study and some future works.\nThis work is highly influenced from previous work in computer graphic [8] where authors successfully generate age map from texture images. The main idea of age map is to quantify irregularities on weathered texture images into age values in the range of 0 to 1, where weathered areas (i.e., consumed by time and weather) are regarded as irregularities"}, {"section_title": "", "text": "Abstract-In this paper, we propose a novel way to produce voxel-based irregularity age map (IAM) for brain magnetic resonance image (MRI) to identify white matter hyperintensities (WMH) on scans with mild vascular pathology. Age map is a term used in computer graphic field that reveals age/progression of defected areas in images' texture. In this work, age map is used to reveal the age of irregularity of brain tissue (i.e., hyperintensities). Age map of WMH is useful because it shows not only the probability of voxels to be WMH but also the scale in the progression of voxels to become WMH. Our approach is fully automatic and unsupervised with little to none human interaction. We evaluated our approach using brain MRI data obtained from the Alzheimers Disease Neuroimaging Initiative (ADNI) database and visually compared the results with those obtained from the public toolbox Lesion Segmentation Toolbox (LST). We also evaluated our proposed approach on images from 10 different subjects using Dice similarity coefficient (DSC)."}, {"section_title": "I . I n t r o d u c t i o n", "text": "White matter hyperintensities (WMH) are regions in brain magnetic resonance image (MRI) that appear brighter than the other regions in the T2-Fluid Attenuation Inversion Recovery (FLAIR) MRI sequence. WMH are features found in many brain pathologies such as stroke, multiple sclerosis (MS) and dementia/Alzheimer's Disease (AD). Specifically, it is believed that WMH are associated with the progression of dementia [1] [2] . Because of that, producing age map of WMH is beneficial and important to track the progression of brain pathologies.\nIn past years, there have been many attempts to develop WMH segmentation tools where most of works use machine learning algorithms. Support vector machine (SVM) [3] , ran dom forest (RF) [4] and convolution encoder network (CEN) [5] are some supervised machine learning methods that have been studied for automatically segmenting WMH. However, supervised methods are limited to the availability of labelled data, which is very time consuming to produce and highly dependent on physician or expert's delineation. To avoid the aforementioned dependencies, unsupervised methods have 1Data used in preparation o f this article were obtained from the Alzheimers Disease Neuroimaging Initiative (ADNI) database (adni.loni.usc.edu). As such, the investigators within the ADNI contributed to the design and implementation o f ADNI and/or provided data but did not participate in analysis or writing o f this report. A complete listing o f ADNI investigators can be found at: http://adni.loni.usc.edu/wp-content/uploads/how_to_apply/ ADNI_Acknowledgement_List.pdf been developed, tested and available as public toolboxes such as Lesion Segmentation Tool (LST) [6] and Lesion-TOADS [7] , Unfortunately, performances of these toolboxes, which employ unsupervised methods, are still limited compared to supervised methods [4] [5] .\nWe propose a novel way to extract irregularity age map that shows age of voxels as hyperintensities instead of probability of voxels being hyperintensities. The irregularity age map proposed in this paper is a map where each brain voxel has value from 0 to 1 to indicate a scale in the progression of irregularities, i.e., hyperintensities, from their minimal up to their maximal intensity degree. In this age map, brighter intensities are indicated with higher value (i.e., close to 1) than the others (i.e., close 0). This differs from probability maps where each voxel has a probability value to indicate whether the voxel is WMH or not. This approach is derived from a previously published computer graphic work [8] , where they extract the age map to indicate weathered area of some texture images.\nAge map calculation and generation have some benefits compared to other approaches. Firstly, the age map calculation and generation do not need hyperintensities to be labelled, which are very tedious and expensive to produce. Secondly, the age map of MRI shows all irregularities inside the brain, not only one from a specific brain pathology. In this work, we use hyperintensities as irregularities of MR images. However, it is possible to generate age maps for different irregularities such as lacunar lesions or traumatic injuries. This paper is organised as follow. Section 1 discusses some backgrounds of this study. Section 2 discusses related work and overview of our proposed approach. Section 3 explains step-by-step on how irregularity age maps are calculated and generated. Section 4 and Section 5 show some results for visual observation and its discussions. Section 6 draws conclusions of this study and some future works. This work is highly influenced from previous work in computer graphic [8] where authors successfully generate age map from texture images. The main idea of age map is to quantify irregularities on weathered texture images into age values in the range of 0 to 1, where weathered areas (i.e., consumed by time and weather) are regarded as irregularities 978-1-5386-3172-0/17/S31.00\u00a9 2017 IE E E of the texture. The age map is produced by calculating distance values between source patches and target patches. Source patches are made by dividing the texture image into grid of N x N non-overlapping patches. Whereas, target patches are all possible patches of the same size of the source patch extracted from the same texture image. A distance value is calculated by computing the difference of luminance and gradient's direction between two patches: a source patch and a target patch. Lower distance value means higher similarity between two patches, while higher distance value means lower similarity. All quantified source patches make a complete age map of texture image where hot/red areas (i.e., age value near to 1) indicate severe irregularities.\nThe same approach of producing age map can be applied for brain MRI because hyperintensities are also tissue irregular ities in MRI. However, some prerequisites and modifications in the calculation of the distance value are needed. In our proposed approach, not only the original MR image but also intra-cranial volume (ICV) and cerebrospinal fluid (CSF) masks are needed. The masks are used to mask out non-brain tissue voxels for the age map calculation. After that, hier archical patch creation with different patches size and patch generation of source patches and target patches are performed. Finally, age values are calculated using distance function and nearest neighbour. Age map generation, which does global normalisation and penalty to the age value calculation results, is also used to produce the final age map. All these steps will be thoroughly discussed in the next section.\nIII. A g e M a p C a l c u l a t i o n a n d G e n e r a t i o n In this section, all steps of the proposed approach are discussed. The steps are divided in four and described in subsections. These are: data preparation (i.e., brain MRI and its masks), patch generation (i.e., hierarchical patch generation for source and target patches), age value calculation (i.e., distance value, nearest neighbour approach and hierarchical age value combination) and final age map generation (i.e., global normalisation and penalty)."}, {"section_title": "A. Data Preparation: Masks o f Brain MRI", "text": "The original brain MRI includes non-brain tissues that are not needed in the age map calculation such as skull, cerebrospinal fluid, veins and meninges. The inclusion of these regions can make computation slower as more unrelated voxels would be included in the computation, and can bias the age value computation because brain voxels would be compared to non-brain voxels. Masks used in this study (i.e., ICV mask and CSF mask) are produced using an in-house pipeline developed by the University of Edinburgh. The ICV mask is a brain mask that excludes skull and background from brain MRI. Whereas, CSF is a mask which extracts brain tissue from cerebrospinal fluid, veins and meninges. Example of original brain MRI overlaid by ICV and CSF masks can be seen in Fig. 1 ."}, {"section_title": "B. Patch Generation: Source Patch and Target Patch", "text": "Like in previous work [8] , the original MR image is divided into non-overlapping grid-patches to create source patches. However, in this study, we create source patches using four different sizes (i.e., lxl, 2x2, 4x4 and 8 x 8). Note that the division is done slice by slice, not in the whole MRI (3D) scan. For each source patch, we then generate random same-sized patches sampled from all possible patches of the same slice for target patches. Fig. 2 visualises the patch generation for source patches and target patches. Unlike in previous work [8] , we do not use all possible patches available for target patches to fasten computation in the next stage. Preliminary pilot tests done in our sample showed no indication that this affects quality of the age map. Furthermore, we skip patch generation and age map calculation in slices without or too few brain voxels to fasten the computation even more. We use four different sizes of patches, which are 1 x 1, 2 x 2, 4 x 4 and 8 x 8, to make sure we capture different details of brain tissue. Smaller patches capture more detailed information from brain MRI while bigger patches capture bigger contextual information. Each of them are computed independently, so there will be four different age maps for each MRI slice. They will be combined together in the last step of age value 978-l-5386-3172-0/17/$31.00\u00a9 2017 IE E E calculation to produce the final MRI age map. The process is repeated sequentially across all MRI slices.\nTo speed-up computation, we do some exclusions in patch generation. In [8 ] , each source patch is compared to all possible overlapping patches from the same image. However, in this study, we do not use all possible overlapping patches for target patches, but they are randomly sampled from all possible overlapping brain patches. Non-brain patches are excluded from random sampling using masks. Moreover, we also exclude neighbouring target patches of source patches because neighbouring patches are too similar (also done in [8] ). Lastly, we only generate target patches if the centre of the source patch is within the ICY mask and outside the CSF mask (i.e. in brain tissue). In general, there are 300-1300 target patches sampled for each source patch."}, {"section_title": "C. Age Value Calculation: Distance Function", "text": "The core computation of the age map generation is age value calculation using a distance function. Age value calculation is done by comparing how distant/different source patch and target patch are, and a distance function is needed for computation. Let s be a source patch and t a target patch, then the age/distance value of the two patches d is:\nAccording to Equation 1, the age value is computed by subtracting the target patches intensities out from the source patches intensities, calculating its absolute maximum and mean values, and then adding them together with a parameter of a (e.g., a = 0.5 in this study). The rationale behind calculating this distance function is that we want to know the maximum difference between source and target patches relative to the mean difference of the two patches. Note that both patches can be arrays/matrices in which we can find theirs maximum and mean values.\nTo calculate the age value of one particular source patch, we need to find its nearest neighbour based on a list of age values from a list of target patches generated from the last step. This can be done by sorting all age values calculated from all target patches in ascending order, and finding the mean age value from the 100 biggest age values in the sorted list. The rationale behind this is that if a source patch is similar to the majority of target patches, then the mean value of the 1 0 0 biggest age values of the sorted list should be still lower than other source patches that are very different than the majority of their target patches. After all age values for all source patches in one slice have been calculated, age value normalisation to [0,1] can be done to create the age map of an MRI slice.\nFrom a previous step, we will have four different age maps of MRI slice from four different sizes of patches. We can combine all of them by using the following formulation: (2 ) where a + /3 + 7 + 5 = 1 and m api, map2 , map a and maps stand for age map from different size of patch, which are 1 x 1 , 2 x 2, 4 x 4 and 8 x 8 respectively. Equation 2 is basically a weighted blend of four different age maps. Also, please note that the size of the age map of an MRI slice from different patch sizes differ depending on the size of the non-overlapping grid patches (e.g., if the patches are of size 1 x 1 we will have a 256 x 256 grid in the MRI slice, and, thus, we will have a 256 x 256 age map. If we use patches of size 2 x 2, we will have a 128 x 128 age map. If we use patches of size 4x4, we will have a 64 x 64 age map, and so on.). To make all age maps of the same size, the age maps are up-sampled to fit the original size of the MRI slices (i.e., 256 x 256 in this study). We also apply Gaussian blur filter to the resized age maps to make them less pixelated. Example results from these steps can be seen in Fig. 3 ."}, {"section_title": "D. Final Age Map: Penalty and Global Normalisation", "text": "The age map generated enhanced voxels that are hypo-and hyper-intense with respect to the normal tissue by means of the absolute intensity difference, as per Equation 1 . This means that, at this point, we cannot differentiate between hyperintensities (i.e., bright voxels) and hypo-intensities (i.e., dark voxels). Most hypo-intensities are excluded using ICV and CSF masks, but there is still possibility that they appear and make some disturbing artefacts. Moreover, the probability of artefacts to appear is much higher if we do not have high quality masks. To subdue these artefacts and refine age map result, we use the following penalty formulation:\nwhere p, is voxel from resulted age map, i is voxel's intensity of the original MRI and pQ is output voxel after penalty. In general term, we do penalty by multiplying all age map's voxels with theirs correspondent original intensity of MRI.\nThe last step in the generation of the final age map is global normalisation (GN) where we do normalisation to [0,1] values for one MRI data (i.e., all slices together). Until now, we do normalisation per slice which is limited to local voxels. GN is useful to subdue biases that usually come differently from each slice, especially from the cerebellum. Furthermore, biases which can appear when there is no hyperintensities in a slice are also subdued by the GN. Example of GN and penalty results are depicted in Fig. 4 ."}, {"section_title": "I V . E x p e r i m e n t a n d V i s u a l R e s u l t s", "text": "We used T2-Fluid Attenuation Inversion Recovery (FLAIR) MRI data from Alzheimer's Disease Neuroimaging Initiative (ADNI) dataset. Since not all data in this dataset have the corresponding WMH labels available, two different evalu ations are done. Firstly, we compare the results from the proposed approach with those from a public toolbox, which is Lesion Growth Algorithm from Lesion Segmentation Tool (LST-LGA) with parameter k = 0.3 (i.e., default value of parameter). We choose LST-LGA because it is an unsupervised approach, similar to our proposed approach. Some examples for visual observation can be seen in Fig. 6 . Secondly, we calculate the similarity index Dice coefficient (DSC) [9] from 20 different subjects for which the corresponding WMH labels Fig. 3 : Example results of age maps of MRI slice. Fig. 5a , 5b, 3c and 3d are generated from different sizes of patch, which are 1 x 1, 2 x 2, 4 x 4 and 8 x 8 respectively, while Fig. 3e is the combination of all four age maps mentioned before. The original MRI and its masks are depicted in Fig. 1 . Please refer to the digital version of this paper to see in more detail. Fig. 4 : Example of (a) global normalisation (GN) and (b) Combined use of GN and penalty to age map. The original MRI and its masks can be seen in Fig. 1 , while its age map before GN and penalty is depicted in Fig. 3e . and all masks needed for computation are available. DSC scores show how similar/dissimilar segmentation results are with respect to the reference labels (i.e., groundtruth), and are calculated using the following equation: (4) where TP is true positive, FP is false positive and FN is false negative. Higher DSC score means better performance. To produce WMH segmentations from the final age map, arbitrary threshold values can be used. In this study, we used four different thresholds which are 0.50, 0.40, 0.30 and 0,23. We compare the DSC scores from the results of the proposed method against those from the LST-LGA [5] with parameter k = 0.05. The results are depicted in Fig. 5 , where a bar chart shows performance in 10 random subjects and box-plots show distribution of performances for each approach. On the other hand, visual observation can be seen in Fig. 6 where hot area (red) means age value is higher while cold area (blue) means age value is lower. It can be observed that our proposed approach IAM works well in most cases, especially when there is enough number of WMH in a slice. However, it still struggles when there is limited number of WMH in a slice as shown in the fourth row of Fig. 6 , which is the case of a healthy subject. In this case, our approach gives high irregularity age values to regions of the brain cortex. Furthermore, another shortcoming that can be seen in Fig. 6 is that some subtle hyperintensities do not have high age values compared to other voxels, which are depicted in the first and third row. We believe that this is caused by the penalty term as subtle hyperintensities do not have as high intensity values as strong hyperintensities. However, our proposed approach is generally better than LST-LGA visually."}, {"section_title": "V I . C o n c l u s i o n", "text": "In this study, we successfully implemented a voxel-based irregularity age map generation from T2-FLAIR brain MRI. Compared to LST-LGA, also an unsupervised WMH segmen tation method, our proposed approach is visually better for both strong hyperintensities and subtle hyperintensities. Some shortcomings still can be seen in the cortex. Our proposed approach depends on the existent of hyperintensities: it strug gles if there are no hyperintensities at all in a slice. Some weak hyperintensities are wrongly subdued due to the penalty term imposed. However, we believe that better normalisation and penalty terms can eliminate these two problems in future studies. Another minor shortcoming is that our proposed ap proach highly depends on pre-processing and post-processing. High quality masks, normalisation term and penalty terms are needed to exclude non-relevant regions before computation and subdue artefacts. "}]