[{"section_title": "Abstract", "text": "Abstract. Convolutional neural networks (CNNs) have shown promising results on several segmentation tasks in magnetic resonance (MR) images. However, the accuracy of CNNs may degrade severely when segmenting images acquired with different scanners and/or protocols as compared to the training data, thus limiting their practical utility. We address this shortcoming in a lifelong multi-domain learning setting by treating images acquired with different scanners or protocols as samples from different, but related domains. Our solution is a single CNN with shared convolutional filters and domain-specific batch normalization layers, which can be tuned to new domains with only a few (\u2248 4) labelled images. Importantly, this is achieved while retaining performance on the older domains whose training data may no longer be available. We evaluate the method for brain structure segmentation in MR images. Results demonstrate that the proposed method largely closes the gap to the benchmark, which is training a dedicated CNN for each scanner."}, {"section_title": "Introduction", "text": "Segmentation of brain MR images is a critical step in many diagnostic and surgical applications. Accordingly, several approaches have been proposed for tackling this problem such as atlas-based segmentation [1] , methods based on machine learning techniques such as CNNs [2] , among many others as detailed in this recent survey [3] . One of the important challenges in many MRI analysis tasks, including segmentation, is robustness to differences in statistical characteristics of image intensities. These differences might arise due to using different scanners in which factors like drift in scanner SNR over time [4] , gradient nonlinearities [5] and others play an important role. Intensity variations may even arise when scanning protocol parameters (flip angle, echo or repetition time, etc.) are slightly changed on the same scanner. Fig. 1 (a,b) shows 2D slices from two T1-weighted MRI datasets from different scanners, along with their intensity histograms which show the aforementioned variations. Segmentation algorithms are often very sensitive to such changes. Furthermore, images acquired with different MR modalities, such as T1 and T2-weighted images, may have considerably high-level of similarity in image content (see Fig. 1 ). While analyzing these images, humans can leverage such commonalities easily and it would be highly desirable if learning-based algorithms could mimic this trait. Despite high-level information similarity, there exists considerable intensity and contrast differences, which segmentation algorithms are often sensitive to.\nIn the parlance of transfer machine learning, images acquired from different scanners, protocols or similar MR modalities may be viewed as data points sampled from different domains, with the degree of domain shift potentially indicated by the differences in their intensity statistics. This perspective motivates us to employ ideas from the literature of domain adaptation [6] , multi-domain learning [7] and lifelong learning [8] to the problem of brain segmentation across scanners / protocols. Domain adaptation / transfer learning refers to a situation where a learner trained on a source domain is able to perform well on a target domain, of which only a few labelled examples are available. However, in this case, the performance on the source domain may not be necessarily maintained after adaptation. Multi-domain learning aims to train a learner that can simultaneously perform well on multiple domains. Finally, in lifelong learning, a multi-domain learner is able to incorporate new domains with only few labelled examples, while preserving performance on previous domains.\nVariants of image intensity standardization [9, 10] and atlas intensity renormalization [11] have been proposed as pre-processing steps to insure conventional segmentation methods from inter-scanner differences. Among learning methods based on hand-crafted features, transfer learning approaches have been employed for multi-site segmentation [12] and classification [13] . While adaptive support vector machines used by [12] may be adapted for new scanners in a lifelong learning sense, they are likely to be limited by the quality of the hand-crafted features. Using CNNs, [14] propose to deal with inter-protocol differences by learning domain invariant representations. This approach may be limited to work with the least common denominator between the domains, while, as shown in [15] , providing a few separate parameters for each domain allows for learning of domain specific nuances. Further, it is unclear how [14] can be extended to deal with new domains that may be encountered after the initial training. In the computer vision literature, several adaptations of batch normalization (BN) [16] have been suggested for domain adaptation [17, 18] and multi-domain learning [15, 19] for object recognition using CNNs. Broadly, these works employ BN for domainspecific scaling to account for domain shifts, while sharing the bulk of the CNN parameters to leverage the similarity between the domains.\nIn this work, we extend approaches based on adaptive BN layers for segmentation across scanning protocols in a lifelong learning setting. In particular, we train a CNN with common convolutional filters and specific BN parameters for each protocol/scanner. The network is initially trained with images from a few scanners to learn appropriate convolutional filters. By fine-tuning the BN parameters with a few labelled images, it can then be adapted to new protocols/scanners. Crucially, this is achieved without performance degradation on the older scanners, whose training data is not available after the initial training."}, {"section_title": "Method", "text": "Batch normalization (BN) was introduced in [16] to enable faster training of deep neural networks by preventing saturated gradients via normalization of inputs before each non-linear activation layer. In a BN layer, each batch x B is normalized as shown in Eq. 1. During training, \u00b5 B and \u03c3 2 B are the mean and variance of x B , while at test time, they are the estimated population mean and variance as approximated by a moving average over training batches. \u03b3, \u03b2 are learnable parameters that allow the network to undo the normalization, if required. Inspired by [15] , we propose to use separate batch normalization for each protocol / scanner.\nNotwithstanding variations in image statistics due to inter-scanner differences, a segmentation network would be confronted with images of the same organ, acquired with the same modality (MR). Hence, it is reasonable to postulate common characteristics between the domains and thus, shared support in an appropriate representation space. Following [15] , we hypothesize that such a representation space can be found by using domain-agnostic convolutional filters and that the inter-domain differences can be handled by appropriate normalization via domain-specific BN modules. This approach is not only in line with the previous domain adaptation works [18] , but also embodies the normalization idea of conventional proposals for dealing with inter-scanner variations [9, 10, 11] . Further, like [19] , once suitable shared convolutional filters have been learned, we adapt the domain-specific BN layers to new related domains.\nThe training procedure in our framework is as follows. We use superscript bn to indicate a network with domain-specific BN layers. We initially train a network, N \nIn the spirit of lifelong learning, this approach allows learning on new domains with only a few labelled examples. This is enabled by utilizing the knowledge obtained from learning on the old domains, in the form of the trained domainagnostic parameters. The fact that the number of domain-specific parameters is small comes with two advantages. One, that they can be tuned for a new domain by training with a few labelled images quickly and with minimal risk of overfitting. Secondly, they can be saved for each domain without significant memory footprint. Finally, catastrophic forgetting [20] by performance degradation on previous domains does not arise in this approach by construction because of the explicit separate modeling of shared and private parameters."}, {"section_title": "Experiments and Results", "text": "Datasets: Brain MR datasets from several scanners, hospitals, or acquisition protocols are required to test the applicability of the proposed method for lifelong multi-domain learning. To the best of our knowledge, there are only a few publicly available brain MRI datasets with ground truth segmentation labels from human experts. Therefore, we use FreeSurfer [1] to generate pseudo ground truth annotations. While annotations from human experts would be ideal, we believe that FreeSurfer annotations can serve as a reasonable proxy to test our approach to lifelong multi-scanner learning.\nWe use images from 4 publicly available datasets: Human Connectome Project (HCP) [21] , Alzheimers Disease Neuroimaging Initiative (ADNI) 1 , Autism Brain Imaging Data Exchange (ABIDE) [22] with minor alterations. Namely, our network has a reduced depth with three max-pooling layers and a reduced number of kernels: 32,64,128,256 in the convolutional blocks on the contracting path and 128,64,32 on the upscaling path. Also, bilinear interpolation is preferred to deconvolutional layers for upscaling in view of potential checkerboard artifacts [23] . The network is trained to minimize the dice loss, as introduced in [24] to reduce sensitivity to imbalanced classes. Per image volume, the intensities are normalized by dividing with their 98 %tile. The initial network trains in about 6 hours, while the domain-specific BN modules can be updated for a new domain in about 1 hour."}, {"section_title": "Experiments:", "text": "We train three types of networks, as described below.\n\u2022 Individual networks N d : Trained for each domain d, with n scratch train training images (see Table 1 ). For the known domains (D 1 , D 2 , D 3 ), the accuracy of N d serves as a baseline that the other networks with shared parameters must preserve. For the new domains (D 4 , D 5 ), the performance of N d is the benchmark that we seek to achieve by training on much fewer training examples (n train ) and using the knowledge of the previously learned domains. Results: All networks are evaluated based on their mean Dice score for n test images from the appropriate domain (see Table 1 ). Quantitative results of our experiments are shown in Table 2 . The findings can be summarized as follows:\n\u2022 N 123 preserves the performance of N 1 , N 2 , N 3 . Thus, a single network can learn to segment multiple domains, provided sufficient training data is available from all the domains at once. However, its performance severely degrades for unseen domains D 4 and D 5 . Histogram equalization (denoted by D d,HistEq ) to the closest domain is unable to improve performance significantly, while fine-tuning the network for the new domains causes catastrophic forgetting [20] , that is, degradation in performance on the old domains. "}, {"section_title": "Conclusion", "text": "In this article, we presented a lifelong multi-domain learning approach to learn a segmentation CNN that can be for related MR modalities and across scanners/protocols. Further, it can be adapted to new scanners or protocols with only a few labelled images and without degrading performance on the previous scanners. This was achieved by learning batch normalization parameters for each scanner, while sharing the convolutional filters between all scanners. In future work, we intend to investigate the possibility of extending this approach to MR modalities that were not present during the initial training.\nTo the best of our knowledge, this is the first work to tackle the lifelong machine learning problem for CNNs in the context of medical image analysis. We believe that this may set an important precedent for more research in this vein to handle data distribution changes which are ubiquitous in clinical data. "}]