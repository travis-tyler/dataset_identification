[{"section_title": "INTRODUCTION", "text": "Most attitude control scenarios are highly affected by fuel slosh. This is especially true during aggressive maneuvers when fuel tanks are half empty. Unlike flexible dynamics induced by solar panels, the disturbance torque generated by the slosh effects has a relatively lower frequency action. At the price of lower performances, common strategies consist of avoiding interactions between the rigid dynamics of the spacecraft and those induced by the sloshing modes. The main advantage of such solutions, based on notch filters (see Preumont (1997) for example) is that they do not require any accurate sloshing torque model which is generally difficult to obtain. From the early work of Berry and Tegart (1975), the constant need for improved attitude control systems has led, until quite recently, to the development of more realistic control-oriented slosh models (see Bourdelle et al. (2019) and references therein for details). From a control design perspective, a common way to address sloshing is based on the equivalent mechanical model (see Mazzini (2015); Dodge et al. (2000); Vreeburg and Chato (2000); Sopasakis et al. (2015). In such models, the mechanical parameters (mass, spring stiffness and pendulum length) are tuned to reproduce as well as possible, the liquid behavior. In Enright and Wong (1994) for example, Computational Fluid Dynamics (CFD) is used to evaluate sloshing frequencies and tune the aforementioned parameters. Based on such models, the control of spacecraft with multiple propellant sloshing modes has been addressed in Reyhanoglu and Rubio (2012) with both linear and Lyapunov-based nonlinear feedback controllers. Next, This work was supported by CNES advanced methods have been proposed in Hervas and Reyhanoglu (2012); Hervas et al. (2014) to take into account the consumption of propellant with time-varying parameters. In de Souza and de Souza (2014) pendulum model parameters are identified by a Kalman filter. Interestingly, the uncertainties in pendulum models can be addressed with robust control, as proposed in Yano and Terashima (2001) and further analyzed recently by Sopasakis et al. (2015) in the context of impulsively actuated spacecraft. These models, based on linearized fluid dynamics do generally not depend on angular speed or acceleration of the spacecraft, which however induce significant forces acting on the fluid. This is why, inspired by equivalent mechanical models, a generalization to nonlinear parameter-varying sloshing models along with a CFD-based parameter identification procedure was proposed in Bourdelle et al. (2019) to provide more realistic, control-oriented models. The observer-based attitude control design approach presented in this paper is supported by this model which is first rewritten in a Linear Parameter Varying (LPV) format. This class of systems has been extensively studied in the past twenty years and is well suited to many control design strategies among which observer-based techniques play a keyrole. See for example Hoffmann and Werner (2015) for a recent applications-oriented survey on LPV control techniques and Iulia- Bara et al. (2001) for further details on LPV-based observer design. The remainder of the paper is organized as follows. In section 2, the attitude control problem is presented and the uncertain slosh LPV model is described. The need for slosh compensation is clearly emphasized in this section. Next, section 3 is devoted to the presentation of LPV-based observer design strategy through the resolution of fairly standard Linear Matrix Inequalities (LMIs). Next, the application of the proposed algorithm is detailed in section 4 and illustrated by various parameter-varying simulations. Concluding comments and future directions are finally given in section 5."}, {"section_title": "LPV MODEL DESCRIPTION", "text": ""}, {"section_title": "A brief presentation of the attitude control system", "text": "Based on data provided in Pittet and Arzelier (2006), the main objective of this paper is to evaluate the potential of LPV observer-based attitude control systems for a microsatellite subject to slosh disturbances. Since coupling effects between the three axes of the satellite remain small, compared to the disturbance torques, we will focus on a single axis control problem. The open-loop dynamics then simply read: (1) where J = 30 kg.m 2 and \u03b8 denote the inertia of the satellite and its attitude angle respectively. Three different torques apply to this system. The first one, denoted \u0393 r is the control torque realized by a reaction wheel whose dynamics are represented by a second-order linear transfer function: This transfer function is applied to a saturated commanded torque\u0393 c resulting from the controller output \u0393 c as follows (with \u0393 max = 0.005 N.m): where the kinetic momentum of the wheel verifies: As is clear from (3), the bound H max should be strictly avoided. Beyond this limit indeed the wheel can no longer be accelerated and suddenly stops producing any torque. The second torque, denoted \u0393 d captures all disturbances resulting from the satellite environment. During \"short\" maneuvers, it can be considered as a constant term: The last one, \u0393 S to be further described next and extensively discussed throughout the paper, results from the effects of the slosh dynamics. As a first step, the attitude control system is designed without explicitly taking into account any disturbance torque. To this purpose, a standard proportionalderivative controller is initially tuned with the following structure, where J is assumed to be known (or estimated): A possibly fast varying, but continuous acceleration profil\u00eb \u03b8 r is initially defined according to the objectives to be met. Next,\u03b8 r and \u03b8 r are simply obtained by integration. Note that only \u03b8 m -provided by a star tracker -is available for feedback so that\u03b8 m is estimated with the help of a standard pseudo-derivation first-order filter s/(1 + \u03c4.s) whose time constant \u03c4 = 0.5 is tuned to reject sensor noises affecting \u03b8 m with a reasonable delay. The proportional and derivative gains K p = 0.25 and K d = 3.75 are calculated by an output feedback partial pole placement technique so as to assign a well-damped second-order mode with \u03c9 n = 0.1 to enforce a settling time of less than 60 s. The results are presented in Figure 1. It can be observed that, without any disturbance torque, the reference signal on the attitude is perfectly tracked. After 60 s the residual error verifies |\u03b8 r \u2212 \u03b8| \u2264 0.05 deg and is then twice smaller than the maximum allowed error max = 0.1deg. On the other hand, a small discrepancy is visible on the acceleration signal which cannot perfectly track the reference because of the actuator which, however, does not saturate. Let us now introduce the sloshing effects, captured by the disturbance torque \u0393 d for which a control-oriented model was recently proposed in Bourdelle et al. (2019). The model is essentially based on a time-varying nonlinear and poorly damped second-order system: where the varying coefficients a S , b S , c S , k S mainly depend on the angular velocity (\u03b8) and acceleration (\u03b8). Extensive simulations have also revealed strong correlations between a S and b S on the one hand, and between c S and k S on the other, allowing those to be rewritten as follows: where \u03b1(t) \u2208 [\u22121, 1] and \u03b2(t) \u2208 [\u22121, 1] are normalized parameters that can be approximated by functions whose time dependence is now implicit: The coefficients are summarized in Table 1. In order to justify the need for slosh compensation, preliminary simulations are performed in nominal conditions for which the coefficients in (8) are assumed to be constant with \u03b1(t) = \u03b2(t) = 0. The initial conditions in (7) are chosen as \u03b7(0) = \u22123.10 \u22123 and\u03b7(0) = \u22123.10 \u22124 . In addition, the magnitude of the constant disturbance torque \u0393 d introduced in (1) is also fixed to \u22123.10 \u22124 which is rather high. The proportional-derivative control law is initially applied and produces the results displayed by the blue plots in Figure 2. As one could expect, the pointing performance is poor and it takes almost 200 s before the error verifies the required specification |\u03b8 r \u2212 \u03b8| \u2264 0.1 deg. This is not surprising since the sloshing torque (visualized in the last subplot of Figure 2) exhibits significant variations whose amplitude nearly reaches half of the maximum achievable control torque.  Assuming (which is not true in practice!) that the total disturbance torque is available for feedback, an \"ideal\" control law\u0393 c = \u0393 c \u2212 \u0393 d \u2212 \u0393 s is applied that directly compensates the undesirable torques. The results, visualized in red, demonstrate the effectiveness of this unfortunately non realistic approach. The desired attitude angle is now reached in less than 60 s. This also clearly illustrates the need for the design of a parameter-dependent and robust observer that permits to obtain an accurate estimation of the sloshing torque despite its time-varying properties and the uncertainties that affect the model. This is the main objective of the following section."}, {"section_title": "LPV OBSERVER DESIGN", "text": "3.1 Observer structure and problem statement Combining equations (1), (2), (5), (7), (8) and 9the open-loop model can be rewritten in the standard following compact form: where the varying parameter p(t) = [\u03b1(x(t))\u03b2(x(t))] is assumed available for feedback and the perturbation term B 1 (p(t))w is introduced to capture the mismatch between the \"true\" parameters \u03b1(t) and \u03b2(t) defined in (8) and their respective approximations. The input perturbation w is also used to introduce noise on the measured attitude angle y = \u03b8 m . As is clarified above, the objective is to obtain a reliable estimate of the total disturbance torque z = \u0393 s +\u0393 d . For this purpose, a straightforward parameterdependent extension of the standard Luenberger state observer is used: It is then readily checked that the errors x = x \u2212x and z = z \u2212\u1e91 verify: where the time-dependence in p(t) has been dropped out for compactness. With this choice, the observer design problem \"reduces\" to the optimization of a parameterdependent gain L(p) such that : \u2022 the LPV system (12) remains stable for any admissible parametric trajectory, \u2022 the error z is reduced and kept as small as possible despite possibly adverse initial conditions and non negligible input perturbations."}, {"section_title": "By introducing a quadratic Lyapunov function", "text": "x X x , the first objective is easily enforced, independently of the input w, as soon as a positive definite matrix X can be found such that : 13) where the time-constant \u03c4 is tuned to control the convergence rate of the observation error. Moreover, if V , for positive scalars \u03bb and \u00b5, can be chosen such that: V ( x ) \u2212 \u03bbw w + \u00b5 \u22121 z z < 0 (14) then, by integration one obtains: According to the weights either applied on \u03bb or \u00b5 in the optimization process, the designed observer gain can exhibit different robustness properties against adverse initial conditions (small \u00b5) or worst-case perturbations captured in w (for small \u03bb\u00b5). Boyd et al. (1994) Combining inequalities (13) and 14with state-space equations (12), it is easily verified that the Lyapunov function defined by X > 0 and the observer gain L(p) defined through the auxiliary variable Y (p) are characterized as the solutions of the parameter dependent matrix inequalities:"}, {"section_title": "LMI-based characterization", "text": "For practical reasons, it is often useful to bound the observer gains which is not directly feasible in the above inequality where a change of variable (18) has been introduced. However, assuming that X > I 1 , it is easily checked that: In our context, the parametric dependence in (12) is affine so that the infinite number of matrix inequalities that appear in (16) is equivalently transformed into a finite number corresponding to the N vertices: 20) In addition, it can also be reasonably assumed that the set of all admissible initial conditions x (0) belongs to a polytope with q vertices, so that: (21) With the above assumptions in mind, and denoting for compactness any vertex of the form Z(p i ) by the shortcut Z i , the following LMI-based characterization can be proposed as a flexible optimization framework to compute the vertices of a bounded LPV observer gains (1) initialization \u2022 Fix positive scalars \u03c1 and \u03c4 \u2022 Select positive scalar weightings r \u03bb , r \u00b5 and r \u03bd (2) solve the following linear objective minimization problem under LMI contraints: min Remark 1. Note, by a convexity argument, that the inequalities (24) imply that for all x (0) in the polytope defined by (21), V 0 = x (0) X x (0) \u2264 \u03bd, and then: Remark 2. With the selection (r \u03bb , r \u00b5 , r \u03bd ) = (1, 0, 0) and setting \u03bb = \u00b5 in inequality (22), one obtains the standard solution that minimizes the L 2 induced gain from w to z . Remark 3. Note that the above characterization remains convex in the \"robust\" case with Convexity is lost however when using a parameterdependent Lyapunov function X \u2192 X(p). In that case, the LMI tests (22) at the vertices of the polytope are no longer sufficient but a denser grid including inner points must be considered. This generally leads to heavier calculations with a significant increase both in the number of decision variables and constraints. It also requires to check a posteriori that the solution remains valid on the whole parametric domain Biannic et al. (2011). This approach has not been considered in this application since satisfying solutions were found with fixed Lyapunov functions."}, {"section_title": "APPLICATION & SIMULATION RESULTS", "text": ""}, {"section_title": "Derivation of the polytopic design model", "text": "A polytopic representation of the parameter-varying system (10) is obtained with the help of a Simulink diagram (see Figure 3) which is evaluated at the 4 vertices of the parametric domain corresponding to \u03b1 = \u00b11 and \u03b2 = \u00b11 (see equation 8)."}, {"section_title": "Fig. 3. A Simulink view of the design model", "text": "Remark 4. The output z = \u0393 s + \u0393 d to be estimated by the LPV observer is slightly modified with an anticipating term z \u2190 z + \u03c4 d\u0393s . The parameter \u03c4 d is tuned in such a way that the norm \u0393 d +\u0393 s \u2212z rw is minimized where z rw denotes the response of the reaction wheel system to the input z. With reference to equation (2), the parameter \u03c4 d is obtained as: Remark 5. In addition to the general description of section 3, note that the disturbance input signal w is split in two signals w s (that affects the slosh model) and w y (that affects the measurement). Weighting functions W s and W y are used to penalize the slosh model or the noise respectively."}, {"section_title": "Optimization process", "text": "The design algorithm 1 is now applied with r \u03bb = r \u00b5 = 1, r \u03bd = 0 and fixing \u03bd = 1. The weightings W s and W y are respectively set to 0.01 and 0.1. As observed in Remark 3, the algorithm is easily adapted to the optimization of a fixed gain L (by fixing Y i = Y ) while preserving convexity. The two options have then been considered and the results are presented in Table 2. varying gain L(p) fixed gain L \u03bb 0.85 0.97 \u00b5 1.43 1.87 \u03b3 = \u03bb\u00b5 1.10 1.35 Table 2."}, {"section_title": "LMI optimization results", "text": "As expected the varying gain L(p) permits to further minimize \u03bb and \u00b5 although the improvement is not that significant. It is important however to keep in mind, from equation 11, that the implemented observer remains parameter varying even though L is a constant matrix."}, {"section_title": "Implementation and simulation results", "text": "The above LPV disturbance torque observer is now combined with the proportional-derivative attitude control law (6) and tested for different noise profile on the attitude measurement and various initial conditions. Moreover, during simulations, parametric variations are arbitrarily applied in the interval [\u22121 1] to the normalized coefficients \u03b1(t) and \u03b2(t) that affect the slosh model. Finally, a 30% time-varying multiplicative uncertainty is also introduced on both coefficients. As a result, the varying parameters used by the observer (denoted\u03b1 and\u03b2) differ from the nominal ones. The implemented attitude control law then reads: With the above controller, the simulation initially presented in Figure 2 is now replayed and visualized below (see Figure 4). The upper subplot reveals a perfect tracking of the attitude angle which is stabilized to the desired value after 60 s. The residual error then remains below 0.05 deg. The second subplot shows that the control activity tends to be slightly lower when the compensation scheme is activated although in both cases (with and without compensation) the magnitude bounds are reached. The last subplot shows the evolution of the total disturbance torque (blue line) and its estimation (red line). The initial condition was fixed to \u0393 S0 = \u22123 10 \u22123 . Next, a constant disturbance torque with magnitude \u0393 d = \u22123 10 \u22124 is applied after 50 s. It can be observed that the estimated torque matches well the real disturbance after 60 s. Next, another simulation is performed with a different initial condition (see Figure 5). The initial torque is now reduced to \u0393 S0 = \u22125 10 \u22124 and, quite unexpectedly, it now takes more than 100 s before the tracking objective |\u03b8 r \u2212 \u03b8| < 0.1 is reached. This \"anomaly\" is easily explained by the third subplot of Figure 5 which shows the kinetic momentum of the reaction wheel. As mentioned in section 2, the latter is limited to \u00b10.12. Obviously, the upper bound in reached slightly after 60 s so that the produced torque is canceled out. This nonlinear behavior of the reaction wheel system is not implemented in the LPV observer whose output no longer matches the true disturbance torque."}, {"section_title": "CONCLUSION", "text": "Based on a recently developed control-oriented CFDbased fuel slosh model, an LPV reformulation has been proposed in this paper which then permitted to design an LPV-based observer of the total disturbance torque. Following a standard scheme, the latter has then been used to design an improved attitude control system. In the absence of saturation in the reaction wheel system, the proposed observer-based controller has proven to be very efficient despite uncertainties and adverse initial conditions. Moreover, it appeared that a \"reasonable\" magnitude saturation does not significantly impact the result. This is however not the case of the saturation that affects the kinetic momentum of the wheel which should be strictly avoided. Various strategies, based in particular on explicit reference governors techniques (see Nicotra et al. (2019)) will be proposed and compared in a near future to take such strong limitations into account."}]