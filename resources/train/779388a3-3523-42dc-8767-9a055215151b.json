[{"section_title": "Abstract", "text": "Abstract. Multimodal medical image fusion helps in combining contrasting features from two or more input imaging modalities to represent fused information in a single image. One of the pivotal clinical applications of medical image fusion is the merging of anatomical and functional modalities for fast diagnosis of malign tissues. In this paper, we present a novel end-to-end unsupervised learning based Convolutional neural network (CNN) for fusing the high and low frequency components of MRI-PET grayscale image pairs publicly available at ADNI by exploiting Structural Similarity Index (SSIM) as the loss function during training. We then apply color coding for the visualization of the fused image by quantifying the contribution of each input image in terms of the partial derivatives of the fused image. We find that our fusion and visualization approach results in better visual perception of the fused image, while also comparing favorably to previous methods when applying various quantitative assessment metrics."}, {"section_title": "Introduction", "text": "A rapid advancement in sensor technology has improved medical prognosis, surgical navigation and treatment. For example, anatomical modalities such as Magnetic resonance imaging (MRI) and Computed Tomography (CT) reveals the structural information of the brain like the location of tumor as well as white and gray matter while modalities such as Positron emission tomography (PET) provides functional information like glucose metabolism. The hybrid blend of PET-CT acquisition hardware provides fast and accurate attenuation correction and helps in combining anatomical and functional information. However it exposes patients to high level of X-Ray and ionizing radiation. The integrated MRI-PET scanners results in high tissue contrast with significantly low radiation dose. But the development of a robust hybrid MRI-PET hardware is challenging due to compatibility issue of PET detectors in a high magnetic field environment of MRI. The post-hoc fusion of MRI-PET image pairs overcomes the challenges of fully integrated MRI-PET scanners and helps medical personnel to better diagnose brain abnormalities such as glioma and Alzheimer's disease [1, 2] .\nMost of the past image fusion methods proposed a three step approach to the fusion problem. First, the source images were transformed into a particular domain using approaches such as multi-scale decomposition [3, 4, 5, 6, 7] , sparse representation [8, 9] , mixture of multi-scale decomposition and sparse representation [10] and Intensity-Hue-Saturation [11] among others. Then, the transformed coefficients are combined using a predefined coefficient grouping based fusion strategy such as max selection and weighted-averaging. Finally, the fused image is reconstructed by taking the inverse of the transformation strategy. However, the intricacy of these methods leads to the computational inefficiency making them unrealistic for the real time setup [12] . CNN based medical image fusion [13] has been actively studied in the past. However, these methods train the network on natural images due to the unavailability of large preregistered medical image pairs. The acquisition method of natural images differ from PET images since PET accumulates nuclear tracers depending on positron range, photon collinearity or the width of the detector element that results in a smooth low resolution acquisition without clear interfaces between certain tissues. The high resolution MRI such as T1-MPRAGE on the other hand are acquired in spatial frequency domain by varying the sequence of RF pulses. Hence, the aspects of human visual system that are tuned to process natural images are not equally useful for MRI-PET images due to which the selection of a proper objective assessment metric is challenging [14] . Secondly, there are no ground truth in a fusion problem due to which proper selection of the loss layer becomes critical.\nTherefore, we propose a fast grayscale anatomical and functional medical image fusion approach in an end-to-end unsupervised learning network trained on publicly available medical image pairs. Additionally, the fusion result is visualized based on the contribution of the input images to the fused output image. The computational efficiency of our combined fusion and visualisation framework has the potential of real time clinical application in future."}, {"section_title": "Methods", "text": ""}, {"section_title": "Fusion framework", "text": "The fusion architecture in Fig.1 . takes two grayscale input images I 1 and I 2 and generates a grayscale fused image I F . The network consist of three different strategies named feature extraction, fusion and reconstruction to preserve most of the details from the input modalities. We train the parameters of the feature extraction and reconstruction layers by maximising the structural similarity and minimising the euclidean distance between fused image and the input images. Feature Extraction: In the first feature extraction layer, we perform two different convolution operations on each of the input images to decompose it into high and low frequency feature maps. Since blurry PET images has higher low frequency components than sharp MRI images, we define a kernel filter of size 9 \u00d7 9 for the anatomical input I 1 to capture low frequency (LF) features in a larger window while we select a smaller kernel size of 7 \u00d7 7 to capture the LF features of the functional input I 2 efficiently. For the high frequency (HF) layer, we define a kernel size of 3 \u00d7 3 for anatomical input I 1 to capture the sharp local features such as edges and corners better in smaller neighborhoods while we choose a kernel size of 5 \u00d7 5 for functional input I 2 due to less number of edges. We add two more hidden HF layers with increasing number of channels to preserve the deep high frequency features at the boundary regions.\nFusion and Reconstruction: HF features contain detailed information about texture and edges that has direct impact on the edge distortion of the fused image. Therefore, proper selection of the fusion strategy of HF features is crucial for robust fusion results. Max pooling strategy extracts edges from the features maps whereas average pooling is efficient in preserving textures. We utilise the advantage of each of the methods and propose max-average pooling as 1 st fusion rule for the HF features. We implemented weighted averaging strategy as the 2 nd fusion rule for LF features containing global information of inputs. Our reconstruction strategy contains three hidden layers and we define tanh activation function at the last layer due to its steeper gradients than a sigmoid function making backpropagation effective. Let H 1 (\u03c6) and H 2 (\u03c6) be the high frequency features of I 1 and I 2 at channel \u03c6 in the third hidden HF layer, L 1 (\u03c4 ) and L 2 (\u03c4 ) the low frequency features of I 1 and I 2 at channel \u03c4 in the first hidden LF layer and R i (\u03c4 ) the feature map generated from the second reconstruction layer, then the outputs of first fusion layer H o (\u03c6) and the second fusion layer R o (\u03c4 ) are:\nLoss function: The fused image in medical domain is normally evaluated by a human observer whose sensitivity to noise depends on local luminance, contrast and structural properties of the image. Therefore, we adopt the structural similarity index (SSIM [15] ) as the human perceptive loss function defined as:\nwhere I and J are the two input images and N is the number of local windows in the image. In our paper, \u03b1=\u03b2=\u03b3=1 gives equal importance to luminance l(i k , j k ), structural s(i k , j k ) and contrast c(i k , j k ) comparisons of the image contents i k and j k at k th local window with C l , C c , C s as constants given as:\nbeing the correlation coefficient. By empirically setting only SSIM as the loss function, we observed a shift in brightness of the fused image since the smaller \u03c3 g preserves edges and contrast better than the luminance in the flat areas of the image. Therefore, in addition to SSIM we employ pixel level loss \u2113 2 which preserves luminance better. With I 1 and I 2 as the two source images and F as the final fused image, we express our steerable total loss function as:\nwhere F ) ) and L \u21132 = (||F \u2212 I 1 || 2 + ||F \u2212 I 2 || 2 ) while \u03bb controls the weightage of each of the sub-losses."}, {"section_title": "Visualization framework", "text": "We visualised the functional and anatomical information in the fused grayscale image by first calculating the partial derivative of each pixel of the fused image with respect to each of the input images. Assuming n and m as the dimensions of the anatomical input I 1 and functional input I 2 while k and l are the dimensions of the fused image I F , so the gradients \u2207 F I1 (n, m) and \u2207 F I2 (n, m) will be:\nWe then color coded the functional gradient image \u2207 F I2 and performed Hue Saturation Value (HSV) transformation on both the images. The Hue and Saturation channels of \u2207 F I2 and the Value channel from \u2207 F I1 were stacked and inverse transformed to get the fused colored image. The factor \u2126 is multiplied with the saturation channel of \u2207 F I2 to prevent the occlusion of anatomical information. "}, {"section_title": "Experiments and results", "text": ""}, {"section_title": "Training", "text": "Data acquisition: We obtained 500 MRI-PET image pairs publicly available at the Alzheimer's Disease Neuroimaging Initiative (ADNI) [16] with subject's age between 55-90 years among both genders. All images were analyzed as axial slices with a voxel size of 1.0 x 1.0 x 1.0 mm 3 . The MRI images were skull stripped T1 weighted N3m MPRAGE sequences while PET-FDG images were co-registered, averaged, standardized voxel sized with uniform resolution of the same subject. We aligned the MRI-PET image pairs using the Affine transformation tool of 3D Slicer registration library."}, {"section_title": "Initialisation of hyperparameters:", "text": "The kernel filters of our fusion network are initialised as truncated normal distributions with standard deviation of 0.01 while the bias is zero. The stride in each layer is 1 with no padding during convolution since every down-sampling layer will erase detailed information in the input images which is crucial for medical image fusion. We employ batch normalization and Leaky ReLU activation with slope 0. Loss curve analysis: Fig.3 . shows the loss curves L SSIM and L \u21132 for the training data at different values of \u03bb. The figures convey rapid convergence for all \u03bb values other than \u03bb \u2265 0.9 where L SSIM plays more important role than L \u21132 in the total loss function L total . It is to be noted that L SSIM has higher sensitivity to smaller errors such as luminance variations in flat texture-less regions while L \u21132 is more sensitive to larger errors irrespective of the underlying regions within the image. This property leads to delayed convergence of L SSIM for visually perceptive results at edges as well as flat regions of the fused image."}, {"section_title": "Testing", "text": "We performed cross-validation on our trained model with a disjoint test dataset that contain 100 MRI-PET image pairs of 100 unique subjects from ADNI and Harvard Whole Brain Atlas [17] databases. 90 MR-T1 and PET-FDG image pairs obtained from ADNI were mutually exclusive from training image pairs. In order to test our method on datasets distinct from ADNI, the remaining 10 pre-registered image pairs were a combination of MR-T1 and PET-FDG or MR-T2 and PET-FDG images obtained from Harvard Whole Brain Atlas [17] with subjects suffering from either Glioma or Alzeihmer's disease."}, {"section_title": "Evaluation settings", "text": "The visualisation results of the test images were evaluated with 10 values of \u03bb, \u2126 \u2208 [0, 1] on four objective assessment metrics namely nonlinear correlation information entropy (Q IE ) [18] , xydeas metric (Q G ) [19] , feature mutual information (Q F MI ) [20] , structural similarity metric (Q SSIM ) [15] and human perceptive visual information fidelity (Q V IF F ) [21] with higher values means better performances. The evaluation resulted in highest scores with \u03bb = 0.8 and \u2126 = 0.6 for three of the mentioned metrics. We then used six different medical image fusion methods from recent past namely guided filtering (GF) [7] , nonsubsampled contourlet transform (NSCT-PCDC) [3] and (NSCT-RPCNN) [22] , combination of multi-scale transform and sparse representation (LP-SR) [10] , nonsubsampled shearlet transform (NSST-PAPCNN) [6] and convolutional neural networks (LP-CNN) [13] for quantitative comparisons in a MATLAB R2018a environment. Our code is publicly available at: https://github.com/nish03/FunFuseAn/. Objective assessment: Table 1 . summarizes the average scores of 100 test image pairs computed for different fusion methods along with our proposed method at \u03bb = 0.8 and \u2126 = 0.6. A method with a higher score performs better than a method with a lower score which is applicable for all the mentioned metrics. The results convey that our method performs better with the quality metric Q SSIM and Q V IF F . This is assertive from the fact that the neural network optimizes the loss function and subsequently improves the structural information in the fused image. Overall, the competitive scores reflects the robustness of our method for human perceptive fusion results.\nComputational Efficiency: We evaluated the total runtime of each of the methods for 100 test images in the MATLAB R2018a environment. Table 1 . conveys that our fusion and visualisation method achieved best timings since the network parameters are optimized during the training phase and with a fixed batch size it requires just one forward propagation through the fusion network to generate the fused images. Therefore, our fusion network could also be utilized in a real time neurosurgical intervention setup where a continuous feed of live images in a form of time series will generate fused output video stream with very low time delay."}, {"section_title": "Conclusion and Discussion", "text": "We presented a novel image fusion and visualisation framework which is highly suitable for diagnosing malignant brain conditions. The end-to-end learning based fusion model utilised the structural similarity loss to construct artifact free fusion images and the gradient based visualisation delineated the anatomical features of MRI from the functional features of PET in the fused image. The extensive evaluation of our approach conveyed significant improvements in human perceptive results compared to past methods. In future, our method could further be extended to include other combination of anatomical and functional imaging modalities by changing the fusion architecture especially the feature extraction layers. Additionally, we plan to immersively visualise the proposed results in an augmented reality based real time preoperative setup, thereby enabling medical experts to make robust clinical decisions."}]