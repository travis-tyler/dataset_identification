[{"section_title": "Abstract", "text": "Utilizing multiple modalities to learn a good distance metric is of vital importance for various clinical applications. However, it is common that modalities are incomplete for some patients due to various technical and practical reasons in healthcare datasets. Existing metric learning methods cannot directly learn the distance metric on such data with missing modalities. Nevertheless, the incomplete data contains valuable information to characterize patient similarity and modality relationships, and they should not be ignored during the learning process. To tackle the aforementioned challenges, we propose a metric learning framework to perform missing modality completion and multi-modal metric learning simultaneously. Employing the generative adversarial networks, we incorporate both complete and incomplete data to learn the mapping relationship between modalities. After completing the missing modalities, we use the nonlinear representations extracted by the discriminator to learn the distance metric among patients. Through jointly training the adversarial generation part and metric learning, the similarity among patients can be learned on data with missing modalities. Experimental results show that the proposed framework learns more accurate distance metric on real-world healthcare datasets with incomplete modalities, comparing with the state-ofthe-art approaches. Meanwhile, the quality of the generated modalities can be preserved."}, {"section_title": "Introduction", "text": "With the advances in data collection techniques, large amounts of healthcare data collected from multiple sources are becoming available. Such multi-source data can provide complementary information that can reveal the fundamental characteristics of patients. For example, in the study of Alzheimer's disease, different types of measurements such as magnetic resonance imaging (MRI), positron emission tomography (PET) and cerebrospinal fluid (CSF) are used to examine morphological changes, metabolic changes and cerebrospinal pathology associated with the disease respectively. Extracting valuable information from such multisource (a.k.a multi-modal) data may effectively improve clinical decision support.\nFor many clinical applications such as personalized medicine, trajectory analysis and cohort study, it is crucial to learn a proper distance function or similarity measurement metric from multi-modal data. However, existing metric learning models for measuring similarity among patients [Zhan et al., 2016; only focus on single-modal data, instead of multi-modal data. In other applications, such as image retrieval and face recognition, multi-modal metric learning methods [Xie and Xing, 2013] have been developed through linear or non-linear integration of features from multiple modalities.\nHowever, one common problem that hampers the use of multi-modal metric learning approaches for patient similarity analysis is the issue of missing data. In the healthcare area, each examination generates a modality of data. Due to the potential risks in certain examinations such as PET scans, or invasive procedures such as CSF biomarkers, patients may not be recommended to take all examinations in disease diagnosis. Also, the dropout of patients during the study and data privacy policies can cause the missing modality issue. In the multi-modal datasets, data can be missing in one or multiple modalities, i.e., for a patient, certain data source is either available or missing. Due to the unique challenge of healthcare data, existing unimodal or multi-modal metric learning methods cannot directly measure the distance between two patients with different available modalities.\nA simple approach for solving the missing data problem is to remove all samples with missing values, but this dramatically reduces the amount of samples and results in a severe loss of valuable information. In fact, the large amount of data with incomplete modalities provides more information, which is important to characterize the similarity of samples and the relationship between modalities. This motivates us to complete the missing modalities for complementary study, which not only enables patient similarity learning, but also provides potential patterns of the missing sources that can be used for further clinical analysis. Traditional missing data imputation techniques, such as mean and matrix completion are not suitable for large-scale high-dimensional datasets.\nTo tackle the aforementioned problems, we propose a Metric Learning with Incomplete Modalities (MeLIM) method that jointly infers the missing modalities and similarity information. The proposed model contains a modality completion part and a metric learning part. In the model, we employ generative adversarial network (GAN) to capture the relationship between the existing modality and the missing one. The missing modality is completed by mapping the existing modality through a generator. A discriminator is used to distinguish the true data and the generated one. Meanwhile, the large amount of incomplete data is incorporated into the GAN framework during the training process. In this way, the relationship between modalities is captured by the generative network and the missing modality can be imputed. We then connect the imputation part with metric learning by incorporating an auxiliary task in the discriminator to make use of the extracted non-linear multi-modal representations. In the proposed model, data of high quality and discriminativeness can be generated, which helps to better measure the similarity among samples. Our main contributions can be summarized as follows:\n\u2022 We propose a new framework of patient similarity learning on multi-modal healthcare data with incomplete modalities. It imputes the missing modality and learns the sample representation jointly, without a need for a separate imputation step.\n\u2022 Our proposed method can utilize both complete and incomplete data in the training process. The complete data provides supervised information, and the large amount of incomplete data provides more information of modality characteristics and relationships.\n\u2022 Comparing with the state-of-the-art approaches, the proposed method not only learns a more accurate distance metric, but also preserves the quality of the generated data, which is validated on a real-world dataset."}, {"section_title": "Related Work", "text": "The goal of metric learning is to learn a distance metric so that similar samples are grouped together and dissimilar samples are separated. Metric learning has prompted the development of patient similarity analysis [Zhan et al., 2016; Ni et al., 2017; , which is a key task in clinical decision support applications.\nWhen it comes to integrating information from multiple sources, multi-modal learning approaches [Xie and Xing, 2013; Hu et al., 2014; cannot be easily applied in healthcare domain because of the missing modality problem. To tackle the missing modality problem, partitions the data into multiple complete subgroups; integrates the consistency of modalities. For high dimensional data such as bio-images, deep learning based approaches are adopted. learns PET from MRI images by minimizing the pixel difference between predicted images and true ones. However, the loss function may lead to a blurry problem. To generate high quality data, models based on GAN [Goodfellow et al., 2014] are developed to learn the mapping between modalities. GAN models have achieved great success in image-to-image translation Gan et al., 2017; , attributeto-image generation , etc. The basic GAN framework consists of a generator network and a discriminator network. The generator takes a known distribution and generates new data, while the discriminator is used to distinguish the generated samples from real data distribution. The generator and discriminator play a minimax game.\nRecently, several works Cai et al., 2018; Shang et al., 2017] have emerged utilizing the generative ability of GAN models to impute missing data. These works mainly focus on data generation using GAN, while few of them explore the downstream tasks, such as metric learning. We combine the data generation process and metric learning to resolve the missing modality issue in patient similarity analysis. In terms of cross modal generation and classification, the proposed model is also related to domain adaptation works [Hoffman et al., 2017; Russo et al., 2018] . However, different from these methods that evaluate only on the target domain, the proposed model is a multi-modal learning, i.e., the prediction utilizes the complementary information of all domains. Moreover, they minimize the difference between domains via an unsupervised mapping, while we learn the domain relationship using both paired and unpaired modalities."}, {"section_title": "Methodology", "text": ""}, {"section_title": "Problem Formulation", "text": "Performing patient similarity analysis relies on learning a proper distance metric among patients. In metric learning, a linear or non-linear transformation function f (\u00b7) maps the input data into a new space. The metric in the transformed space measures the sample distances for a considered task. Without loss of generality, the distance metric between two samples p i and p j can be written as:\n(1)\nFor each pair of samples p i and p j , a pairwise label g ij denotes whether these two samples are similar or not. If p i and p j are similar (i.e. they belong to the same group), then g ij is set to 1, otherwise -1. The distance constraints can be constructed via various types of loss functions. In this paper, we minimize the pairwise hinge loss:\nProceedings of the Twenty-Eighth International Joint Conference on Artificial Intelligence (IJCAI-19) where [\u00b7] + = max(\u00b7, 0), \u03b3 is the unit margin, and T = {(p i , p j , g ij )} is the set of annotated positive and negative sample pairs. Each patient p k ideally has two modalities x and y, and such patients are considered as complete/paired samples. We assume that there are N complete samples, denoted as \u2126 xy = {(p x k , p y k )} N k=1 . However, modality missing is a common issue in healthcare area. There are two cases in our setting: x or y modality missing. The sample set without y modality is denoted as \u2126\nis the set without x modality. The total number of samples is N +M x +M y . Figure 1 illustrates the three types of data. In Eq.\n(2), p i can be (p x i , p y i ), p x i or p y i , and so as p j . Due to the issue of incomplete modalities, it is hard to directly apply traditional metric learning to learn similarities among patients. To tackle this issue, we need to design an effective model to automatically infer an appropriate mapping from the observed modality to the missing one. Thus, the proposed model consists of two main parts: missing modality generation and metric learning, and connects them in an endto-end way, which is illustrated in Figure 2 . We first employ GAN to generate the missing modality based on the observed modality, and then feed the latent representation which contains the multi-modal information into a metric learning layer to learn the distance metric. The two parts are optimized simultaneously in the framework. For simplicity, we use x for p x and y for p y when it is unambiguous."}, {"section_title": "Modality Generation", "text": "Intrinsically, multiple modalities share consistency with each other and can provide complementary information together. Through learning the hidden relationship between modalities, the missing modality can be reconstructed according to the observed one. To achieve this goal, we develop the following framework for modality completion.\nThe proposed generative network includes two generators G y : x \u2192 y and G x : y \u2192 x. The goal is to train the generator networks to infer the missing modality from the observed one. From a probabilistic perspective, suppose that x is drawn from the distribution p x (x), and y is drawn from p y (y). The generator G y characterizes the conditional distribution p y (y|x), and G x defines the conditional distribution in the other direction p x (x|y). In the generation process, a sample x is drawn from the data belonging to domain x, and then the generator G y produces a fake sample\u1ef9 = G y (x) in domain y following p y (y|x). Hence, the fake sample pair (x,\u1ef9) follows the joint distribution p Gy (x, y) = p y (y|x)p x (x). Similarly, a fake pair (x, y) can be obtained from G x , i.e.x = G x (y), following p Gx (x, y) = p x (x|y)p y (y)."}, {"section_title": "Loss of Paired Data", "text": "For the paired training data, both of the two modalities x and y are available. We use a discriminator D 1 to distinguish whether a sample (x, y) is real or fake. Since the incompleteness exists in both modalities in our problem, this requires the proposed model to be able to generate data from two directions. It leads to the failure of the unidirectional conditional generation process proposed in [Cai et al., 2018] . Therefore, we develop the following objective function to enable the conditional generation in two directions:\n( 3) The adversarial loss is optimized based on a minimax game. We treat D 1 as a binary classification network. The true data sample (x, y) is set with label 1, and the predicted samples (x,\u1ef9) and (x, y) are given label 0. We minimize the binary cross-entropy loss\nto train the classifier. Therefore, the loss function of D 1 can be expressed as:\nTo minimize Euclidean distance between the predicted and true data, the mean squared error loss L mse is calculated as:"}, {"section_title": "Loss of Unpaired Data", "text": "In real world applications, it is usually hard to obtain complete data. The small amount of available complete data may not provide enough information to characterize the dataset.\nThe incomplete data contain partial extra information and are expected to improve the performance of downstream tasks. Therefore, how to incorporate the incomplete data into training is the issue that we aim to resolve. For unpaired data, we lack supervision in the form of paired modalities. To make use of the unpaired data, motivated by [Dumoulin et al., 2016; Donahue et al., 2016] , we use the following equation to enable joint distribution matching:\nwhere the discriminator D 2 is used to distinguish whether a fake modality pair is from p(x,\u1ef9) or p(x, y). Similarly to D 1 , the loss function of D 2 is:\nProceedings of the Twenty-Eighth International Joint Conference on Artificial Intelligence (IJCAI-19)"}, {"section_title": "Loss of Generation", "text": "The generators G x and G y learn the mapping between two domains, and are optimized to make the imputed data hard to be distinguished from the real data. Following the optimization strategy in [Goodfellow et al., 2014] , we train the generators with the objective function:\nThe generators and discriminators are all deep neural networks. In particular, the generators G x and G y follow a U-net encoder-decode network [Ronneberger et al., 2015] structure with skip connections between layers. The discriminators D 1 and D 2 extract high-level representations h 1 and h 2 respectively from their input sample pairs. The representation vectors h 1 and h 2 are not only used for discriminating the sample pairs, but also for performing the metric learning task."}, {"section_title": "Metric Learning Layer", "text": "Through the generators G x and G y in Section 3.2, we can predict the missing modalities and obtain three types of data (x, y), (x, y) and (x,\u1ef9). We then perform the multi-modal metric learning on the whole training data. We make use of the latent representations of the discriminators to perform metric learning, by training the distance metric as an auxiliary task [Odena et al., 2017] in the discriminator. In this way, the adversarial network and metric learning layer are optimized in an end-to-end way. The similarity information learned by metric learning is expected to improve the discriminability of the generated domains, i.e., a generated sample should be more similar to the samples in the same group and dissimilar to the samples from another group. Meanwhile, the high quality and discriminability of the generated data in return can improve metric learning performance.\nDuring the training process, a sample p i \u2208 \u2126 x with only modality x i is fed into G y to generate the missing modalit\u1ef9 y i , and then a complementary sample p i = (x i ,\u1ef9 i ) can be derived. The sample (x i ,\u1ef9 i ) is fed into discriminators D 1 and D 2 for adversarial training as described in Section 3.2. Meanwhile, latent representations h 1 i and h 2 i are extracted by D 1 and D 2 , respectively. The vectors h 1 i and h 2 i are non-linear abstract representations which capture the characteristics of (x i ,\u1ef9 i ). We then transform h 1 i and h 2 i to obtain a latent vec-\nwhere \u2295 is the concatenation operator and f (\u00b7) is a fully-connected layer. Here h i can be considered as the representation in the transformed space for p i in Eq. (1). Similarly, the vector representations for (x j , y j ) and (x k , y k ) are obtained from the latent vectors learned from D 1 and D 2 . Note that (x j , y j ) does not contribute to the adversarial loss of D 2 . After obtaining the representations for a batch of samples, including {(x i ,\u1ef9 i )}, {(x j , y j )}, and {(x k , y k )}, we calculate the metric learning loss in Eq. (2) for sample pairs in the mini-batch."}, {"section_title": "The Learning Framework", "text": "In the proposed method, the generators are trained to produce fake data which can fool the discriminators. The discriminators produce not only the probability distribution of real/fake modality pairs, but also the distance distribution of sample pairs. Metric loss L m is involved to optimize the parameters of discriminators and generators. Generators are trained to minimize \u03b1L m + L u adv + L p adv , and discriminators are trained to minimize \u03b1L m \u2212 L u adv \u2212 L p adv , where \u03b1 is a trade-off parameter. In the training process, we first randomly choose a batch of paired and unpaired samples, and then use generators to predict the corresponding fake data. Generator and discriminator are updated iteratively by fixing one and updating the other. When it comes to testing, we use the generators to obtain the imputed data, and the metric learning network to obtain the distance metric."}, {"section_title": "Experiments", "text": ""}, {"section_title": "Dataset", "text": "The Alzheimer's Disease Neuroimaging Initiative (ADNI) 1 project aims to track the progression of Alzheimer's disease using biomarkers and clinical measures. There are 840 patients in three cohorts: 231 cognitively normal (CN), 410 mild cognitive impairment (MCI), and 199 Alzheimer's disease (AD) patients. In this work, we use the available modalities in the database: MRI images and PET images, and generate the missing images from each other. We first preprocess the MRI and PET images for each patient. The T1-weighted MRI images are skull-stripped and intensity inhomogeneity corrected. After that, each MRI is segmented into gray matter, white matter and cerebrospinal fluid, and further spatially normalized into a template space using SPM 2 and CAT12 3 softwares. In the experiments, we use the gray matter tissue density maps as the MRI modality. The PET modality is coregistered, spatially normalized and rigidly aligned to the MRI modality. The MRI gray matter images and PET images are further smoothed using a unit standard deviation Gaussian kernel. To reduce the computational cost, we downsample the images to 32\u00d732 2D slices as the inputs."}, {"section_title": "Experimental Setup Baseline Approaches", "text": "We compare the proposed metric learning framework on the incomplete dataset with the state-of-the-art approaches. For the baseline approaches, we follow a two-step strategy: first impute the missing modalities using data completion methods, and then perform multi-modal metric learning. The approaches for imputing missing modalities include: Multimodal Autoencoder (MultiAE), Pix2pix and CycleGAN [Zhu et al., 2017] . The approaches for multimodal metric learning include: LM3L [Hu et al., 2014] first fill in the missing modalities with the imputation method that gives the best performance among baselines. We also conduct experiments by first completing the data using different modality completion methods, and then training a deep metric learning network on each imputed dataset to optimize the loss in Eq.\n(2). The metric learning network has the same structure as the discriminator in the proposed framework."}, {"section_title": "Implementation Details and Measurement", "text": "We randomly divide the patient set into training, validation and testing sets in a 0.75:0.05:0.2 ratio. Adam optimizer is used for models with deep architectures. We set the learning rate and the network structures the same as [Cai et al., 2018] but in a 2D fashion. We evaluate the learned distance metric in two tasks: disease prediction and patient clustering. For the disease prediction task, k-nearest neighbor (KNN) classification is performed on the learned distance metric. For each testing patient, we assign the predicted label with the most common class label among the top-k neighbors from the training set. We set k = 3 in the KNN classifier, and use accuracy and F1 as measures for the comparison. For the patient clustering task, we perform k-means algorithm with k = 2 on the testing examples based on the learned distance metric. The quality of clustering is reported in terms of purity and Rand index (RI). We also evaluate the performance of data generation part, by employing structural similarity (SSIM) [Cai et al., 2018] to quantitatively measure the structural difference between predicted images and the corresponding true ones. The SSIM values are in the range of [0,1], and the higher the better."}, {"section_title": "Experimental Results", "text": "We evaluate the performance on two tasks separately: distinguishing CN and AD patients (CN-AD), and MCI and AD patients (MCI-AD). Each task can be viewed as a dataset.\nFor the training set, we use a small ratio of paired data and the available unpaired data. For the testing set, we keep half paired data and half unpaired data. We repeat all the approaches five times on the two datasets."}, {"section_title": "Patient Similarity Analysis", "text": "There are two main ways for similarity comparison of incomplete data. One way is to first complete the missing modalities and then conduct metric learning. The other is to integrate missing modality imputation and metric learning into an end-to-end learning framework. For the baseline algorithms, we follow the two-step procedure. For the proposed method, image generation and metric learning are trained jointly.\nIn Table 1 , we present the average and standard deviation values of different methods by varying the ratio of paired data in the training set (i.e. 5% paired and 20% paired). In the table, we can see that the proposed method MeLIM outperforms baselines in terms of both disease classification and patient clustering tasks. Since we measure the distance metric on the testing set with both complete and imputed samples, we expect that the imputed data can be both realistic and distinguishable. In general, if the imputed data are in high quality, the performance of the downstream task (i.e. metric learning in our problem) will be better. MultiAE and Pix2pix can utilize only paired data samples. The number of available data is so small that they cannot learn a good mapping. Since MultiAE optimizes the content loss L mse , it suffers from the so-called \"blurry\" problem. CycleGAN is an unsupervised image-to-image translation method, and it suffers from the lack of supervision. These data completion methods optimize the data generation process, but can not guarantee a good representation for learning the similarity among patients. MeLIM optimizes modality generation and metric learning simultaneously, and thus obtains the best results. The traditional multi-modal metric learning models, LM3L, FISH-MML and HM3L learn linear transformations to map the original inputs to new spaces, which is not suitable for high-dimensional complex dataset. Therefore, they cannot obtain satisfactory results for lack of the ability to extract precise representations. MeLIM utilizes the latent space learned by the discriminator which has a deep architecture, and thus high level features which better characterize the inputs can be extracted. For each method, the performance on the CN-AD dataset is generally better than that on the MCI-AD dataset. Since MCI is the mild stage of AD, it is easier to distinguish AD patients from CN groups than from MCI groups. We also observe that using more modality complete samples during training leads to better performance. This demonstrates that supervised information helps the data generation process, and the higher quality of generated data can help to improve downstream tasks."}, {"section_title": "Data Quality Comparison", "text": "In this subsection, we show that the proposed framework not only learns accurate distance metric, but also preserves the quality of generated images. We calculate the SSIM values between the predicted images and the true images. Figure 3 shows the results using different modality completion methods. In the figure, we provide the average SSIM values of MRI and PET generations. It can be seen that MultiAE and Pix2pix are not able to generate high quality data when there is not enough paired training data. CycleGAN is trained on the whole datasets without paired information, so that its results do not change with the ratio of paired data. Since the proposed method takes into consideration both the paired and unpaired data, it generates high quality images that are more similar to the ground truth. By comparing the results on the data with different ratios of complete samples, we can see that using 20% paired samples is generally better than using 5% paired samples, especially for MultiAE and Pix2pix. This is due to the fact that more complete samples can provide more supervision to the data generation process. In the diagnosis of AD, doctors focus more on some critical regions and less on the whole images. Therefore, in this work, we mainly focus on the patient similarity analysis using the generated images, and do not emphasize too much on the overall image quality."}, {"section_title": "Complete vs. Imputed Data", "text": "To validate the importance of modality imputation, we conduct the following experiments by comparing the metric learning performance on complete and imputed dataset. We train a deep metric learning model using only the complete/paired data in the training set, and report model performance on the testing set of complete data. For comparison, we train MeLIM using the whole training set (including both paired and unpaired data), and report the performance on the same testing set. The comparison results between the above two strategies can be seen in Figure 4 . We conduct experi-ments on the two datasets with 5% paired training samples. We observe that by incorporating the imputed data during training, metric learning can achieve much better results. As the majority of patients have missing modalities, the information in the complete dataset may not be sufficient, so that metric learning model cannot be well optimized using only complete data. Our proposed method enables metric learning model to incorporate the incomplete data into the training process. The imputed data provides useful information to improve the performance of metric learning.\nAccuracy F1 "}, {"section_title": "Conclusion and Discussion", "text": "The problem of incomplete modalities hampers the development of metric learning approaches on healthcare domain. Moreover, the incomplete data contains extra information which should not be abandoned. To tackle this issue, we propose a new framework to perform metric learning on healthcare data with incomplete modalities. In the proposed method, modality imputation and metric learning are conducted simultaneously in an end-to-end way. In the modality generation part, we incorporate both complete and incomplete data in the learning process, making use of the complementary information contained in the two types of data. Meanwhile, the non-linear high-level representations of both complete and imputed samples are extracted by the discriminators, and then fed into a metric learning layer as an auxiliary task. Experiments show that the proposed model learns an accurate distance metric and also generates high quality data. The proposed method can be generalized for other types of data, by adjusting the network structures of generators and discriminators. The future research may address the scenario in which the datasets contain more than two modalities, but there exists incomplete or missing data in some modalities."}]