[{"section_title": "Abstract", "text": "Longitudinal registration has been used to map brain atrophy and tissue loss patterns over time, in both healthy and demented subjects. However, we have not seen a thorough application of the geodesic shooting in diffeomorphisms framework for this task. The registration model is complex and several choices must be made that may significantly impact the quality of results. One of these decisions is which image matching functional should drive the registration. We investigate four matching functionals for atrophy quantification using geodesic shooting in diffeomorphisms. We check if the choice of matching functional has an impact on the correlation of atrophy scores with clinical variables. We also check the impact of matching functional choice on estimates of the N80 sample size for hypothetical clinical trials that test for slowing of brain atrophy. We find that the mutual information function, which has primarily been used for linear and multimodal registration, achieves comparable correlation with clinical variables to other matching functionals while yielding better sample size estimates."}, {"section_title": "INTRODUCTION", "text": "Nonlinear image registration represents the shape change evident in a pair of anatomical images as a displacement vector field. The LDDMM (large deformation diffeomorphic metric mapping) framework for diffeomorphic registration [1] restricts the displacement field to be a diffeomorphism, which is constructed by integrating the flow of a time-dependent velocity field. Consequently, LDDMM constructs a path within a space of diffeomorphisms; Beg et al. show that at optimality this path is a geodesic. In the geodesic shooting in diffeomorphisms (GSiD) formulation, rather than optimizing the entire velocity flow, only the initial momentum of the flow is considered a free variable, and the path is constructed by integrating the appropriate Euler-Poincar\u00e9 differential equation (EPdiff) [2, 3, 4, 5, 6] ; this guarantees the path will be a geodesic throughout optimization. Further, as shown by Miller et al. [2] , at optimality the initial momentum is proportional to the moving image gradient. Hence, the objective of GSiD is to find a scalar momentum field that parameterizes an optimal matching between the given images.\nLike most registration methods, GSiD requires an image matching functional that takes two images as input and returns a scalar value quantifying how well aligned the images are. Many matching functionals have been proposed in the literature [7] . Generally speaking, the primary difference between them is the extent to which they attempt to normalize unwanted features from the image intensities. For example, the sum of squared differences functional makes no attempt to account for meaningless image intensity differences, and hence would be a poor choice for noisy or cross-modality registrations, whereas the mutual information functional is invariant to some transformations between the image intensity histograms.\nA great deal of the theoretical work on LDDMM and GSiD is agnostic about the choice of matching functional, and we have not seen an evaluation of the impact of matching functional choice on the quality of measurements in the GSiD context. In particular we are interested in the application of GSiD to longitudinal MRI time-series of the brain to quantify atrophy. In that case, deformations are often very low amplitude even relative to the spatial resolution of the images. However, atrophy of as little as 5% in critical brain areas can be associated with significant clinical effects [8] . Hence, it is crucial to measure atrophy, and therefore longitudinal deformations, with the highest degrees of accuracy and precision possible. In such a case, the selection of image matching functional may significantly impact our ability to capture atrophy evident in the image time-series."}, {"section_title": "METHODS", "text": ""}, {"section_title": "GSiD", "text": "A complete discussion of the GSiD model is beyond the scope of this paper; for a thorough discussion of the following equations, please see [3] . For a moving image I and fixed image J, the GSiD objective function is:\nwhere D(\u00b7, \u00b7) is a functional taking two images as input and returning a scalar value that quantifies how well the images are matched. Equation (1) must be minimized with respect to the initial scalar momentum field P 0 . The initial momentum P 0 provides the remaining initial condition for the EPdiff equation(s), which govern the time evolution of the momentum and moving image:\nThe third equation relates momentum and velocity, where K plays the role of an inertia; K is a smoothing kernel and K(w) is taken to mean the convolution of vector field w with K. The path of diffeomorphisms \u03c6 t is constructed from the velocity flow v(x, t) according to the ODE:\nthis yields the geodesic path of diffeomorphisms \u03c6 t , where the end point \u03c6 1 is used to match I and J. The matching residual \u2207 \u03c61 D(\u00b7, \u00b7)/\u2207I, which resides in the coordinate system of J, must be brought back to the coordinate system of I while respecting the geodesicity of the whole path \u03c6 t . This is done by integrating the adjoint system backwards in time\nThe solution of system (4) provides the gradient of equation (1) with respect to the initial momentum P 0 enabling optimization by some form of gradient descent."}, {"section_title": "Matching Functionals", "text": "Let I(x) and J(x) be two images such that x \u2208 \u2126 \u2282 R 3 with \u03b4\u2126 the boundary of \u2126 and I(\u03b4\u2126) = J(\u03b4\u2126) = 0. We review the functional form, interpretation, and some implementation details (including any free parameters) for four different matching functionals. We do not derive the gradients of the functionals; for those details see [9] .\nSum of squared differences: This is the simplest functional:\nThe SSD(\u00b7, \u00b7) functional considers the input images elements of a Euclidean vector space; it deals directly with the input image intensities, and has no free parameters. Global Correlation Coefficient:\nwhere \u2126 * I is the support of I(x) and | \u00b7 | denotes volume); i.e.\u00ce(x) is I(x) adjusted such that the mean intensity value over its support is 0. Let J(x) be defined similarly. The global correlation coefficient is then:\nThe GCC ranges from 0 for distinct images of random noise to 1 for images that differ only by a linear mapping of the image intensities. Due to this invariance, GCC is more robust to global confounds of the image intensities that might occur due to scanner drift (for images taken at different times) or scanner differences (for images taken at different sites). GCC also has no free parameters. Local Correlation Coefficient: This functional is the application of the GCC formula to all patches of a fixed window size in the image support. That is, if w x is a window centered at x and x is a coordinate local to w x then the LCC is:\nwhere\u00ce wx and\u0134 wx are mean filtered images with window size w. As opposed to GCC, LCC accounts for local rather than global image intensity statistics. This makes LCC more robust to nonlinear transformations of the image intensity histogram, which might occur under various circumstances including if one or more intensity gradients or confounds due to a large nonlinear field inhomogeneity are present.\nComputing the LCC requires mean filtering both images, which can be efficiently implemented using summed area tables (faster than FFT methods). The LCC has one free parameter, the window size w, which should be selected based on the size scale of features the registration is attempting to match.\nMutual Information: Mutual information has several equivalent definitions; we will present only one. First, let p I (i) and p J (j) be the normalized intensity histograms for images I and J and let p IJ (i, j) be the normalized joint intensity histogram for both images. Here, i and j are image intensity values. Then, mutual information is defined as the KullbackLeibler divergence of the joint intensity distribution from the joint distribution under the assumption of independence:\nM I(I, J) is minimal when I(x) contains no information about J(x); that is, when knowing the intensity at a particular location in I tells you nothing about what intensity might be at the same location in image J. In that case, I and J are independent and p IJ (i, j) = p I (i)p J (j) and M I(I, J) = 0. M I(I, J) is maximal when I(x) fully determines J(x) (and vice versa); in that case,\nwhich is the Shannon entropy of the image.\nM I requires estimation of the joint intensity distribution (the individual image distributions are then obtained by marginalizing the joint distribution). First, a number of bins must be selected in which to count the image intensities. Second, the joint distribution is constructed by Parzen-window density estimation. This can be efficiently implemented by first constructing the joint intensity histogram and then Gaussian smoothing. Hence, with this implementation, M I requires two user parameters: the number of bins and the width of the smoothing kernel."}, {"section_title": "Histogram matching", "text": "We will consider the previous four matching functionals both with and without histogram matching (HM) of the input data. HM is a nonlinear transformation of the image intensities of one image such that its histogram matches that of another. HM may be particularly appropriate for longitudinal image pairs considering anatomical structures are expected to be comparable in size and intensity, modulo any atrophy. Hence, HM of a follow-up image to a baseline image, for example, is expected to compensate for some noise and intensity differences due to scanner drift or other acquisition confounds."}, {"section_title": "EXPERIMENTAL RESULTS", "text": "We took 100 randomly chosen subjects from the ADNI-2 longitudinal MRI dataset -publicly available at adni.loni.usc.edu -and registered their baseline scans to their 24-month followup scans using GSiD. We repeated these registrations with five different choices for matching functional: SSD, GCC, LCC with a window size of w = 11 \u00d7 11 \u00d7 11mm, LCC with a window size of w = 21 \u00d7 21 \u00d7 21mm, and M I with Fig. 1 . ROI significantly associated with atrophy in AD used to compute atrophy scores 256 bins and an isotropic Gaussian smoothing kernel standard deviation of 2.5 bins. Further, we repeated these five experiments on the same data set but first histogram matched the follow-up image to the baseline image. Hence, we present results for a total of 10 experimental conditions. Before GSiD, the images were preprocessed according to the protocol detailed in [10, 11] .\nAfter GSiD, the Jacobian determinants of the deformations mapping the baseline to the 24 month followup images were moved to a common coordinate system. The Jacobian determinants were averaged in a region where the rate of atrophy is significantly associated with Alzheimer's Disease (AD; Fig. 1 ) to produce a scalar value atrophy score that represents the percent volume loss within the region for each subject [8] . The region was constructed from registrations of baseline to 24 month followup images from a completely separate data set of healthy controls and AD subjects from ADNI-1. Using the Jacobian determinant maps from those registrations, a statistical test was performed at every voxel to test for significant differences between healthy controls and AD subjects. The region used here is made up of the voxels whose p-value was below 10 \u221214 .\nWe first ask if the choice of matching functional significantly affects atrophy measurements. We performed a pairwise t-test between the atrophy scores for all pairs of experimental conditions. Figure 2 shows the p-values of those tests. Using a significance threshold of 0.001 \u2248 0.05/45. We find that nearly all matching functionals produce atrophy scores significantly different from atrophy scores produced by the other matching functionals with a few exceptions. In particular, it seems that the correlation based matching functionals are less likely to produce distinct measurements from each other than from the non-correlation based functionals. This may indicate that for this dataset, the local intensity statistics are sufficiently similar to the global intensity statistics, in which case GCC may be preferred for speed. Another important observation is that the mutual information functional produced atrophy scores that were different from all other meth- We also ask how the choice of matching functional impacts the correlation of atrophy scores with known clinical measures of dementia. Atrophy scores obtained by longitudinal registration have been shown to correlate with the diagnostic group of the subject and with their performance on clinical assessments of dementia. The left side of Figure 3 shows the Pearson's correlation coefficient with diagnostic group (DX corr) and mini mental state exam scores (MMSE corr). In both cases, the choice of matching functional does not seem to have a large affect on the correlation between the atrophy scores and clinical variable with one exception. The LCC with the larger window size correlates less with the clinical variables than the other results, something which histogram matching seems to correct.\nThe correlation is a measurement of the strength of a linear relationship between two variables, however it says nothing about the slope of that relationship. We also would like to assess the impact of matching functional on the distribution of atrophy scores within diagnostic groups. One measurement that captures information about these distributions is the N80 sample size estimate; in words the N80 is the estimated number of individuals required to detect a 25% reduction in the mean rate of atrophy, with 80% power, and with 95% confidence in the result. As a formula, the N80 is:\nwhere \u00b5 is the average atrophy score for a population, \u03c3 2 is its standard deviation, and z \u03b1 is the value at which the cumulative standard normal distribution equals \u03b1. Substituting in the values for z reduces the N80 formula simply to N80 = 250.88 \u00d7 (\u03c3/\u00b5) 2 .\nThe N80 is a function of the breadth of the distribution of atrophy scores normalized by the average amplitude of the atrophy signal. A lower N80 indicates a stronger signal, less variance in the signal, or both. The right side of Figure 3 shows N80s for all 10 experimental conditions for each of four diagnostic groups: healthy controls (HC), early mild cognitive impairment (EMCI), late mild cognitive impairment (LMCI), and Alzheimer's disease (AD). In general, the N80s tend to decrease for matching functionals that are increasingly invariant to confounds in the intensity matching. In particular, M I seems to offer some of the lowest N80 sample size estimates while retaining correlations to the clinical variables comparable to the other functionals. Finally, we acknowledge a few matching functionals which we did not include in this study, but may evaluate in future studies [12, 13] ."}, {"section_title": "ACKNOWLEDGMENTS", "text": "The authors thank Dmitry Isaev for help troubleshooting our MI implementation. This work was supported, in part, by NIH grant U54 EB020403 to the ENIGMA Center for Worldwide Medicine, Imaging & Genomics."}]