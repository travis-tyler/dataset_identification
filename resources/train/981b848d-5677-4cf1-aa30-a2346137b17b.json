[{"section_title": "Abstract", "text": "Intensity normalization is an important preprocessing step in magnetic resonance (MR) image analysis. In MR images (MRI), the observed intensities are primarily dependent on (1) intrinsic magnetic resonance properties of the tissues such as proton density (P D ), longitudinal and transverse relaxation times (T 1 and T 2 respectively), and (2) the scanner imaging parameters like echo time (T E), repeat time (T R), and flip angle (\u03b1). We propose a method which utilizes three co-registered images with different contrast mechanisms (PD-weighted, T2-weighted and T1-weighted) to first estimate the imaging parameters and then estimate P D , T 1 , and T 2 values. We then normalize the subject intensities to a reference by simply applying the pulse sequence equation of the reference image to the subject tissue parameters. Previous approaches to solve this problem have primarily focused on matching the intensity histograms of the subject image to a reference histogram by different methods. The fundamental drawback of these methods is their failure to respect the underlying imaging physics and tissue biology. Our method is validated on phantoms and we show improvement of normalization on real images of human brains."}, {"section_title": "INTRODUCTION", "text": "MRI is one of the principal modalities used in imaging brain tissue. Brain MRI scans are collected on many different scanners and at many different sites. The quality of these images is highly dependent on the imaging parameters and the calibration of the scanners, the variations of which lead to vastly differing intensity profiles for images. It is a fundamental problem of MR imaging that the image voxel intensities do not have any specific numeric meaning, unlike computed tomography (CT). The performance of image analysis routines like segmentation and registration is dependent on the underlying intensity distribution, 1 which can be made consistent through intensity normalization or standardization. Previous work, [1] [2] [3] [4] [5] [6] [7] [8] focuses primarily on histogram matching. Histogram matching however suffers from quantization artifacts. Additionally, forcing a subject image histogram to match a reference, forces the tissue intensity distribution of the subject to be equal to that of the reference. This can have unwanted consequences if the subject and the reference brain anatomies differ by a lot. Landmark-based approaches like 1, 3, 4, 9 result in using linear, 4 piece-wise linear 1, 9 or polynomial 3 intensity transforms calculated from landmarks on intensity histograms. These types of one-to-one transforms are insufficient to model the highly nonlinear variations introduced in different images by the MR imaging physics. Recent work by Weisenfeld et al. 5 and J\u00e4ger et al. 10 uses multiple images and focuses on matching multidimensional histograms of the subject and the reference. Though these methods can result in a nonlinear, many-to-many transform, the basic issue of forcing the subject joint histogram to match a reference joint histogram remains.\nAll the above mentioned methods overlook a vital point while performing intensity normalization, the MR imaging physics and its effect on tissue biology. The contrast obtained in an MR image is dependent on imaging parameters like repetition time T R, single or multiple echo times T E's, and flip angle \u03b1. It is also dependent on the physical properties of the underlying tissue such as the proton density P D , and the longitudinal and transverse relaxation times, T 1 and T 2 respectively. We propose to use the imaging equations of the pulse sequences in our data to estimate the aforementioned imaging parameters. Using these, we intend to use multiple different images obtained by different pulse sequences to estimate the intrinsic biophysical properties Normalization entails simply applying the reference pulse sequence equations, on the subject \u03b2 properties to generate new intensities. We show that this approach is feasible using the highly nonlinear pulse sequence equations and also describe a better performing algorithm using approximations of the actual pulse sequence equations. This approach shares its principle with a segmentation approach described by Fischl et al. 7 Sec. 2 describes our assumptions and the main algorithm. Sec. 3 describes our results using phantom as well as real data. We describe future avenues of work and conclusions in Sec. 4."}, {"section_title": "METHOD", "text": "Consider a set of co-registered subject images S = {S 1 , S 2 , S 3 }, which we intend to normalize using a set of co-registered reference images, R = {R 1 , R 2 , R 3 }. Each S i , as well as the corresponding R i , is produced by a pulse sequence \u0393 i . In our case, \u0393 1 and \u0393 2 denote the P D -weighted (P D -w) and T 2 -weighted (T 2 -w) outputs of a double spin echo sequence, respectively. \u0393 3 denotes T 1 -weighted (T 1 -w) spoiled gradient recalled echo (SPGR) sequence. The goal is to normalize S 3 to R 3 with the help of the other two acquisitions. Fig. 1 shows the three input images. These sequences use imaging parameters like repetition time (T R), echo time (T E), flip angle (\u03b1) and a scalar gain (A). Let the set of imaging parameters of \u0393 i for the subject be denoted as \u0398 Si , i \u2208 {1, 2, 3}. In our case, for the double spin echo sequences \u0393 1 and\nWe also denote the intrinsic tissue MR properties at a voxel location x in the subject as \u03b2(\n. The set of imaging parameters for reference images R i is denoted by \u0398 Ri . To keep the notation compact, we refrain from using the subscripts \"S\" and \"R\" in the parameter names T R i , T E i \u03b1 i ,and A i . Instead we will refer to their collection using \u0398 Si for the subject and \u0398 Ri for the reference, where i \u2208 {1, 2, 3}. Using this notation, we can describe the intensity at a voxel x in the subject image for a sequence \u0393 i with imaging parameters \u0398 Si in Eq. (1).\nThe human brain tissue primarily consists of three major tissue classes, cerebrospinal fluid (CSF), gray matter (GM) and white matter (WM). We assume that the mean \u03b2 values for these three major tissues are known for 1.5T scanners,\n, 70], respectively. T 1 and T 2 are in milliseconds while P D is relative. Additionally, for a subject image S i generated by the pulse sequence \u0393 i , i \u2208 {1, 2, 3}, lets C,i ,s G,i , ands W,i represent the mean intensities of CSF, GM, and WM respectively. Our key assumption is that the mean tissue \u03b2 values give rise the mean tissue intensities when the imaging equation for \u0393 i is applied."}, {"section_title": "Normalization Algorithm", "text": "(a) Estimating \u0398 Si and \u0398 Ri :\nOur key assumption is that for a pulse sequence \u0393 i , the average MR tissue properties i.e.\u03b2 C ,\u03b2 G , and\u03b2 W give rise to the average tissue intensitiess C,i ,s G,i , ands W,i respectively. This is represented as,\nWe solve this system to estimate \u0398 Si and a corresponding equivalent system for the reference set to estimate \u0398 Ri . Since we have three equations, in principle we can solve this system if \u0398 Si has three or fewer parameters. We denote\u0398 Si as the estimate of \u0398 Si , i \u2208 {1, 2, 3} which we get as a solution. We also estimate\u0398 Ri i \u2208 {1, 2, 3} for the reference images in an analogous fashion.\nWe know the relationship between \u03b2(x) and the recorded intensity from Eq. 1. For a particular subject voxel x, we have three intensities s i (x), i \u2208 {1, 2, 3} from the three images. Thus we have a system of equations to solve for \u03b2(x) in Eq. 3\nThis system has three equations and three unknowns since\n. So in principle it can be solved to estimate \u03b2(x); \u2200x in the subject image. Let\u03b2(x) be the solution estimate of \u03b2(x).\n(c) Applying Reference Pulse Sequence:\nTo normalize voxel intensities of subject image S 3 to the reference image R 3 , we only have to apply the pulse sequence \u0393 3 using imaging parameters\u0398 R3 estimated in (a) to\u03b2(x) estimated in (b) to generate a normalized subject image S (n) 3 .\nIn essence, we are extracting the subject's biology and applying the reference's imaging physics to generate a subject image as it would have looked, had we imaged it with the same pulse sequence parameters as that of the reference. We have described here a general algorithm to normalize S 3 to R 3 . The implementation of this algorithm depends on how \u0393 i is modeled. We describe two ways of using this algorithm. The first one (denoted by M1), described in Sec. 2.2 uses the actual pulse sequence equations derived for the sequences we have used. 12 We show that this approach is feasible subject to certain assumptions. Despite its feasibility, M1 has its limitations, which are reflected in its performance. In Sec. 2.3 we describe an approach, M2, where \u0393 i are modeled as approximate forms of the imaging equations used in M1."}, {"section_title": "Using Exact Imaging Equations: M1", "text": "For each S i , we use the imaging equations described in 12 directly. Eqns. 5, 6, 7 describe the \u0393 i we use in this approach.\nHere, the imaging parameters are\nwhere T R i are repeat times, T E i are echo times, A i are scalar factors and \u03b1 i are flip angles. Note that there are four unknowns in \u0398 Si and as described in Sec. 2.1, we can estimate \u0398 Si only if we have three unknowns. To simplify, we constrain the parameters which are least variable while acquiring images in practice. Specifically for our dataset, we use T R 3 = 15 ms in \u0398 S3 , T E 11 = 17 ms, and T E 22 = 80 ms in \u0398 S1 and \u0398 S2 , respectively. We also approximate T * 2 in Eq. 7 by\nT2 +k, where k is estimated to be 0.02 for CSF using values observed in the literature. 13 We solve the equations as shown in Eq. 2 to estimate\u0398 Si and\u03b2(x) using Newton's nonlinear least squares method. The reference pulse sequence is next applied to the estimated\u03b2(x) to produce a normalized S "}, {"section_title": "Solving Approximate Imaging Equations: M2", "text": "The method described in Sec. 2.2, although being the theoretically correct way, leads to non-convergent solutions, especially for CSF voxels. This can be attributed to the highly non-linear nature of the pulse sequence equations, imperfect T * 2 approximation, assumptions on one of the imaging parameters or low signal-to-noise ratio in the CSF intensities in P D -w and T 2 -w images. The average T * 2 value of CSF is considerably different from its average T 2 value, unlike GM and WM, which leads to another problem, the estimation of k. It is also computationally expensive since the nonlinear simultaneous system of equations is to be solved for each voxel. To address these issues, we approximated the pulse sequence equations by a first order Taylor series approximation, that does not need any information about the pulse sequence parameters.\nEqn. 7 is simplified using the fact that T R 3 is usually smaller than the T 1 for all the tissues, log S 3 (x) = log A 3 + log P D (x) + log(1 \u2212 e\nwhere \u0398 S3 = {\u03b8 31 , \u03b8 32 , \u03b8 33 }. This is a first order approximation assuming T R 3 < T 1 (x), \u2200x. Any residual part of the approximation is absorbed into the additive constant \u03b8 31 . This additive term also absorbs any differences in T 2 and T 2 . Thus we model \u0393 1 as in Eqn. 9.\nTo approximate the P D -w and T 2 -w imaging equations, we follow a slightly different strategy. In these sequences, the repetition times, T R 1 , T R 2 \u2248 2000ms, which is comparable to the T 1 's of CSF. Thus we cannot use the same approximation used for SPGR. Using the fact that T E 11 and T E 22 are small compared to T R 1 and T R 2 , we can approximate Eqn. 5-Eqn. 6 as, log S 1 (x) = log A 1 + log P D (x) + log 1 \u2212 2e\nThe middle term, log(1 \u2212 e\n, is a sharply decreasing function of T 1 (x), We can approximate it with a linearly decreasing function in T 1 (x) within the range of values that we are interested in (i.e. T 1 \u2208 (0, 6000) ms in the human brain at 1.5T). Thus we can write a more compact form of the approximations in Eqns. 11 12\nwhere\nThus we have \u0393 1 modeled in Eqn. 11, \u0393 2 in Eqn. 12 and \u0393 3 in Eqn. 9. We carry out the steps described in Sec. 2.1(a) to estimate\u0398 Si and\u0398 Ri . Next, we estimate\u03b2(x). This step is easier and faster as it involves solving a quadratic equation. Thus, this approach does not face convergence issues. Normalization is as described in Sec. 2.1(c)."}, {"section_title": "RESULTS", "text": "We performed two sets of experiments, with phantom and real images respectively. To show the biological correctness of our procedure we used simulated images with known imaging parameters from Brainweb 13 where we know the ground truth for tissue classes at each voxel and the mean values of\u03b2 C ,\u03b2 G , and\u03b2 W ."}, {"section_title": "Brainweb Phantom Experiments", "text": "For this experiment, we used a number of simulated T 1 -w SPGR images of the normal anatomical model with varying T R 3 , T E 3 and flip angles \u03b1 3 and 0% noise. For reference images we used a simulated P D -w image R 1 and a T 2 -w image R 2 with T R 1 = T R 2 = 3000ms, T E 11 = T E 21 = 17ms and T E 12 = T E 22 = 80ms. We fixed the SPGR as the reference image, R 3 , with T R 3 = 15 ms, T E 3 = 2ms, and \u03b1 3 = 30\n\u2022 . Fig. 3 shows the normalization result for the given reference and a subject image with T R 3 = 100ms, T E 3 = 2ms, and \u03b1 3 = 30\n\u2022 . The scale factor (A) is different for all the simulated images. The reference images are shown in Fig. 2(a)-(c) and served as the reference set of images R = {R 1 , R 2 , R 3 }. For the subject set, S = {S 1 , S 2 , S 3 }, we set S 1 = R 1 and S 2 = R 2 . S 3 is chosen to vary with T R , T E , and \u03b1. Since all the images come from a single subject with common biological properties, a perfect normalization scheme will convert the subject SPGR image into an exact replica of the reference SPGR image. We measured image similarity between the reference and the normalized subject image using metrics like mean squared error (MSE) in Table 1 , visual information fidelity (VIF) 14 in Table 2 . We compared M1 and M2, with histogram matching (HM), white matter peak scaling (WMP), 4 and a landmark-based method piece-wise linear method (UPL). 1 VIF is an image quality metric Orig. image Ref image\nNormalized image Difference image "}, {"section_title": "Real Data Experiments", "text": "To test our methods on real image data, we chose to use the Baltimore Longitudinal Study of Aging (BLSA)."}, {"section_title": "15", "text": "For nine subjects, we chose two consecutive scans per subject. In general these scans are a year apart of each other. We assume that the anatomical change in the brain is negligible within these two scans, as the subjects are healthy. The SPGR images are 0.9375\u00d70.9375\u00d71.5 mm 3 in resolution while the P D -w and T 2 -w images are of 0.9375\u00d70.9375\u00d75 mm 3 resolution. Initial preprocessing involved isotropic resampling, removal of non-brain tissue using SPECTRE, 16 removing intensity inhomogeneities using N3, 17 affine registration of the P D -w and T 2 -w images to the corresponding SPGR. The second year images were affine registered to the first, so as to carry out pixel-wise comparisons between the two. Table 4 describes the average MSE and KL distances between year one and normalized year two scan across all subjects. WMP and M2 are comparable since the pulse sequence used in both years is identical with possibly only a scale difference in the intensities. Fig. 4 shows the normalization result on a sample year 1 -year 2 pair of images. "}, {"section_title": "CONCLUSIONS AND FUTURE WORK", "text": "We have presented a novel paradigm for performing intensity normalization, which stays true to the underlying intrinsic biological MR properties. We have validated its performance using phantom and real brain images. An additional benefit of this method is the ability to characterize complex pulse sequences using three parameter pulse sequence approximate equations. Estimation of the tissue properties allows us to synthesize any desired MR contrast. This opens up avenues into the design of optimal pulse sequences for the best tissue contrast as well. We are interested in characterizing the underlying biological parameter space and reducing the number of images required, so that this approach can be applied more generally."}]