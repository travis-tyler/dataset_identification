[{"section_title": "Abstract", "text": "In this paper, we propose an image registration algorithm named statistically-based FFD registration (SFFD). This registration method is a modification of a well-known free-form deformations (FFD) approach. Our framework dramatically reduces the number of parameters to optimise and only needs to perform a single-resolution optimisation to account for coarse and fine local displacements, in contrast to the multi-resolution strategy employed by the FFD-based registration. The proposed registration uses statistical deformation models (SDMs) as a priori knowledge to guide the alignment of a new subject to a common reference template. These SDMs account for the anatomical mean and variability across a population of subjects. We also propose that available anatomical landmark information can be encoded within the proposed SDM framework to enforce the alignment of certain anatomical structures. We present results in terms of fiducial localisation error, which illustrate the ability of the SDMs to encode landmark position information. We also show that our statistical registration algorithm can provide registration results comparable to the standard FFD-based approach at a much lower computational cost."}, {"section_title": "INTRODUCTION", "text": "The analysis of medical images plays an increasingly important role in many clinical applications. One of the most important and recurrent procedures in this field is image registration. The goal of this approach is to estimate an optimal transformation T : x = (x, y, z) \u2192 x = (x , y , z ) that maps any point in a reference template image I 0 (x) onto its corresponding point in a source image I(x ).\nOne of the most clinically important applications of image registration is within functional or morphological studies of a cohort of subjects. Since the anatomical variability within the population under these studies can be potentially very large, non-rigid registrations to a common template space have to be performed in order to be able to subsequently conduct clinical or statistical comparisons within that common space. But, due to the large amount of degrees of freedom that a standard image registration problem involves, which is normally in the order of hundreds of thousands or even millions, it is necessary to further impose certain constraints to these non-rigid registrations so as to produce results that are coherent with respect to the group in study.\nIn this article, we propose a new registration approach referred as to statistically-based FFD registration (SFFD), in which any new unseen subject can be registered in a very efficient way by means of a statistical deformation model (SDM) learnt from N known deformations of brain images to a given common template space. This SDM account for the mean and variability of the known deformations and constraints the registration procedure to produce only statistically likely types of warps. Morover, in case of availability of anatomical landmarks we propose to encode them within our statistical framework, in order to provide a better alignment of the anatomical structures described by these points. Our work has many similarities to that presented previously by Loeckx et al. 1 where a statistical deformation model is trained using Principal Component Analysis (PCA) to be used for the registration of thorax CR images of the same subject for temporal substraction. New to our approach is that the deformations used to train our model are obtained automatically via registration rather than manually. Another important difference is the ability of our method to perform intra-and inter-subject registration on more complex images, like skull-stripped 3D brain MRI.\nPrevious contributions on the use of statistics for medical image registration include the work by Wang and Staib, 2 where statistical shape information of boundary points is incorporated into a Bayesian formulation of the objective function, which is subsequently used for elastic and fluid registrations. Benameur et al. 3 use a statistical deformable template to constraint a set of admissible deformations for the registration of scoliotic vertebrae. Xue et al. 4 performs PCA on each band of wavlets coefficients of voxel-wise deformations to obtain an SDM that permits the construction of a statistically-constrained voxel-wise registration framework. Fran\u00e7ois et al. 5 propose a rigid registration method for ultrasound images that makes use of a texture-based similartity measure where texture information is given by spatial Gabor filters and represented by statistical kernel-based distributions. Finally, PCA models are used to generate intermediate templates for faster registration in the papers by Kim et al. 6 and Tang et al. 7 Manually determined anatomical landmarks or salient points automatically detected within the images via feature extraction algorithms can be used to drive the registration process to produce deformations that align them as accurately as possible. In Johnson and Christensen 8 images are registered by iteratively aligning landmark positions and image intensities away from these locations. A similar approach is presented by Fischer and Modersitzki, 9 but in this case the landmark locations are used as a constraint for the energy function. Hartkens et al. 10 uses point and surface information to correct for large differences between pre-and post-resection images. Rohr et al. 11 describes a landmarkbased elastic registration algorithm where thin-plate splines resulting from a minimising functional allow to weight the landmarks according to their localisation uncertainty. Pennec et al. 12 present an approach to extract features like crest lines and extremal points and perform rigid registration between them. Fianlly, Arun et al. 13 presents an aprroach where corresponding feature points are found via SIFT, which are then used to estimate the transformation parameters using Moving Least Squares.\nThe rest of this paper is organised as follows. Section 2 describes the deformation model in which our work is based, and both the proposed statistical and landmark-based registrations. Experiments and results are shown on section 3. Finally, we conclude on section 4."}, {"section_title": "METHODS 2.1 Deformation Model", "text": "The B-splines based free-form deformation (FFD) algorithm 14 is still one of the best state-of-theart registration algorithms for medical imaging, with good results for inter-subject registration. 15 In this approach, the total transformation is represented by a global affine transformation plus a local displacement\nwhere the local displacement T ffd local (x) is the 3D tensor product of the familiar 1D cubic B-splines\nwhere \u03a6 denotes the unknown values for a number of control points that form a regular lattice of size n x \u00d7 n y \u00d7 n z which parameterises the FFD, i, j, k are the indexes of the control points, and u, v, w correspond to the relative positions of x in lattice coordinates. Given the reference template I 0 and the source I, this mapping maximises the energy functional\nwhere E similarity is a similarity measure, E smooth constrains the transformation to be smooth, and \u03b2 is a tradeoff between the two terms."}, {"section_title": "Optimisation", "text": "The energy functional in equation (3) is optimised using a gradient descent approach, where the gradient is computed using its analytical expression\nSince is not possible to directly calculate the gradient of the energy term with respect to the control point values \u03a6, equation (4) is rewritten, by means of the chain rule, as\nThe derivatives of the energy terms 16 for details), sum of squared differences or cross correrlation. The value of \u2202x \u2202\u03a6 is given by\nIn the case of the proposed statistical approach, which also uses gradient descent as optimisation method, it is necessary to calulate the analytical gradient of the energy term with respect to the new parameterisation \u03c9 \nTaking into account that we can trivially calculate\n\u2202\u03c9 = \u0393, equation (13) can be rewritten as\nHence, the gradient used in the statistical approach is the gradient with respect to the statistical representation \u03a6 (\u03c9) , projected to the new parameterisation using the bases matrix \u0393.\nFor the landmark approach, the gradient is given by\nwhere \u2202Effd \u2202\u03a6 is given by equation (5) and\nProc. of SPIE Vol. 8314 831418-5\nHere, \u03a8 (x 2 ) = 1 1+x 2 /\u03bb 2 and\nis the Jacobian of the displacement field at point l"}, {"section_title": "Statistically-based FFD registration (SFFD)", "text": "Given a population of N subjects S 1 , . . . , S N registered to a common reference template with precomputed FFDs E 1 , . . . , E N \u2208 R 3\u00d7nx\u00d7ny\u00d7nz , a new subject S * can be registered using a SDM learnt from E j (j = 1, . . . , N) following the approach by Rueckert et al. 17 We introduce a modification to the classical FFD transformation in equation (1)\nHere, T sffd local (x) are the local displacements for S * given by:\nwhere \u03a6 (\u03c9) = (M + \u0393\u03c9) is the statistical representation of the x, y and z components of the control point values as a funtion of a new parameterisation \u03c9 \u2208 R P \u00d71 , where P is a chosen parameter that represents the number of degrees of freedom to use. \u0393 \u2208 R (3\u00d7nx\u00d7ny\u00d7nz)\u00d7P is the bases matrix and M \u2208 R (3\u00d7nx\u00d7ny\u00d7nz)\u00d71 is the shift vector that, depending on the particular statistical technique in use, is either the zero vector or the mean vector M = 1 N N j=1 E j . A summary of the proposed framework is depicted on Fig. 1 .\nIn this paper, we utilise PCA to obtain the bases matrix \u0393. When using PCA, the bases matrix \u0393 corresponds to the first P eigen vectors of the covariance matrix C =\nand M is the mean vector.\nGiven the new mapping T sffd (x), the reference template I 0 and the source I, our proposed SFFD registration approach maximises the energy functional\nNote that the dimentionality of the unknown \u03c9 is P , whereas registering S * directly with (3) involves optimising 3 \u00d7 n x \u00d7 n y \u00d7 n z variables. Thus, since in most cases p 3 \u00d7 n x \u00d7 n y \u00d7 n z , our method allows for a substantial reduction in the number of parameters. Figure 1 . Proposed statistical framework. Note that the training process needs to be performed only once in order to be able to statistically register any number of unseen images."}, {"section_title": "Landmark-based FFD registration (LFFD)", "text": "The statistical registration (9) assumes that a set of N pre-computed FFDs are available. These can be obtained via (3) . However, if a priori information about the position of anatomical landmarks is available, it is posible to incorporate this information into our statistical model. For this purpose, we propose an alternative approach to obtain the pre-computed FFDs. This approach can be realised as (3) with an additional energy term that accounts for the alignment of the landmarks:\nwhere \u03b1 is a tradeoff parameter and E landmark is defined as\nL is the number of landmarks, l I i is the location of the i-th landmark on the source I, and T ffd (l I 0 i ) is the location of the i-th landmark on the reference template I 0 mapped onto I. We employ a robust function \u03a8 to control the penalisation of large landmark discrepancies. 18 We choose the Cauchy function 19 \u03a8(x 2 ) = \u03bb 2 log(1 + (x 2 /\u03bb 2 )). The parameter \u03bb represents an inflection point on the curve from which large deviations (outliers) are downweighted."}, {"section_title": "RESULTS", "text": "In our experimental setting we utilised 820 1.5 Tesla T1-images from the Alzheimer's Disease Neuroimaging Initiative (ADNI) database, 20 from which 500 where used to learn M and \u0393, and the remaining 320 for testing. As common reference template I 0 we used the MNI single-subject T1-atlas. 21 We utilised normalised mutual information (NMI) 22 as similarity measure and thin-plate bending energy 23 as regulariser. We chose p as the number of principal components that account for 95% of subject variability. In the landmark-based registration method, the number of landmarks L is 20 per subject (see Rueckert et al. 17 for a further description of the landmarks used), the parameter \u03bb was set to 3, and the weight for the bending energy \u03b2 was set to 0.001.\nWe compare the FFD-based registration (3) against our statistical SFFD framework (9) , measuring the fiducial error, i.e., how well the landmarks are aligned. Table. 1 shows these results for different values of the trade-off parameter \u03b1. The method (3) produces more accurate results than our model (9) when there is no or little utilisation of the landmark information (\u03b1 \u2208 [0, 0.5]). On the contrary, increasing the value of \u03b1 does improve the alignment. Thus, our method embeds both the variability across the population and the landmark information. Table 1 . Mean fiducial errors (in voxels) over 320 images for the proposed statistical registration method (SFFD) using PCA, trained with examples from landmark registration using different values of \u03b1, compared to the standard FFD approach. \u03b1 = 0 3.08 \u00b1 1.1 \u03b1 = 0.5 2.87 \u00b1 0.68 \u03b1 = 1 2.74 \u00b1 0.64 \u03b1 = 2 2.53 \u00b1 0.6 FFD 2.82 \u00b1 1.25\nWe now look at the NMI measure between the template and the registered source using both methods (3) and (9) for \u03b1 = 2. Fig. 2 shows that the FFD-based method appears more accurately aligned in terms of intensity similarity. However, intensity matching does not necessarily correlate with the alignment of anatomical structures. The strenght of our method is that it takes advantage of both sources of information.\nFinally, we measured the mean computational cost of 85 registrations using both methods. The FFD-based approach takes 12 minutes, whereas our statistical approach takes 4.5 minutes. It is worth mentioning that while the former is solved using multi-resolution optimisation, the latter is solved using a single-resolution optimisation. This is due to the fact that the statistical training is fed with FFDs obtained via multi-resolution optimisation, which implicitly account for both coarse and fine displacements. "}, {"section_title": "CONCLUSION", "text": "In this article, we introduced a registration approach based on statistical deformation models learnt from a population of groupwise registered subjects. These models are employed as prior information knowledge to guide the alignment of a new subject to a common reference template. Furthermore, the learning stage of our framework can take advantage of available landmark information to enforce the alignment of certain anatomical structures. We focused on the case where a set of deformations registering a group of subjects to a common template is already available. Thus, any subsequent registration of an unseen image, to the template space, can be performed via the proposed framework. Our preliminary results suggest that the proposed statistical registration method can can provide registration results comparable to the standard FFD-based approach at a much lower computational cost."}]