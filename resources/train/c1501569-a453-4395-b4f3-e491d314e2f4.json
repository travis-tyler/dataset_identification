[{"section_title": "Abstract", "text": "Functional connectomes reveal biomarkers of individual psychological or clinical traits. However, there is great variability in the analytic pipelines typically used to derive them from rest-fMRI cohorts. Here, we consider a specific type of studies, using predictive models on the edge weights of functional connectomes, for which we highlight the best modeling choices. We systematically study the prediction performances of models in 6 different cohorts and a total of 2000 individuals, encompassing neuro-degenerative (Alzheimer's, Post-traumatic stress disorder), neuro-psychiatric (Schizophrenia, Autism), drug impact (Cannabis use) clinical settings and psychological trait (fluid intelligence). The typical prediction procedure from rest-fMRI consists of three main steps: defining brain regions, representing the interactions, and supervised learning. For each step we benchmark typical choices: 8 different ways of defining regions -either pre-defined or generated from the rest-fMRI data-3 measures to build functional connectomes from the extracted time-series, and 10 classification models to compare functional interactions across subjects. Our benchmarks summarize more than 240 different pipelines and outline modeling choices that show consistent prediction performances in spite of variations in the populations and sites. We find that regions defined from functional data work best; that it is beneficial to capture between-region interactions with tangent-based parametrization of covariances, a midway between correlations and partial correlation; and that simple linear predictors such as a logistic regression give the best predictions. Our work is a step forward to establishing reproducible imaging-based biomarkers for clinical settings."}, {"section_title": "Introduction", "text": "Resting-state functional Magnetic Resonance Imaging (rest-fMRI), based on the analysis of brain activity without specific task, has become a tool of choice to probe human brain function in healthy and diseased populations. As it can easily be acquired in many different individuals, rest-fMRI is a promising candidate for markers of brain function (Biswal et al., 2010; Greicius, 2008) . This has lead to the rise of large-scale rest-fMRI data collections, such as the human connectome project (Van Essen et al., 2013) or ABIDE (Di Martino et al., 2014) . Larger datasets bring increased statistical power (Elliott et al., 2008) , and many population-imaging studies use rest-fMRI to relate brain imaging to neuropathologies or other behavior and population phenotypes Dubois and Adolphs, 2016) . These efforts build biomarkers from rest-fMRI with predictive models (Woo et al., 2017) .\nA functional connectome -characterizing the network structure of the brain (Sporns et al., 2005) -can be extracted from functional interactions in rest-fMRI data (Varoquaux and Craddock, 2013) . The weights of the corresponding brain functional connectome are used to characterize individual subjects behavior, cognition, and mental health (Craddock et al., 2009; Richiardi et al., 2010; Milazzo et al., 2014; Smith et al., 2015; Miller et al., 2016; Colclough et al., 2017; Dubois et al., 2018) , aging (Liem et al., 2017) as well as brain pathologies (Drysdale et al., 2016; Abraham et al., 2017; Ng et al., 2017) .\nMachine-learning pipelines are key to turning functional connectomes into biomarkers that predict the phenotype of interest (Woo et al., 2017) . On rest-fMRI, such a pipeline typically comprises of 3 crucial steps as depicted in Fig. 1 , linking functional connectomes to the target phenotype (Varoquaux and Craddock, 2013; Craddock et al., 2015) . Yet, there exist many variations of this prototypical pipeline, even for classification from edge-weights of brain functional connectomes, as revealed by reviews of the field (Wolfers et al., 2015; Arbabshirani et al., 2017; Brown and Hamarneh, 2016) . These various choices have a sizable impact on the accuracy of population studies, and are seldom discussed (Carp, 2012) . The cost of such analytical variation is twofold. First, it puts the burden on the practitioner to explore many options and make choices without systematic guidance. Second, methods variations create researchers degrees of freedom (Simmons et al., 2011) that can compromise the measure of the prediction accuracy of biomarkers (Varoquaux, 2017) . Guidelines on optimal modeling choices are thus of great value for rest-fMRI biomarker research.\nHere, we perform a systematic benchmark of common choices for the different steps of the functional connectome-based classification pipeline. To outline the preferable strategies, we analyze the prediction accuracy across 6 different cohorts, with different clinical questions and one psychological trait, different sample sizes, and prediction problems of different difficulties. While best model choice may vary depending on the prediction task, our benchmarks outline some trends. Specifically, we explore the following analytical choices:\nHow should nodes be chosen: via pre-defined atlases, or data-driven approaches? How many nodes are needed for brain-imaging based diagnosis? Should nodes be distributed brain networks or regions of interest (ROIs)? How should weights of brain functional connectomes be represented: via correlations, partial correlation, or more complex models capturing the geometry of covariance matrices? What classifiers should be used for machine learning on weights of brain functional connectomes? Should linear or non-linear models be preferred? Should sparse or non-sparse models be used? With or without feature selection?\nBesides these main questions, we did additional experiments on preprocessing strategies -studying the effect of band-pass filtering and global signal regression-and on covariance estimators, by comparing sparsity-inducing to classical shrinkage.\nThe paper is organized as follows: we first review current practices and methods used to-date for prediction of psychiatric diseases from weights of brain functional connectomes. Then, we present the different choices that we benchmark for the steps of classification pipelines and describe these methods. Finally, we report our experimental results and the trends that they reveal. Fig. 1 shows the standard rest-fMRI classification pipeline that we consider."}, {"section_title": "Methods: functional connectome-classification pipeline", "text": ""}, {"section_title": "A brief review of current practices: functional connectome-based predictive methods", "text": "We first survey methods used for prediction studies based on three extensive reviews: Wolfers et al. (2015) ; Arbabshirani et al. (2017) ; Brown and Hamarneh (2016) . From these reviews, 27 studies used rest-fMRI and gave good classification scores. Below, we briefly outline the choices in the different pipeline step used (see Table A2 in the appendix for the full list).\nDefinition of brain ROIs.Studies define ROIs to extract signals with a variety of approaches: balls 2 of radius varying from 5mm to 10mm centered at coordinates from the literature (Dosenbach et al., 2010; Power et al., 2011) ; reference anatomical atlases such as AAL (Tzourio-Mazoyer et al., 2002) , sulci-based atlases (Perrot et al., 2009; Desikan et al., 2006) , or connectivity-based cortical landmarks (Zhu et al., 2013) ; data-driven approaches based on k-means or Ward clustering, as well as Independent Component Analysis (ICA) approaches (Calhoun et al., 2001; Beckmann and Smith, 2004) or dictionary learning (Abraham et al., 2013) .\nThe number of nodes used was typically around 100, but ranged from dozens to several hundreds.\nRepresentation of brain functional connectomes. Studies define functional interactions from second-order statistics -based on signal covariance-using Pearson's correlation or partial correlations estimated mostly either with the maximum-likelihood formula for the covariance or the Ledoit-Wolf shrinkage covariance estimator (Ledoit and Wolf, 2004; Varoquaux and Craddock, 2013; Brier et al., 2015) . Partial correlation between nodes is useful to rule out indirect effects in the correlation structure, but calls for shrunk estimates (Smith et al., 2011; Varoquaux et al., 2010b) . Mathematical arguments have also led to representations tailored to the manifold-structure of covariance matrices (Varoquaux et al., 2010a; Ng et al., 2014; Dodero et al., 2015; Colclough et al., 2017) . We benchmark the simplest of these, a tangent representation of the manifold which underlies the more complex developments (see Appendix A for a quick introduction to this formalism).\nClassifiers used for prediction. Many different classifiers have been used, whether linear or non-linear, sparse or non-sparse, optionally with prior feature selection. See Table A2 for the comprehensive list of classifiers used in these studies. Finally, beyond the prototypical pipeline exposed above, some studies employ complex-graph network modeling approaches -e.g. network modularity or centrality (Rubinov and Sporns, 2011)-(Wolfers et al., 2015; Arbabshirani et al., 2017; Brown and Hamarneh, 2016) These approaches are seldom combined with supervised learning. Indeed, graph-theory metrics capture well global aspects of brain connectivity, but do not lend themselves well to tuning to connections in specific subnetworks (Hallquist and Hillary, 2018) . Here, we focus on machine-learning methods that extract discriminant connections; as such we do not study graph-theoretical approaches. Fig. 1 . Functional connectome-prediction pipeline with three main steps: 1) Definition of brain regions (ROIs) from rest-fMRI images or using already defined reference atlases, 2) quantifying functional interactions from time series signals extracted from these ROIs and 3) comparisons of functional interactions across subjects using supervised learning.\nThe current practice is very diverse, without standard modeling choices. To open the way toward informed decisions, we explore popular variants of the classic machine-learning pipeline to predict on connectomes. We measure the impact of choices at each step on prediction for diverse targets across multiple datasets. We detail below the specific modeling choices included in our benchmarks."}, {"section_title": "Definition of brain regions of interest (ROIs)", "text": "For functional connectomes, the hypothesis is that the Definition of ROIs should capture well the relevant functional units (Smith et al., 2011) . We study both anatomically and functionally defined reference brain atlases, as well as data-driven methods that define ROIs from the data at hand. ROI selection is a difficult choice, as the optimal may vary for different conditions or pathologies.\nA selection of pre-defined atlases. We consider four standard atlases, of which two are structural atlases: i) Automated Anatomical Labeling (AAL) (Tzourio-Mazoyer et al., 2002) , a structural atlas with 116 ROIs defined from the anatomy of a reference subject, ii) Harvard Oxford (Desikan et al., 2006) , a probabilistic atlas of anatomical structures, contains of 48 cortical & 11 sub-cortical ROIs in each hemisphere, ie 118 ROIs in total. We also include two functional atlases: iii) Bootstrap Analysis of Stable Clusters (BASC) (Bellec et al., 2010) , a multi-scale functional atlas built with clustering on rest-fMRI, coming with different f36; 64; 122; 197; 325; 444g numbers of ROIs; iv) Power, a coordinate-based atlas consisting of 264 coordinates used to position balls of 5mm radius (Power et al., 2011) . For an additional set of benchmarks, on larger data, we use only pre-computed regions. For a pre-computed functional atlas with dictionary learning, we use an atlas 3 computed by Mensch et al. (2016a) with a very scalable sparse dictionary-learning algorithm on the HCP900 dataset (Van Essen et al., 2012) . This algorithm, MODL (massive online dictionary learning), solves the \u2113 1 dictionary-learning problem with an algorithm fast on very large datasets that converges to the same solution as standard on-line solvers (Mensch et al., 2018) .\nA selection of data-driven methods. We consider four popular datadriven methods to extract brain ROIs from intrinsic brain activity (Yeo et al., 2011; Kahnt et al., 2012; Thirion et al., 2014; Calhoun et al., 2001; Beckmann and Smith, 2004; Abraham et al., 2013) . We choose to define ROIs using two clustering methods: i) K-Means (Hastie et al., 2009) , and ii) hierarchical agglomerative clustering using Wards algorithm (Ward, 1963) with spatial connectivity constraints (Michel et al., 2012) ; and two linear decomposition methods: iii) Canonical Independent Component Analysis (GroupICA or CanICA) (Varoquaux et al., 2010c) , iv) Dictionary Learning -\u2113 1 (DictLearn) (Mensch et al., 2016b) .\nDimension selection in data-driven atlases. For clustering methods, we extract brain atlases with a varying number of ROIs in dim \u00bc f40; 60; 80; 100; 120; 150; 200; 300g. With linear decomposition methods i.e. CanICA and DictLearn, we explore the following number of components: dim \u00bc f40; 60; 80; 100; 120g. 4 For each data-driven method, we learn brain ROIs on the training set only, to avoid possible overfit . In a cross-validation loop, for each split, we define the brain ROIs on a training set and use the atlases to learn connectivity patterns for prediction. We also applied additional Gaussian smoothing of 6mm on preprocessed rest-fMRI datasets for all data-driven methods prior to learning brain ROIs to enhance the region extraction step.\nNodes formed local regions or distributed networks? Current practices in functional connectomics includes defining nodes as local regions of the brain (Shirer et al., 2012; Craddock et al., 2012) , or as full distributed functional networks that may include several regions (Smith et al., 2015; Yeo et al., 2011) . We consider both approaches: using the distributed networks, or breaking them up in regions with a segmentation step to separate out regions (Abraham et al., 2014a) . For example, a bi-hemispheric brain networks is separated into regions, one in each hemisphere.\nWe use a Random-Walker based extraction of regions from the brain networks obtained by CanICA and DictLearn as proposed in Abraham et al. (2014a) . By contrast, for K-Means and BASC, we simply break out clusters in their connected components. During this procedure, we remove spurious regions of size < 1500mm 3 . Fig. 2 shows an example of the set of brain regions obtained from the various data-driven methods on the ADNI rest-fMRI data."}, {"section_title": "Connectivity parametrization", "text": "We extract representative time series for each node. For signal extraction, we explored several denoising strategies to account for nonneural artifacts: with or without low-pass filtering or global signal mean regression (details in Appendix B). To estimate functional connectomes efficiently, we use the Ledoit-Wolf regularized shrinkage estimator (Ledoit and Wolf, 2004; Varoquaux and Craddock, 2013; Brier et al., 2015) , which gives a closed form expression for the shrinkage parameter. This estimator yields well-conditioned estimators despite the variation in length of time series across rest-fMRI datasets. We also explored non-regularized and sparse estimator for the covariance (see Appendix H.2). With this covariance structure, we study three different parametrizations of functional interactions: full correlation, partial correlation (Smith et al., 2011; Varoquaux and Craddock, 2013) and the tangent space of covariance matrices. The latter is less frequently used but has solid mathematical foundations and a variety of groups have reported good decoding performances with this framework (Varoquaux et al., 2010a; Barachant et al., 2013; Ng et al., 2014; Dodero et al., 2015; Qiu et al., 2015; Rahim et al., 2017; Wong et al., 2018) . We compared two variants, using as a reference point the Euclidean mean (Varoquaux et al., 2010a) or the geometric mean ; in both cases we rely on Nilearn implementation (Abraham et al., 2014b) . Note that computing partial correlation or tangent space require inverting covariance matrices, hence these must be well conditioned. Non regularized covariance estimation is thus not useable for these parametrizations.\nFor each parametrization, we vectorize the functional connectome, 4 We also investigated higher dimensionality (150, 200 and 300) on some of the datasets, but could not do a systematic study above 300 because of high computational costs. These preliminary results showed no improvements in prediction accuracy compared to lower dimensionalities. It should be noted that the resulting components typically encompass several brain regions, which explains the dimension difference.\nusing the lower triangular part of the connectomes matrix for classification. Additionally, on the ACPI dataset, we considered the ADHD status of the subjects as a variable of non interest and regressed it out in this second-level analysis, as we were interested in predicting the consumption of Marijuana."}, {"section_title": "Supervised learning: classifiers", "text": "The final step of our pipeline predicts a binary phenotypic status from connectivity features extracted from previous step. We consider several linear and non-linear classifiers for prediction i.e. both sparse and nonsparse methods. For non-linear methods, we consider Nearest Neighbors (K-NN) (Cover and Hart, 1967) been found to be a good default ."}, {"section_title": "Experimental study", "text": "To benchmark the various predictive-modeling choices, we apply the functional connectome-classification pipeline on five publicly-available rest-fMRI datasets. We study prediction from functional connectomes of various clinical outcomes -neuro-degenerative and neuro-psychiatric disorders, drug abuse impact, fluid intelligence. We focus on binary classification problems, predicting a phenotypic target between two groups. We use the following datasets, summarized in Table 1: 1. COBRE, Center for Biomedical Research Excellence, 6 comprising restfMRI data to study schizophrenia and bipolar disorder (Calhoun et al., 2012) . We focus on predicting schizophrenia diagnosis versus normal control. 2. ADNI, the Alzheimer's Disease Neuroimaging Initiative 7 database studies neuro-degenerative diseases (Mueller et al., 2005 Martino et al., 2014) . We use the data from Preprocessed Connectome Project to discriminate individuals from Autism Spectrum Disorder from normal controls. 6. HCP, 10 Human Connectome Project contains imaging and behavioral data of healthy subjects (Van Essen et al., 2013) . We use preprocessed rest-fMRI data from HCP900 release (Van Essen et al., 2012) to discriminate individuals from high IQ and low IQ. We used HCP rs-fMRI datasets to probe a different setting: data with longer acquisitions. Due to the data size, we limit the benchmarks here to pre-computed atlases.\n3.1. Rest-fMRI data processing: softwares and related Data preprocessing. We preprocess COBRE, ADNI, and ADNIDOD. We use a standard protocol that includes: motion correction, fMRI coregistration to T1-MRI, normalization to the MNI template using SPM12, 11 Gaussian spatial smoothing (FWHM \u00bc 5mm). The SPM based preprocessing pipeline is implemented through pypreprocess 12 -Python scripts relying on Nipype interface (Gorgolewski et al., 2011) . All subjects were visually inspected and excluded from the analysis if they have severe scanner artifacts or head movements with amplitude larger than 2mm. Since pre-processed rest-fMRI subjects from ABIDE and ACPI are available, we choose images pre-processed using C-PAC pipeline , without global signal regression. For ACPI, we choose linearly registered images using (Advanced Normalization Tools) ANTS and without motion scrubbing and no global signal regression. For already available preprocessed rest-fMRI subjects, we select the protocols such that it matches with the standard protocol we use. We have not done any additional preprocessing steps on ABIDE and ACPI. Exclusion criteria. We not only exclude subjects based on visual inspection of preprocessed data, but also subjects that do not fall into binary classification groups, eg we removed subjects who had both bipolar disorder and schizoaffective groups from COBRE samples. For HCP, we select the subjects with single session and phase encoding in a left-toright (LR) direction. Out of these selected subjects, we discriminate the low IQ from the high IQ individuals, where the data are split in 3 according to quantiles 0.333 and 0.666, and the subjects in the middle group are excluded to make the prediction easier in a binary classification setup (see Table 1 for numbers of subjects included in the analysis).\nCross validation and error measure. We perform cross-validation (CV) by randomly shuffling and splitting each dataset over 100 folds, forming two sets of subjects: 75% for training the classifier and learning brain atlases with data-driven models and the remaining 25% for testing on unseen data . We create stratified folds, preserving the ratio of samples between groups. For each split, we measure the Area Under the Curve (AUC) from the Receiver Operating Characteristics (ROC) curve: 1 is a perfect prediction and .5 is chance. The final prediction scores in AUC (> 120k scores) are used to measure the impact of Table 1 Datasets and prediction tasks, as well as the number of subjects in each group. COBRE -142 subjects, ADNI -136 subjects, ADNIDOD -167 subjects, ACPI -126 subjects, ABIDE -866 subjects, HCP -443. IQ represents fluid intelligence; 788 subjects had an IQ score in the HCP900 release. The acquisition parameters of each dataset are summarized in Table A3 . various choices in our prediction pipeline outlined below in results section.\nComputations and implementation. Our experimental study consists of more than 240 types of pipelines (8 atlases \u00c2 3 connectivity measures \u00c2 10 classifiers, plus some variants such as 3 filtering options and 3 covariance estimator options). These pipelines were run on each of 5 datasets for 100 CV folds. As a result, there are more than 500 000 pipeline fits, from the raw data to the supervised step, a heavy computational load. Technically, we rely on efficient implementations opensource scientific computing packages using Python 2.7: Nilearn v0.3 (Abraham et al., 2014b) to define brain atlases, extract representative timeseries and timeseries confounds regression, and build connectivity measures. All machine-learning methods used for prediction i.e., classifiers and cross-validation are implemented with scikit-learn v0.18.1 (Pedregosa et al., 2011) . For visualization, we rely on Nilearn for brain-related figures while matplotlib is used (Hunter, 2007) for generating other figures."}, {"section_title": "Results: benchmarks of pipeline choices", "text": "We now outline which modeling choices have an important impact on predicting over diverse phenotypes from all rest-fMRI datasets.\nWe report in Table 2 the AUC scores obtained for all rest-fMRI datasets. The scores reported in the table are simplified to the optimal choice selection at each step in the pipeline which showed significant impact. These optimal choice of steps are discussed in following sections.\nImpact of methodological choices. We study the prediction score of each pipeline relative to the mean across pipelines on each fold. This relative measure discards the variance in scores due to folds or datasets. From these relative prediction scores, we study the impact of the choice of each step in the prediction pipeline: choice of classifiers, connectivity parametrizations, and brain atlases. This is a multifactorial set of choices and there are two points of view on the impact of a choice for a given step. First, the impact of the choice for one step may be considered when the other steps are optimal, or close to optimal. Second, the impact of one step may be considered for all other choices for the other steps -marginally on the choice of other steps. Empirically, the two scenario lead to similar conclusions. In the following figures, we study the first situation, focusing on \"good choices\": given a choice for one step, we report data for top third highest performing scores (quantiles 0.666) for the choices in the other steps. Appendix C gives results for all scores, hence studying one choice, marginally upon the others. Fig. 3 summarizes the performances of classifiers on prediction scores for all rest-fMRI datasets. The results display a certain amount of variance across folds and datasets (i.e., prediction targets). However, they show that non-sparse (l 2 -regularized) linear classifiers perform better, with a slight lead for logistic-l 2 . Using non-linear classifiers does not appear useful; neither does sparsity. The results in Fig. 3 are conditional on a good choice for the other steps of the pipeline. The marginal performances of the different choices of classifiers -i.e. cconsidering all other choices in the pipeline-are shown in Figure A2 . They show similar trends, leading to preferring l 2 -regularized linear classifiers. Fig. 4 summarizes the impact of covariance matrix parametrization on the relative prediction scores for all rest-fMRI datasets. Tangent-space parametrization tends to outperform full correlations or partial correlations. Indeed, it performs better on average, but also has less variance across datasets (prediction targets) or folds. Results are similar for simpler variant of the tangent-space parametrization relying on a simple Euclidean mean rather than the full geometric (Riemannian) -see Appendix A for more details. While scores in Fig. 4 are conditional on a good choice for other pipeline parameters, Figure A3 gives results marginal to all choices. In both settings, connectivity matrices built with tangent space parametrization give an improvement compared to full or partial correlations."}, {"section_title": "Choice of classifier", "text": ""}, {"section_title": "Choice of connectivity parameterization", "text": ""}, {"section_title": "Choice of regions definition method", "text": "To find the preferred approaches to define brain regions, we proceed in two steps. First, for each method, we find the dimensionality that gives the best prediction. This holds for the BASC atlas, that comes in various dimensionalities, and for data-driven region-Definition methods, for which we vary the dimensionality. Second, we study the prediction accuracy for each approach at the optimal dimensionality.\nBest approach. Fig. 5 summarizes the relative prediction performance of all choices of region-Definition methods. While the systematic effects are small compared to the variance over the folds and the datasets, the general trend is that regions defined from functional data lead to better prediction than regions defined from anatomy. Using \u2113 1 dictionary learning to define regions from rest-fMRI data appears to be the best Table 2 5th percentile, median and 95th percentile of accuracy scores in AUC over cross-validation folds (n \u00bc 100) for all five rest-fMRI datasets. Accuracy scores reported correspond to optimal choices in functional connectivity prediction pipeline: brain regions defined with regions using DictLearn, connectivity matrices parametrized by their tangent-space representation, and an l 2 -regularized logistic regression as a classifier, as discussed below. Best prediction is achieved with schizophrenia vs control discrimination task on COBRE dataset at 86:2% (median). Figure A2 gives all the data points, not limited to good choices in the overall pipeline. Overall, l 2 -regularized linear classifiers perform better, with a slight lead for \u2113 2 logistic regression. The box plot gives the distribution across folds (n \u00bc 100) and datasets (denoted by markers) of prediction score for a given choice (classifier) relative to the mean across all choices (regions-definition and connectivity parametrizations, classifiers). The box displays the median and quartiles, while the whiskers give the 5 th and 95 th percentiles. method, closely followed by ICA, which is also based on a linear decomposition model. Interestingly, BASC, an atlas pre-defined on unrelated rest-fMRI datasets using data-driven clustering technique, performs almost as well as the best regions-extraction method applied to the rest-fMRI data of interest. Unlike other pre-defined atlases, like Harvard Oxford or AAL, that lack some crucial functional regions. The BASC atlas (Bellec et al., 2010 ) is readily available online, and is thus easy to apply to data. Fig. 5 shows the impact of region-definition approach conditional on good choices in the other steps of the pipeline, however studying the impact of region-definition independently of other choices ( Figure A4 ). Both comparisons highlight that defining regions from functional data gives the best-performing pipelines, and that linear-decomposition methods are to be preferred. Optimal dimensionality. The choice of the best dimensionality for each approach paints a less clear picture (Fig. 6 ): a range of dimensionalities lead for good prediction for each method. 13 We find that there is a very soft optimum: prediction reaches a plateau as the number of extracted networks increases, and then slowly decreases for some methods. To favor the most parsimonious model, in this paper we choose to work at the lower end of the plateau (red arrow on Fig. 6 ): simpler models for better stability and statistical control. While this choice is not clear cut, the curves also suggest that, in a reasonable range, it does not have a large impact on prediction accuracy. Note that the dimensionality here corresponds to the number of networks, these are then broken up into separate regions. We find that the typical number of regions at the optimal is around 150 (Appendix E).\nLocalized regions or distributed networks. Nodes of the functional connectomes may be defined from localized regions, or the distributed networks that naturally arise from approaches such as ICA or dictionary learning. The choice of one over the other has little impact over prediction, though there is slight, non significant, benefit to using regions ( Figure A5 )."}, {"section_title": "Larger datasets and pre-computed atlases", "text": "To investigate the consistency of analytics choices for higher-quality datasets, we perform extra benchmarks including the HCP data. As this data comprises much longer time-series, we restrict our analysis to precomputed atlases, that alleviate computational costs. We share the resulting time-series and scripts to reproduce our analysis.\n14 Fig. 7 summarizes the impact of method choice on the prediction accuracy for all six different cohorts. This experiment outline similar tradeoffs as the others: functional atlas pre-computed with dictionary learning (here MODL, from Mensch et al. (2016a) ), tangent-space parametrization, and l 2 -regularized classifiers are preferable. This experiment is not as systematic as the other, as a very large dataset like HCP would require much more computing power to study region extraction.\n15 Yet, even for region-Definition methods, it outlines similar trends than when tuning the regions to the data at hand."}, {"section_title": "Filtering, global signal, and covariance estimation", "text": "When extracting functional signal for connectivity modeling, there are many options to reject confounds, including temporal filtering or Figure A3 gives all the data points, not limited to good choices in the overall pipeline. Prediction using tangent space based connectivity parameterization displays higher accuracy with relatively lower variance than using full or partial correlation. The box displays the median and quartiles, while the whiskers give the 5 th and 95 th percentiles. Figure A4 gives all the data points, not limited to good choices in the overall pipeline. Learning atlases from rest-fMRI data tends the prediction for all tasks. By contrast anatomical atlases perform poorly over diverse tasks. The box displays the median and quartiles, while the whiskers give the 5 th and 95 th percentiles.\nglobal signal mean regression (Fox et al., 2009; Murphy et al., 2009; Power et al., 2012) . Also, to extract a structure reflecting well brain connectivity, it has been show that careful covariance estimation is useful and that sparse inverse covariance methods perform well (Smith et al., 2011; Varoquaux et al., 2010b) . For both of these steps, our experiments for predictive modeling applications do not reveal clear preferences. Different time-series filtering approaches (band-pass or global-signal regression) make no visible differences on prediction accuracy ( Figure A9) . A likely reason is that the supervised step can learn a predictor that is independent of the corresponding noise in the signal.\nWith regards to covariance estimation, we also investigate the empirical covariance (maximum likelihood estimator) and sparse inverse covariance (Appendix H). The empirical covariance can only be used to compute correlations -as partial correlation or tangent parametrization require an invertible covariance matrix-in which case it performs similarly as the Ledoit-Wolf estimator (see Figure A11 ). Sparse inverse covariance performs as well or worse than the Ledoit-Wolf estimator. This latter estimator is easier to use, as it is faster and does not require setting a regularization parameter. Learning discriminant connectivity patterns across conditions does not seem to require the same regularization -sparsity-as identifying the brain connectivity structure."}, {"section_title": "Discussion", "text": "An increasing amount of studies use predictive models on functional connectomes, for instance in population-imaging settings to relate brain activity to psychological traits or to build biomarkers of pathologies. While the basic steps of a pipeline are fairly universal -Definition of brain regions, construction of an interaction matrix, and supervised learningstudies in the literature show many methodological variants (Table A2 ). Recommendations on methods that perform well can increase practitioner's productivity and limit vibration effects that risk undermining the reliability of biomarkers (Varoquaux, 2017) . A challenge to such recommendations is the heterogeneity of prediction settings, for instance across different acquisition centers or clinical questions.\nHere, we investigate methodological choices across 6 databases covering different clinical questions and behavioral task. We systematically compare commonly used functional connectome-based prediction methods. We find that some trends emerge, despite a large variance due to variability across subjects -visible across the folds-and across cohorts and clinical questions. Non-sparse linear models, such as logistic regression, appear as a good default choice of classifier. The lack of success of sparse approaches suggests that the discriminant signal is distributed across the functional connectome for the tasks we study. The tangent-space parametrization of functional connectomes brings improvements to prediction accuracy. With regards to nodes of the functional connectomes, defining them from rest-fMRI data gives slight benefits in prediction. Linear decomposition methods, such as dictionary learning or ICA, are good approaches to define these nodes from the rest-fMRI data at hand. Unlike clustering methods base on \"hard\" assignment, they provide a soft assignment to regions, enabling to capture a form of uncertainty in the Definition of regions. Alternatively, the MODL 16 (Mensch et al., 2016a) or BASC (Bellec et al., 2010) atlases provide good readily-available nodes that simplify the process and alleviate computational cost. The good analytic performance of pre-computed atlases is promising and calls for further study. Establishing standard atlases brings significant computational benefits, as the definition of regions and the extraction of signal is the most computation-intensive part of the pipeline -in particular when performed inside a nested cross-validation loop. We found that using around 100 networks (corresponding to 150 regions) was sufficient for good prediction, though for many region-definition approaches a finer resolution did not hurt average prediction accuracy but only increased variance. Overall, these results are consistent with the practice of the field. Preliminary comparisons in Abraham et al. (2017) on a single cohort revealed similar trends though ICA had performed poorly while here, with more systematic benchmarking, it appears to be a good solution. ICA has been used to define functional parcellations or nodes of functional connectomes by many groups (Kiviniemi et al., 2009; Rashid et al., 2014; Smith et al., 2015; Miller et al., 2016) . More generally, it is well recognized that the nodes should be defined to match functional networks (Smith et al., 2011) . Logistic regression, or the closely-related SVM, is the go-to classifier for many. Tangent-space parametrization of the connectivity matrix is more exotic, probably due to the mathematical complexity of its original presentation. However, it is gaining traction outside of methods studies (Colclough et al., 2017; Ng et al., 2017) and is simple to implement, as summarized in Appendix A.\nTo enable comparison across different cohorts, we focused on 2-class classification problems. However, the results in terms of regions Definition and connectivity parametrization should extend to other supervised learning settings, such as regression -e.g. for age prediction (Liem et al., 2017 )-multi-output approaches as with Canonical Correlation Analysis popular in large-scale population imaging settings (Smith et al., 2015; Miller et al., 2016) for dimensional approaches to psychology. Fig. 6 . Impact of the number of regions in atlases on prediction accuracy. The figure shows the distribution of the relative accuracy AUC scores across methods on the five rest-fMRI datasets, as a function of the number of regions. Horizontal bars (black) represent the median of the relative scores for the given number of regions. The chosen dimensionality for each method is indicated by a red arrow and was selected as the one with lowest variance in the error, and a median above zero.\nLimitations and Challenges. The main limitation of our study is probably that we had to make choices and focus on the most popular methods. Indeed, to study systematically methods avoiding overfit requires computational-intense nested cross-validation (where the nesting is required to set the methods' internal parameters). In particular, we did not investigate Total-Variation constrained dictionary learning (TV-MSDL, Abraham et al. (2013) ). This approach defines regions by imposing spatial structure in a linear-decomposition model. In a previous study, we found it promising , but it entailed too large of a computational cost for this multi-cohort study. Another important class of methods that this study did not investigate are biomarkers based on graph-theoretical approaches. Indeed, we benchmarked variants of a specific pipeline -region Definition, followed by construction of a connectivity matrix, and supervised learning on it. Graph-theoretical approaches are an additional step to add to this pipeline. A full study of all options with this additional step would result in a combinatorial explosion of pipelines and prohibitive computational costs. We hope that the good choices of regions for edge-level models outlined in this study is also a good one for graph-theoretical approaches and that further studies can focus on exploring only a subset of the options covered here.\nWith evolving techniques, characteristics of data change, and optimal choices may evolve. However, the consistency of results on HCP suggest that our conclusions apply to high-quality datasets using state of the art techniques. A potential concern is the low accuracy for markers of drug abuse in subjects from ACPI datasets, possibly because the number of subjects is small or because ADHD status confounds drug-abuse predictions even after regressing it out. Nevertheless, our pipelines achieved similar accuracy as reported in a previous study on the same data (Meszl enyi et al., 2016) . Finally, the analysis performed here can only outline trends across datasets. Indeed, the study does not establish that a pipeline choice strictly dominates others (see notes on statistical analysis in Appendix J), but it gives expected improvements. In term of expected improvement, the choice of classifier is the most important, as going from a poor to a good choice can improve the AUC by more than 0.1. Both choice of region and choice of parametrization bring smaller expected improvements."}, {"section_title": "Conclusion", "text": "Predictive models on rest-fMRI bring the promise of robust and reliable biomarkers: given new brain imaging data, they should give accurate predictions of clinics or behavior (Woo et al., 2017) . The framework of the functional connectomes grounds well the analysis of rest-fMRI; yet instantiating it still calls for many arbitrary choices.\nOur study reveals trends that can provide good defaults to practitioners, summarized on Table 3 : regions defined from functional data, for instance with ICA or dictionary learning as in the pre-computed MODL atlas, representing connectivity with the tangent embedding of covariance matrices, and using a non-sparse linear model, such as a logistic regression. In particular, good defaults can limit the combinatorial explosion of analytic pipelines, which decreases the computational cost of running a study and makes its conclusion more robust statistically. Yet, as it is well known in machine learning (Wolpert, 1996) , there cannot be a one-size-fits-all solution to data analysis: optimal choices will differ on datasets with very different properties from the datasets studied here."}, {"section_title": "Ethics statement", "text": "No experiments on living beings were performed for this study. Hence IRB approval was not necessary. The data that we used were acquired in original studies that had received approval by the original institution's IRB. All data were used accordingly to respective usage guidelines."}, {"section_title": "Data and code availability", "text": "The original data can be retrieved from:"}, {"section_title": "Fig. 7. Pipelining choices with precomputed regions, across six datasets:", "text": "Marginal distribution of relative prediction scores, using only pre-computed atlases for regions Definition, where MODL is a parcellation built using a form of Online dictionary learning. Restricting to pre-computed regions and adding a different dataset (HCP) gives results consistent with Figs. 3-5: best choices are regions defined functionally, with decomposition methods (MODL) followed by clustering methods (BASC), tangent-space parametrization of connectivity, and l 2 -regularized logistic regression. The box displays the median and quartiles, while the whiskers give the 5 th and 95 th percentiles. Table A1 reports the corresponding absolute scores."}, {"section_title": "Table 3", "text": "Recommendations for rest-fMRI based prediction pipeline.\nStep Recommendation "}, {"section_title": "Appendix A. Computing the covariance tangent-space", "text": "Most of the methods that we study are readily-available in several computing environments, including Matlab and Python with a variety of wellmaintained implementations. However, the only library that provides the tangent-space parametrization of covariance matrices is the Nilearn Python library. 17 To facilitate reproducing our analysis in different environments, we describe here how to compute this parametrization with a few simple formulas. The computation is made of two step: First a group average covariance matrix \u03a3 \u22c6 is computed from the covariances of the training subjects: f\u03a3 i ; i 2 T raing. Second, it is used to transform covariance matrices, in the train set or the test set. Fig. A1 . Difference between mean of MCI and AD group connectivity matrices: We show the connectivity matrices from the ADNI dataset computed on samples diagnosed as Mild Cognitive Impairment (MCI) and Alzheimer's disease (AD). As can be seen, tangent-space parametrized connections are interpretable and positions in between correlation and partial correlation in terms of connectivity differences. We show the matrices estimated using timeseries extracted with pre-computed MODL dict. learning atlas of n \u00bc 64.\nComputing the group average. As with any analysis based on covariance or correlation matrices, it is preferable to compute individual covariances from time series with an estimator that ensures well-conditioned matrices. The Ledoit and Wolf (2004) estimator is a good default choice (Varoquaux and Craddock, 2013; Brier et al., 2015) .\nStrictly speaking, the group average should be computed according to the geometry of covariance matrices (Varoquaux et al., 2010a; Pennec et al., 2006) . This is a Frechet mean, which is computed by minimizing a cost function for instance using algorithm 3 of Fletcher and Joshi (2007) . A simpler approach relies on using the Euclidean mean, which we found to give almost the same predictive performance. In this case, the formula of the mean is the standard one:"}, {"section_title": "Transforming covariance matrices", "text": "Given the group reference covariance matrix \u03a3 \u22c6 , covariance matrices are transformed in the tangent-space representation by whitening them as follows (Varoquaux et al., 2010a) . Computations are easily written with eigenvalues decompositions 18 : given a subject's covariance matrix \u03a3 i ,"}, {"section_title": "Compute the whitened matrix\u03a3", "text": "where U T \u0394 U \u00bc \u03a3 \u22c6 by eigen-value decomposition, and operations on the diagonal matrix \u0394 are element-wise operation applied to the diagonal.\n2. Compute the matrix logarithm logm\u03a3 i :\nwhere\u03a3 i \u00bc\u0168 T\u0394 i\u0168 and the logarithm is applied to the diagonal elements of\u0394 i . Finally, the resulting matrix is turned to a vector and its entries are used as a features for the classifier. The motivation from these transformations arises from the fact that covariance matrices -or correlations matrices-form a specific manifold of the \u211d p\u00c2p matrices. Their structure is broken by standard additive arithmetic's: the difference of two covariances may create a matrix that does not correspond to the covariance matrix of a signal. Optimal statistical analysis calls for following the structure of the manifold (Pennec et al., 2006) . The tangent-space parametrization is a simple way to approximate this structure by Euclidean geometry, in which standard additions and subtractions can be used (Varoquaux et al., 2010a) .\nWith regards to statistical analysis, the structure of covariance matrices appears as constraints, or dependencies, between the coefficients of the matrix. As a result, these coefficients alone form a poor representation for second-level statistical analysis. The tangent-space approximation yields a parametrization of the problem in which features are i.i.d. (Varoquaux et al., 2010a) . Such a parametrization is optimal for statistical learning. In addition, as discussed in Varoquaux et al. (2010a) , this parametrization also gives good edge-level tests for instance see Figure A1 . Hence, the weight vectors of the classifiers can be interpreted as edge-level weights."}, {"section_title": "Appendix B. Time-series signals extraction", "text": "In this appendix, we give more details on time-series extraction, to complement subsection 2.3. After defining brain ROIs, we extract a representative time-series for each ROI in each subject. For atlases composed of non-overlapping ROIs as can be seen in Fig. 2 (bottom row) , we simply compute the weighted average of the fMRI time series signals over all voxels within that specific region. For fuzzy overlapping ROIs, such as the atlases driven by CanICA and DictLearn as shown in Fig. 2 (top row) , we use ordinary least squares regression to unmix the signal in each voxel as the additive decomposition of signals over several overlapping ROIs. This is the same procedure as in . Let Y 2 \u211d n\u00c2p be the subject-specific signals, written as p voxels by n timepoints, and V 2 \u211d k\u00c2p the atlas of k maps supported on p voxels. We estimate U 2 \u211d n\u00c2k , the set of time series for each ROI, using:\nAt the signal-extraction level, we regress out confounds or non-neural information (Varoquaux and Craddock, 2013) . As confounding time-series we use: 10 CompCor (Behzadi et al., 2007) on the whole brain and 6 motion related. We remove motion-related signal only for COBRE, ADNI and ADNIDOD as they are provided as raw data. We have not done any additional preprocessing steps on already preprocessed public datasets like ABIDE, 19 ACPI 20 .\nThe signal of each region is also then normalized, detrended and bandpass-filtered between 0.01 and 0.1 Hz. All these steps are done with Nilearn v0.3. Investigating filtering choices. At signal extraction level, we perform additional experiments to assess the impact of filtering strategies (low-pass filtering, global signal regression) on prediction accuracy. Overall, we observe no significant differences between filtering strategies -low-pass filter and no global signal regression, low-pass filter and global signal regression, no low-pass filter and no global signal regression. See Appendix F for complete comparisons. Appendix C. Comparing each step marginally on the others\nThe figures in the main part of the paper summarize the impact of one modeling choice in the pipeline conditionally on nearly-optimal choices for the other steps. Here we compare the modeling choices at each step marginally on all other choices, i.e. considering all results and including well performing and poorly performing pipelines. This approach studies each step of the method independently from the other steps. The results are overall similar to performing the conditional analysis, however the variance is larger, as the plots pool together pipelines that perform well and pipelines that perform poorly. Appendix C.1Step:3 Choice of classifiers Figure A2 shows the relative impact of classifier choices on prediction accuracy. All \u2113 2 regularized classifiers are performing markedly better than other considered classifiers, with a logistic regression as the best performer. Fig. A2 . Impact of classifiers on prediction accuracy: Marginal distribution of the relative prediction accuracy of all classification choices for all rest-fMRI datasets. The results are obtained covering all the choices for the remaining steps i.e., atlases and connectivity parametrizations. Non-sparse linear models perform well and l 2 -regularized logistic regression appears as the best choice.\nAppendix C.2Step 2: Choices of connectivity parametrizations Figure A3 shows the relative impact of connectivity parametrization on prediction accuracy when considering all choices for the other pipeline steps. The tangent-space parametrization performs better than correlation or partial correlation and gives less variance. Fig. A3 . Impact of connectivity parametrization on prediction accuracy: Marginal distribution of relative prediction accuracies for all rest-fMRI datasets, considering all pipelining options. Tangent space parametrization displays the highest accuracy and smallest variation across all datasets and folds. Fig. A4 . Impact of regions-Definition method on prediction accuracy: Marginal distribution of relative prediction accuracy per region-definition approach across all rest-fMRI datasets. This is obtained while considering all pipelining options uniformly in all other steps. Among all pre-defined atlases, BASC is best. Among datadriven based atlases, the best choice is Online dictionary learning. Fig. A5 . Impact of regions-vs network-based representation on prediction accuracy: Each data point represents the difference in relatively mean prediction scores between regions -i.e. with extraction of connected components-and networks -without such an extraction. Each time, the optimal dimensionality for the corresponding option is used. Points on the left side indicate that the network representation is better, while points on the right side indicate superior performance of the region-based representation. Results are shown for each rest-fMRI dataset. Regions-based representations appear better suited, but this effect is not significant. Note that Ward clustering does not appear in this figure as it extracts connected regions. Fig. A6 . Impact of the number of regions in data-driven atlases on prediction accuracy. For each method, the distribution of relative prediction accuracy (AUC) is displayed as a function of the number of regions, across rest-fMRI datasets. The horizontal bar (black) represents the median of the relatively mean scores for each dimensionality. The whiskers of each data point represent the 95% confidence interval for a given dataset across the folds. The optimal choices (red arrow) are selected as the minimal variance score with a median close to the maximum. The prediction scores are obtained for the optimal pipeline setting, involving tangent-space parameterization and logistic regression-l 2 classifier. Figure A4 shows the relative impact of region-Definition choices on prediction accuracy for all choices in remaining steps. Atlases which are functionally derived lead to good performances. Linear-decomposition methods, appear as the best choice for region-definition methods, in particular, Online Dictionary Learning."}, {"section_title": "Appendix C.3Step:1 Choices of region-Definition methods", "text": ""}, {"section_title": "Appendix D. Additional experiments on region-Definition methods", "text": "Here we give additional results related to step 1 of the pipeline: defining nodes, formed of brain regions or brain networks. An important parameter to chose is the optimal dimensionality dim i.e., how many networks are needed to predict from the rest-fMRI images. Another choice is whether these networks should be broken up into simply connected regions -with a region-extraction step-or whether distributed networks can be readily used. These two parameters may be important in the comparison of brain-region Definition, in particular for data-driven approaches such as linear decomposition or clustering methods. In our study, we found that atlases learned using linear decomposition methods give a good prediction. Appendix D.1Varying dimensionality without region extraction While the results in the main part of the manuscript are presented after regions extraction, Figure A6 studies the optimal dimensionality without region extraction. The optimal choices are not far from what we have observed with region extraction (Fig. 6 ). As shown with a red arrow, the dimensions shown good prediction impact are: ICA and DictLearn -80 networks, K-Means and Ward -120 clusters, 122 networks with BASC. As dimensionality goes higher, we observe that the variance in prediction accuracy increases."}, {"section_title": "Appendix D.2Defining nodes with regions or networks", "text": "One the optimal dimensionality chosen with and without region extraction, we compare for each method whether region-Definition with regions or networks gives best prediction. Figure A5 summarizes the results but with no obvious clear-cut conclusions. The figure shows the distribution of differences in prediction scores between regions-based approaches and network-based approaches. There is a very slight tendency to favor region-based approaches, but the trend is not significant."}, {"section_title": "Appendix E. Regions extracted for different network-Definition methods", "text": "Data-driven method tend to naturally extract networks rather than regions: ICA and dictionary learning give distributed networks, while KMeans gives clusters made of different connected components. Only Ward clustering readily gives ROIs as it has connectivity constraints.\nWe use a region-extraction procedure to go from networks to regions (Abraham et al., 2014a) . Figure A7 shows the distribution of the number of regions extracted from networks obtained with different approaches for increasing dimensionality. The computational cost is too high to learn spatial maps for each split using Group ICA and Online Dictionary Learning. Hence we show outcomes for dimensions up to 120. For each method, the distribution of the number of regions regularly increases with increasing dimensionality: the number of regions is roughly proportional to the number of networks.\nFor the optimal choice of dimensionality (dim \u00bc 80 for Group ICA and DictLearn and dim \u00bc 120 for K-Means as studied in Fig. 6 ), the average number of regions lies on average around 150.\nThe number of regions extracted from ICA network sometimes displays an ill-controlled behavior, for instance for dim \u00bc 80; 100; 120 on COBRE, where a small number of folds lead to 300 or more regions. We believe that these high number of regions are extracted from an noisy ICA map with little structure as shown in Figure A8 . Dictionary learning, which has a criteria on sparsity of the maps, does not create such unstructured maps, and therefore does not suffer from the same problem. In general, it can be expected that increasing the dimensionality of an ICA typically split large-scale networks into smaller regions. Given these noise components, the picture is slightly more complex. Indeed, as shown by Figure A7 , high-dimensional ICA also typically extracts more noise components. Fig. A9 . Temporal signal filtering strategies on prediction accuracy (AUC) for five rs-fMRI datasets: Distribution of relative prediction scores showed no big differences across three filtering strategies: lowpass filter and no global signal regression, lowpass filter and global signal regression, no lowpass filter and no global signal regression. Fig. A10 . Comparison between geometric & Euclidean distance metrics on tangent space parametrization of covariances: Distribution of difference in prediction score (AUC) between these 2 metrics outlined for the dictionary learning atlas. Geometric distance based connectivity parametrization yields higher accuracy than Euclidean distance based parametrization. Fig. A11 . Impact of covariance estimator, for the different connectivity parametrizations: Marginal distribution of relative prediction scores per connectivity method across covariance structures for all rest-fMRI datasets. This is obtained by considering the good choices in dimensionality as studied in the main figures. Overall, using empirical covariance instead of Ledoit-Wolf shrinkage yield minor difference in prediction performances; note that partial correlation and tangent parametrization require the use of shrinkage. Graph lasso tends to perform lower compared with other estimators."}, {"section_title": "Appendix F. Experiments on filtering time-series", "text": "The results in the main part of the paper (eg Figs. 3, Figure 4 , Fig. 5 ) as well as the marginal distribution figures shown on Appendix C, are established with low-pass filter of the time series and without global signal regression.\nHere, we investigate the impact of filtering strategies on prediction accuracy. We compare three filtering schemes: low-pass filtering and no global signal regression, low-pass filtering and global signal regression, no low-pass filtering and no global signal regression. Figure A9 shows the outcome for all of these filtering combinations: there is no significant differences on prediction accuracy across all rs-fMRI datasets."}, {"section_title": "Appendix G. Tangent-space parametrization: Euclidean versus Geometric mean", "text": "We also compare two variants of tangent-space parametrization: using the geometric (Frechet) mean and using the simple Euclidean mean for \u03a3 \u22c6 (A). Figure A10 highlights the difference between the relative prediction scores for each dataset. We compare between the optimal choices in brain atlas methods i.e. GroupICA and DictLearn. Geometric mean based parametrization gives a slightly better prediction accuracy than Euclidean mean based parametrization. Euclidean mean gives a reduced computational cost, but the Geometric mean is better justified in theory.\nAppendix H. Covariance estimators: unregularized, l 2 -regularized Figure A11 compares different covariance estimators for the three connectivity parametrizations. Appendix H.1Empirical covariance: unregularized\nWe considered empirical covariance as our choice of unregularized covariance estimator. Using empirical covariance in the pipelines did not improve the predictions. We found little difference when compared with Ledoit-Wolf using full correlation as can be seen from Figure A11 .\nThe empirical covariances are ill-conditioned matrices and not invertible, hence they cannot be used for partial correlations or tangent parametrization. Ledoit-Wolf shrinkage or sparse inverse covariance estimators overcome such limitations. Appendix H.2GraphLasso: l 2 -regularized estimator Sparse inverse covariance is effective at recovering brain connectivity (Smith et al., 2011; Varoquaux et al., 2010b) . We use the graphical lasso (Friedman et al., 2008) to estimate sparse covariance matrices, in order to study full correlation, partial correlation and tangent space parametrization in comparison with l 2 -regularized covariance estimator (Ledoit-Wolf) . Such estimator requires the choice of a regularization parameter that sets the amount of sparsity. A good regularization parameter typically depends on the amount of time points available and the number of nodes. For each dataset and choice of regions, we used an inner-loop optimization to set the regularization parameter: we test two parameters values, 0.5 and 0.2, where 0 corresponds to a non regularized covariance and 1 or above to fully sparse covariances. For all datasets, 0.5 was the best trade-off as using 0.2 gave ill-conditioned results. Note that parameter selection for the graphical lasso on a wide and varied dataset is challenging as the graphical lasso runs into convergence problems when covering a variety of regularization parameters on covariance matrices with different properties. This happens very seldom, but with 100 folds on 1500 subjects, and a dozen different atlases, the problem makes automatic parameter selection difficult. The convergence problem is well understood theoretically: the algorithm is a primal-dual algorithm and errors can accumulate between the primal and the dual solution (Mazumder and Hastie, 2012) . Figure A11 shows the impact of graph lasso on connectivity parametrizations. Overall, we observed no improvements in the prediction results based on graph lasso with respect to Ledoit-Wolf. Table A1 5th percentile, median and 95th percentile of accuracy scores in AUC over cross-validation folds (n \u00bc 100) for all six rest-fMRI datasets including HCP. Accuracy scores reported correspond to optimal choices in functional connectivity prediction pipeline as shown on Fig. 7 : precomputed atlas defined using massive online dictionary learning (MODL), connectivity matrices parametrized by their tangent-space representation, and an l 2 -regularized logistic regression as a classifier. Appendix I. A review of current practices in functional connectome-based classification Table A2 summarizes about the list of methods used for prediction studies in diverse psychiatric diseases. "}]