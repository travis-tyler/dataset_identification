[{"section_title": "Abstract", "text": "Abstract-Neuroimaging data collection is very costly, and acquisition is commonly distributed across multiple sites. However, factors such as different noise characteristics or inhomogeneities make it difficult to successfully combine multi-site functional imaging data. Here, we show that the distribution of signal quality measures across scanners can be significantly different, and that this will have an impact on correlation estimators necessary for computing functional connectivity graphs as well as topological features extracted from the graphs. We propose to find a stable subspace by using a discriminative projection that does not only minimise site differences, but also preserves discriminative class information. We compare our method with the \"regressing-out\" approach in a cross-validation setting and show that regressing out can yield very poor results."}, {"section_title": "I. INTRODUCTION", "text": "Brain graphs [1] , representing interactions between different parts of the brain based on neuroimaging data, are a useful representation of resting-state functional MRI (rs-fMRI) data. They can be used to compare groups of subjects or for prognosis in clinical applications [2] , or to perform inference about complex brain states [3] .\nSince data acquisition with human subjects is costly in time, there is an increased tendency to share data and distribute dataset collections across multiple sites, with the promise of improved statistical power. Indeed, most large-scale fMRI datasets (including ADHD-200, ABIDE, ADNI GO, and fBIRN) are multisite, ranging from 7 to 50 sites.\nHowever, MR physics is such that even two scanners of the same brand or model, using the same operating system and acquisition sequence will yield different images. Signal fluctuations, spiking patterns, and uneven sensitivity profiles will contribute to significantly altering signal dynamics and large-scale spatio-temporal covariance. The computation of brain graph rests on several steps, including spatial and temporal data preprocessing and edge weight estimation, all of which can be affected by the quality of MR acquisition.\nWhile good cross-site reproducibility has been reported for structural imaging classification [4] , evidence supporting the applicability of predictive modeling methods to multisite connectivity datasets is non-existent, although connectivity estimates themselves may be resilient [5] .\nIn the present work, we wanted to verify if site differences could indeed cause significant shifts in signal quality measures likely to affect brain graphs, what the effect of site differences is on graph representations and cross-site classification performance, and propose a projection method to diminish site effects."}, {"section_title": "II. IMAGING DATA AND PROCESSING", "text": ""}, {"section_title": "A. Datasets", "text": "In this paper we will present results on two open multi-site datasets: fBIRN and ABIDE.\nThe fBIRN Phase I Traveling Subjects dataset [6] includes five healthy males (mean age: 25.2, range = 20.2 to 29). All subjects traveled to 9 sites (10 scanners), where they were scanned twice over a period of 2 days for a total of 20 scans per participant. However, all the datasets without a T1 acquisition were excluded from the analysis, and our results arebased on 4 scanners and 4 subjects, shown in table I. Two rs-fMRI acquisitions (TR/TE = 3 s/30 -40ms, FOV = 22 cm, thickness = 5 mm, number of volumes = 85, slice order = interleaved) and one anatomical T1 scan (TR/TE = 9.8 ms/min, FOV = 22 cm, thickness = 4 mm) were acquired in most of the sites. The Autism Brain Imaging Data Exchange (ABIDE) provides rs-fMRI datasets from 539 individuals with autism spectrum disorder (ASD) and 573 typical development (TD) subjects acquired in 16 sites, publicly available for the scientific community. Based on the ABIDE image quality check reported by Abraham [7] , 5 of 16 sites were selected, consisting of 20 subjects per site (10 ASD and 10 TD paired by age).\nAll ABIDE sites had their own rs-fMRI protocol, therefore acquisition parameters were different across sites. Principal site characteristics are listed in table I. KKI, UCLA, and USM had eyes-opened acquisition, while Leuven and Trinity had eyes-closed acquisition."}, {"section_title": "B. Data processing and graph computation", "text": "Standard SPM8 (http://www.fil.ion.ucl.ac.uk/spm/) fMRI preprocessing (slice timing correction, realignment, coregistration, normalisation) was performed on the data using all default settings of SPM 8. For the extraction of resting state functional connectivity matrix, we followed an atlas-based pipeline [8] .\nFor spatial processing, the structural image was coregistered to the mean image of the functional data. Then, an individual brain atlas containing 116 cortical and sub-cortical regions of interest (ROIs) was then computed with a modified version of the IBASPM toolbox [9] and the AAL atlas [10] . Finally, the spatially-averaged time courses were calculated from the voxels corresponding to these regions in the functional space. we restricted the analysis to the 90 non-cerebellum regions, and further excluded the bilateral globus pallidus due to signal dropout, resulting in 88 regions per brain, each associated with a regional time course.\nFor temporal processing, the 6 realignment parameters were regressed out of each regional time courses. The regional time courses were then filtered into four orthogonal frequency subbands using a wavelet transform (if the TR was the same across sites), or bandpassfiltered between 0.01 and 0.1Hz (if the TR was different across sites). Then, the pairwise Pearson correlation coefficients between all pairs of filtered regional time courses were computed to obtain the edge weights of the edges linking each of the 88 regions represented by a graph vertex, leading to an 88 x 88 adjacency matrix."}, {"section_title": "III. FUNCTIONAL CONNECTIVITY-RELATED SIGNAL QUALITY MEASURES ACROSS SITES", "text": "If image quality differs between sites, brain graphs can be impacted. Here we focus on only two measures of fMRI signal quality."}, {"section_title": "A. Structural quality measure", "text": "The number of voxels per atlas region M (in native space) depends largely on the segmentation step in preprocessing, because it is computed from the intersection of a gray matter mask (itself obtained from a thresholded tissue probability map) and an atlas mask. The segmentation, in turn, depends on several image factors, in particular local inhomogeneities and how bias field correction is performed. Thus, M can be expected to vary across sites.\nIn turn, we have shown previously [11] that the number of voxels in two regions will bias the inter-regional correlation estimator depending on the correlation within each of the two regions. Assuming a true correlation value corX,Y between all voxels of regions X and Y , then the estimator of the correlation between the regions' average time coursesX and\u0232 , corX ,\u0232 , will behave as corX ,\u0232 \u2192corX,Y if the within-region correlation between voxels is 1, and as corX ,\u0232 \u2192 \u221a P McorX,Y if the within-region correlation between voxels is low (inhomogeneous region).\nTherefore, large regions will tend to have higher correlation to the rest of the brain, as illustrated in Fig. 1 . "}, {"section_title": "B. Functional quality measure", "text": "Functional connectivity estimates will also be impacted by sitespecific temporal noise. Here, we use Signal to Fluctuation Noise Ratio (SFNR) [12] a measure useful to account for brain-wide BOLD signal activation differences in multi-site studies [13] .\nHere, we defined a spatially localised version: for each atlas region, we computed an SFNR value by dividing signal image (average of the time series) by the temporal fluctuation noise image (standard deviation of the time series detrending with a second-order polynomial)."}, {"section_title": "C. Empirical results", "text": "For fBIRN and ABIDE we wrote a mixed-effect model qmi 1 + scannerID+(1|subjectID), where qmi is a quality measure (either number of voxels or SFNR) for region i, with subjectID as random effect to account for the correlation of regional measures within each subject. We then tested the main effect of scannerID using a mixedeffects ANOVA.\nThe total number of voxels for the whole brain did not differ significantly between sites for the fBIRN dataset (p = 0.56), but did for the ABIDE dataset (p < 10 \u22124 ). Testing regionwise showed that 30/88 regions differed significantly in their number of voxels in fBIRN (pFDR < 0.01, Fig. 2a ), and all regions had significantly different number of voxels in ABIDE (pFDR < 10 \u22124 , Fig. 2b ).\nWhole-brain SFNR was significantly different between sites for the fBIRN dataset (p = 0.01) (consistent with previous results on this dataset [13] ) and the ABIDE dataset (p < 10 \u22124 ). Regionwise, 85/88 regions differed significantly in fBIRN (pFDR < 0.03, Fig. 2c ), and all regions had significant differences in ABIDE (pFDR < 10 \u22124 , Fig. 2d )."}, {"section_title": "IV. GRAPH REPRESENTATIONS ACROSS SITES", "text": "Graphs can be represented as vectors in different ways in order to use statistical learning methods operating in vector spaces [1] . Here we focus on two techniques: direct embedding, where edge weights are taken as features directly [14] , and topological features embedding [15] . Both representations rely on estimates of edge weights (or absence/presence of edges), which is likely to be influenced by properties of the acquisition site. Site-specific violin plots of the number of voxels per region (two left panels) and regional signal-to-fluctuation noise ratio (two right panels) in the fBIRN and ABIDE datasets. Each dot is the value for one region in one subject. fBIRN data is color-coded by subject (4 subjects shown here), and ABIDE data is colored by diagnosis class, where blue is typically developing (TD) and red is autism spectrum disorder (ASD)"}, {"section_title": "A. Edge weight distributions", "text": "Given our results on signal quality measures, we can expect the distribution of edge weights (obtained by Pearson linear correlation coefficient) to shift significantly depending on the acquisition site. Indeed, Fig. 3 shows that this is the case, even when the acquisition protocol and field strenghts are the same (as in the case of fBIRN). More worryingly, in the case of clinical applications (ABIDE dataset), the patients and control distributions can shift and overlap to the point where researchers at different sites can reach opposing conclusions: patients can be thought to be under-connected for a UCLA researcher, while they could be described as over-connected for a Trinity researcher. "}, {"section_title": "B. Topological graph features", "text": "Both weighted and unweighted topological graph features rely on edge strength estimation. Unweighted features are computed on a thresholded and binarised version of the graph, meaning that the value of the numerical threshold can have a large influence on the resulting feature.\nHere, we first used a fixed edge density threshold for all subjets, keeping 90% of the edges with the largest weight. We then computed six vertex topological features: degree, clustering coefficient [16] , unweighted local efficiency [17] , unweighted betweenness centrality [18] , closeness centrality [19] , and pageRank [20] .\nWe then defined a mixed-effect model vpi \u223c 1 + scannerID + (1|subjectID), where vpi is a vertex property for vertex i, and subjectID is a random effect to account for the correlation of regional vertex properties within each subject. We then tested the main effect of scannerID using a mixed-effects ANOVA.\nRobustness was consistent for the ABIDE and fBIRN datasets: degree, path length, betweenness centrality and pageRank showed no site effect.\nLocal efficiency, closeness centrality, and clustering coefficient showed significant effect of site on ABIDE (all at p < 10 \u22124 ), and an insignificant effect on fBIRN.\nOur results show that robustness to site differences varies between topological features, and that a consistent acquisition protocol can help reduce the effect of site differences on topological features."}, {"section_title": "V. MINIMISING SITE INFLUENCE", "text": "Given a multi-site dataset, how can we mitigate the confounding effect of having different sites? The dominant approach is to regress out the site identity, and to perform the rest of the modeling using prediction residuals. We evaluate how this approach performs in a cross-validation setting, and propose a projection-based approach that attempts to preserve class discrimination while reducing site effects.\nOur graph representation is either a direct embedding (leading to 2828-dimensional feature vectors), or a concatenation of the six topological features mentioned above (leading to a 528-dimensional vectors (88 regions \u00d7 6 properties))."}, {"section_title": "A. Cross-validation setup", "text": "For the ABIDE dataset, we look at an imaging marker scenario, where data from multiple sites is available to train an imaging marker, but we cannot see all subjects ahead of time. We want to evaluate how well the imaging marker is likely to perform on unseen subjects, so we estimate the generalisation ability by leaving a few subjects out for each site. The training data contains a total of Ntr subjects coming from a number of sites."}, {"section_title": "B. Regression approach", "text": "The regressing-out approach assumes a linear shift effect of the site, and mean-centers the features using site-specific means. However this is typically performed outside of a cross-validation loop, thereby benefitting from a peek at some testing data.\nHere, we learn the parameters of the regression (beta coefficients) strictly on training data, before applying the prediction to both training and testing data. In addition, our approach to regression also includes regional quality measures SFNR and number of voxels, as well as a random effect for subject: we write our model vpi \u223c 1 + SF N Ri + Mi + scannerID + (1|subjectID)."}, {"section_title": "C. Projection approach", "text": "For the projection approach, we modified the Nuisance Attribute Projection (NAP) technique [21] , originally developed for channel compensation in speaker verification problems.\nWe start by defining two binary constraint matrices over the Ntr training feature vectors. First, a site constraint matrix Ws \u2208 {0, 1}\nNtr \u00d7Ntr , where Ws ij is 0 if feature vectors i and j are from the same site, and 1 if they are from different sites. Second, a class constraint matrix Wc \u2208 {0, 1}\nNtr \u00d7Ntr , where Wc ij is 1 if feature vectors i and j are from the same class, and 0 if they are from different classes. We obtained a linear combination of the two constraint matrices W = Ws + \u03bbWc.\nWe then defined an optimisation problem to find the optimal projection matrixP such that P = arg min\nwhere x\u00b7 are feature vectors. The optimal projection matrix will push feature vectors together if they are from different sites, and pull them apart if they are from different classes.\nBy writing P = I \u2212 V 1:k V T 1:k , where V is a matrix with orthonormal columns and V T V = I, we can solve the optimisation problem as a generalised eigenvalue problem:\nwhere the columns of V contains the eigenvectors sorted by decreasing eigenvalue. Thus, to train this method two two free parameters must be tuned: \u03bb \u2208 R + , which selects the trade-off between reducing site differences (low \u03bb) and maximising class differences (high \u03bb), and k \u2208 N + , which selects the number of leading eigenvectors retained. After training, the projection matrix was applied both to the training data and the testing data."}, {"section_title": "D. Statistical analysis of multi-site topological feature distributions", "text": "We focused the analysis on local efficiency, closeness centrality, and clustering coefficient, which we have shown to be site-dependent. Here, the goal of the regression and projection procedures was to minimise the effect of site. For both fBIRN and ABIDE, the regressing-out procedure succeeds in cancelling the site effect as measured by the mixed-model ANOVA. However the distributions are still mismatched. For fBIRN, the projection procedure succeeds in making the main effect of site insignificant (p = 0.94, 0.95 and 0.66 for local efficiency, closeness centrality, and clustering coefficient respectively). For ABIDE, the projection procedure fails to make the site effect insignificant."}, {"section_title": "E. Prediction accuracy in multi-site data", "text": "Using the ABIDE dataset (fBIRN has no class information), we first ran a leave-one-subject-per-group-out cross-validation on single sites (Fig 4) . The classifier used was a random forest with 501 trees. Depending on sites and graph representations, accuracies ranged from 0.33 (below chance) to 0.75. While using 10 subjects per class per site yields wide confidence intervals, accuracy appears strongly linked to site. Then, we ran multisite tests with the original data, regressioncorrected data and projection-corrected data in a cross-validated fashion (leaving one control and one patient out for each site). We used a nested-cross validation optimising for accuracy to set the \u03bb and k parameters of the projection. In all three cases (original, regression, projection) we used both direct embedding and topological feature embedding. The results are shown in Fig. 4 . The accuracy of the two embedding does not differ significantly, and is significantly above chance. 60% accuracy is consistent with the literature [22] , but below the state of the art at 67% [23] , although comparison is difficult due to the different subsets of subjects. Regression makes prediction random for both embeddings. Projection on topological features also makes prediction random, but a small (non-significant) improvement is obtained on direct embedding. "}, {"section_title": "VI. CONCLUSIONS", "text": "Acquisition sites have significant and large effects on basic image properties. As shown using structural and functional quality measures, these effects can impact functional connectivity, and furthermore impact graph representations. This effect is both global and localised in space, since not all regions are affected equally by site effects. Different topological features have various degrees of robustness. It is possible that unweighted properties, assorted with an edgedensity thresholding procedure, are less susceptible to site effects, but this robustness can come at the expense of discrimative power.\nRegressing-out the site identity may harm classification performance when performed in a cross-validated setting. This may be due to mean-alignment that does not rescale the distribution.\nDiscriminative projection approaches may be better suited to the task, although the current version of our proposed approach is does not perform particularly well. This is probably due to the difficulty of tuning the parameters of the projection within a nested crossvalidation loop, where the data is high dimensional. Meta-analysis techniques, which we have not explored here, may offer a good way forward by abstracting away signal differences and focusing on effect sizes directly."}, {"section_title": "ACKNOWLEDGMENT", "text": "This work was supported in part by a Marie Curie International Outgoing Fellowship of the European Community's 7th framework programme (PIOF-GA-2011-299500), and in part by the Bavaria-California Technology Center. The fBIRN dataset is provided by the Biomedical Informatics Research Network under grants U24-RR021992 and U24 GM104203. The ABIDE dataset is supported by the NIMH under grant K23MH087770 and the Leon Levy Foundation."}]