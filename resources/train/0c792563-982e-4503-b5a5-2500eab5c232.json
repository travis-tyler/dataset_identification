[{"section_title": "Abstract", "text": "Most neurological diseases are characterized by gradual deterioration of brain structure and function. To identify the impact of such diseases, studies have been acquiring large longitudinal MRI datasets and applied deep-learning to predict diagnosis label(s). These learning models apply Convolutional Neural Networks (CNN) to extract informative features from each time point of the longitudinal MRI and Recurrent Neural Networks (RNN) to classify each time point based on those features. However, they neglect the progressive nature of the disease, which may result in clinically implausible predictions across visits. In this paper, we propose a framework that injects the extracted features from CNNs at each time point to the RNN cells considering the dependencies across different time points in the longitudinal data. On the feature level, we propose a novel longitudinal pooling layer to couple features of a visit with those of proceeding ones. On the prediction level, we add a consistency regularization to the classification objective in line with the nature of the disease progression across visits. We evaluate the proposed method on the longitudinal structural MRIs from three neuroimaging datasets: Alzheimers Disease Neuroimaging Initiative (ADNI, N = 404), a dataset composed of 274 healthy controls and 329 patients with Alcohol Use Disorder (AUD), and 255 youths from the National Consortium on Alcohol and NeuroDevelopment in Adolescence (NCANDA). All three experiments show that our method is superior to the widely used methods. The code is available at https://github.com/ouyangjiahong/longitudinal-pooling."}, {"section_title": "Introduction", "text": "Longitudinal MRIs enable scientists to track the gradual effect of neurological diseases and environmental influences on the brain over time [21] . One way of quantifying those effects is by training deep learning models to distinguish the longitudinal MRIs of healthy controls from those of the cohort of interest [7] . These learning models often couple Convolutional Neural Networks (CNN) with Recurrent Neural Networks (RNN) [14, 20, 11, 7, 12] , where the CNN reduces each MRI of the longitudinal sequence to informative features and the RNN uses the features to predict cohort assignment at each visit. One can now track the assignments across visits and reduce that sequence to a singled label by, for example, simply relying on the assignment of the last visit [20, 11, 7] or by adding a linear layer on top of the RNN predictions [6] .\nShortcomings of these deep learning approaches arise from their implementations of RNN, which analyze the longitudinal MRI in one temporal direction by, for example, performing inference at a visit only considering that and prior visits [1, 19] . Alternatively, bidirectional RNNs [3] perform inference using both future and past visits but they cannot explicitly model disease progression. They often result in clinically implausible predictions with fluctuating disease diagnoses across visits. For example, once a person transitions from Mild Cognitive Impairment (MCI) to Alzheimer's Disease (AD), they cannot convert back to MCI. However, the RNN model is not confined to that constraint so that it might predict AD to MCI conversion. To address this shortcoming, we extend the CNN+RNN architecture with a novel longitudinal pooling layer to regularize the model on the feature level and a consistency loss function to regularize on the prediction level.\nFor each visit of the longitudinal MRI, the longitudinal pooling layer aims to fuse information from the current with proceeding visits. Traditional approaches suggest to use feature concatenation [16] or fully connected networks [13] . However, these operations require a fixed number of time points, which is not a good fit for longitudinal studies as the number of visits can greatly vary across subjects [15] . An alternative to the fixed-length operations is a set operation such as defined by social pooling [2] , which has been used to predict the spatial trajectories of pedestrian. Inspired by this model, our design of the longitudinal pooling layer generates (for each visit) a compact representation of MRI features from future visits and concatenates it with features of the current visit before feeding them into the RNN. The final predictions produced by the RNN are then regularized by a consistency loss objective, which strongly discourages changes in cohort assignment of subjects with irreversible conditions, such as AD. For those subjects, the function penalizes a decrease in confidence to be labelled AD as visits proceed.\nWe evaluate our method on three longitudinal structural MRI datasets: 404 subjects from ADNI to analyze the progression of AD, 603 subjects to distinguish healthy subjects from those diagnosed with AUD, and 255 no-to-low drinking youths (ages 14 to 16 at baseline) of NCANDA to identify the ones that transition to heavy drinkers once they become adults. On these data sets, the accuracy of our proposed architecture is higher than alternative models without the longitudinal pooling and consistency layers. vary across subjects, while we make the simplifying assumption that the interval between time points is the same across subjects and that the same acquisition protocol is used throughout the study. We denote the entire dataset with S.\nThe backbone of our model is a 3D-CNN coupled with a sequence-to-sequence RNN (gray components in Fig. 1 ). First, informative features c t := CNN(x t ) are extracted by applying a 3D-CNN independently for each time point t to the corresponding MRI of the longitudinal sequence. Note, the same 3D-CNN (i.e., set of weights) is used across time points in order for the model to accurately track longitudinal changes. These features are fed into an RNN to model their temporal relations. The output of each RNN cell is then fed into fully connected (FC) layers followed by sigmoid activation to turn the confidence measure of the RNN cell into a binary label. This framework is now extended by a Longitudinal Pooling layer and a Consistency Loss function, which are described in further detail next. Longitudinal Pooling (LP). Inspired by social pooling [2] , the LP layer augments the features c t derived by the 3D CNN for subject s at time point t with those of future time points via a pooling operation H(\u00b7), i.e.,\nFor simplicity, H(\u00b7) computes the average. The last time point does not have proceeding time points to pool from, so that we use c ms itself. For each time point, the features c t of the current time point are concatenated with the pooling embedding g t , which are then applied to a fully connected layer \u03c6(\u00b7) (i.e, a linear function with tanh activation and weights W f ) to determine the augmented hidden state h t := \u03c6([c t , g t ]; W f ). Lastly, h t becomes the new input to the RNN layer h t := RNN(h t ; W r ), where weights W r are shared among time points. Note, LP can be easily generalized to the scenario of multiple RNN layers. In this case, the pooling operation defined with respect to Eq. (1) and h t is performed on h t , . . . , h ms instead of {c t , . . . , c ms }. Consistency Loss. To explicitly model irreversible disease progression, such as in the case of AD, our deep learning approach assigns higher confidence p (s) t to subjects assigned to the cohort of interest S + (e.g., AD) as time progresses. In other words, the consistency loss function expects p s 1 \u2264 p s 2 ... \u2264 p s m for s \u2208 S + and penalizes predictions violating this rule:\nwhere \u00b7 + sets negative values to 0. Objective Function and Training Strategy. To reduce the overfitting problem in training recurrent neural networks [7] , we first pre-train a 3D-CNN classifier using all available training images while discarding their longitudinal dependencies. Then, we incorporate the recurrent and longitudinal pooling layers on top of the pre-trained 3D convolutional layers to jointly train our CNN+RNN model. The final training objective function can be written as:\nwhere the first term is the binary cross entropy with w pos balancing between the influence of S + with S\\S + . The second term is defined by Eq. 2, and the third term regularizes W, which represents the weights of all linear and recurrent layers. \u03bb cons and \u03bb reg weigh the consistency loss and regularization loss."}, {"section_title": "Experiments", "text": "All longitudinal MRIs in the following experiments were first preprocessed by a pipeline composed of denoising, bias field correction, skull striping, affine registration to a template, and re-scaling to a 64 \u00d7 64 \u00d7 64 volume. We first randomly selected 10% of the subjects as the validation set, then we measured the classification accuracy by 5-fold cross validation on the rest of subjects. was applied to each MRI of the same subject. We flipped hemispheres based on the assumption that the studied effect bilaterally impacts the brain, which is the case for most neurological diseases. The 3D CNN contained 4 convolutional blocks connected by 2\u00d72\u00d72 3D Max-Pooling. Each block contained two stacks of 3\u00d73\u00d73 3D convolution, Batch Normalization, ReLU, and dropout layers. The resulting 512-D features were connected to two fully connected layers (FC) with tanh activation producing a 16-D feature (c t ) as the input of RNN. We used Gated Recurrent Units (GRU) layer with 16 hidden units as the RNN implementation. The regularization weights were set to \u03bb reg = 0.02 and \u03bb cons = 2.0.\nWhile the 5 folds were split based on subjects, we measured the accuracy of our proposed method (CNN+RNN+LP+CL) with respect to each individual MRI in the testing fold. Specifically, we measured the balanced accuracy (BACC), sensitivity (SEN), specificity (SPE), and Area Under the Curve (AUC) in percent. To put those accuracy scores in perspective, we applied a crosssectional CNN to each MRI of a longitudinal scan [10] . CNN+AP added an average pooling layer to the CNN baseline by concatenating the CNN features of a visit with the average of the CNN features across all the other visits. The baseline for our longitudinal MRI analysis was the CNN+RNN approach [14] , to which we also added the LP layer (CNN+RNN+LP)."}, {"section_title": "Evaluation on ADNI", "text": "Based on all successfully processed T1-weighted MRIs of the ADNI data set, we applied the proposed method to distinguish 214 normal controls (NC; age: 75.57 \u00b1 5.06 years, 108 Male / 106 Female) from 190 patients diagnosed with Alzheimer's disease (AD; age: 75.17 \u00b1 7.57 years, 104 M/86 F). There was no significant age difference between the NC and AD cohorts (p=0.55, two-sample t-test). The number of time points m s varied from 1 to 5 (denoted as t 1 ...t 5 ) covering the first two years of the ADNI study with 6-month intervals.\nAccording to the accuracy scores listed in Table 1 (left), each implementation recorded a sensitivity that was similar to its specificity indicating that the prediction accuracy was fairly balanced across the two cohorts. However, the accuracy scores were significantly different across implementations with CNN recording the lowest (balanced) accuracy of 86.1%. The accuracy slightly improved when Fig. 2 . Predictions by CNN and the proposed method on the three datasets adding subject-level pooling but was still lower than that of the longitudinal models. Of those longitudinal models, CNN+RNN recorded the lowest accuracy and AUC, implementation including LP achieved the highest AUC (91.5%), and the highest balanced accuracy of 90.4% was recorder for the model with both LP and consistency loss (CL). This accuracy score was also higher than the 89.4% reported by [7] , which coupled a CNN with a bi-directional RNN with similar network architectures on a similar subset of ADNI (i.e, 229 NC and 198 AD with up to 5 visits). Most importantly, our proposed model was significantly more accurate than the CNN baseline (p<0.005 according to DeLong's test [8] ). Finally, we were able to further improve the accuracy of our approach to 90.8% by adding 137 ADNI subjects labelled as pMCI to the training data set; pMCIs transitioned from mild cognitive impaired (MCI) to AD during the study .\nAccording to Table 1 (right), another way of improving the accuracy of our implementation was confining the test set to subjects with at least 3 visits. CNN+RNN+LP+CL achieved the highest accuracy of 91.8% when basing predictions on the longitudinal MRIs of subjects with 5 visits. This indicates that our model was effectively capturing the changes within the longitudinal MRI. Fig. 2(a) qualitatively confirms this finding. Many of the predictions generated by the cross-sectional CNN fluctuate between NC and AD as the lines (which connect predictions of the same subject) frequently cross the 0.5 barrier (dotted blue line). These clinically impossible transitions rarely happened for the predictions of our proposed approach. Not only did the intra-subject prediction score for most AD patients increase with each visit but, somewhat surprising, those scores decreased for NC subjects. This phenomenon resulted in the NC and AD cohorts being clearly separated. Table 2 . Comparison across methods on NC/AUD classification and the BACC of the proposed method with respect to the number of visits analyzed"}, {"section_title": "Evaluation on AUD", "text": "Chronic drinking often causes gradual deterioration in the gray and white matter tissue [18, 22] . In this experiment, we applied the proposed method to distinguish longitudinal T1-weighted MRIs (up to 4 visits) of 274 Normal Controls (NC;age: 47.3 \u00b1 17.6, 136 M / 138 F) from those of 329 patients diagnosed with Alcohol Use Disorder (AUD; age: 49.3 \u00b1 10.5, 100 M / 229 F).\nAs it was the case in the ADNI experiment, all implementations (except CNN) recorded a sensitivity that was similar to its specificity and achieved accuracy scores significantly more accurate than chance (p<1e-5; Fisher Exact test); The longitudinal approaches were more accurate than the cross-sectional ones, and the accuracy of CNN+RNN+LP+CL improved with the number of available visits for prediction (according to Table 2 ). However, the accuracy scores were much lower than recorded for ADNI, and the consistency loss did not improve the accuracy as CNN+RNN+LP and CNN+RNN+LP+CL had similar scores. Most likely this was due to the relatively small number of subjects with more than two time points. Another reason could be that even the cross-sectional CNN approach produced predictions that were relatively stable across visits (see fig. 2(b) ) so that the benefit of the consistency loss function was limited for this application."}, {"section_title": "Evaluating Implementations on the NCANDA Data Set", "text": "One aim of the NCANDA study is to study the brains of no-to-low alcohol drinking adolescents in order to predict who is going to become a heavy drinker during young adulthood [4] . To aid this goal, we applied our implementations to the longitudinal MRIs (up to 5 visits) of the 255 no-to-low drinking adolescents (124 boys/131 girls) of this study that were 14-16 years old at baseline. During young adulthood (i.e, age 18 or older), 115 subjects remained no-low drinkers, 71 subjects transitioned to moderate drinkers, and 69 were heavy drinkers according to the Cahalan criteria [5, 17] . Our implementation now aimed to differentiate the heavy from no-to-low drinkers (which were matched with respect to age), while we included the moderate drinkers (in the heavy drinking cohort) during training to reduce overfitting.\nAgain, findings of the previous experiments were largely confirmed. However, sensitivity and specificity were not as balanced as in previous experiments, and all implementations favored the heavy drinking cohort. CNN+RNN+LP+CL achieved the highest accuracy with 72.7 % and was significantly more accurate than the CNN baseline (p<0.001, DeLong's test). Similar to the ADNI experiments, the consistency loss operation was able to improve the accuracy. Moreover, the prediction scores of the cross-sectional CNN implementation greatly varied across time, while this was not the case for the proposed implementation (see Figure 2 ). This underlines the importance of the pooling and consistency layer of our longitudinal CNN+RNN implementation. Unlike the previous two experiments, Table 3 shows that the prediction accuracy was balanced with respect to the number of time points used for prediction. This indicates that risk factors for heavy alcohol drinking potentially precede the neurodevelopment before age 14 [9] . This finding is also echoed by the relatively \"flatter\" predictions along age in Fig. 2 (c) compared to previous plots for AD in Fig. 2(a) and AUD in Fig. 2(b) ."}, {"section_title": "Conclusion", "text": "In this paper, we have proposed a generalized framework on top of the CNN and RNN backbone to model from longitudinal MRI the gradual deterioration of brain structure and function caused by neurological diseases and environmental influences. On the feature level, we proposed a novel longitudinal pooling layer that combined the features of a visit with a compact representation of information from proceeding visits. On the prediction level, we included a consistency loss to characterize the gradual effect on brain structures across visits. Our method was applied to three datasets classifying Alzheimer's disease, alcohol use disorder, and adolescents at risk for heavy alcohol drinking upon becoming young adults. The proposed method achieved superior accuracy scores compared with cross-sectional and longitudinal baseline methods. Future work will focus on making the deep learning framework more relevant to neuroscientific discoveries by explicitly modelling confounding factors, visualizing patterns of brain structure driving prediction, and relaxing the assumption of identical time intervals between visits."}]