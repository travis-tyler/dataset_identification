[{"section_title": "Abstract", "text": "Network-oriented analysis of functional magnetic resonance imaging (fMRI), especially resting-state fMRI, has revealed important association between abnormal connectivity and brain disorders such as schizophrenia, major depression and Alzheimer's disease. Imaging-based brain connectivity measures have become a useful tool for investigating the pathophysiology, progression and treatment response of psychiatric disorders and neurodegenerative diseases. Recent studies have started to explore the possibility of using functional neuroimaging to help predict disease progression and guide treatment selection for individual patients. These studies provide the impetus to develop statistical methodology that would help provide predictive information on disease progression-related or treatment-related changes in neural connectivity. To this end, we propose a prediction method based on Bayesian hierarchical model that uses individual's baseline fMRI scans, coupled with relevant subject characteristics, to predict the individual's future functional connectivity. A key advantage of the proposed method is that it can improve the accuracy of individualized prediction of connectivity by combining information from both group-level connectivity patterns that are common to subjects with similar characteristics as well as individual-level connectivity features that are particular to the specific subject. Furthermore, our method also offers statistical inference tools such as predictive intervals that help quantify the uncertainty or variability of the predicted outcomes. The proposed prediction method could be a useful approach to predict the changes in individual patient's brain connectivity with the progression of a disease. It can also be used to predict a patient's post-treatment brain connectivity after a specified treatment regimen. Another utility of the proposed method is that it can be applied to test-retest imaging data to develop a more reliable estimator for individual functional connectivity. We show there exists a nice connection between our proposed estimator and a recently developed shrinkage estimator of connectivity measures in the neuroimaging community. We develop an expectation-maximization (EM) algorithm for estimation of the proposed Bayesian hierarchical model. Simulations studies are performed to evaluate the accuracy of our proposed prediction methods. We illustrate the application of the methods with two data examples: the longitudinal resting-state fMRI from ADNI2 study and the test-retest fMRI data from Kirby21 study. In both the simulation studies and the fMRI data applications, we demonstrate that the proposed methods provide more accurate prediction and more reliable estimation of individual functional connectivity as compared with alternative methods."}, {"section_title": "Introduction", "text": "Brain functional connectivity research based on fMRI, especially resting-state fMRI (rs-fMRI), has become an important approach for understanding brain organization and has revealed intrinsic neural functional connections that can be found consistently across groups of subjects and in repeated scanning sessions (Smith et al., 2009; Damoiseaux et al., 2006; Shehzad et al., 2009) . Clinically, functional connectivity has also shown great promises for studying pathophysiology of the development and progression of psychiatric diseases and their response to treatments (Biswal et al., 1995; Greicius et al., 2003; Fox et al., 2005; Smith et al., 2009 among many others) . Numerous studies have identified distinct patterns of functional connectivity in brain networks among subjects with psychiatric disorders as compared to a healthy comparison population that support a neuropathophysiology of cognitive/behavioral problems associated with these disorders (Wang et al., 2007; Woodward and Cascio, 2015) . Studies report mental disorders such as Alzheimer's disease affect brain functional connections across time with the disease progression (Damoiseaux et al., 2012; Yao et al., 2014) . Furthermore, several studies have found significant pre-to post-treatment changes in brain connectivity following psychiatric treatments (Gay et al., 2014; Sarpal et al., 2015) . These collective findings strongly implicate alterations in functional connectivity in the pathophysiology of psychiatric disorders and their responses to medical schooltreatment. This provides motivation for the potential utility of forecasting disease progression-related and treatment-related brain functional connectivity reflected in fMRI.\nThere has been some work aimed to link baseline brain connectivity to disease progression or the eventual clinical response to treatment (Damoiseaux et al., 2012; Yao et al., 2014) . In a related manner, several authors (Brody et al., 1999; Goldapple et al., 2004; Kennedy et al., 2001; Lee et al., 2005; Mayberg et al., 2000 Mayberg et al., , 2001 Moresco et al., 2000) showed that changes in brain activity across time were associated with disease progression or treatment response. Hence, important insights can be gained for disease progression or treatment response by evaluating baseline and follow-up scans. However, in clinical practice, these insights are offset due to the unavailability of follow-up scans at the early phase of disease occurrence or at the time when a clinician makes treatment decision for a particular patient. This pragmatic shortcoming suggests the utility of developing a statistical framework to predict disease-related or treatment-related brain alterations, which could then be combined with baseline scans and patients' relevant risk factors to help inform clinical decision-making.\nIn this work, we present a general framework for predicting individual future resting-state functional connectivity (RSFC) based on his/her baseline rs-fMRI and relevant clinical and demographic characteristics, such as disease stage or treatment group. The proposed prediction method provides a useful tool to predict the changes in an individual's brain connectivity with the progression of the disease or normal aging. It can also be applied to predict a patient's brain connectivity after a specified treatment regimen to help inform individualized treatment plan. The proposed predictive model could potentially have important clinical applications by helping implement early intervention based on predicted disease progression trajectory to prevent severe outcomes from mental illnesses. The method can also help guide the development of a more effective individualized treatment plan by taking into account both the population-level effects as well as a patient's distinct neural connectivity characteristics. Another utility of the proposed method is to provide a more reliable estimator for individual RSFC than the noisy subject-specific estimator in testretest rs-fMRI data. A reliable RSFC estimate can provide important information about the properties of brain networks and is the basis for many complex network-related analyses. For example, Shou et al. (2014) and Mejia et al. (2015) have shown that by improving the reliability of RSFC estimates, one can improve the reproducibility of individual brain parcellation, which is generated from the RSFC.\nThe remainder of this paper is organized as follows. In the method section, we first present a general modeling and prediction framework for individual functional connectivity, and then illustrate the model specification for two types of imaging studies: longitudinal imaging studies which investigate disease progression and treatment-related changes in functional connectivity, and test-retest studies which aim to investigate and improve the reliability of estimates for individual RSFC. We conduct simulations studies to evaluate the accuracy of the proposed method using the K-fold cross-validation approach. We also illustrate the application of the proposed method using two imaging datasets: the longitudinal resting-state fMRI from ADNI2 study and the test-retest fMRI data from Kirby21 study (Landman et al., 2011) ."}, {"section_title": "Method", "text": "The need to predict a subject's future brain connectivity often arises in medical research and clinical practice. Some examples include prediction on how neural connectivity pattern will be affected across time with the progression of a brain disorder or prediction on posttreatment brain connectivity due to treatment-related alterations on neural processing. A subject's future brain connectivity depends on various factors including current disease status, type of treatment, his/ her baseline brain connectivity and other relevant subject characteristics such as age, gender and family history, etc. Our aim is to develop an algorithm that utilizes information related to these relevant factors to provide accurate individualized prediction for future brain connectivity. Our approach is to develop a statistical model for characterizing the changes in functional connectivity using a training data set that includes both baseline and follow-up imaging scans. We then derive a prediction algorithm for future brain connectivity using a subject's baseline images and clinical/demographic characteristics based on the developed statistical model. Once the prediction algorithm is established, researchers or clinical practitioners can apply it to predict the future brain connectivity for a new subject by inputting information derived from the subject's baseline scans and relevant individualized traits. With the predicted future brain connectivity, researchers or clinical practitioners can find helpful information in forecasting alterations in a patient's brain networks with the progression of the disease or in deciding whether a treatment is appropriate for a particular patient in the way that it can lead to favorable therapeutical alteration on the patient's brain connectivity. We summarize our proposed approach for developing and applying the prediction algorithm in Fig. 1 . Prior to presenting our prediction algorithm, we describe the statistical model underlying the formulation of our T. Dai, Y. Guo NeuroImage 147 (2017) 772-787 prediction framework."}, {"section_title": "Bayesian hierarchical model (BHM) and estimation", "text": "One of the most commonly used measures for functional connectivity in the neuroimaging community is pair-wise correlation between fMRI Blood-oxygen-level dependent (BOLD) signals obtained from pairs of brain locations or regions, which are called the nodes in the connectivity network (Biswal et al., 1995; Greicius et al., 2003; Fox et al., 2005; Fransson and Marrelec, 2008) . We illustrate the proposed prediction method using correlation as the measure of functional connectivity but our method is general enough to be readily applied to alternative connectivity measures. We derive our predictive framework for brain functional connectivity using a Bayesian hierarchical model (BHM). The BHM is developed using subjects' repeatedly measured brain connectivity derived from both baseline and followup imaging scanning sessions. The first level of BHM models withinsubject session-specific connectivity measures obtained at multiple scans in terms of subject-specific effects, and the second level models subject-specific effects in terms of population parameters modulated by covariate effects. An expectation-maximization (EM) algorithm is developed to estimate the parameters in the model. The prediction algorithm is then derived based on the BHM model. The proposed method is applicable to various study designs. Specifically, our method can be applied to longitudinal studies where there are relatively long time intervals between different imaging scanning sessions and hence temporal changes are expected between connectivity measures at different sessions. The proposed method can also be applied to testretest studies where repeated scanning sessions are very close to each other in time and hence no significant temporal changes are expected between the repeatedly measured connectivity. We start with presenting a general model structure and later we will provide detailed examples of how to adapt the proposed model to specific study designs.\nLet i N = 1,\u2026, index subjects, m M = 1,\u2026, index nodes in the connectivity network, and k K = 1,\u2026, index scanning sessions. For any node pair m m ( , \u2032), we denote the observed connectivity estimated using subject i's brain images from the K scanning sessions as m m r m m r m m r ( , \u2032) = ( ( , \u2032),\u2026, ( , \u2032))\n. In the paper, we illustrate our model using the commonly used correlation coefficient as the measure of brain connectivity and r m m ( , \u2032) ik represents the Fisher's z transformation of the correlation between the two node-specific fMRI time series extracted from images obtained at the kth scanning session. One can also select other measures such as partial correlation as the connectivity measure and r m m ( , \u2032) ik would then represent the selected connectivity measure after proper transformation. The first-stage of BHM models the within-subject session-specific connectivity for a node pair m m ( , \u2032) as follows,\nwhere X i (1) is the first-level covariate matrix with the dimension of K q \u00d7 matrix and contains q session-specific covariates such as the time point corresponding to each of the K scanning sessions. Note that X i (1) includes time-varying covariates that can change across the K scanning sessions.\nm m R ( , \u2032) i is a q \u00d7 1 vector of subject-specific effects of interest corresponding to\nis the random error vector and is assumed to follow a zero-mean multivariate\n. We assume that m m R ( , \u2032)\nare independent across all subjects. In the first-level model (1), m m R ( , \u2032) i is a random variable, which represents the underlying connectivity between nodes m and m\u2032 for subject i and captures the within-subject correlations among the session-specific connectivity measures repeatedly obtained across the K sessions. The random error \u03f5 m m ( , \u2032)\nreflects the session-specific random variabilities after accounting for subject-specific connectivity characteristics. We assume that the random errors are independent across sessions, i.e. m m \u03a3 ( , \u2032) (1) is a diagonal matrix, since within-subject correlations across sessions are already accounted for by the subject-specific effects. The variability of the random errors can be the same or different across various sessions depending on the study design. For example, if subjects' images in different sessions are acquired under similar conditions (e.g. under the same protocol) and sessions are conducted very close in time such as in test-retest studies, it is reasonable to assume the variability of the random errors remain the same across sessions, hence the covariance matrix can be specified as\n, where \u03bb (1) is the covariance hyper-parameter and I K is the identity matrix of order K. On the other hand, in longitudinal studies where sessions are conducted across relatively long time intervals, we can specify different error variability level to accommodate potentials temporal changes, e.g.\nwhere\nrepresents the error variability at the jth session (j=1,2). At the second stage, we focus on modeling the subject-specific effects with respect to population parameters of interest, such as disease status, treatment assignment or other relevant patient characteristics (e.g., gender, age). The second-stage model is specified as follows\nwhere \nrepresents the deviation of subject-specific effects from the population mean adjusted with covariate effects. We assume the subject random variability follows a zero-mean multivariate normal distribution with the covariance matrix m m \u03a3 ( , \u2032) (2) . The specification of m m \u03a3 ( , \u2032) (2) depends on the subject-specific effects R i that we are interested in modeling. We will provide details on how to specify the covariance matrix for different study designs such as longitudinal studies and test-retest studies in the following sections. We note that the Level 2 model focuses on modeling subject-specific effects in terms of non-time varying covariates. In some studies, certain subjects' covariates may vary across sessions such as clinical variables measured at each session, we can model their effects on connectivity via Level 1 model in Eq. (1). Specifically, we can either include these time-varying covariates in X i\n(1) to model their effects via subject-specific effects or include them as additional covariates in Level 1 model which are associated with population-level parameters. For the population level parameters \u03b2, we specify prior distributions given by \u03b7 N \u03a3 ( , ) \u03b2 \u03b2 , where \u03a3 \u03b2 is a diagonal covariance matrix. If there is information available regarding \u03b2 from previous studies, one can take a full Bayesian approach and treat the population parameters as known, i.e. by setting \u03a3 0 = \u03b2 . In practice, we usually have little, if any, prior information for these parameters and a parametric empirical Bayes scheme with \u03a3 = \u221e \u03b2 (i.e. the diagonal variance terms are \u221e) is appropriate (Friston et al., 2002; Guo et al., 2008) . In this case, the prior expectation \u03b7 \u03b2 does not need to be specified (Appendix). In this case, the hyperparameters for our Bayesian hierarchical model only include the parameters in the covariance matrices m m \u03a3 ( , \u2032) (1) and m m \u03a3 ( , \u2032) (2) , which we denote as \u03bb m m ( , \u2032). These hyperparameters can be estimated from the data under parametric empirical Bayes scheme (Carlin and Louis, 2000; Friston et al., 2002) .\nThe proposed Bayesian hierarchical model can be estimated using the expectation-maximization (EM) algorithm (Dempster et al., 1977 (Dempster et al., , 1981 . Please see the Appendix for details. The EM algorithm offers a convenient approach to estimate both the parameters and hyperparameters in the model from the data. The E-step of EM algorithm involves estimating the conditional distribution of the parameters given the observed data, holding the hyperparameters \u03bb m m ( , \u2032) fixed. The M-T. Dai, Y. Guo NeuroImage 147 (2017) 772-787 step finds the maximum likelihood estimates of hyperparameters, i.e. \u03bb m m ( , \u2032) that maximize the marginal likelihood of the observed connectivity measures, where the marginal likelihood is obtained by integrating over the conditional distribution of the parameters obtained from the E-step. For a linear model under Gaussian assumptions such as ours and with the parametric empirical Bayes, the EM algorithm outputs the expectation and the covariance of the Gaussian posterior distribution of the parameters and the marginal maximum likelihood estimates of the hyperparameters (Appendix). The EM algorithm can also be adopted for full Bayes and maximum likelihood estimation (Carlin and Louis, 2000; Friston et al., 2002) .\nUnder certain conditions, the proposed Bayesian hierarchical model can be rewritten in terms of a frequentist Linear Mixed Model (LMM) allowing for an unequal spacing of the time points and both baseline and time-varying covariates. One appealing feature related to BHM is that it provides the possibility of incorporating prior information, if available, into the models. (4) and (5), we obtain the estimated conditional mean is the expected later connectivity based on subject's relevant characteristics coded in X i (2) which may include disease group, treatment assignment, age, etc. This part represents the population-level expectation for the subject based on his/her characteristics and is shared by the subpopulation of subjects who have the same traits. The second component in (6) represents the adjustment to the populationlevel prediction for the particular subject using subject-specific effects revealed from his/her earlier observed scans. More specifically, subject-specific effects are estimated by the deviation of the subject's earlier connectivity estimates from his/her earlier population-level"}, {"section_title": "Prediction algorithm", "text": "The amount of the adjustment depends on the variability of earlier connectivity estimates and the association between earlier and later connectivity estimates: the lower the variability of the earlier connectivity estimates and the higher association they have with the later connectivity estimates, the larger the effect the earlier connectivity estimates have on the later connectivity prediction. Additionally, we can also construct a \u03b1\nIn the following section, we will illustrate how to specify the hierarchical model for two commonly seen study designs involving repeated-measures fMRI, which are longitudinal studies and test-retest replication studies."}, {"section_title": "BHM model specification for various types of studies", "text": ""}, {"section_title": "Model specification for longitudinal studies", "text": "In longitudinal imaging studies, subjects are scanned repeatedly in multiple sessions that are separated by relatively long time intervals and temporal changes in neural processing across the sessions are expected and of interest. For example, longitudinal studies may be conducted to evaluate how brain functional connectivity changes with the disease progression or neurodevelopment. In other cases, longitudinal studies are used to investigate treatment-related changes by repeatedly scanning subjects at pre-treatment and post-treatment periods. When applying the proposed the BHM model to longitudinal studies, we model the population and subject effects on temporal change in connectivity as well as baseline connectivity. Specifically, suppose the longitudinal measurements of the connectivity m m\nindicates the baseline. Assuming a constant change rate in the connectivity over time, the proposed BHM model in (1) and (2) can be specified as follows for the longitudinal study, \n(2)\nwhere\nare the subject-specific baseline and change rate of connectivity, X iB and X i\u0394 include subjects' covariates relevant to the baseline and change rate, respectively, \u03b2 m m ( , \u2032)\nare population effects of interests related to the baseline and change rate. In this BHM model, we first model the repeatedly measured connectivity in terms of subject-specific baseline and change rate and then we model the subject-specific effects in terms of population parameters modulated by subjects' covariates. For the random errors from first-level model, we assume that\nof the second-level model represent the deviation of the subject-specific baseline and change rate from the population mean after adjusting for subjects' covariates effects. These random errors are assumed to follow a zero-mean multivariate normal distribution with the covariance matrix m m\n, where \u03bb m m\nand \u03bb m m ( , \u2032)\nrepresents the between-subject variabilities in the baseline and change rate, respectively."}, {"section_title": "Model specification for test-retest reliability studies", "text": "In test-retest reliability studies, subjects are scanned repeatedly in multiple sessions that are separated by very short time intervals. The studies are usually conducted to quantify the reproducibility of the results obtained from statistical analysis using the scan-rescan imaging data. In recent years, there has also been strong interest in using testretest imaging studies to develop more reliable estimator or predictor for individual neural features such as connectivity (Shou et al., 2014; Mejia et al., 2015) . In test-retest studies, no disease-related or treatment-related temporal changes are expected given the short time interval between scanning. The proposed BHM model in (1) and (2) \nwhere\nis the subject-specific connectivity, X i contains relevant subjects' clinical or demographic characteristics that may be affect functional connectivity. In the BHM model (8), the level 1 model takes the similar form as the classical measurement error model (Carroll et al., 2006) . Here, the measurement errors are assumed to follow a zero-mean multivariate Gaussian distribution with\n. At level 2 of the hierarchical model, we model the subject-specific connectivity in terms of population parameters modulated by a subject's covariate effects. And the random error m m \u03f5 ( , \u2032)\nrepresents between-subject variability and follows zero-mean normal distribution with a variance of \u03bb m m ( , \u2032)\n. Based on the hierarchical model (8), we can quantify the reproducibility of the estimated individual functional connectivity in the scanrescan imaging data. Specifically, we can evaluate the reproducibility using the intraclass correlation coefficient (ICC) which is a commonly used reproducibility index. ICC ranges between 0 and 1 with higher ICC indicating the more reproducible a measurement is within a subject. \n(1)\n, which is the ratio of between-subject variability \u03bb m m ( , \u2032) (2) to the total variability which includes the between-subject and within-subject variability, i.e.\n. The proposed Bayesian hierarchical model and prediction algorithm can also help achieve another goal in test-retest imaging study, that is to develop more reliable estimator for individual functional connectivity. The approach is to develop an estimator for individual connectivity based on his/her first scan and evaluate it accuracy in estimating the subject's connectivity in the second scan (Shou et al., 2014; Meija et al., 2015) . Using our proposed methods, we can first train the Bayesian hierarchical model (8) using the scan-rescan data in the training data set and then apply the proposed predictor in equation (6) to derive an estimator for a new subject's connectivity in the second scan based on his/her connectivity measured from the first scan. The proposed estimator for individual connectivity has the potential to improve the subject-specific connectivity estimate by not only using information from the subject's own measurement from the first scan but also \"borrowing\" strength from the group of subjects who share similar characteristics with the current subject. To illustrate this, we consider a simple test-retest study with two scanning sessions (K=2), in which researchers are interested in estimating subjects' second-session connectivity based on their first-session fMRI scans. After fitting the Bayesian hierarchical model in (8), we can apply the predictor in (6) as an estimator of a subject's functional connectivity in the second scan based on the data in the first scan. We show the predictor in (6) \n(1)\n. Eq. (9) shows the BHM estimator of the individual connectivity is a weighted average of the subject-level connectivity measurement, r m m\n, and covariate-adjusted population expectation, X \u03b2 m m ( , \u2032)\n, which ranges between 0 and 1, represents the relative weight assigned to the subject-level estimate as compared to population expectation. The higher ICC, i.e. the more reproducible the within-subject connectivity estimates are, we would assign more weight to the same subject's own connectivity estimate. On the other hand, with low ICC or low within-subject reproducibility, our predictor would place more weight on the population-level expected connectivity in estimating the subject's connectivity. The implications from Eq. (9) are that the BHM estimator for subject i's connectivity not only depends on the subject's own connectivity measured in the first scan but also borrows strength from the population-level expectation based on the subject's covariates X i , and that the relative weights assigned to the two parts are automatically adjusted based on the level of within-subject reproducibility.\nIn the empirical Bayes literature, the proposed estimator (9) is often known as the \"shrinkage estimator\" (Efron and Morris, 1975; James and Stein, 1961) , which has been shown to improve upon traditional estimators by shrinking the estimators towards some fixed constant value. In addition, the proposed estimator is similar to the best linear unbiased predictor (BLUP) of random effects in linear mixed models, except in the latter case, the weights depend on unknown values of variance components, which are replaced by sample-based estimates (Henderson (1975) and Liu et al. (2008) ). The weight \u03b3 m m ( , \u2032) B is referred to as the shrinkage factor since it controls how much we shrink the subject-level estimator towards the population mean. As ICC increases, subject-level information is more reliable and hence more weight is assigned to the subject-level estimate r m m ( , \u2032)"}, {"section_title": "i1", "text": ". On the contrary, as ICC decreases, subject-level information is less reliable and we should benefit more by \"borrowing\" information from the population. As a shrinkage estimator, our predictor in (9) has a nice connection with the recently proposed shrinkage estimator (Shou et al., 2014; Mejia et al., 2015) for predicting future brain connectivity in test-retest imaging studies. Specifically, Shou et al. (2014) and Mejia et al. (2015) proposed a shrinkage estimator for individual functional connectivity as follows, \n(1)\n. where\nare moment estimators for within-subject and between-subject variance.\nFrom (9) and (10) by Shou et al. (2014) and Mejia et al. (2015) . However, there are two major differences between the two methods. First, the population expectation in Shou's estimator is the sample mean connectivity across all subjects. The population expectation in the BHM predictor is the model-based subpopulation mean based on subject's covariates pattern. By taking into account covariate effects in population mean estimation, the BHM predictor can potentially provide more precise covariate-adjusted population-level expectation for a subject based on his/her clinical and demographic characteristics. Secondly, Shou's shrinkage factor is derived empirically based on the moment estimators of the variance. In comparison, the shrinkage factor in BHM predictor is derived from the model-based variance estimates."}, {"section_title": "Experimental methods", "text": "We illustrate the proposed BHM method and compare it with existing methods on simulated data and also on two real-world fMRI data examples."}, {"section_title": "Simulation studies", "text": "We conducted two sets of simulation studies to evaluate the performance of the proposed BHM method in comparison with alternative methods for predicting brain connectivity for longitudinal imaging studies and test-retest reliability studies. Under each simulation scenario, we generated 100 data sets each with 100 subjects. We evaluated the accuracy of the prediction methods using the K-fold cross-validation. Specifically, we split the data into K=5 subsets. In each iteration, we assigned K \u2212 1 subsets as training data and the one remaining subset as the test data. The training data were used to develop the prediction algorithms based on the proposed BHM method and alternative methods and the test data were then used to evaluate the prediction accuracy. For example, to evaluate the prediction accuracy based on the proposed Bayesian hierarchical model, we first fit the model to the training data then predict the connectivity for subjects in the testing data using the estimated parameters from the training data. We repeated this procedure for the K different training and test data assignments to compute the predicted connectivity for all subjects. We measured the prediction error using average prediction mean square error (PMSE) between the true underlying connectivity and the predicted connectivity.\nIn the first setup, we simulated longitudinal data with three connectivity measurements within each subject from the hierarchical model in (7). For Level 2 model in (7), we considered two subject groups. We assume subjects from the two groups had the same baseline connectivity \u03b2 B but potentially had different change rates across time with\n. We considered three levels of between-group differences in the change rate with \u03b2 \u03b2 ( ,\nspecified as (0.2, \u22120.2), (0.1, \u22120.1), (0, 0), representing large, small and no group difference, respectively. The between-subject variability in the baseline and change rate, i.e. \u03bb B (2) and \u03bb \u0394 (2) , were set at 0.03 and 0.01 respectively to mimic the real data. For Level 1 model in (7), the within-subject variance \u03bb (1) was chosen so that the variance ratio of between-subject variance and total variance at baseline, i.e. \u03bb \u03bb \u03bb\n(2) , varied from 0.1 to 0.9. We then applied various prediction methods to predict the connectivity at t 3 based on the measurements observed at t 1 and t 2 . For the longitudinal study, we compared the proposed BHM predictor with a raw predictor and a General Linear Model (GLM) predictor. Raw predictor predicted a subject's future connectivity using the same subject's baseline estimate. The GLM predictor was derived based on the following GLM model which models connectivity from all subjects with common population parameters and assumes independence among scans obtained at multiple sessions within a subject, i.e., , which only reflects grouplevel expectation and does not take into account of information obtained from the subjects' previous scans.\nIn the second setup, we simulated data with two scan-rescan connectivity measurements for each subject from the test-retest BHM in (8). For Level 2 model in (8), we considered two subject groups with\nrepresenting the mean connectivity for group 1 and 2, specifically. We considered three levels of between-group differences with \u03b2 \u03b2 ( , ) 1 2 specified as (0.6, 0.2), (0.4, 0.2), (0.2, 0.2), representing large, small and no group difference, respectively. We specified the between-subject variance \u03bb (2) in Leven 2 model as 0.03, and let the within-subject variance \u03bb (1) in Level 1 model vary so that the variance ratio of between-subject variance and total variance changed from 0.1 to 0.9. We applied the prediction methods to predict the connectivity in the second scan based on the measurement in the first scan. For the test-retest study setting, we compared the BHM estimator with the raw estimator, a mean estimator, the GLM estimator and the shrinkage estimator (Shou et al., 2014; Mejia et al., 2015) . Here, the mean estimator gave the prediction for a subject's rescan connectivity using the group mean at the first scan. The GLM estimator is derived based on the following GLM, , which only reflects group-level expectation.\n4.1.1. Simulation results for longitudinal studies Fig. 2 presents the average PMSEs across simulation runs to evaluate the prediction accuracy based on BHM, GLM and the raw estimator. We plot the PMSE against the variance ratio to see how the PMSE changes with respect to the between-subject variability in relative to the total variability. We evaluate the PMSE for the three simulation scenarios with large, low and no between-group differences in the change rate. Results show that the PMSE of the BHM predictor was always smaller as compared to GLM predictor and raw estimator. Specifically, both the BHM and GLM performed much better than the raw estimator when there is large between-group differences in the connectivity change rate since BHM and GLM take into account of the group information in the predictive model while the raw estimator does not. Additionally, the PMSE of the BHM and GLM was also much lower than the raw estimator when the variance ratio is low indicating low within-subject correlation. This is because the raw estimator uses the same subject's baseline connectivity to predict his/her follow-up connectivity and hence performs poorly when the baseline scan had a low correlation with the follow-up scan. Between BHM and GLM, we find that BHM performed better than GLM when the variance ratio increases, corresponding to higher within-subject correlation in the longitudinal measurements. This is because BHM takes into account of within-subject correlation while GLM does not.\nIn addition to PMSE, We also present distributions of the predicted connectivity at t 3 based on the three methods and compare them with the true distribution of the simulated connectivity (Fig. 3) . In Fig. 3 , the data were from the case where there was large between-group difference in the connectivity change rate and the variance ratio was 0.5. Results show that the box plots of the predicted connectivity based on the BHM predictor best resembled the true connectivity distribution at t 3 . In comparison, the GLM predictor did poorly in predicting individual-level connectivity although it successfully predicted the mean connectivity for the two groups. This is because GLM predictor didn\u2032t account for individual variability in the prediction. The raw estimator failed to predict the difference between the two subject groups' connectivity at time t 3 due to the different change rates of the two groups. This is because the raw estimator simply used each subject's baseline to predict his/her follow-up and did not account for any longitudinal changes across time in the connectivity. Due to the high within-subject as well as between-subject variability in rs-fMRI measurements, it is a challenging task to model and predict individual trajectories in longitudinal resting state connectivity. The proposed BHM predictor is based on both the population-level expectation as well as subject-specific effects. This allows the BHM predictor to effectively capture the between-subject as well as within-subject variability. Therefore, it did a good job in predicting both the group effects as well as individual trajectories in longitudinal connectivity."}, {"section_title": "Application to longitudinal rs-fMRI data in ADNI2 study", "text": ""}, {"section_title": "Longitudinal rs-fMRI in ADNI2 study and pre-processing steps", "text": "We first applied the proposed BHM method to the longitudinal rsfMRI data from the Alzheimer's Disease Neuroimaging Initiative 2 (ADNI2) study. One of the main purposes of ADNI2 project is to examine changes in neuroimaging and other biomarkers with the progression of mild cognitive impairment (MCI) and Alzheimer's Disease(AD). Data used in our analysis were downloaded from ADNI website (http://www.adni.loni.usc.edu) and included longitudinal rsfMRI images from eighty subjects that were collected at screening, 6 months and 1 year. A T1-weighted high-resolution anatomical image (MPRAGE) and a series of resting state functional images were acquired with a 3.0 Tesla MRI scanner (Philips Systems) during longitudinal visits. The rs-fMRI scans were acquired with 140 volumes, TR/TE=3000/30 ms, flip angle of 80 and effective voxel resolution 3.3\u00d73.3\u00d73.3 mm. Additional image acquisition parameters are described in details on http://www.adni-info.org. Quality control was performed on the fMRI images both by following the Mayo clinic quality control documentation (version 02-02-2015) and by visual examination. Among the 80 subjects, 23 were normal, 47 had MCI, and 10 were diagnosed with AD at baseline. Among normal/MCI/AC groups, 10(43%), 28(60%) and 4(40%) were male and the mean age was 73.7 \u00b1 5.6, 71.4 \u00b1 6.4, 70.8 \u00b1 7.8, respectively. No significant age or gender differences were found across disease status groups (Age: p=0. 30; Gender: p=0.31).\nThe rs-fMRI data were preprocessed using the modified preprocessing script released from the 1000 Functional Connectomes Project. Specifically, skull stripping was performed on the T1 images to remove extra-cranial material, then the first four volumes of the functional time series were removed to stabilize the signal, leaving 136 volumes for subsequent preprocessing. The anatomical image was registered to the 8th volume of the functional image (slice time corrected) and subse-quently spatially normalized to the MNI standard brain space. These normalization parameters from MNI space were used for the functional images, which were smoothed with a 6 mm FWHM Gaussian kernel. Motion corrections were applied on the functional images. A validated confound regression procedure (Satterthwaite et al., 2015) was performed on each subject's time series data to remove confounding factors including motions, global effects, white matter (WM) and cerebrospinal fluid (CSF) nuisance signals. The confound regression contained nine standard confounding signals (6 motion parameters plus global / WM / CSF) as well as the temporal derivative, quadratic term and temporal derivative of the quadratic of each. Furthermore, motion-related spike regressors were included to bound the observed displacement. Lastly, the functional time series data were band-pass filtered to retain frequencies between 0.01 and 0.1 Hz which is the relevant frequency range for rs-fMRI."}, {"section_title": "Brain network construction", "text": "To construct brain network, we chose the 264-node cortical parcellation system defined by Power et al. (2011) . Each node is a 10 mm diameter sphere in standard MNI space representing a putative functional area, and the collection of nodes provides good coverage of the whole brain. It is a finer spatial resolution than the commonly used Automated Anatomical Labeling (AAL) atlas (Tzourio-Mazoyer et al., 2002), but is not as granular as using a system of single voxels. This intermediate node scheme is recommended to balance the trade-off between increased spatial resolution and attenuate signal-to-noise ratio (Fornito et al., 2010; Power et al., 2011) . Power et al. (2011) has shown that brain networks constructed based on the 264-node system demonstrated better reflection of brain organization than AAL-atlas based networks.\nFor our connectivity analysis of ADNI2 rs-fMRI data, we considered 258 of the 264 nodes that were within the gray matter mask derived from the data. To facilitate the understanding of the functional roles of the nodes, we assigned them to ten functional networks or modules that correspond to the major resting state networks (RSNs) described by Smith et al. (2009) . The RSN maps, determined by ICA decomposition of a large database of activation studies (BrainMap) and rs-fMRI data, are coherent during both task activity and at rest. The functional modules include medial visual network (Med Vis), occipital pole visual network (OP Vis), lateral visual network (Lat Vis), default mode network (DMN), cerebellum (CB), sensorimotor network (SM), auditory network (Aud), executive control network (EC), and right and left frontoparietal networks (FPR and FPL) . To determine the module membership at each node, we found the RSN map with the largest zvalue in the node, above a certain threshold (z > 3). 36 of the 258 nodes in the grey matter were not strongly associated with any RSN maps, and were therefore not included. Also, since too few nodes were contained in the cerebellum, this module and corresponding nodes were not included in the analysis as well. A visualization of the remaining 216 nodes that were used in subsequent analysis, classified by functional module, is shown in Fig. 6 . All brain visualizations were created using BrainNet Viewer (Xia et al., 2013) .\nTo measure the connectivity between the nodes, we extracted the representative fMRI time series from each node by performing singular value decomposition (SVD) on the time series from all the voxels within that node. We then constructed a 216\u00d7216 symmetric connectivity matrix for each subject by calculating Pearson correlation between the representative time series extracted from each node. Fisher's transformation was then applied to the correlation coefficients."}, {"section_title": "Bayesian hierarchical model for ADNI2 longitudinal study", "text": "We applied the proposed Bayesian hierarchical model in (7) denote the connectivity measure between node m and m\u2032 for subject i at at baseline, 6 months and 1 year, respectively. The hierarchical model for the ADNI2 study was specified as follows: . In ADNI2 study, the longitudinal measurements were obtained at baseline, 6 months and 1 year for subjects, hence t t = 0, = 0.5\n. In the second level of BHM, we model the subject-specific baseline R m m ( , \u2032) iB and change rate R m m ( , \u2032) i\u0394 in terms of population parameters that code effects for the three disease groups: Normal, MCI and AD. Here, I iN , I iM and I iA are binary group indicators which equals 1 if the ith subject was in the normal control, MCI and AD group, respectively, and zero otherwise. Therefore, our model can capture the group differences not only in baseline connectivity but also in its temporal changes across time."}, {"section_title": "Application to test-retest rs-fMRI data in Kirby21 study", "text": "In this section, we illustrate the utility of the proposed method in test-retest imaging reproducibility studies with the Kirby21 data (Landman et al., 2011) which was used in previous work (Shou et al., 2014; Mejia et al., 2015) to develop estimators for individual functional connectivity. The data set contains two 7-minute scan-rescan restingstate fMRI images for 21 healthy adults (11 M/ 10 F, aged 22-61). Each scanning session took about one hour. After the first scan, each subject exited the scan room for a short break, and then reentered the scan room for an identical second scanning session. A T1-weighted anatomical image and a series of rs-fMRI were acquired using a 3T MR scanner. Resting-state fMRI were collected using 2D EPI sequence with SENSE partial-parallel imaging acceleration to obtain 3\u00d73 mm inplane resolution in thirty-seven 3 mm transverse slices with 1 mm slice gap (TR/TE=2000/30 ms, FA=75).\nThe rs-fMRI data was preprocessed using the standard rs-fMRI preprocessing procedure that was described in the previous section. We applied the proposed Bayesian hierarchical model for test-retest studies presented in Eq. (8) to model the Kirby21 data. We then applied the proposed BHM predictor presented in Eq. (9) to estimate a subject's functional connectivity in the second scan based on the data in the first scan.\nWe used 7-fold cross validation to evaluate the reliability of the BHM connectivity estimators. The reliability was measured by prediction mean square error (PMSE) between the observed and estimated connectivity for the second scan. In comparison to the BHM-based estimator, we considered four alternative methods: GLM, mean, raw and the shrinkage estimator."}, {"section_title": "Results", "text": ""}, {"section_title": "Simulation results for test-retest studies", "text": "We present the simulation results in a similar manner for test-retest studies. In Fig. 4 , we plot the average PMSEs to evaluate the prediction accuracy based on BHM, GLM, the raw estimator, the mean estimator and the shrinkage estimator. We evaluated the PMSE for the three levels of between-group difference and also for various variance ratio (ICC) levels. Results show that the PMSE of the proposed BHM predictor was the smallest as compared to the other methods under all settings. As ICC increases indicating higher within-subject correlation, the PMSE of BHM, shrinkage and raw predictors decreased, and difference among these three methods also decreased. In comparison, the PMSE of GLM and mean predictors remained the same with ICC increases because these two methods do not take into account withinsubject correlation in the connectivity. When there was larger difference between two group means, the benefits of BHM and GLM predictors were more obvious, since these two methods take into account the group effects. Among the five methods, the BHM estimator and the shrinkage estimator demonstrated best performance in general. When there is large between-group difference in connectivity, the BHM estimator out performed the shrinkage estimator. The reason is that the BHM estimator takes into account group differences while the shrinkage estimator does not. When there is no group difference but high ICC indicating high within-subject correlation among the same subject's repeated measured scans, the raw estimator which is based on the same subject's baseline scan actually had better performance than the GLM predictor which is a group-level predictor without exploiting the information from the same subject's baseline scan. Fig. 5 presents the simulated distributions of connectivity at the scan and rescan time points and then presents the distribution of the predicted connectivity at the rescan based on the five methods. The data were from the case where there was large between-group difference and the ICC was set at 0.5. The distribution of predicted values from BHM method best resembled that of the simulated data in terms of the group mean and between-subject variability. GLM predictor successfully differentiated the population means for different groups but performed poorly on individual-level prediction. Raw estimator also captured the difference in group means but was more variable than the true distribution because it didn\u2032t pool information T. Dai, Y. Guo NeuroImage 147 (2017) 772-787 across subjects in prediction. Pooled mean predictor performed the worst since it ignored the large between-group difference. The shrinkage estimator did well except that there was slight misalignment between the group means of the shrinkage estimator and those in the true distribution. This is because the shrinkage estimator doesn\u2032t formally model between-group differences in the prediction. As in Figs. 3, 5 shows that our proposed BHM predictor did a better job than the existing methods in accurately predicting both the group effects as well as individual trajectories in connectivity, because it models both the population-level effects as well as subject-specific effects."}, {"section_title": "Results for ADNI2 longitudinal study", "text": "The proposed EM algorithm was applied to estimate the parameters in the Bayesian hierarchical model for the ADNI2 longitudinal rs-fMRI study. In Figs. 7 and 8 , we present BHM model-based estimates of baseline connectivity and temporal change rate in connectivity across time for the three disease groups. Specifically, Fig. 7 (a)-(c) illustrates the estimated 216\u00d7216 baseline connectivity matrices for the three disease groups. In general, we observe similar connectivity patterns across the three disease groups at baseline. For example, edges within the same functional network mostly demonstrate positive connections; we also observe positive between-network connections such as connections between the three visual networks and connections between the auditory and sensorimotor networks.\nIn Fig. 7 , we present edges that were found to have considerable differences between the MCI and control group ( Fig. 7(d) - (e)) and between the AD and control group (Fig. 7(f) - (g)).To identify edges that were different between the groups, we evaluate the posterior probability at each edge for having at least moderate between-group differences, which is defined as an absolute between-group difference in the correlation connectivity measure that is greater than 0.1. Edges that had an posterior probability of greater than 0.7 for having at least moderate between-group difference are shown in Fig. 7(d) -(g). To help understand the direction of the group differences, we present the results for positive and negative connections separately. Results show that there were more differences in baseline connectivity between AD and controls than between MCI and controls, indicating the baseline connectivity in AD patients is more distinctive from the control group as compared to the MCI. Compared to the control group, both the MCI and AD disease groups demonstrated weaker positive connectivity within the auditory and sensorimotor networks and also weaker positive connections between these two networks. Some previous studies have found altered activity and connectivity in these two networks that are related to the Alzheimer disease (Agosta et al., 2010; Goll et al., 2012; Salustri et al., 2013; Terranova et al., 2013; Ferreri et al., 2016) .\nIn Fig. 8 , we compare the change rate in connectivity from baseline to one-year between the three disease groups. We first evaluate the posterior probabilities for demonstrating at least moderate temporal changes, which is defined as having an absolute change rate that is greater than 0.2. Fig. 8(a)-(c) show the edges where the posterior Fig. 3 . Comparison between the predicted connectivity distributions with the true connectivity distributions in the simulated data for longitudinal studies with large between-group difference in connectivity change rate. On the left panel, we present the distributions of simulated data for all three sessions in the longitudinal study. On the right panel, we present the distributions of predicted connectivity for session 3 by BHM, GLM and raw estimators. probabilities for demonstrating moderate or greater temporal changes are greater than 0.7. Results show that the AD group demonstrated much more significant temporal changes during the one year period as compared to the normal and MCI group. Specifically, we find very few edges had moderate or greater changes in the control and MCI group. While in the AD group, considerable changes were observed in many connections. To further illustrate the edges that showed significant changes across time, we selected 50 edges with the largest posterior probabilities for temporal changes in the AD group, and present their estimated connectivity at baseline and then one year in Fig. 8(d) and (e). In the figures, red lines and blue lines are used to denote positive and negative connections, respectively. The width of the lines reflects the magnitude of the estimated connectivity based on BHM. Some observations from these figures are that for the connectivity decreased between nodes in sensorimotor and auditory network and also between DMN and auditory network over the year for the AD patients.\nWe applied the proposed BHM prediction algorithm to forecast brain connectivity one year after baseline for each subject based on the Fig. 5 . Comparison between the predicted connectivity distributions with the true connectivity distributions in the simulated data for test-retest studies with large between-group difference in mean connectivity. The horizontal reference lines correspond to the population means of connectivity for the two groups. T. Dai, Y. Guo NeuroImage 147 (2017) 772-787 Fig. 7 . Group differences in baseline connectivity based on the bayesian hierarchical model (BHM) for ADNI2 study. Subfigures (a)-(c) present the BHM model-based estimates of 216\u00d7216 baseline connectivity matrices for normal controls (NC), mild cognitive impaired (MCI) and Alzheimer patients (AD). Each element in the connectivity matrix represents a node-pair or edge where the nodes are defined based on the Power node system and grouped by functional networks. Red edges indicate positive connectivity and blue edges indicate negative connectivity. Subfigures (d)-(g) present the edges that showed significant differences in the baseline connectivity between NC and MCI/AD groups. Yellow edges indicate a posterior probability of greater than 0.7 that the baseline connectivity in the patient group has considerably larger magnitude than NC, and green edges indicate a posterior probability of greater than 0.7 that baseline connectivity in patient group had considerably smaller magnitude than NC.\nsubject's observed images at baseline and 6 months in the ADNI2 study. Fig. 9 presents the prediction accuracy based on BHM measured by the prediction mean square error (PMSE) between the observed and predicted connectivity based on 5-fold cross validation. In comparison to the proposed method, we also present the prediction accuracy based on GLM and that based on the raw estimator. Fig. 9 shows BHM demonstrated the highest prediction accuracy among the three methods, with the PMSE generally below 0.06 and the average (SD) for PMSE being 0.045(0.011). GLM predictor, which used group mean for prediction, had an average PMSE of 0.050(0.014). The raw predictor, which used the subject's baseline connectivity, demonstrated the worst performance with an average PMSE of 0.070(0.016). Another observation from these figures is that the prediction accuracy was lowest for forecasting connectivity within the executive control, frontoparietal left and right, and visual networks, indicating it is more challenging to accurately predict future connections in these networks as compared to Fig. 8 . Group differences in connectivity change rate based on the bayesian hierarchical model (BHM) for ADNI2 study. Subfigures (a)-(c) present the BHM model-based estimates of 216\u00d7216 thresholded posterior probability matrices for demonstrating significant connectivity changes over 1 year in the three disease groups. Dark blue indicates edges that demonstrated at least moderate temporal change, i.e. having an absolute change rate of greater than 0.2, with posterior probability greater than 0.7. Results show that the AD group demonstrated much more significant temporal changes during the one year period as compared to the normal and MCI group. Specifically, considerable amount of edges demonstrated high posterior probabilities of temporal changes in the AD group, while very few edges in NC and MCI showed significant change. In subfigures (d) and (e), we display the baseline and one-year connectivities for 50 edges with the largest posterior probabilities of temporal change in the AD group. Red edges indicate positive connectivity and blue edges indicate negative connectivity. The size of the edges reflects the strength of connectivity.\nT. Dai, Y. Guo NeuroImage 147 (2017) 772-787 the other networks. To further illustrate the prediction accuracy in individual subjects, we plotted the average PMSE across all edges for each subject based on the three methods in Fig. 9 (d)-(f). Results show that our BHM-based predictor outperformed GLM predictor for most of the subjects (71 out of 80) and outperformed the raw predictor for all subjects. In this paper, we present the results for predicting connectivity in one-year following-up scans in the ADNI2 study based on the longitudinal data that were available at the time of our data analysis. As a reviewer pointed out, when more longitudinal scans become available from the study, it will be helpful to predict connectivity after a longer follow-up period such as 3-5 years when more clinically significant changes due to the progress of the Alzheimer's disease are expected Fig. 10 . We further examined the coverage probabilities of the 95% prediction intervals for predicting one-year functional connectivity based on the Bayesian hierarchical model. Across all edges, 94.1% (with a standard error of 2.2%) of the observed connectivity measurements fell within the 95% prediction intervals."}, {"section_title": "Results for kirby 21 test-retest fMRI study", "text": "Similar as the results from the simulation studies, our BHM predictor and the shrinkage estimator demonstrated the highest reliability among the five methods for the Kirby 21 data, where BHM had slightly lower PMSE as compared to the shrinkage estimator. GLM predictor and mean estimator showed reasonable reliability. The raw predictor which only used the subject's own first-session scan showed the lowest reliability. Across all edges, 92.3% (with a standard error of 4.7%) of the observed connectivity measurements fell within the 95% prediction intervals for predicting individual functional connectivity based on the BHM method, indicating the proposed method produces satisfactory coverage level."}, {"section_title": "Discussion", "text": "In this paper, we present a general Bayesian hierarchical model for forecasting individual future functional connectivity based on the individual's earlier fMRI scans and relevant clinical and demographical characteristics. The proposed method provides a general framework for investigating brain connectivity under various scenarios. The method can be applied to both task-related and resting state fMRI studies. Furthermore, our method can be applied to a range of connectivity metrics such as correlation, partial correlation, coherence after performing proper transformation on these metrics. The utility of the proposed approach is demonstrated for both longitudinal and testretest imaging studies. Through simulation studies and a longitudinal imaging study, we show that the proposed method provides more accurate prediction and estimation for individual connectivity by both taking into account an individual's distinct connectivity patterns and pooling information across the group of subjects who share similar characteristics. The predictive model can potentially have important applications in clinical practice. For example, by providing prediction for individual neural development trajectory, it can facilitate implementation of early intervention for brain disorders to mitigate a more Fig. 9 . Comparison of prediction mean square error (PMSE) for predicting one-year functional connectivity in ADNI2 study using different prediction methods. Subfigures (a)-(c) present the average PMSE matrices across all subjects using the BHM, GLM, and the raw estimator, respectively. Darker color represents larger PMSE, and lighter color represents smaller PMSE. In subfigures (d)-(f), we compare the performances of different prediction methods for each individual using average PMSEs across all edges. Results are presented separately for the normal control, MCI and AD disease groups.\nsevere mental illness evolving. The predictive model can also provide guidance for developing more effective individualized treatment plans by providing clinicians with predictive information concerning the effect of treatment on brain connectivity. A MATLAB toolbox for the proposed BHM predictive model will be made available at the website of the Center for Biomedical Imaging Statistics (CBIS) at Emory University.\nFor the proposed BHM-based prediction algorithm, most of the computation time is spent on the prediction algorithm development stage, i.e. estimation of the BHM model using the training data. Once the prediction algorithm is established, applying the algorithm to predict a new subject's brain connectivity is quite rapid. For example, for the ADNI2 longitudinal data example which involves about 80 subjects and 216-by-216 connectivity matrices, the computation time for training the BHM model was about 1.3 h on a single processor with Intel Core i7 CPU (2.4 GHz) and 8 GB RAM. The prediction based on the BHM for a new subject took no more than one second on the same processor.\nThe proposed Bayesian hierarchical model has an important advantage in handling missing data in the longitudinal studies. Unlike many other methods, the BHM doesn\u2032t require removal of subjects who have missing data at certain time points but rather can estimate the parameters using all the data that are available from the subject. Specifically, in the presence of missing data, we will estimate the model by using the EM algorithm to maximize the likelihood based on all the observed data. In this way, BHM can make use of all the available information from the observed data (Verbeke and Molenberghs, 2000) .\nFor test-retest imaging studies, the proposed method can provide a more reliable estimator for individual brain connectivity than alternative methods. We show that there is a nice connection between the BHM estimator and the recently developed shrinkage estimator (Shou et al., 2014; Mejia et al., 2015) . Both methods are essentially a weighting procedure that \"borrow\"s strength from a larger population to improve individual estimates. Compared with the existing methods, the new contributions of the proposed method based on the Bayesian hierarchical model include the following: the proposed method can account for covariate effects and thus can potentially provide more accurate estimates for heterogeneous population, e.g., when the study cohort consists of both patients and healthy controls, the proposed predictor provides a unified and model-based approach for determining the weighting factor which controls the relative contribution from the population-level and individual-level effects, finally, the proposed method allows for hypothesis testing and prediction intervals which can help provide inference for the connectivity estimates. T. Dai, Y. Guo NeuroImage 147 (2017) , where \u03a3 (1) and \u03a3 \u03b8 are based on \u03bb m ( ) ."}, {"section_title": "M Step", "text": "At the M step, we use the estimated conditional distribution of \u03b8 given r from the E-step to update the maximum likelihood (ML) estimates for the covariance hyper-parameters \u03bb. Specifically, we find the \u03bb m ( +1) such that the log-likelihood r \u03bb F p = ln ( | ) is maximized. This can be done using a "}]