[{"section_title": "Abstract", "text": "Accurate segmentation of anatomical structures in medical images is important in recent imaging based studies. In the past years, multi-atlas patch-based label fusion methods have achieved a great success in medical image segmentation. In these methods, the appearance of each input image patch is first represented by an atlas patch dictionary (in the image domain), and then the latent label of the input image patch is predicted by applying the estimated representation coefficients to the corresponding anatomical labels of the atlas patches in the atlas label dictionary (in the label domain). However, due to the generally large gap between the patch appearance in the image domain and the patch structure in the label domain , the estimated (patch) representation coefficients from the image domain may not be optimal for the final label fusion, thus reducing the labeling accuracy. To address this issue, we propose a novel label fusion framework to seek for the suitable label fusion weights by progressively constructing a dynamic dictionary in a layer-by-layer manner, where the intermediate dictionaries act as a sequence of guidance to steer the transition of (patch) representation coefficients from the image domain to the label domain. Our proposed multi-layer label fusion framework is flexible enough to be applied to the existing labeling methods for improving their label fusion performance, i.e., by extending their single-layer static dictionary to the multi-layer dynamic dictionary. The experimental results show that our proposed progressive label fusion method achieves more accurate hippocampal segmentation results for the ADNI dataset, compared to the counterpart methods using only the single-layer static dictionary."}, {"section_title": "Introduction", "text": "Magnetic resonance imaging (MRI) is an advanced medical imaging technique, which plays an essential role in neuroscience research and clinical studies. However, due to the large amount of MRI data produced every day, it is time-consuming and expensive to process medical images manually. Therefore, automated and accurate segmentation is in high demand in existing imaging-based studies, in order to either discover group differences between individual subjects or quantify subtle changes over time. For instance, the hippocampus is known as an important structure related to Alzheimer's disease, epilepsy, and schizophrenia ( Devanand et al., 20 07; Dickerson et al., 20 01; Holland et al., 2012; Van Leemput et al., 2009 ) . Therefore, automated and accurate segmentation of the hippocampus is critical.\nHowever, since anatomical structures (i.e., hippocampus) vary significantly across individuals, the prior knowledge of shape and appearance learned from a certain template is often not sufficient for guiding the segmenta, multi-atlas based segmentation methods have been recently developed and achieved great success by letting the target labels on the target image follow the consensus of labels of multiple atlases with similar local image appearance. Generally, with more atlases, higher segmentation accuracy can be achieved by reducing the variations between the target and atlas images.\nTo do the segmentation, followed by registering atlas images to the target image, the latent anatomical label on each target image point can be determined by a certain label fusion strategy, such as majority voting (MV) ( Heckemann et al., 2006; Rohlfing et al., 2005 ) . Majority voting is a classical label fusion method, which simply chooses the label with the highest vote as the final label. To improve the labeling accuracy, local weighted voting (LWV) was also proposed by replacing the hard voting (considering only the label information) with soft voting which is proportional to the patch-wise appearance similarity ( Sabuncu et al., 2010 ) .\nApparently, the above point-wise label fusion strategies are highly dependent on the accuracy of image registration. To address the potential issue of inaccurate registration, many patchbased label fusion methods have been proposed in recent years Fig. 1 . Demonstration of the significant gap of representation profiles computed in the image domain using image appearance and in the label domain using label information. ( Artaechevarria et al., 2009; Song et al., 2015; Wang et al., 2011; Yan et al., 2013; Zhang et al., 2011 ) . In these methods, the main assumption is that, if two image patches have similar appearance, they should bear the same anatomical label. The typical patchbased label fusion methods include nonlocal patch-based labeling (NPBL) ( Coup\u00e9 et al., 2011; Rousseau et al., 2011 ) and sparse patchbased labeling (SPBL) ( Tong et al., 2013; Zhang et al., 2012a Zhang et al., , 2012c . Note that all patch-based label fusion methods collect candidate atlas patches in a search neighborhood across all registered atlas images. The weights used for label fusion in NPBL are proportional to the decayed patch-wise similarities penalized by the exponential function. Inspired by the discriminative power of sparse representation ( Tibshirani, 2011; Zhang et al., 2012b Zhang et al., , 2012a , the SPBL method has been proposed to introduce sparsity into the optimization of the weighting vector at each image point. Since the sparsity constraint enforces many zero elements in the weighting vector, the SPBL method can reduce the risk of taking incorrect or ambiguous patches and finally use only a small number of well-matched patches for labeling. More advanced methods can be found in Wang et al. (2013) and Wu et al. (2014) , where the pairwise dependency between atlas patches is further modeled to avoid the repeating label fusion error by similar atlas patches.\nIn all of the above state-of-the-art methods, the weights are exclusively optimized in terms of patch-wise image appearance. The computed weighting vector is regarded as an appearance representation profile and then directly used to determine the (binary) labels for the target image. Despite its simplicity and effectiveness, there is no evidence showing that such weights are domaininvariant, i.e., the optimized weights derived from the best image patch presentation may not be necessarily optimal for label fusion. Fig. 1 demonstrates the significant gap of representation profiles estimated in the image domain using appearance information (left) and in the label domain using label information (which is assumed to be known for the unseen target image). It is clear that there is no guarantee for the current state-of-the-art label fusion methods to achieve the optimal labeling results by directly applying the appearance-based representation profile for label fusion.\nTo address this issue, we propose a novel label propagation framework to progressively convert the representation profile from the image domain to the optimal weighting vector (for label fusion) in the label domain by constructing a set of intermediate dictionaries to bridge the image domain and the label domain. Such intermediate dictionaries provide a sequence of guidance to steer the estimation of the appearance representation profile to the optimal weighting vector for label fusion.\nSpecifically, in the training stage for each target image patch, the initial-layer dictionary consists of the original atlas image patches (in the image domain), similar to the most of traditional label fusion methods. Since each atlas image patch has its corresponding label patch, it is straightforward to build the label patch dictionary (in the label domain) by arranging the corresponding label patches with the same order as the original atlas image patches in the initial-layer dictionary. To remedy the large transitions from the image domain to the label domain, we first apply a label fusion technique (e.g., NPBL or SPBL) to obtain the representation profile for each atlas image patch in the initial-layer dictionary, while regarding all other instances in the initial-layer dictionary as the atlas image patches. Then, we compute a label probability patch by applying the obtained representation profile to the respective atlas label patches. By repeating the above leave-one-out label fusion procedure to all the patches in the initial-layer dictionary, we can construct the first-layer intermediate dictionary. Similarly, we can construct the subsequent intermediate dictionaries, as shown in Fig. 2 . In the end, we can construct a sequence of intermediate dictionaries, where the label probability patches become sharper and sharper, close to the binary shape of the corresponding atlas label patches.\nIn the testing stage, given the learned multi-layer dictionary at each target image location, the final weights for voting the label are also estimated in a progressive way. Specifically, starting from the initial layer, we gradually refine the label fusion weights by alternating the following two steps. First , we compute the representation profile of the target image patch by using the patch dictionary in the current layer. Second , we refine the label probability map within the target image patch by applying the latest representation profile to the binary atlas label patches, and then use the obtained new probability patch as the new target image in the next layer of the label estimation. In this way, we can obtain more and more accurate weights to determine the anatomical label for the original target image, with the guidance of the intermediate dictionary at each layer.\nThe contributions of our proposed method include: (1) since we harness the multi-layer dictionary to remedy the gap between patch appearances and anatomical labels, our label fusion essentially seeks the best label fusion weights, instead of just patchwise representation; (2) the sequence of built intermediate dictionaries allows us using not only appearance features but also structural context information ( Tu and Bai, 2010 ) to significantly improve the robustness in patch representation; (3) our proposed progressive patch representation by a multi-layer dictionary is general enough to be integrated with many conventional patch-based segmentation methods for improving their performances. Our proposed method has been evaluated in the segmentation of the hippocampus from elderly brain MR images in the ADNI dataset. More accurate segmentation results have been achieved, compared to the state-of-the-art methods, i.e., NPBL and SPBL. The remainder of the paper is organized as follows. In Section 2 , we present a short introduction of the existing hippocampus labeling methods in the literature, followed by a detailed description of our progressive multi-layer label fusion method. Section 3 shows the results of our proposed method in hippocampus segmentation. Then, in Section 4 , we give the discussion of the proposed method along with the future work. Finally, we conclude our work in Section 5 ."}, {"section_title": "Methods", "text": ""}, {"section_title": "Overview", "text": "In general, multi-atlas patch-based segmentation aims to determine the label of each point in the target image T by using a set of N registered atlas images I s and label images L s (s = 1 , . . . , N) . For each voxel v \u2208 T in the target image, P T ( v ) is the target patch centered at point v . The candidate atlas patches are recruited within a small neighborhood n v across all N registered atlas images. We assume there are K candidate atlas patches P s ( u ) centered at point u ( u \u2208 n v ) after patch pre-selection ( Coup\u00e9 et al., 2011 ) . Note that patch pre-selection is often used in a searching neighborhood to speed up the label fusion and also preclude the most dissimilar patches. Generally, patch pre-selection provides a balance between the segmentation accuracy and computational time. In our implementation, we follow the criteria of pre-selection in Coup\u00e9 et al. (2011) by computing the well-known structural similarity measure (SSIM) ( Wang et al., 2004 ) .\nThen, we vectorize each atlas patch\nSince each atlas patch has label information, it is straightforward to construct a corresponding label patch dictionary L =\nis a binary vector of {0, 1} M representing the particular label (with '0' denoting background and '1' denoting the hippocampus in this paper) which is associated with x s (u ) of atlas patch P s ( u ). So the latent label for point v can be estimated through the interaction between the target patch P T ( v ) and all candidate atlas patches P s ( u ). Given the weight \u03b1 s ( u, v ) for the pair of P T ( v ) and P s ( u ), the predicted label vector \u03d5 (v ) for the target point v can be estimated via\nwhere \u03d5 (v ) is a vector of label probability, with each element in \u03d5 (v ) associated with one point in the target patch P T ( v ). Then, it is straightforward to obtain hippocampus segmentation within the target patch P T ( v ) by binarizing the probability vector \u03d5 (v ) by a threshold of 0.5. In the following, we first introduce the calculation of weight \u03b1 s ( u, v ) by the conventional patch-wise labeling methods in Section 2.2 . Then, we present our multi-layer framework in Section 2.3 , including the construction of the multi-layer dictionary."}, {"section_title": "Conventional patch-based labeling", "text": "The principle of the conventional NPBL method is originated from the non-local strategy, which was widely used in computer vision, i.e., for image denoising ( Buades et al., 2005 ) and superresolution ( Protter et al., 2009 ) . The applications of NPBL in medical images can also be found in Awate and Whitaker (2006) and Manj\u00f3n et al. (2010) . In the NPBL method, each candidate atlas patch P s ( u ) contributes to the final label fusion. And the weight of each candidate patch is calculated by a patch-wise similarity between the target patch P T ( v ) and the candidate patch P s ( u ), defined as\nwhere \u03c3 controls the strength of exponential penalty on patchwise difference. In contrast to the NPBL method, the SPBL method assumes that the representation should be sparse, which means the optimal representation should use a smaller number of atlas patches. Given the patch dictionary X , sparse representation aims to find a sparse linear combination of patches in the dictionary X for the best representation of the target patch P T ( v ). For simplicity, we denote the target patch P T ( v ) by y and consider the weights associated with the patch dictionary X forming a weighting vector \u03b1. Thus, the estimation of weighting vector \u03b1 can be formulated as a problem of minimizing the reconstruction error in the following energy function:\nIn this objective function, the first term measures the reconstruction error, and the second term uses the l 1 -norm constraint on the weighting vector \u03b1. The regularization parameter \u03bb controls the strength of sparsity on \u03b1. "}, {"section_title": "Proposed method 2.3.1. Multi-layer labeling", "text": "The limitation of conventional multi-atlas patch-based segmentation methods is that they assume high correlation between original image patches and label patches . However, such an assumption may not be held in medical images which often have one-to-many mapping between appearance patches and label patches. To mitigate the inconsistency between the appearance patches (continuous) and the label patches (binary), we hypothesize a pathway of patch evolution that can smoothly transit from the image appearance to the corresponding labels. Our solution is to progressively construct a dynamic dictionary in a layer-by-layer manner, where a sequence of intermediate dictionaries can be constructed to gradually guide the transition from the appearance representation profile in the image domain to the optimal weighting vector (label fusion) in the label domain. As shown in both ends of Fig. 3 , a set of atlas appearance patches (in left end) and their associated label patches (in right end) are extracted to form the image and label dictionaries, respectively. The constructed intermediate patch dictionaries (displayed in the middle of Fig. 3 ) describe the transition path, in terms of (from fuzzy to sharp) label probability maps. In this way, we can formulate the single-layer estimation of the representation profile to the multi-layer optimization of the weighting vector (for label fusion) by progressively refining the weighting vector with the evolution of the intermediate dictionaries from the image appearance to binary labels. The construction of the multilayer dictionary and also the progressive label fusion are detailed below."}, {"section_title": "Multi-layer patch dictionary construction", "text": "In the training stage, to construct multi-layer patch dictionaries, we use the original intensity patch dictionary X to form the initial layer D (0) = X as shown in the bottom of Fig. 2 , i.e.,\nNote that we here use k to refer the k -th patch in the dictionary. From the first layer D (1) , we iteratively con-\nnating the following three steps.\n\u2022 First , starting from h = 1 , for each instance d\n, we use all the other instances d \n\u2022 Third , by repeating the above two steps for all instances d\nThe proposed procedure of progressively constructing multilayer dictionary D is briefly summarized in Algorithm 1 ."}, {"section_title": "Algorithm 1 Learning the intermediate dictionaries.", "text": "Input: Intensity atlas patch dictionary\n, patch number K, and layer number H."}, {"section_title": "End for", "text": "D (h ) = [ d (h ) k ] , and h = h + 1 . End While Output: The learned intermediate dictionaries { D (0) , \u00b7 \u00b7 \u00b7 , D (H\u22121) }."}, {"section_title": "Progressive label fusion via multi-layer dictionary", "text": "In the testing stage, given the multi-layer dictionary D , the weighting vector \u03b1 can be gradually refined from \u03b1 (0) at the initial layer (which is optimal only for the patch appearance representation) to \u03b1 (H\u22121) in the last layer (which is optimal for the label fusion). Hereafter, we call the weighting vector \u03b1 (0) as the appearance representation profile .\nIn the initial layer, we use the original intensity patch dictionary D (0) to present the target image patch y (0) = y located at v and thus obtain the representation profile \u03b1 (0) of the initial layer.\nConventional label fusion methods stop here and then vote for the label via the weights in \u03b1 (0) . Instead, our progressive label fusion method computes the label probability patch y (1) by letting\n. It is worth noting that the intensity target image vector y (0) now turns to a label-probability vector after going through the initial layer. Then, we iteratively refine the probability patch vector y (1) until it reaches the label dictionary. Specifically, we use y (1) as the new target patch and further represent it by the intermediate dictionary D (1) in the same layer, thus obtaining the new label probability patch y (2) . Next, we continue to represent y (2) in the second layer using the intermediate dictionary D (2) . By repeating the same procedure until reaching the last layer, the estimated probability patch y (h ) becomes sharper and sharper, as shown in Fig. 4 . Accordingly, the representation profile \u03b1 (H\u22121) can be regarded as the best weighting vector, which can be finally used to determine the latent label on the target image point v . The algorithm of the proposed multi-layer label fusion is summarized in Algorithm 2 ."}, {"section_title": "Experiments", "text": ""}, {"section_title": "Dataset", "text": "In our experiments, we randomly select 64 3T MRI and 240 1.5T MRI from the Alzheimer's Disease Neuroimaging Initiative (ADNI) Fig. 4 . The framework of the proposed method. Conventional methods estimate the patch representation profile using only the image dictionary (i.e., green dash box), and then directly apply it to the label dictionary (blue dash box) for label fusion. To address the large gap between these two different dictionaries (image and label), our method uses a set of intermediate dictionaries (red dash boxes) to gradually guide the estimation of the representation profile from the image domain to the label domain. In the application stage, we sequentially go through these intermediate dictionaries and obtain the final binary label. (For interpretation of the references to colour in this figure legend, the reader is referred to the web version of this article.)\nAlgorithm 2 Multi-layer label fusion."}, {"section_title": "Input:", "text": "The testing image, multi-layer dictionary D , and label dictionary L ."}, {"section_title": "End while End for", "text": "Binarize the probability map y (H) . Output: The segmentation result (binary label map) of the testing image. dataset ( www.adni-info.org ), which include three types of subjects, i.e., normal control (NC), MCI (Mild Cognitive Impairment) and Alzheimer's disease (AD). The image resolution is resampled to 1 \u00d7 1 \u00d7 1 mm 3 . The detailed subject information is shown in Table 1 .\nThe following three pre-processing steps were performed to all subject images. First, we removed the skull by a learning based meta-algorithm ( Shi et al., 2012 ) . Second, we used N4-based bias field correction ( Tustison et al., 2010 ) . Third, we applied intensity standardization to normalize the intensity range ( Madabhushi and Udupa, 2006 ) . Both left and right hippocampi have been manually labeled for each subject. In our experiments, we regard those manual segmentations as ground-truth. To label the target subject, we first aligned all the atlas images to the underlying target subject. In order to improve the computational efficiency, both atlas selection and patch selection strategies were applied, where the selection criterion was based on image intensity similarity.\nTo evaluate the performance, we use both the Dice ratio and sensitivity to calculate the accuracy and stability by comparing the automated segmentation results with the manual ground-truth. The Dice ratio is defined to measure the overlap between regions R 1 and R 2 via\nSensitivity is a statistical measure of the segmentation results, which is defined as\nwhere |.| denotes for the regional volume, and R 1 and R 2 represent the estimated and ground-truth labels, respectively. The mean absolute surface distance (MASD) is a symmetric border positioning measure that gives the mean minimal distance between two surfaces ( Sluimer et al., 2005 ) . Given the two surfaces S 1 (from the automated segmentation result) and S 2 (from the ground-truth segmentation), let d min (S 1 , S 2 ) be the average minimal distance from all points on surface S 1 to surface S 2 , and then MASD can be defined as\nIt should be mentioned that all testing images were evaluated in a leave-one-out manner. Specifically, in each leave-one-out case, we use FLIRT in the FSL toolbox ( Smith et al., 2004 ) with 12 \u00b0of freedom and the search range of \u00b120 in all directions, for the initial linear registration. For deformable registration, we use the diffeomorphic Demons method ( Vercauteren et al., 2009 ) with the smoothing kernel size of 2.0, and iteration numbers of 15, 10, and 5 in the low, middle, and high resolutions, respectively."}, {"section_title": "Parameters setting", "text": ""}, {"section_title": "Parameter selection", "text": "In the following experiments, we fix the patch size as 5 \u00d7 5 \u00d7 5 mm 3 and the search window as 5 \u00d7 5 \u00d7 5 mm 3 for constructing the dictionaries. In the non-local mean method, the penalty strength \u03c3 is set to 0.5, while, in the sparse patch-based label fusion method, the sparse constraint \u03bb is set to 0.1. In all experi- ments, we discard the searched candidate atlas patches if the preselection threshold on the SSIM measurement is less than 0.9."}, {"section_title": "The influence of atlas number", "text": "In order to test the effect of the atlas number, we evaluate the labeling accuracy on 64 3 T MRI by using a different number of atlases. For simplicity, we fix the number of the dictionary layer to 4. As shown in Fig. 5 , the average Dice ratio keeps increasing as the number of atlases increases. When the atlas number reaches beyond 15, the improvement of the Dice ratio becomes marginal. Considering the computational time, we thus use 15 atlases throughout all the following experiments."}, {"section_title": "The influence of the number of layer", "text": "In this experiment, we use the same dataset as in Section 3.2.2 to investigate the influence of the number of layers on the performance of our proposed method. The evolution curve of the average Dice ratio with respect to the number of dictionary layers is shown in Fig. 6 . It can be observed that the improvement of our progressive label fusion method is obvious after using the initial layer (corresponding to the baseline methods), i.e., more than 1% improvement of the Dice ratio over both the non-local and SPBL methods. Our progressive label fusion framework gradually converges after using three layers. Considering the computation time, we use four layers ( H = 4 ) in the following experiments."}, {"section_title": "Entropy of multi-layer dictionary", "text": "We use entropy as a measure of the quality for evaluating our constructed multi-layer dictionary. Note that label map with simple constant values has lower entropy, while the probability map with complex intensity values has higher entropy. Actually, minimum entropy has been used as a good criterion for the design of classification/segmentation methods ( Palubinskas et al., 1998; Viola and Wells III, 1997 ) . Fig. 7 is an example of the evolution of entropy in the multilayer dictionary. For a testing patch (i.e., a green solid block in the (top-left) original image) centered at a (red point) voxel, a set of similar patches (i.e., 24 patches used in this figure) are searched (i.e., in the blue dash box), along with their corresponding known label patches ((i.e., in the green dash box). By construction of a multi-layer patch dictionary as described in Section 2.3.2 , we can obtain the intermediate dictionaries (i.e., those in the red dash box). The tables in the right panel of this figure provide the corresponding entropies for the patches in the blue, red, and green dash boxes.\nEach element in the right tables of Fig. 7 shows the entropy of the corresponding patch in the multi-layer dictionary (i.e., blue and red dash boxes) as well as in the ground-truth label patches (i.e., green dash box). Consistent with our above description, the label patches have lower entropy (as shown at the bottom of the right figure) . On the contrary, the intensity image patches have higher entropy (as shown at the top of the right figure) , because of their relatively uniform intensity distribution. The right tables also show the entropy of the patch element in each layer of the multi-layer dictionary (i.e., layer 0 to layer 3, as shown from the middle top to middle bottom of the right figure). Since entropy is related to the minimum number of bits required to code the intensity distribution, the predictability is closely related to the value of entropy ( Mangin, 20 0 0 ) . That is, a predictable variable has low entropy, while an unpredictable variable has high entropy. As shown in Fig. 7 , from layer 0 to layer 3, the entropy is decreased for most patches, thus, becoming easier to predict. As a result, with the increase of the number of layers, the intermediate dictionary becomes sharper and sharper, which finally becomes closer to the binary label maps. Tables 2 and 3 show the mean and standard deviation of the Dice ratio on the hippocampus (left, right and overall) in linear and deformable registration scenarios, respectively. Compared to the baseline non-local and SPBL methods with single-layer dictionary, our progressive label fusion framework can improve the labeling accuracy with more than 1% increase of the Dice ratio. The maximum improvement is 1.8% between the conventional non-local method and our progressive non-local method in the case of linear image registration. Also, the improvements over the baseline methods in terms of the overall Dice ratio are statistically signifi- "}, {"section_title": "Labeling results for 3T MR images", "text": ""}, {"section_title": "Table 4", "text": "The surface distance (unit: mm) on hippocampus labeling between automatic segmentations and manual ground-truth segmentations with different number of intermediate layers. cant with a p -value less than 0.05 by using paired t -test. Significant improvements are indicated with ' * in Tables 2 and 3 . Furthermore, we calculate the surface distance between the ground-truth hippocampus and the estimated hippocampus (left and right). The SPBL method is used as the example to demonstrate the evolution of the surface distance during the progressive label fusion in Fig. 8 . According to the color bar shown in the right side of Fig. 8 , the surface distances keep decreasing with the increase of the number of intermediate layers. Table 4 shows the corresponding surface distances on the whole hippocampus in Fig. 8 . In accordance with Fig. 8 , by increasing the number of intermediate layers, the mean surface distance decreases gradually. When H = 1 , which corresponds to the conventional one-layer SPBL method, the maximum distance is 2.83 mm, and it significantly decreases to 1.22 mm at H = 4 by our method."}, {"section_title": "Number of layers", "text": "H = 1 H = 2 H = 3 H = 4"}, {"section_title": "Labeling results for 1.5T MR images", "text": "We have also applied our multi-layer method on the 240 1.5T MRI dataset. Specifically, we test three datasets, including normal control (NC), mild cognitive impairment (MCI) and Alzheimers disease (AD), and each dataset has 80 cases as shown in Table 1 . For further evaluation, we compute the mean and standard deviation of the hippocampus volumes of the manual ground truths for each dataset in Table 5 . The table shows significant volume differences among the three datasets. Specifically, compared to the NC data, the volumes of AD and MCI are smaller; in particular, AD has much smaller volume than NC, and also AD has the largest volume variation.\nMoreover, the evaluation measures (i.e., Dice ratio, sensitivity and MASD) are obtained using different combined strategies (i.e., non-local and SPBL under linear or deformable registration) on the 1.5T MRI dataset (for AD, MCI and NC), as summarized in Fig. 9 , Fig. 10 and Fig. 11 , respectively. Obviously, our progressive meth- ods consistently outperform all other methods in all these three evaluation measures, regardless of AD, MCI or NC (with larger improvement for the NC subjects). The best result is achieved for our progressive SPBL method in the case of using deformable registration. As shown in Fig. 9 , compared to the baseline methods, our progressive label fusion methods can improve the labeling accuracy for more than 1% Dice ratio, in the cases of both linear and deformable registrations. According to Fig. 11 , the mean surface distance is also getting smaller. In order to further testify the effectiveness of our proposed method, we also conduct experiments on the mixed datasets of NC, MCI and AD. Table 6 shows the average Dice ratios by the Table 6 The mean and standard deviation of Dice ratio (in %) in labeling 1.5T-MRI hippocampi."}, {"section_title": "Method", "text": "Linear Deformable\nConventional non-local 81 .8 \u00b1 3.3 83 .4 \u00b1 2.6 Progressive non-local 83 .1 \u00b1 3.1 84 .9 \u00b1 2.5 Conventional SPBL 81 .9 \u00b1 3.2 83 .7 \u00b1 2.6 Progressive SPBL 83 .3 \u00b1 3.0 85 .1 \u00b1 2.5 four methods in both linear and deformable registration cases. Obviously, our progressive methods consistently outperform the conventional methods. Specifically, compared to the conventional nonlocal method, our progressive method gains improvements of 1.3% and 1.5% for the linear and deformable registration cases, respectively."}, {"section_title": "Computational complexity", "text": "As illustrated in Algorithms 1 and 2 , our proposed multi-layer label fusion method takes major computational cost in two stages, including (1) dictionary learning and (2) progressive multi-layer label fusion. By analyzing the proposed method, we found three major factors determine the computational cost in including two stages, including the number of layers H , the number of atlas patches K , and the size of each patch M .\nBased on these factors, the computational complexities of the dictionary learning and the multi-layer label fusion stages are O ( HK 2 M ) and O ( HM ), respectively. Therefore, it costs O ( HK 2 M ) for each voxel. Considering the computational time, we have used various strategies to speed up our algorithm, including parallel programming and patch pre-selection."}, {"section_title": "Discussion", "text": ""}, {"section_title": "Application to volumetric labeling", "text": "Algorithms for automatic segmentation of brain structures are important for brain analysis. Hippocampal volume has been found as an early biomarker for AD, but it is hindered by various limitations of manual segmentation. Although many methods have been proposed for hippocampal segmentation in MR images, they often directly determine the label according to the weights computed from the appearance representation of the testing image. However, the intensity images and label maps are in two different domains, and there is no evidence to show a direct connection between intensity images and label maps. Thus, in Fig. 2 , we construct a bridge to connect these two domains. As shown in Fig. 3 , with the help of this built \"bridge\" (multi-layer dictionary), the probability patches can become sharper and sharper, and thus the intensity image domain and the label domain can be better connected. In this way, the representation coefficients can be iteratively computed from the built dictionaries, and then the latent label can be predicted by applying the estimated coefficients to the atlas labels in a layer-by-layer manner. The proposed method shows its potential in volumetrical labeling. The optimized dictionary also makes our labeling method more robust to registration errors."}, {"section_title": "Segmentation quality", "text": "The results presented in this work demonstrate that our proposed multi-layer label fusion method is well-suited for automated hippocampus segmentation. First, we have tested the influences of both the atlas and layer number. In Fig. 5 , we found that further increasing the number of training images will not improve the performance significantly. Considering the computational cost, we select 15 as the atlas number in all experiments of this paper. Also, the multi-layer dictionary learning makes the probability maps much closer to the label maps. Thus, it is also important to choose a suitable layer number. Similar to the atlas number, the use of more layers can lead to better results. As shown in Fig. 6 , the use of 4 layers produces the best results for all experiments, and thus we use 4 layers in this paper. To further validate the effectiveness of the multi-layer dictionary learning, we analyze each built dictionary quantitatively by entropy. It is found that entropy is decreased with the increase of the number of layers, which further demonstrates the significance of our multi-layer dictionary learning.\nAs pointed out in Tables 2 and 3 , using the 3T MRI, the Dice ratio can exceed 0.85, showing good overlap with manual segmentations. Also, the surface of automated segmentation is very close to the surface of ground-truth segmentation. Besides, with the 1.5 T MRI, our proposed progressive methods also outperform all 1-layer methods, in terms of Dice ratio, sensitivity, and MASD."}, {"section_title": "Comparison to other methods", "text": "In our method, we have applied either the NPBL or SPBL as a basic label fusion algorithm to obtain the representation profile at each layer. Compared to the original (single-layer) NPBL and SPBL methods, our proposed method is consistently better, with statistically significant improvements on both the Dice ratio and surface distance. The direct visual comparison on the large image dataset also shows better results with our method, compared to the two baseline methods.\nThe performance of our progressive multi-layer label fusion scheme is further compared with the performances of other two single-layer algorithms (i.e., non-local and SPBL) on both the 3 T and 1.5T MRI scans. For both cases of linear and deformable registrations, our method outperforms these baseline methods in hippocampal segmentation. On the other hand, the use of deformable registration often gives better results than the use of linear registration, for all methods (including our method and conventional methods)."}, {"section_title": "Limitation and future work", "text": "The main limitation of our proposed method is the time complexity, for the case of using a large number of layers or a large number of selected atlases. In such case, for each testing patch centered at each voxel, a set of patches needs to be selected to estimate the testing patch in a leave-one-out manner, for creating a multi-layer dictionary. Since this procedure needs to be online, it further increases the computational time for our proposed method.\nIn this paper, we just focus on segmentation of the hippocampus. With the shown benefit of using a multi-layer dictionary for image labeling, it will be interesting to also apply our method on the segmentation of other organs in the future."}, {"section_title": "Conclusion", "text": "In this paper, we proposed a progressive label fusion framework for multi-atlas segmentation by dictionary evolution. Different from the conventional label fusion methods, in our proposed method, we constructed a sequence of intermediate dictionaries in a multi-layer manner to progressively optimize the weights for label fusion. In this way, our proposed method seeks for the representation weights that can be progressively improved for final label fusion, instead of employing only the original intensity patches based representation weights, which are used in the conventional methods. To this regard, our proposed multi-layer method can also be considered as an extension of the conventional single-layer methods. We have applied our novel label fusion method to hippocampus segmentation in both 1.5T and 3T MRI brain images from the ADNI dataset. Compared to the state-of-theart counterpart label fusion methods with a single-layer dictionary, our proposed multi-layer label fusion method achieves better performances."}]