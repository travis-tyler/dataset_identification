[{"section_title": "Abstract", "text": "Local variation in cortical connectivity profiles is typically modeled as having a coarse spatial scale that can be parcellated into cortical systems of large, interconnected brain areas. We created a common model of the human connectome using a new algorithm -\"connectivity hyperalignment\" -that discovers shared basis functions for connectivity topographies. Transforming individual connectivity data into the common model connectome dramatically increases intersubject correlation of connectivity profiles.\nMore importantly, the common model connectome captures shared fine-scale spatial variation in connectivity profiles that is obscured by other methods of aggregating multisubject data into a common space. We found similar results using fMRI data obtained in the resting state and while subjects watched a movie. Fine-scale variations in connectivity profiles are closely related to fine-scale distinctions in representations of information. These results reveal the existence of a shared fine-scale structure in the human connectome that was not incorporated in previous models. Common model of the human connectome Guntupalli 3"}, {"section_title": "Introduction", "text": "Functional magnetic resonance imaging (fMRI) data collected while subjects are at rest reveals patterns of functional connectivity that are used to investigate the human connectome and parcellate the brain into interconnected areas that form brain systems and can be modeled as networks (Biswal, Yetkin, Haughton, & Hyde, 1995; Glasser et al., 2016; Gordon et al., 2016; Laumann et al., 2015; Smith, Vidaurre, et al., 2013; Sporns, Chialvo, Kaiser, & Hilgetag, 2004; Thomas Yeo et al., 2011; Wig et al., 2014) .\nAggregating individual data into a general model is typically accomplished by aligning brains based on anatomical features. Individual variations from the general model are described at the level of areal organization and characterized in terms of the absence or anomalous locations of functional areas (Gordon, Laumann, Adeyemo, & Petersen, 2015; Laumann et al., 2015) . The connectivity of a single area is modeled as a mean connectivity profile and considered to be relatively homogeneous (Cohen et al., 2008) .\nCortical topography has both a coarse scale of cortical areas and a finer scale of multiplexed topographies within areas (Grill-Spector & Weiner, 2014; Guntupalli, Hanke, et al., 2016; Haxby et al., 2001 Haxby et al., , 2011 . Fine-scale within-area topographies are reflected in patterns of activity that can be measured with fMRI and decoded using multivariate pattern analysis (MVPA) (Haxby et al., 2001; Haxby, Connolly, & Guntupalli, 2014; Norman, Polyn, Detre, & Haxby, 2006) . For example, patterns of activity in primary visual cortex distinguish responses to natural image stimuli that reflect local receptive fields for Gabor filters of different orientations and spatial frequencies (Kay, Naselaris, Prenger, & Gallant, 2008) . Patterns of activity in the fusiform face area (FFA) (Kanwisher, McDermott, & Chun, 1997 ) distinguish responses to different head angles, face identities, animal species, and small objects (Guntupalli, Wheeler, & Gobbini, 2016; Haxby et al., 2001 Haxby et al., , 2011 , but the stimulus feature spaces that determine these patterns is not well understood. These fine-scale patterns of activity are not well-aligned across brains based on anatomical landmarks. Consequently, averaging responses across brains blurs these patterns, making them less distinctive (Haxby et al., 2011) . We have developed an algorithm, response hyperalignment (RHA) (Guntupalli, Hanke, et al., 2016; Haxby et al., 2011) , that models variations in response tunings with a large set of basis functions that are shared across brains. Using RHA to transform individual cortical representational spaces into a high-dimensional common model representational space aligns the fine-scale structure of within-area functional topographies. We ask here whether local variation in functional connectivity also has a fine-scale structure, similar to the fine-scale spatial structure of response tuning profiles, and whether such variation can be captured in a common model with basis functions that are shared across brains.\nWe developed a new algorithm, connectivity hyperalignment (CHA), to discover basis functions that are shared across brains and model variation in connectivity profiles. We show that CHA can derive these shared basis functions based on functional connectivities derived from neural activity during the resting state and during a task, namely watching and listening to movie. Transformation of individual connectomes into the resultant common model of the human connectome greatly increases intersubject correlation of local connectivity profiles. Moreover, the common model connectome also captures a fine spatial scale in local variation of connectivity profiles with a granularity equivalent to what we observe in individual connectomes.\nAlthough this fine-scale local variability in connectivity profiles can be observed and modeled in individual data (Haak, Marquand, & Beckmann, 2016; Jbabdi, Sotiropoulos, & Behrens, 2013) , its existence was not incorporated into models of the connectome because it is obscured when connectomes are averaged across brains after anatomical alignment. We show further that this local variability in functional connectivity profiles is meaningful in that it is closely related to local patterns of responses during movie viewing that encode fine-scale distinctions among representations. Our results indicate that this shared fine-scale local variation accounts for a large portion of variance in connectivity profiles and is, therefore, a dominant component that was previously overlooked in models of the human connectome. (a) Connectivity can be defined as any measure of similarity between a cortical locus (eg. voxel) and target region. Connectivities of loci in a region of interest or a searchlight to a target region is associated with a connectivity pattern in that region of interest or a searchlight for that target. These patterns can be thought of as connectivity vectors in a space in which each cortical locus in that region is a dimension. (b) Connectivity vectors in a region of interest or a searchlight to be hyperaligned are calculated for target regions distributed uniformly across the whole cortex. Connectivity hyperalignment rotates individual subject connectivity spaces to align these vectors across subjects. (c) Whole cortex connectivity hyperalignment extends connectivity hyperalignment to the whole cortex by performing connectivity hyperalignment in searchlights uniformly covering the cortex. Local transformations derived in each searchlight are aggregated by summation into a single transformation matrix that aligns data from the whole cortex into the common space and affords projection of vectors in common space back into individual cortical patterns by multiplication with the transpose of the transformation matrix."}, {"section_title": "Results", "text": "We derived a common model of the human connectome by applying whole cortex connectivity hyperalignment (CHA; Fig. 1 ) to two different fMRI datasets: 1) data collected for the HCP during task-free resting state and a battery of tasks (Barch et al., 2013; Smith, Beckmann, et al., 2013; and 2) data collected while subjects watched a full-length audio-visual feature film -\"Raider of the Lost Ark\" (Guntupalli, Hanke, et al., 2016; Haxby et al., 2011) . We validated the common model in terms of 1) inter-subject correlation (ISC) of connectivity profiles, 2) spatial specificity of shared connectivity profiles. The results show that the common model connectivity captures shared fine-scale structure. To test whether this fine-scale structure is meaningful for the representation of information, we tested 3) ISC of task maps in the HCP data, 4) ISC of representational geometry in the movie data, and 5) betweensubject multivariate pattern classification (bsMVPC) of responses to the movie."}, {"section_title": "Inter-subject correlation of connectivity profiles", "text": "Resting state data. CHA based on resting state connectivity profiles greatly increased ISC of resting state connectivity profiles in independent resting state data. The connectivity profile of a feature is measured as the correlations of its time-series with the average time-series in a set of target searchlights that covered the whole cortex ( Fig. 1a ). The centers of these target searchlights were identical to those used for CHA. Figure 2a shows a cortical map of mean ISCs of connectivity profiles in MSMAll-aligned data and in the common model connectome space, as well as within-subject betweensession correlations of connectivity profiles. ISC is measured as the correlation of the connectivity profile for a given cortical location in each subject with the mean of other subjects' profiles. Within-subject correlations are computed between connectivity profiles for different resting state sessions. We quantify the increases in 26 functional ROIs, identified using a meta-analytic database, NeuroSynth (Yarkoni, Poldrack, Nichols, Essen, & Wager, 2011) (Fig. 2b ; Supplementary Table 1 ). CHA increased mean ISC of connectivity profiles across these ROIs, relative to anatomical alignment, from 0.56 to 0.72 (95% confidence interval, CI, for mean difference = [0.14, 0.17]). Note that data alignment before CHA of the HCP dataset uses the MSM-All (Multimodal Figure 2. ISC of connectivity profiles calculated from HCP rsfMRI data. (a) Average ISC of connectivity profiles in each surface node after surface alignment (MSM-All) and in the common model connectome space, and within-subject between-session correlation in common space. (b) ISC of connectivity profiles averaged within ROIs covering visual, auditory, cognitive, and social systems across the cortex and their mean comparing the common model connectome space, within-subject betweensession correlation in common space, and surface alignment. Bootstrapped testing showed significantly higher within-subject correlations and ISCs in the common model connectome space relative to anatomical alignment in all ROIs, and significantly higher ISCs in the common model connectome space than within-subject correlations in some ROIs (\"+\": ISC after CHA>within-subject between-session correlation).\nSurface Matching using individual cortical folding, myelin map, and rsfMRI correlation data) method which aligns subjects' data using both functional and structural properties (Robinson et al., 2014) . Furthermore, ISCs of resting state connectivity profiles in the common model connectome space are slightly, but significantly, higher than withinsubject correlations of resting state connectivity profiles (mean correlation = 0.68; CI for difference = [0.01, 0.06]) ( Fig. 2b ). This latter result indicates that after transformation into the common model space, an individual's connectome is better predicted by other subjects' connectomes (N=19) than by estimates based on that subject's own rsfMRI data, due to the benefit of aggregating data across a large sample of brains.\nMovie data. CHA increased the ISC of connectivity profiles for each feature in the movie data as well. Figure 3a shows the mean ISCs of the connectivity profiles mapped onto cortical surface after anatomical alignment and CHA (see Supplementary Fig. 1 for control analysis). Figure 3b "}, {"section_title": "Local spatial granularity of the common model connectome", "text": "Resting state data. We investigated the spatial specificity of the common model connectome derived from rsfMRI data by computing spatial point spread functions (PSFs) of ISCs of connectivity profiles (Guntupalli, Hanke, et al., 2016) . PSF of connectivity profiles was computed as the correlation of connectivity profile in a cortical surface node with the average connectivity profile of nodes at cortical distances ranging from 0 to 12 mm in other subjects' data. We similarly calculated within-subject PSFs between two resting state sessions. Figure 4 shows the slopes of connectivity profile PSFs in the ROIs (Fig. 4a ) and the mean PSF across ROIs (Fig. 4b ) in MSMAll-aligned data, in the common model connectome space, and within-subject. CHA increased the average slope of PSF across these ROIs, relative to anatomical alignment, from 0.015 to 0.066 (difference=0.051 [0.046, 0.054]). The PSF slopes in the common model as correlation between the connectivity profile for a cortical locus in one subject and the profiles of its spatial neighbors in other subjects at increasing distances from that locus (ISCs). For the HCP rsfMRI data, within-subject PSFs are computed as the correlation between the connectivity profile for a cortical locus from one rsfMRI session and the profiles of its spatial neighbors from a different rsfMRI session. Slope is estimated using a linear fit of these correlations at different distances as a function of distance in each of the ROIs (Left). Average PSF across all ROIs is plotted on the right. (a) shows PSF and slopes for HCP rsfMRI data and (b) shows the same for the movie data."}, {"section_title": "Figure 5. ISC of HCP task activation and contrast maps.", "text": "Connectivity hyperalignment parameters derived from a session of resting state data were applied to the task maps and the correlation of these maps is computed between each subject and the average of others before and after hyperalignment. Hyperalignment improved correlations on average across all tasks and in all but two (labeled ns) individual task maps. connectivity profiles for neighboring cortical nodes across subjects that are not captured after the MSM-All alignment provided by the HCP.\nMovie data. Figure 4c shows the slopes of connectivity profile PSFs for the movie data in the ROIs, and Fig. 4d shows the mean PSF across ROIs. ISCs of connectivity profiles decrease as the cortical distance between features increases. Inter-subject cortical PSF slopes are much steeper in the common model connectome space, relative to anatomical alignment. Mean of connectivity profile PSF slopes was 0.077 in the common model connectome space and 0.035 after anatomical alignment (difference = 0.042 [0.039, 0.044]). See Supplementary Fig. 2 for comparison with RHA."}, {"section_title": "Inter-subject correlation of task activations", "text": "CHA based on resting state connectivity profiles increased ISC of task activation and contrast maps (Barch et al., 2013) . Figure 5 shows the average correlation between each subject's task map and the average task map of all other subjects. This was done for each of the 46 task maps independently. ISC of all but two (Face-Shapes and Body-Average) task maps were higher after CHA, and the average correlation across task maps increased from 0.58 to 0.65 (mean difference = 0.07 [0.06, 0.08]). Figure 6 shows the mean correlations of local representational geometry in each subject with the mean of other subjects' geometry after anatomical alignment and CHA. Representational geometry is indexed as the similarity of patterns of response to different time-points in the movie. CHA increased the ISC of representational geometry in all of the ROIs (ROI mean ISC=0.291) relative to anatomical alignment (ISC=0.173) (difference=0.118 [0.103, 0.129]) ( Fig. 6b ). See Supplementary Fig. 3 for comparison with RHA. Figure 7 . Between-subject multivariate pattern classification of movie segments. Classification of 15 s movie segments was performed within each movie half separately and the accuracies are then averaged across the two halves. Parameters for hyperalignment and SVD are derived from the half that was not used for classification. (a) Classification accuracies in each searchlight after anatomical alignment and in the common model connectome space. (b) Classification accuracies in 24 ROIs covering visual, auditory, cognitive, and social systems across the cortex and their mean after anatomical alignment and in the common model connectome space. Bootstrapped testing showed significantly higher accuracies in the common model connectome space to anatomical alignment in all ROIs. (c) Classification accuracies using information from multiple systems across the whole cortex. Dimensionality of the data is reduced using SVD and classification is performed with different set sizes of top singular vectors. Peak accuracy is reached after 200 dimensions in the common model connectome and at 50 dimensions for anatomically aligned data."}, {"section_title": "Intersubject correlation of representational geometry", "text": ""}, {"section_title": "Between-subject multivariate pattern classification of movie segments", "text": "Successful bsMVPC of movie segments reflects the degree to which patterns of activity representing the content of the movie stimulus are aligned across subjects. Figure 7a shows the mean classification accuracies in searchlights distributed across the whole cortex mapped to their centers. CHA greatly increased bsMVPC accuracies.\nAccuracies in the 24 ROIs (Fig. 7b ), were nearly six times higher after CHA than after anatomical alignment (mean accuracies across ROIs were 9.93% and 1.73%, respectively). Classifying movie segments using the information distributed across the whole cortex also reflected a similar trend ( Fig. 7c ). Peak accuracy after CHA is 89.61% with more than 200 dimensions, whereas the peak accuracy with anatomical alignment is 74.85% with 50 dimensions (mean difference between CHA and anatomical alignment = 14.76% [12.17%, 17.12%]). See Supplementary Fig. 4 for comparison with RHA."}, {"section_title": "Discussion", "text": "We developed and present here a computational model of the human connectome that mm, corresponding to a smoothness of three or more voxels. This local fine-scale variation was not incorporated into previous models of the connectome because its common structure across brains was obscured in anatomically-aligned and MSMAllaligned data.\nThe common model connectome accounts for a large share of the variance of connectivity profiles across cortex, approximately 80% more than is accounted for by MSMAll-alignment of HCP data and 77% more than is accounted for by anatomicalalignment of movie data. In the HCP rsfMRI data, the common model connectome is a better predictor of an individual brain's connectome than is an independent rsfMRI data session from the same subject, due to the benefit of aggregating data over a large number of brains at the precision afforded by CHA. The results indicate that this added shared variance in the model is meaningful, affording substantially higher ISCs of representational geometry and dramatically higher bsMVPC for movie time segments.\nThe results also found significantly higher ISCs of task maps and contrasts in the HCP data, even though these maps reflect coarse functional distinctions with functional topographies that are less dependent on fine-scale local variations.\nResting state fMRI connectivity is used to map the brain as a network of interconnected areas that form multi-area systems (Glasser et al., 2016; Gordon et al., 2016; Laumann et al., 2015; Smith, Vidaurre, et al., 2013; Sporns et al., 2004; Thomas Yeo et al., 2011; Wig et al., 2014) . Homogeneous connectivity profiles within areas and sharp changes in connectivity profiles are used to define functional areas and their boundaries (Gordon et al., 2016; Wig et al., 2014) . The existence of meaningful finescale local variation within areas is not inconsistent with such parcellation of cortex into areas. In fact, aligning cortical functional topography with CHA may sharpen the changes at borders, affording more precise delineation of their locations. Shared finescale variation within areas may reveal finer parcellations or how within-area functional topographies, such as retinotopy and orientation selectivity, are recapitulated and transformed from one area to another.\nCHA aligns local high-dimensional connectivity spaces across subjects. Whole cortex CHA produces a common model of functional connectivity for all of cortex using a searchlight approach that we used previously for RHA (Guntupalli, Hanke, et al., 2016) .\nCHA, in contrast to RHA, does not rely on synchronized stimulation across subjects, as it finds basis functions for shared patterns of within-brain correlations of response profiles (connectivity profiles), rather than for synchronous response profiles.\nConsequently, CHA can be applied to fMRI data that are not synchronized across subjects. We show that CHA can derive valid common model connectomes based on rsfMRI data with asynchronous response profiles as well as on movie fMRI data with synchronous responses. We defined the connectivity profile of a cortical locus as its functional connectivity to a set of target regions distributed across the cortex. We index functional connectivity of a cortical locus as the correlation of its time-series with the time-series of the connectivity target regions. These target regions can be individual voxels or parcels covering the cortex. Our implementation of CHA here uses a set of searchlights that uniformly cover the cortex as target regions, but the algorithm can be applied to any other choice of targets and to other connectivity measures, including diffusion weighted imaging (DWI). To capture multivariate information within a target region, we used responses of the top three principal components instead of mean response in each region as our target.\nCHA analyzes connectivity profiles in a searchlight or ROI as a set of vectors in which each cortical locus is a dimension and the connectivities of all ROI loci with each target is a vector in a connectivity space. These vectors reflect the \"geometry\" of functional connectivity for that ROI and are the basis for its hyperalignment. By defining the targets as sizeable regions or parcels, we can assume a coarse correspondence of targets across subjects. CHA aligns connectivity spaces across subjects by aligning these connectivity vectors across subjects with a high-dimensional transformation that is specific to each individual. This is analogous to how RHA aligns representational spaces across subjects by aligning response vectors during synchronized stimulation (Guntupalli, Wheeler, et al., 2016; Haxby et al., 2011) . Synchronized stimulation allowed us to assume correspondence of responses at each time-point across subjects, and similarly, the top PCs for sizeable target regions, which are aligned to have similar connectivities with other target regions, allows us to assume correspondence of connectivity vectors for each target PC across subjects.\nSuccessful alignment of fine-scale patterns of neural activity using CHA, as shown by increased ISCs of representational geometry and bsMVPC of movie time segments, suggests that the response tuning function of a cortical locus is closely related to its connectivity profile to the rest of the cortex. Although we predicted this relationship, it was not clear that it need exist. It was possible that different cortical loci in a given brain area have different response tuning functions but communicate with the same constellation of areas in other parts of the brain (Saygin et al., 2012 (Saygin et al., , 2016 . In other words, the connectivity of cortical loci within an area could be driven by the portion of response tuning variance that is shared across those loci, yielding a homogeneous connectivity profile, or by the portion of response tuning variance that varies across loci, yielding fine-scale local variation in connectivity profiles. Our results show the fine-scale local variation in response tunings is strongly associated with fine-scale local variation in connectivity profiles.\nRecent studies have explored another avenue to extract more information from connectivity in the temporal domain. Most studies, including this one, use a single consensus connectivity computed across the whole session of an experiment or resting state. But connectivity between regions varies across time and tasks (Allen et al., 2014; Geerligs, Rubinov, Cam-CAN, & Henson, 2015; Hutchison et al., 2013; Shine et al., 2016) . CHA could be extended to multiple connectomes extracted from different tasks or states in the same subject. Using connectivity vectors from a set of brain states to derive hyperalignment, rather than assuming a single stationary brain state, could potentially improve the generalization of alignment to other experiments.\nUsing connectivity profiles for hyperalignment offers important practical advantages.\nSince connectivity is computed within subject, synchronized responses to the same stimuli are no longer required for hyperalignment. Consequently, connectivity hyperalignment can be based on data from experiments probing planning and decision making tasks, which might unfold at different speeds across subjects, more free-form tasks such as social interactions, and data from task-free resting state sessions.\nResting state data in particular are simple to acquire, already ubiquitous and acquired routinely by many labs for participants in varied experiments, and can be acquired in patient populations in which demanding tasks may affect compliance. Many large shared datasets acquired on normal subjects, such as the HCP and ADHD-200 (\"The ADHD-200 Consortium,\" 2012), and on patient populations (ADHD-200, ADNI-GO (Jack Jr. et al., 2010) , UCLA Neuropsychiatric Phenomics ) already contain resting state data.\nAcquisition of resting state data is now widespread in fMRI research, but such data may not be optimal for building a common model of high-dimensional representational spaces. rsfMRI datasets typically are limited in size -usually five to ten, at most twenty, minutes -and more data afford better estimates of the large number of parameters in transformation matrices for increased general validity (Guntupalli, Hanke, et al., 2016) . Furthermore, a recent study has suggested that connectivity profiles during movie viewing, as compared to connectivity profiles during the resting state, may be more reliable across sessions and may enhance measures of individual differences in a normal population (Vanderwal et al., 2016) . Further work will be necessary to quantify the precision and general validity afforded by different sizes and types of fMRI datasets for building a common model connectome using hyperalignment.\nIn summary, we present here a common model of the human connectome that captures the local fine-scale structure of functional connectivity in shared basis functions. The model is derived with a new hyperalignment algorithm, CHA, that enables application of hyperalignment to a greatly expanded array of experimental data.\nThe common model connectome captures the functional architecture of human cortex at a fine spatial scale. Application of CHA to resting state rsfMRI data afforded the discovery of a shared fine-scale spatial granularity in local variation of connectivity profiles that was previously unrecognized. Capturing this fine-scale structure in the common model connectome can afford better models of the areal structure of cortical topography and study of how within-area topographies are recapitulated and transformed between areas. CHA can be used to project data from large public databases, such as the HCP, into a common model space to align functional connectivities and functional topographies at a fine spatial scale and, thereby, increase the power of these databases for investigation of neural representation, connectivity, individual differences, and parcellation of cortex into functional areas."}, {"section_title": "Materials and Methods", "text": ""}, {"section_title": "Resting state data: Human Connectome Project", "text": "In the HCP database (Van Essen et al., 2013) , we found unrelated subjects of age <= 35 with at least four resting state scans, yielding a list of 64 subjects. We chose the first 20 of these subjects in the sorted order of subject IDs for our analysis.\nFor each subject, we used their cortical surfaces and fMRI data aligned to the group using MSMAll (Robinson et al., 2014) with 32K nodes in each hemisphere as provided by the HCP. We used data from one resting state session (Smith, Beckmann, et al., 2013) (\"rfMRI_REST1_LR\") to derive CHA parameters and validated it on a different resting state session (\"rfMRI_REST2_LR\"), and task fMRI sessions (Barch et al., 2013) (EMOTION, GAMBLING, LANGUAGE, MOTOR, RELATIONAL, SOCIAL, and WM).\nResting state data were acquired for 1200 TRs with a TR of 0.720s in each session (total time=14 min 33 s). The data used to derive the CHA parameters and common model and the resting state data used for validation tests used the same phaseencoding direction (LR). We used a single session of rsfMRI for alignment to mimic a typical resting state data acquisition which usually varies from 10-20 mins of scanning.\nSee Smith et al. (2013) for more details about the acquisition and preprocessing pipelines.\nWe masked the data to include only the left and right cortices (Cortex_Left and Cortex_Right), removing all the non-zero nodes that correspond to the medial subcortical regions, resulting in 59,412 nodes across both hemispheres. We generated a coarser surface grid to match the ico8 surface in SUMA (Saad, Reynolds, Argall, Japee, & Cox, 2004) with 1284 nodes (10.7 mm spacing between nodes). We found the closest matching nodes on the 32K surface to the nodes on the ico8 surface, and used those as our searchlight centers for connectivity target searchlights. For validation of task fMRI, we used all of the maps provided by the HCP after removing redundancies (such as FACE-AVG and AVG-FACE), which resulted in 46 maps."}, {"section_title": "Movie data: Raiders of the Lost Ark", "text": "We scanned 11 healthy young right-handed participants (4 females; Mean age: 24.6+/-3.7 years) with no history of neurological or psychiatric illness during movie viewing. All had normal or corrected-to-normal vision. Informed consent was collected in accordance with the procedures set by the local Committee for the Protection of Human Subjects. Subjects were paid for their participation. fMRI data preprocessing fMRI data were preprocessed using AFNI software (Cox, 1996) (http://afni.nimh.nih.gov). Functional data were first corrected for the order of slice acquisition and head motion by aligning to the last volume of the last functional run. Any spikes in the data were removed using 3dDespike in AFNI. Data were then filtered using 3dBandpass in AFNI to remove any temporal signal variation slower than 0.00667 Hz, faster than 0.1 Hz, and that correlated with the whole brain average signal or the head movement parameters. Each subject's anatomical volume was first aligned to the motion corrected average EPI volume and then to the MNI 152 brain template in AFNI."}, {"section_title": "Stimuli and design", "text": "Functional EPI BOLD data were then aligned to the MNI 152 brain template using nearest neighbor resampling by applying the transformation derived from the alignment of the anatomical volume to the template. Functional data were spatially smoothed with a 4 mm full-width at half-max Gaussian filter (see Guntupalli et al. (2016) for the details of how smoothing affects hyperalignment and subsequent validations). Data acquired during the overlapping movie segments were discarded resulting in a total of 2662 TRs with 1326 TRs in the first session and 1336 TRs in the second session. We derived a gray matter mask by segmenting the MNI_avg152T1 brain provided in AFNI and removing any voxel that was outside the cortical surface by more than twice the thickness of the gray matter at each surface node. It included 54,034 3 mm isotropic voxels across both hemispheres. We used this mask for all subsequent analyses of all subjects."}, {"section_title": "Connectivity Hyperalignment", "text": "CHA uses functional connectivity profiles to compute transformation matrices and derive a common model of the human connectome. Connectivity profiles consist of the correlations of the response profiles of cortical loci in an ROI or searchlight with the response profiles of targets distributed across the cortex. CHA finds a transformation that minimizes the distances between the connectivity vectors for each target in one subject with the vectors for matched targets in other subjects. In our implementations of hyperalignment, we have used the Procrustes transformation (Sch\u00f6nemann, 1966 ) that derives an orthogonal matrix for the optimal improper rotation of one subject's connectivity vectors to the mean of others'. Other hyperalignment algorithms have used alternatives for calculating the transformation matrices, such as regularized canonical correlation and probabilistic estimation (Chen et al., 2015; Xu, Lorbert, Ramadge, Guntupalli, & Haxby, 2012) . The RHA algorithm uses the same procedure but minimizes the distances between response vectors for the same time-points or stimuli across subjects (Guntupalli, Hanke, et al., 2016; Haxby et al., 2011) . A common model connectome for an ROI is derived iteratively by first aligning a subject's connectivity vectors to those of another subject, then aligning a third subject's vectors to the mean of those subjects, and then aligning each additional subject to the mean of the subjects that have already been hyperaligned. On a second pass, each subject's connectivity vectors are aligned to the mean vectors for all-but-that subject calculated in the first pass. The mean connectivity vectors that have been re-hyperaligned in the second pass are the common model connectome. It is a matrix of connectivities between cortical loci (tagged to the reference subject's anatomy) as columns and connectivity targets as rows. Thus, each cortical locus in the common model connectome has a connectivity profile that is common across brains. The cortical loci in an individual brain are transformed into the common model connectome space with a matrix which has the common model connectome's loci as columns and the individual brain's loci as rows.\nCortical loci in the common model connectome space can be transformed into topographies in an individual brain, using the columns in these transformation matrices, that are individual-specific topographic basis functions that capture how the common connectivity profiles are expressed in individual brains as multiplexed topographies.\nEach connectivity target is a surface-searchlight of 13 mm radius centered on a node of a coarse surface with a total of 1284 covering both hemispheres. Thus, neighboring searchlights for connectivity are overlapping. To capture more variance of response profiles in each target, we used 3 principal components to represent the response profiles in that searchlight instead of using the mean of response profiles of all features as is typically done for computing connectomes. CHA rests on the assumption that the top target components reflect the same connectivity profiles across subjects (similar to the correspondence of time points in a movie across subjects for RHA).\nTherefore, we used a 2 step process to make sure these components are aligned across subjects in terms of their connectivity to other targets.\nIn the first step, we hyperaligned the features (voxels/surface nodes) in each target searchlight across subjects using the correlation of responses between each feature in that target and the mean response profiles of all the features in each of the target searchlights. For each target searchlight with N s features (voxels or surface nodes), we computed a 1284 x N s correlation matrix for each subject, and performed hyperalignment of these matrices to align those N s features. This aligns the features in a particular target searchlight across subjects based on their connectomes -feature connectivity profiles to other target searchlight means. We averaged these aligned connectomes across subjects and did a singular value decomposition (SVD) to compute the top three components that explained the most shared variance. Each component is a weighted sum of features in that target searchlight for each subject such that its connectivity profile is aligned across subjects. Each individual subject's responses for the top three components were then used as target response profiles for CHA. This step gave us 1284 x 3 = 3852 target response profiles in each subject's cortex.\nIn the second step, we hyperaligned the larger searchlights centered on a dense grid. For the HCP data, searchlights were centered on each of the 59,412 nodes and we selected all surface nodes within each searchlight of 20 mm radius. The mean number of surface nodes in these large searchlights was 337. For the movie data, we used a surface-searchlight (Oosterhof, Wiestler, Downing, & Diedrichsen, 2011) approach as described previously in Guntupalli et al. (2016) with searchlights centered on each of 20,484 cortical nodes with 2.9 mm average spacing between the nodes. We performed voxel selection within these searchlights to reduce the contribution from noisy or nongray matter voxels that were included due to this dilation (Guntupalli, Hanke, et al., 2016) . The mean number of selected voxels in these searchlights was 235. We then computed the connectivities profile between each surface node (or voxel for the movie data) in each searchlight of 20 mm radius to the 3852 response profiles for the connectivity targets. The 3852 connectivity vectors in an ROI or searchlight, one for each connectivity target, are used as the basis for CHA of that ROI or searchlight, producing transformation matrices that are then aggregated into a single, whole-cortex transformation matrix using the algorithm for whole-cortex searchlight RHA described in Guntupalli et al. (2016) .\nWhole cortex hyperalignment aggregates the orthogonal matrices from hyperalignment of each searchlight by adding all the weights estimated for a given node-to-feature mapping in surface-searchlights centered on different cortical nodes, resulting in an N x N transformation matrix for each subject, where N is 59,412 surface nodes for HCP data and 54,034 voxels in the gray matter mask for movie data. The reverse mapping matrix is the transpose of this matrix for that subject (Fig. 1c ). Whole cortex hyperalignment transformation matrices for an individual were applied to any new dataset in that same individual by first normalizing the data in each voxel by z-scoring and multiplying that normalized dataset with the transformation matrix. The same procedure can be followed to apply reverse mapping (Guntupalli, Hanke, et al., 2016) .\nCHA of HCP data was based on one session of resting state data (~15 min, 1200 TRs) and a second session of resting state data was used for validation tests. CHA of movie data was based on one half of the movie data (~55 min, ~1300 TRs) and a second half of the movie data was used for validation tests."}, {"section_title": "Validation tests and statistical analyses", "text": "Functional ROIs. In addition to analyzing the results of validation tests in each feature or searchlight across the whole cortex, we also examined the results of validation tests in 24 functional ROIs associated with different sensory, perceptual, and cognitive functions to assess the general validity of the common model (Guntupalli, Hanke, et al., 2016) . We searched for terms and cortical areas implicated in visual, auditory, cognitive, and social functions in NeuroSynth (Yarkoni et al., 2011) and took the coordinates for the peak location associated with the respective term ( Supplementary Table 1 ). For validation testing using the HCP dataset, we found the closest surface node corresponding to each peak locus and used a surface searchlight with a 10 mm radius around that surface node as the functional ROI. Functional ROIs that were medial and encompassing both hemispheres in the volume space were split into left and right ROIs in the surface space resulting in 26 ROIs for tests on the HCP data. For validation testing using the movie dataset, we used volume searchlights centered around those peak loci with a radius of 3 voxels as our functional ROIs. For analyses of ISCs and PSFs of connectivity profiles in functional ROIs, we calculated the mean ISC or PSF across all cortical loci within the ROI searchlights (Figs. 2b, 3b, and 4) ."}, {"section_title": "Statistics.", "text": "We used bootstrapping to test for significance of the effects by sampling subjects 10,000 times to compute 95% CIs using BootES (Kirby & Gerlanc, 2013) . We did this for each ROI and for the mean of all ROIs separately. We used the same bootstrapping procedure for all validation tests unless specified otherwise."}, {"section_title": "Intersubject correlation (ISC) of connectivity profiles.", "text": "Connectivity profile of a feature (or a cortical node) was defined as the correlation of its time-series to that of average time-series in a set of target regions covering the whole cortex. For HCP data, targets were surface searchlights with a radius of 10 mm with centers with centers uniformly distributed on a coarse surface grid (ico8). There were 1284 targets in total.\nThis gave vector of 1284 values for each cortical locus. ISCs of connectivity profiles were computed between each subject's connectivity profile and the average connectivity profile of all other subjects in each cortical locus. ISCs of connectivity profiles were computed for session REST2 before and after CHA, while the session REST1 was used for deriving CHA.\nWe also computed within-subject between-session (REST1 and REST2) correlation of connectivity profiles. This also was performed after CHA to account for any filtering effects but to a single common space as used for our main analyses.\nFor the movie data, ISCs of connectivity profiles were computed within each movie half separately and before and after CHA based on the other half of the movie. Each target is a surface disc searchlight of radius 13 mm with centers uniformly distributed on a coarse surface grid (ico8). Correlation values were Fisher transformed before averaging across both halves of the movie in each voxel. These were then averaged across all subjects and inverse Fisher transformed before mapping onto the cortical surface for visualization.\nSpatial point spread function. To investigate the spatial granularity of representation, we computed a spatial point spread function (PSF) of ISCs of connectivity profiles. We computed the correlation of connectivity profiles in each cortical locus (voxel or surface node) with the average connectivity profiles of cortical loci at varying cortical distances in other subjects' data. To account for the effect of filtering, we did this analyses with data after hyperalignment with each subject aligned to a different common space as proxy for anatomical alignment and after hyperalignment with each subject aligned to the same reference subject for hyperalignment (Guntupalli, Hanke, et al., 2016) . We computed similar PSFs for connectivity profiles within-subject between-sessions (REST1 and REST2). This was also performed after hyperalignment to account for any filtering effects but to a single common space as used for our main analyses.\nInter-subject correlation of task activations. We evaluated if CHA derived from the resting state data improves alignment of task maps across subjects. We applied the CHA transformations derived from one session of the resting state data to the task maps for the respective subjects provided by the HCP (Barch et al., 2013) . We used 46 maps by keeping only one map for each contrast. We then computed the spatial correlation of these maps across subjects in the MSM-All aligned data and hyperaligned data for each task map."}, {"section_title": "ISC of representational geometry.", "text": "ISCs of similarity structures were computed within each movie half separately using a searchlight of 3 voxel radius. In each searchlight, similarity structure was computed as a matrix of correlation coefficients between responses at every pair of time-points from that movie half for each subject. The flattened upper triangle of this matrix excluding the diagonal was extracted as the profile of representational geometry at each searchlight for each subject. ISC of representational geometry in each searchlight was computed as the correlation between each subject's similarity profile and the average of all other subjects' similarity profiles for that searchlight. Correlation values were Fisher transformed before averaging across both movie halves in each voxel. These were then averaged across all subject-average pairs and inverse Fisher transformed before mapping onto the cortical surface for visualization. The same steps were performed to compute inter-subject correlation of representational similarity before and after hyperalignment."}, {"section_title": "Between-subject multivariate pattern classification (bsMVPC). bsMVPC of 15 s", "text": "movie time segments (6 TRs) was computed within each movie half separately using a searchlight of 3 voxel radius. bsMVPC was performed using a one-nearest neighbor classifier based on correlation distance (Guntupalli, Hanke, et al., 2016; Haxby et al., 2011) . Each 15 s (6TR) sequence of brain data for an individual was compared to average 15 s sequences for all other subjects for that sequence and other sequences using a sliding time window (chance < 0.1%). Classification accuracies at each voxel were averaged across both halves in each subject before mapping the subject mean onto the cortical surface for visualization. bsMVPC of movie segments using voxels from the whole cortex was performed after projecting the test datasets into the singular vector (SV) space derived from the the same training data as used to derive hyperalignment. These SVs were sorted in the descending order of their singular values. bsMVPC was performed for multiple sets of top singular vectors in each movie half and the accuracies for the two halves of the movie were averaged for each subject at each set size.\nWe implemented our methods and ran our analyses in PyMVPA (Hanke et al., 2009) (http://www.pymvpa.org) unless otherwise specified. All preprocessing and analyses were carried out on a 64-bit Debian 7.0 (wheezy) system with additional software from NeuroDebian (Halchenko & Hanke, 2012) (http://neuro.debian.net). Supplementary Figure 1 . ISC of connectivity profiles in the movie data with RHA and control analysis. (a) ISC of connectivity profiles mapped onto cortical surface after anatomical alignment, RHA, CHA, and filtering control. We controlled for the filtering effect of hyperalignment transformation by applying a transformation on each subject that projects that subject's data into a common model space derived with a different reference subject. That way, even though all subjects are projected to common model space, their correspondence is only based on anatomy. Increase in ISC of connectivity profiles after CHA cannot be explained by the filtering effect. (b) ISC of connectivity profiles averaged within ROIs covering visual, auditory, cognitive, and social systems across the cortex and their mean comparing anatomical alignment, RHA and CHA. Bootstrapped testing showed significantly higher ISCs after both CHA and RHA relative to anatomical alignment in all ROIs, and slightly but significantly higher ISCs after CHA than after RHA in all but two ROIs (\"-\" : CHA<RHA; \"ns\" : no significant difference between ISCs after CHA and RHA; \"+\" : CHA>RHA). CHA afforded higher ISCs of connectivity profiles across ROIs than did RHA (ROI means = 0.82 and 0.79, respectively; difference = 0.03 [0.02, 0.04]). Figure 2 . Spatial granularity of connectivity profiles in the movie data. The intersubject point spread function (PSF) of connectivity profile correlations are computed as correlation between the connectivity profile for a cortical locus in one subject and the profiles of its spatial neighbors in other subjects at increasing distances from that locus (ISCs). Slope is estimated using a linear fit of these correlations at different distances as a function of distance in each of the ROIs (Left). Average PSF across all ROIs is plotted on the right. Bootstrapped testing showed significantly higher slopes of PSFs after both CHA and RHA relative to anatomical alignment in all ROIs, and some differences after CHA and RHA (\"-\" : CHA<RHA; \"ns\" : no significant difference between ISCs after CHA and RHA; \"+\" : CHA>RHA). Mean ROI PSF slopes for connectivity profiles were 0.077 and 0.080 after CHA and RHA, respectively, as compared to 0.035 after anatomical alignment (difference in mean slope between CHA and RHA = 0.003 [0.002, 0.004]). after both CHA and RHA relative to anatomical alignment in all ROIs, and some differences after CHA and RHA (\"-\" : CHA<RHA; \"ns\" : no significant difference between ISCs after CHA and RHA; \"+\" : CHA>RHA). CHA increased the ISC of representational geometry in all of the ROIs (ROI mean ISC=0.291) relative to anatomical alignment (ISC=0.173) (difference=0.118 [0.103, 0.129]), but the increase is slightly, but significantly, less than that provided by RHA (ISC=0.306) (difference=0.015 [0.009, 0.019]). Supplementary Table 1 Selected cortical loci implicated in visual, auditory, cognitive, and social functions from Neurosynth."}, {"section_title": "Supplementary Figures", "text": ""}, {"section_title": "Supplementary", "text": ""}, {"section_title": "Supplementary Tables", "text": ""}, {"section_title": "Search Term", "text": "Hemisphere MNI Coordinates (x, y, z "}]