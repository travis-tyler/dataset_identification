[{"section_title": "Abstract", "text": "The dynamical evolution of complex systems is often intrinsically stochastic and subject to external random forces. In order to study the resulting variability in dynamics, it is essential to make measurements on replicate systems and to separate arbitrary variation of the average dynamics of these replicates from fluctuations around the average dynamics. Here we do so for population time-series data from replicate ecosystems sharing a common average dynamics or common trend. We explain how model parameters, including the effective interactions between species and dynamical noise, can be estimated from the data and how replication reduces errors in these estimates. For this, it is essential that the model can fit a variety of average dynamics. We then show how one can judge the quality of a model, compare alternate models, and determine which combinations of parameters are poorly determined by the data. In addition we show how replicate population dynamics experiments could be designed to optimize the acquired information of interest about the systems. Our approach is illustrated on a set of time series gathered from replicate microbial closed ecosystems."}, {"section_title": "I. INTRODUCTION", "text": "Complex systems in physics and other fields, such as biology and sociology, are often characterized by intrinsically stochastic dynamics and subject to external random forces. At the same time, nontrivial trends are pervasive in those systems, be it in the laboratory, society, or nature. This raises a basic question when studying the variations in the activities or numbers of the system components. How can one separate the contribution of the trend to the observed dynamical evolution from the contribution of the various sources of noise? Traditionally, and mostly for unique time series, such a separation is \"achieved\" by using models with constant coefficients, which allow for only a few types of trends, such as constant average, logistic or exponential growth, or oscillations.\nIn reality, however, trends can have much more sophisticated time dependence, and deviations between the true average dynamics and the average dynamics imposed by constant-coefficient trend models will have the appearance of fluctuations around the inferred average dynamics. This will confound the analysis of true variability of the dynamics. The most direct approach to answering the question above is to replicate the experiment many times, with identical initial and experimental conditions. The average over the different replicate dynamics naturally defines the common trend of the system, while replicate-dependent deviations correspond to specific realizations of the stochastic fluctuations. Obviously, in practice, this approach is hindered by various limitations, * Present address: Green Center for Systems Biology, University of Texas Southwestern Medical Center, 6001 Forest Park Road, Dallas, TX 75390, USA; doeke.hekstra@utsouthwestern.edu such as the errors in the measurements, the limited number of available replicates, and limited sampling. To which extent those limitations affect the determination of the common trend and the characterization of the statistical features of the fluctuations is a matter of concern.\nThe purpose of this paper is to address this general question, with a focus on the specific case of ecological systems. The dynamics of ecological systems are by their very nature stochastic, as a result of, for instance, random genetic and phenotypic changes and randomness in the timing of birth and death. External forces, such as the weather and the random immigration of other species, play crucial roles, too. Factors such as seasonal variation, depletion of nutrients, detailed chemistry, and any other factor not explicitly modeled may affect the average dynamics in various idiosyncratic ways, and their interplay can produce nontrivial average dynamics (a common trend). While replication of ecosystems is already fairly common, model ecosystems permitting excellent control of starting and experimental conditions are becoming increasingly available. Examples include the development of replicate closed ecosystems [1] [2] [3] , multispecies chemostats [4] [5] [6] , and gnotobiotic mouse experiments [7, 8] , which have been revolutionized by modern sequencing methods.\nBy providing multiple time series, experimental replication allows one to better separate temporal variation of the average density dynamics from density fluctuations around the average. However, to realize this advantage, one needs to be able to fit simple models to the data which are flexible enough to accommodate arbitrary average dynamics.\nHere, we develop a method for the statistical analysis of population dynamics measurements for replicate ecosystems. Our approach is based on a combination of methods and ideas coming from the study of stochastic processes in statistical physics and probability theory, as well as from statistical Bayesian inference. A crucial point in our approach is the distinction between \"measurement error\" and \"dynamical noise,\" which both contribute to the observed density fluctuations around the average dynamics. Measurement error comprises both the effects of limited sampling and the possibility that the measured populations do not coincide with the dynamically relevant ones [9] . For example, one might observe individuals in only one life-cycle stage (e.g., adults) or in only one part of their habitat. Dynamical noise affects the population dynamics itself and can arise from endogenous sources, such as randomness in the number and timing of births and deaths or in behavior, and exogenous sources, such as fluctuations in the weather or the timing and nature of individuals entering the system of interest. Apparent dynamical noise can also result from more complex dynamics (e.g., chaos or interactions with unobserved species) not adequately captured by the deterministic part of a chosen model. Collectively, we will refer to measurement error and dynamical noise as \"noise sources.\"\nTo separate the effects of measurement error and dynamical noise, our approach is based on a state space model [10] , described by two types of equations: (1) one or more so-called state equations which describe the system dynamics in terms of its true, underlying variables, say, x = (x 1 , . . . ,x N ) (bold symbols denote vectors and matrices), model parameters, say, \u03b8 , and dynamical noise, say, \u03b7, and (2) an \"observation equation\" describing the relation between the observed variables, say, y, the underlying variables, x, and measurement error, \u03be . State space models have indeed become fairly commonplace in ecology [11] [12] [13] [14] .\nSuch a model defines the probability P ( y|\u03b8) of the data given the model parameters. To infer the values of the parameters from the observed data we introduce the posterior probability distribution of the model parameters given the data, P (\u03b8 | y) = P ( y|\u03b8) \u00b7 P (\u03b8 )/P ( y) by Bayes's theorem. Here P (\u03b8 ) is the so-called prior probability distribution of the model parameters, which specifies what is known a priori about the model parameters. P ( y) is the probability of the data under the model integrated over all possible values of the model parameters. Maximizing the unnormalized posterior probability, P ( y|\u03b8) \u00b7 P (\u03b8), is thus equivalent to finding the most likely set of parameters given the data.\nThe use of state space models poses, however, a difficulty, since one needs to integrate over the possible values of the underlying (unobserved) variables, x, to evaluate P ( y|\u03b8 ) = d x (P ( y|x,\u03b8 )P (x|\u03b8)). This integration is commonly done by so-called Markov-chain Monte Carlo methods (e.g., in WINBUGS [15] ). Such methods essentially explore the \"product space\" of underlying variables and model parameters, X \u00d7 , by artificial Monte Carlo dynamics dependent on P (x, y|\u03b8) \u00b7 P (\u03b8 ), and obtain estimates of the posterior distribution, P (\u03b8 | y). Alternatively, such integration can be performed using forward and backward recursion relations, known as filters and smoothers, which propagate estimates of the probability distribution of the underlying variables, x, as a function of the data. This integration is then alternated with optimization over the model parameters. A rigorous example of such an approach is expectation maximization (see Ref. [16] for a nice introduction). For linear, Gaussian, discrete-time models, the forward and backward recursions reduce to the so-called Kalman filter (for forward recursion only [17] ) or Kalman smoother (forward and backward recursion, also known as the Rauch-Tung-Striebel smoother [18] ). In ecology, approximate methods are more common, in which the likelihood function is simplified and, most commonly, the Kalman filter is used (for example, restricted maximum likelihood [14] and conditional maximum likelihood [19] ).\nHereafter, we choose to study a model that is linear in (the logarithms of) the underlying variables and has a Gaussian stochastic structure. This permits explicit integration over underlying variables and an analytical expression for the posterior density of the model parameters. Because of the availability of the methods mentioned, explicit calculation of the likelihood function is not often used. However, much like a partition function in statistical mechanics, a likelihood function provides a complete description of a statistical problem and can be used to illuminate any aspect of data analysis and experimental design. We show that explicit calculation of the posterior distribution is feasible for the common trend problem, which contains two layers of underlying variables: the true population densities in each replicate ecosystem and the common trend.\nWhile there are arguably many nonlinearities in ecology, a linear model often provides a reasonable starting point. First, many of the questions addressed here in fitting a linear model to the data will be encountered a fortiori for nonlinear models. Second, a linear model can often be considered a linearization of a nonlinear model [19] and as such as a reasonable \"null hypothesis\" for the importance of nonlinear effects. Often, for complex systems, there is conceptual support for one kind or another of nonlinear effect contributing to the dynamics. The heterogeneity and multitude of scales present in complex systems can easily make a judgment of their relative importance impossible. Polansky et al. [20] , for example, found no statistical support for the inclusion of nonlinearities in the dependence of per capita growth rate on density in any of 25 data sets examined. Third, for our data (below), a linear, Gaussian model with a time-dependent coefficient describes the data well, as we anticipated based on previous work [1] .\nLinear state space models with constant coefficients have received considerable attention both within and outside of ecology. An ecological example is the \"stochastic exponential,\" or \"random-walk,\" model, which does not contain a density-dependent term in its dynamics (Refs. [9, 11, 21, 22] for discrete time and Ref. [23] for the continuous time case). Another common linear, Gaussian model is the so-called Gompertz model, which accommodates density dependence. The discrete-time, constant-coefficient Gompertz model often has been used to study ecology (Refs. [14, 24, 25] for single species and Ref. [19] for multiple species). Here we will examine a continuous-time Gompertz model with a timedependent per-species term and a time-independent speciesspecies interaction matrix.\nThe paper is organized as follows. To allow quick perusal, we begin both the Methods and Results sections with a brief overview. Readers not interested in the mathematical details of our methods can restrict themselves to reading the overview of the Methods section. In the Methods section, we formulate the likelihood function in detail for replicate time series modeled using the continuous-time Gompertz model and describe the integration over underlying variables and maximization over model parameters. This allows us to determine maximum likelihood parameter estimates and the joint (multivariate) posterior distribution of the model parameters. We will apply our methods to time series we recently acquired from replicate closed ecosystems (CES, Ref. [1] ). These experiments are briefly summarized at the end of the Methods section.\nIn the Results section we validate our method and discuss how one can estimate parameters, determine which parameter combinations are hard to estimate, compare models, and optimize experimental design.\nApplied to our closed ecosystem data, we show that (1) a model with a time-dependent term is more suitable to describe variability in ecological dynamics than is a constant-coefficient approach; (2) the covariation between species in these closed ecosystems does not reflect the structure of instantaneous fluctuations in densities but rather the collective response of the interacting species to such fluctuations; (3) the net effective interactions between species nearly vanish for one linear combination of densities, that is, for one system dimension, or \"ecomode,\" the ecosystems lack a significant \"restoring force\"; and (4) this, in turn, causes the dynamics of each species in individual ecosystems to resemble a random walk around the common trend."}, {"section_title": "II. METHODS", "text": ""}, {"section_title": "A. Overview", "text": "In the Methods section, we will describe the first step in the statistical analysis of replicate time series from stochastic systems subject to a common trend: calculation of the likelihood function. We will do so in the language of ecosystems with interacting species, but similar equations likely apply to many classes of complex systems. The approach is very similar whether one uses frequentist or Bayesian statistics. We will use the Gompertz model, a linear model of population dynamics. We will formulate the dynamical model and assumptions about measurement error and provide a physical intuition for the way the common trend is described (Sec. II B). We formulate the likelihood function and describe how we will address the two layers of unobserved values: of the dynamics in each individual ecosystem and of the common trend shared by the replicate systems (Sec. II C). To control the degree to which the common trend description can vary with time, we introduce a smoothing parameter, \u03bc. The structure of the likelihood function allows us to integrate over the unobserved variables: that is, we can consider all possible values at once (Sec. II D). This greatly reduces the number of parameters that need to estimated. Calculation of the likelihood function over the remaining parameters exploits a number of parameter transformations (Sec. II E) to make the likelihood function close to Gaussian. This final likelihood surface can be described by the location of its maximum and the Hessian matrix, which describes how steeply the likelihood function is peaked around the maximum in each direction. We will examine this matrix in detail in the Results section. Finally (Sec. II F), we briefly summarize closed ecosystem experiments.\nIn this section, we outline the challenge posed by the statistical analysis and experimental design of time-series measurements on replicate stochastic systems (Sec. III B). We study the likelihood function derived in Eq. (13) and Tables I  and II to address several aspects: First, we characterize the scaling of bias and variance of parameter estimates using simulated time series (Sec. III C). This analysis emphasizes that replication is especially valuable when one needs to disentangle a common trend and fluctuations. We discuss how one should smoothen the trend: There is a basic tension between smoothing the average dynamics too much (essentially into a straight line) and too little (Sec. III D). Too much smoothing results in mistaking true temporal variations of the average dynamics for fluctuations. Too little results in interpretation of measurement errors as fluctuations. We propose and discuss results for two choices of intermediate smoothing. Measurements typically give different amounts of information on different parameters and parameter combinations (Sec. III E). We show how one can detect poorly constrained parameter combinations. We then address how one can judge the quality of models both in comparative terms (against other models) and in absolute terms (in terms of data fit) in Sec. III F. Doing so, we clarify a remarkably common situation in which parameter estimates and model comparison suggest conflicting interpretations of the data, the Lindley paradox. We then describe how one can improve experimental design with a focus on particular (combinations of) parameters (Sec. III G). Surprisingly, nonstandard experimental designs can in some cases lead to substantial improvement in parameter estimates."}, {"section_title": "Notation", "text": "We consider a general experiment of duration T , in which population densities (or numbers) N obs are observed for K species, with index k = 1,2, . . . ,K. These densities are observed in S systems with index s = 1,2, . . . ,S, at N time points, t n \u2208 [0,T ], with n = 1,2, . . . ,N the index over time points. The time points do not need to be regularly spaced. We start by transforming to logarithmic densities: y kns = log N obs ks (t n ), indexed by species k, system s, and time point n. The general case in which densities may have been measured in different ecosystems at different times is described in the Supplemental Material [26] , Sec. S3.\nFor simplicity, we will suppress indices that are implied. For example, y k refers to all observations of log N obs for a given species k, an NS \u00d7 1 vector; y s refers to all observations for a given system, s, a KN \u00d7 1 vector; and y n refers to all observations at a given time point, t n , a KS \u00d7 1 vector. Unless specified otherwise, sums run over their entire possible range."}, {"section_title": "B. A state space model", "text": "We will make a few basic assumptions. First, we assume that the measurements do not affect the dynamics. Second, we assume that the dynamics are Markovian. That is, we assume that population density changes are a function of the present state of the ecosystem and not (also) of past states.\nThese assumptions lead to a state space approach in which the dynamics are separated into two parts: a state equation describing the (stochastic) dynamics of the system itself in terms of \"true\" underlying logarithmic densities, x(t) = log N dyn (t) [Eq. (1a)], and an observation equation describing the relation between observed and true logarithmic densities [Eq. (1b)],\u1e8b\nHere g(x) represents the system dynamics and \u03b7 s additive dynamical noise with (instantaneous) covariance matrix S d dt. We further assume that the dynamical noise is Gaussian and uncorrelated over time. Such dynamical noise in the dynamics is a realistic assumption for our data [1] . For the description of measurements, we will assume h(x) = x and additive Gaussian measurement error, \u03be . This corresponds to log-normal measurement error in the observed densities, which seems appropriate for experiments in which one likely makes proportional errors in estimating the underlying density. We treat the variance of measurement error of each species, S m k , as an unknown model parameter and assume measurement errors are independent between species. That is, we assume the covariance matrix for measurement errors, S m , to be a diagonal matrix. It is straightforward to derive the general case instead.\nAs an example of linear dynamics, g(x), we consider a Gompertz model [27] , in which\nwhere we assume f (t) to depend on time but A to be time independent.\nThe dynamical model in Eqs. (1a) and (2) is a \"driven\" version of the Ornstein-Uhlenbeck process [28] and is formally analogous to that of a set of S particles (with indices s) moving in K dimensions in the presence of a harmonic (quadratic) potential energy well with multivariate spring constant A and center position x * (t) = A \u22121 f (t) under overdamped conditions (that is, viscous forces instantaneously oppose any other forces). In this analogy, each particle represents an ecosystem. Each particle will tend to track the well (which itself can move with time) and experiences thermal fluctuations, \u03b7 s . If the eigenvalues of A are large and positive, the average position of each particle will closely match that of the well, i.e., x(t) \u2248 x * (t) = A \u22121 f (t). If, in contrast, the eigenvalues of A are small (a shallow well), the well position x * (t) at any instant becomes unimportant. Instead, x(t) \u2248 x(0) + The analogy has its limitations, since the eigenvalues of A can be complex and its eigenvectors need not be orthogonal. An extensive ecological interpretation of this \"particle in a well\" picture of ecological dynamics is given by Ives et al. [19, 29] for the case of the function f being constant.\nTo fix terminology, we will call the matrix A the \"effective interaction matrix\" because it describes the net effects that species densities exert on their own and other species' growth rates. We call the expected replicate-average dynamics, x(t) , the \"common trend.\" As outlined above, the function f (t) can dictate the course of this common trend, in principle, in arbitrary ways. The time dependence of f (t) gives the model its flexibility. Because of this, we will call f (t) the \"trend function.\" Since population density measurements mostly occur at discrete time points, we will switch to a representation of f (t) by a discrete set of \"trend variables.\" We refer to these as trend variables rather than as trend parameters because we will treat the trend and the dynamics of individual replicates as two layers of unobserved dynamic quantities (variables). Fluctuations, then, are the deviations of the dynamics of individual replicates from the common trend."}, {"section_title": "C. Formulation of the likelihood function", "text": "Our first aim is to estimate the model parameters, \u03b8 = (A,S d ,S m ), from the data, y. From a classical perspective, one typically seeks to derive an estimator, such as a maximum likelihood (ML) estimator, for the model parameters. The likelihood is simply defined as\nthat is, the probability of the data given the model parameters. The maximum likelihood estimate maximizes l y (\u03b8 ). In Bayesian statistics, ones estimates P (\u03b8 | y ), the conditional probability of the model parameters given the data, also known as the posterior distribution of \u03b8 . By Bayes's theorem,\nwhere P (\u03b8 ) is the so-called prior distribution of the model parameters and contains any constraints we put on our estimation a priori, based on prior knowledge or limitations imposed by the experimental design. P ( y) is a model-dependent, but parameter-independent, normalization factor. We will refer to the product P ( y |\u03b8 ) \u00b7 P (\u03b8 ) as the unnormalized posterior distribution of \u03b8. It is obvious that the likelihood function, l y (\u03b8 ) \u2261 P ( y |\u03b8 ), plays a central role in parameter estimation in either perspective. To develop the likelihood function, however, one needs to account not just for the data, y, and the model parameters, \u03b8 , but also for the two types of underlying variables, the true logarithmic densities, x, and the unknown common trend, described by f . Central to our approach is that we explicitly integrate l y (\u03b8) over the underlying variables. That is,\nWe will first obtain expressions for each of the three factors in the integrand of this expression. Then we integrate over the two types of underlying variables, x and f , successively.\nFirst, P ( y |x,\u03b8 ) = n,s P ( y ns |x ns ,\u03b8 ), with each P ( y ns |x ns ,\u03b8 ) \u223c N (x ns ,S m ), a multivariate normal distribution. We consider dynamics without memory in\u1e8b(t), as mentioned above. Hence, P (x| f ,\u03b8 ) = s,n<N P (x n+1,s |x ns , f ,\u03b8 ). We obtain these dynamical transition probabilities, P (x n+1,s |x ns , f ,\u03b8 ), by integration of Eq. (1a) over a time interval t n = (t n+1 \u2212 t n ) [30] . (Note that we omit a prior distribution on x 1 , although this would be trivial to include.) For the Gompertz model the transition probabilities are Gaussian, with expectation value as follows:\nt n e \u2212A(t n+1 \u2212t ) f (t )dt and covariance matrix\nn can be calculated analytically by so-called matrix fraction decomposition ([31] , summarized in the Supplemental Material [26] , Sec. S1.) Note that, in the limit of weak effective interactions (A kl \u2192 0 for all k,l), one obtains n \u2192 S d t n and \u03c6 n \u2192 f n = 1 t t n+1 t n f (t)dt. From this point onward, we will take the \u03c6 n , rather than f (t), as the variables describing the common trend.\nA description of the common trend can take up many variables. To control the effective number of variables used, we introduce a smoothness condition in P (\u03c6|\u03b8) \u2261 P ( f |\u03b8), which penalizes curvature (\"flexibility\") in the common trend [32] (this is also known as \"regularization\"),\nwhere \u03bc is a smoothing parameter that determines the smoothness of the inferred common trend of each species. From a Bayesian perspective the smoothness condition can instead be considered a prior distribution for the unknown common trend. We examine the choice of \u03bc in Sec. III D. A complete specification of the Bayesian unnormalized posterior distribution requires formulating prior distributions for the 062714-4 nn , \u03b1 n , and \u03b2 n are K \u00d7 K (sub-)matrices, while each u ns is a K \u00d7 1 vector. In addition, any transposes or inverses of single-index variables imply transposition or inversion of the indexed variable, not vice versa. That is,\n\u22121 , and not ( \u22121 ) n . Also, y ns = ( y ns ) . Note that \u03b4 nn = 1 for n = n and 0 otherwise. Likewise, 1 (condition) = 1 if the condition is satified, and 0 otherwise.\nmodel parameters, \u03b8 . We discuss the specification of prior distributions in detail in the Supplemental Material [26] , Sec. S2.\nThe full expression for the likelihood function is complicated, but both x and \u03c6 appear solely as at most quadratic terms in exponential factors. One can thus integrate over the underlying variables and eliminate them from the likelihood function."}, {"section_title": "D. Integrating out underlying variables", "text": "We can now integrate the likelihood over the variables x and \u03c6, slightly modifying the proposal in Eq. (5) as follows:\nTo do so, we put P ( y|x,\u03b8 )P (x|\u03c6,\u03b8 )P (\u03c6|\u03b8,\u03bc) in the form\nby collecting terms proportional to x ns x n s into Q (s) nn , proportional to x ns into u ns , and constant terms into C (s) and C (0) , respectively (each defined in Table I ). As long as the measurement schedule is the same for all ecosystems, Q (s) = Q for all s. One can rewrite the term (10) as\nWe will repeatedly encounter such Gaussian integrals. We remind the reader that (for general z and A)\nwith |A| the determinant of A and p the number of elements in z. We perform the Gaussian integration over x in Eq. (9) . This leaves an integral over \u03c6,\nTo perform the integration over the \u03c6, we note that u s , C (s) , and C (0) all depend on \u03c6 (see Table I ). One can expand the exponent in Eq. (12) and collect terms proportional to \u03c6 n \u03c6 n in R nn , to \u03c6 n in v n , and constants into a term C , completely analogously to the integration over x (we summarize R, v, and C in Table II ). Integration of \u03c6 is Gaussian as well and yields the following:\nFor a Bayesian analysis, we simply multiply the likelihood function in Eq. (13) by the expressions for the prior distributions (see the Supplemental Material [26] , Sec. S2, for a detailed description)."}, {"section_title": "E. Likelihood maximization, parameter transformation, and the posterior distribution", "text": "We obtained maximum likelihood estimates of the model parameters by numerical optimization of the likelihood func-TABLE II. Integration over \u03c6. R, v, and C are defined in the description of Eq. (13) . The conventions used are the same as in Table I .\ntion [Eq. (13)] over the parameters \u03b8 . To be precise, we minimized L y (\u03b8; \u03bc) \u2261 \u22122 log l y (\u03b8 ; \u03bc) over a set of transformed model parameters, \u03d1 = w (\u03b8), with w a parameter transformation (see below). For simplicity, we will sometimes refer to L itself as the log-likelihood. Minimization was performed using the Nelder-Mead algorithm (MATLAB 6.1, Mathworks, Inc.) and a conjugate gradient algorithm [33] , with similar results (cf. Ref. [13] ). We recommend examining the likelihood surface to verify a convex shape around the found minimum (as in Fig. S-4 ). For small data sets it may be helpful to use a stochastic minimization routine such as simulated annealing and/or multiple initial parameter guesses to avoid convergence to local minima. Parameter transformations play two roles in this work. First, they allow unconstrained minimization. That is, while, for example, S m k would need to be constrained to be positive, this is not necessary for log S m k . In addition to logarithmic transformation for the S m k , we used the so-called log-Cholesky transformation for the matrix S d to guarantee the constraint that it be positive definite [34] .\nThe second purpose of parameter transformation is to guarantee a nearly parabolic log-likelihood surface around the likelihood maximum. A suitable choice of w (\u03b8 ) can often yield a nearly quadratic structure of L y (\u03d1; \u03bc) around its minimum, \u03d1 [35] (for our data, this is illustrated in Fig. S-4 ). Such a condition facilitates integration over model parameter space and allows maximum likelihood estimates to be as accurate as possible (by the Cram\u00e9r-Rao inequality [36] ). Such a transformation can be done after the optimal parameters have been found to make Gaussian approximations in subsequent analysis more accurate. For this purpose, we instead described\nAlternative parameter transformations for this purpose have been proposed in Ref. [35] . More generally, classes of so-called normalizing transformations have been proposed [37] , as well as closely related \"variance-stabilizing transformations\" [37, 38] ."}, {"section_title": "Bayesian approach", "text": "In Bayesian statistics one can obtain a full description of the joint posterior probability of the model parameters. To do so, we first sought the minimum of\nis approximately parabolic around its minimum,\u03b8, one can approximate the unnormalized posterior probability of the parameters around \u03d1 as (14) whereH is the \"Hessian matrix\" of the log-likelihood function, describing how sharply L B y is peaked around the optimal estimate. That is,\nIn this approximation [Eq. (14)], it is also trivial to normalize the joint posterior distribution by Gaussian integration (which we will do explicitly in Sec. III F). We now obtain the posterior distribution for our original model parameters \u03b8 by transforming P (\u03b8 | y ) d\u03b8 = P (\u03d1 | y ) d\u03d1 = P (w(\u03b8) | y ) dw(\u03b8 ) or by constructing a histogram computationally by applying the inverse transformation w \u22121 (\u03d1) to samples drawn from P (\u03d1 | y ). The Hessian matrices before and after model parameter transformation are related by\nWe want to make a number of observations about these results. First, provided L is an excellent approximation of the covariance matrix of the posterior distribution of \u03d1, that is, the posterior covariance matrix (Sec. III E). In addition, the expected value ofH is the so-called Fisher information matrix, which places a bound on how well any estimator can perform (see Sec. III G). In practice, we calculate the Hessian matrix using finite difference derivatives of the log-likelihood function,\n. Given the likelihood function in Table II , it is, in principle, possible to calculate the Hessian matrix exactly instead."}, {"section_title": "F. Closed ecosystem experiments", "text": "These experiments are described in detail in Ref. [1] . Our CESs contained three motile, unicellular organisms: the green alga Chlamydomonas reinhardtii, the bacterium Escherichia coli, and the ciliate Tetrahymena thermophila. Briefly, replicate CESs were constructed by inoculating the three species in 3 ml of a minimal medium with 0.03% proteose peptone (as the only source of carbon and nitrogen) and kept in small (\u223c5-ml) cuvettes. We kept these CESs under constant light and temperature. We noninvasively measured densities in a small subvolume (\u223c10 nl) in each cuvette by in situ fluorescence microscopy, acquiring a few thousand images per time point on measurement days. Measured local densities were proportional to the observed average number of individuals per image. We performed two independent experiments, in which densities were measured in sets of eight to nine replicate ecosystems at frequencies of 4-7 times per week (experiment 1) and 2, 1, 1 2 , 1 4 , and 1 8 times per week (experiment 2) for each set of ecosystems. Sets of systems measured less frequently than once per 2 weeks were not included in the analysis presented here (retaining 35 replicate systems for the analysis presented here)."}, {"section_title": "III. RESULTS", "text": ""}, {"section_title": "B. The basic problem", "text": "Whenever one has noisy time series for one or more instances of a system with stochastic dynamics, one is faced with questions about how to assign any variation in the data: Do variations from one time point to the next represent a change in the common trend, a fluctuation of the dynamics with respect to the common trend, or simply measurement error? For unique time series one cannot answer this question without making strong assumptions about the average dynamics. The situation differs when time series are available for replicate systems, as illustrated in Fig. 1 for our set of replicate closed ecosystems. The measurements, in our notation the y kns , are shown for 2 of 35 systems as circles and squares, respectively.\nCrucially, one can estimate both the average dynamics or common trend x kn (estimates with associated uncertainty shown as broad bands in Fig. 1 ) and the fluctuations in each system around the common trend [shown are bands of inferred x ks (t) \u00b1 2\u03c3 (x ks (t)) tracking the measurement points]. Since we integrate over the underlying variables, we estimate the average dynamics and densities in individual replicates implicitly while estimating the model parameters. Whether implicit or explicit, however, this ability to separate fluctuations around the average dynamics from the average dynamics is crucial for model parameter estimation and the accurate analysis of variability in system dynamics. (We discuss how one can extract the posterior distribution of the underlying variables in detail in the Supplemental Material [26] )."}, {"section_title": "C. Variance and bias of estimates", "text": "To validate our statistical method, we examined inference for a number of artificial data sets. In Fig. 2 we show results for artificial data generated by a three-species model following the dynamical and measurement equations used for inference [Eq. However, at small NS these variances were in some cases much larger than expected from extrapolation, especially for variable t (dashed lines, Figs. 2(a)-2(c)]. Close inspection revealed that this happens as the global minimum of L starts to merge with local minima assigning all the noise in the data to either measurement error alone or to dynamical noise alone (cf. Refs. [14, 40] ). Cases in which one can no longer separate the different parameters (here the relative contributions of dynamical noise and measurement error at large t) are called \"identifiability problems\" (see Sec. III E). As the difference between the solid and dashed curves in Figs. 2(a)-2(c) suggests, however, one can attain much more precise estimates at the same overall effort by designing the measurement schedule differently. We consider \"optimal sampling\" in Sec. III G. Fig. 2(f) ]. These biases vanish as NS \u2192 \u221e. Bias in each panel is most pronounced for scaling with variable S (crosses). For the A ii , this is a well-documented effect in the econometrics literature and analytical results are available [41] . Bias of the A ii estimates is expected to scale as \u223c1/ST . In essence, the estimated common trend will resemble the data more closely than the true common trend because it is inferred from the same data. Since the A ii measure the time scales at which each time series tends to return to the common trend, each time series will seem to have a stronger tendency to return to the common trend (and thus have a larger A ii ) than is true. At smaller values of \u03bc, this effect may be enhanced. The bias in log S Fig. 2(f) ] occurs for much the same reason: the difference between the true and estimated common trends is due to both measurement error and dynamical noise. The difference between the true and the estimated common trend will thus contain some unobserved variance. On average, one thus underestimates the strength of both sources of noise by about a factor 1/S. These biases highlight an important advantage of having replicate time series available: The common trend and the dynamics of individual replicate systems can be separated more reliably and, hence, effective interactions determined with less bias. We note that results are similar for Bayesian and maximum likelihood approaches since our priors have little effect on parameter estimation (see the Supplemental Material, [26] Fig. S-4 )."}, {"section_title": "D. Parameter estimation and the common trend", "text": ""}, {"section_title": "Choice of smoothing parameter", "text": "Often in ecology the common trend is assumed to be a simple exponential function, either by using a constantcoefficient \"stochastic exponential\" model (in our formulation A = 0 and \u03bc \u2192 \u221e, that is, f constant; cf. Refs. [9, 11, 21, 23] ) or by adding an explicit linear time dependence to x(t) [42, 43] . More generally, the constant-coefficient stochastic Gompertz model corresponds to \u03bc \u2192 \u221e for general A. Unfortunately, such constant-coefficient models can describe only a few types of average dynamics, and any idiosyncratic variation of the average will be confounded with fluctuations around the average dynamics. Thus constant-coefficient approaches are particularly ill suited for time series of replicate ecosystems. For such data the average dynamics can-to some extentbe separated from the dynamics of each individual replicate ecosystem. Thus, one needs models like Eq. (1a), with flexible average dynamics, that is, \u03bc < \u221e. We examine two alternative perspectives on the choice of smoothing parameter: treatment as a model parameter and treatment as a Bayesian prior.\nFrom a maximum likelihood perspective, one could treat \u03bc as an additional model parameter characterizing the dynamics of the common trend. For our data set, such straightforward optimization yielded an optimal value of \u03bc, \u03bc ML 100 [ Fig. 3(a) ]. In general, however, such an approach can have surprising consequences. We noticed that for some test data \u03bc kept rising during optimization of the likelihood function. Indeed, even a set of multiple replicate time series displaying some curvature in the common trend can yield \u03bc ML \u2192 \u221e. We investigate this in detail in the Supplemental Material [26] , Sec. S3. For example, for a single species, for A = 0 and S m = 0, a critical number of replicates S c exists below which \u03bc ML \u2192 \u221e,\nwhere\u0233 is the average dynamics over replicate ecosystems and \u0233 n =\u0233 n+1 \u2212\u0233 n . In the Supplemental Material [26] , Sec. S3, we derive a form of Eq. (17) From a Bayesian perspective, one can consider \u03bc a \"hyperparameter\" determining the relative role of the prior distribution of the \u03c6 nk . Specifically, we test giving the prior distribution a weight equal to that of a single additional time series (a concept known as the \"unit information prior\" (UIP) [44] ). Following Ref. [44] , this implies that the eigenvalues, \u03bc 2 \u03bb D , of the matrix \u03bc 2 D should on average be S times smaller (and the variance S times larger) than the eigenvalues of the data-derived matrix (R = R \u2212 \u03bc 2 D), \u03bb R . (The matrices \u03bc 2 D and R can be considered inverse covariance matrices of the prior and posterior distribution on \u03c6, respectively, so R is the data-derived part.) This constraint yields\nwhere the bars indicate geometric means. In practice, we first calculate R and D and then set \u03bc. For our data, the unit information prior yields \u03bc UIP = 0.8. Of course, in a Bayesian approach one can introduce other prior \"beliefs\" about \u03bc instead.\nTo examine the consequences of each choice of \u03bc, we examine their effects on inference for our experimental data. It is important to keep in mind that, in principle, our method fits all the observed dynamics, not just the average dynamics or the fluctuations around it. At low \u03bc, the inferred common trend is described by a large number of trend variables (here up to 188 variables, {\u03c6 nk }, per species as \u03bc \u2192 0) and effectively traces the sample average dynamics. Since many variables {\u03c6 nk } are available to fit the average dynamics, estimates of the (other) model parameters are dominated by the properties of the observed fluctuations around the average dynamics. However, some variation among the {\u03c6 nk } is likely due to limited sampling and measurement error. As \u03bc increases, this variation is progressively filtered out. This noise-suppression effect should become relevant around \u03bc UIP . The accompanying large decrease in L y (\u03b8; \u03bc) [ Fig. 3(a) ] implies that many of the {\u03c6 nk } are not well determined at low \u03bc.\nAs shown in Fig. 3 , as we further increase \u03bc up to about the maximum likelihood estimate for \u03bc, \u03bc ML , parameter estimates are fairly insensitive to the precise value of \u03bc. For example, estimates for A ij based on the unit information prior, \u03bc UIP , are quite similar to those at \u03bc ML . The same is true for estimates of the S m i and S d ij (data not shown). However, beyond \u03bc ML few effective degrees of freedom remain in the common trend (see the Supplemental Material [26] , Sec. S3 and Fig. S-2 , for a quantification). Since the parameters A ij do appear in the description of the common trend (see, for example, the Supplemental Material [26] , Sec. S3), a decrease in the number of effective degrees of freedom in the common trend description implies that estimates of the A ij are now also affected by the average dynamics. As a consequence, any systematic deviations between the observed common trend and any trend the model can describe will introduce idiosyncratic, and possibly large, biases in the A ij . At small \u03bc, on the other hand, the \u03c6 nk will describe the average dynamics, and the estimates of A ij will be dominated by the properties of the fluctuations around the common trend. If one, thus, is interested in the statistical structure of the fluctuations around the average dynamics, high values of \u03bc should be avoided, even if this is not immediately apparent from the log-likelihood.\nThis analysis should be disconcerting to anyone analyzing unique time series. Even though our common trend does not display any pronounced features (Fig. 1) , the assumption of constant f (or large \u03bc) would lead to incorrect inferences about the statistical structure of fluctuations around the average dynamics. For example, while the change in log-likelihood is modest, three of nine coefficients, involving all species, clearly switch sign as \u03bc is increased beyond \u03bc ML ."}, {"section_title": "Estimates of interaction coefficients", "text": "Once the smoothing parameter has been set, one can examine the posterior distribution of the model parameters. To do so, we note that the parameter transformations discussed in Sec. II E allow us to normalize the posterior distribution and calculate the posterior covariance and correlation matrices of the inverse parameters.\nOf direct ecological interest are the estimates of the effective interaction coefficients A ij . We will analyze these interaction coefficients for \u03bc = 25. As shown in Fig. 4(a) , estimates of eight of nine interaction coefficients significantly differ from 0 (the exception, A 32 , is the effect of E. coli on T. thermophila).\nBesides the statistical validation of our method above, we sought to provide some biological validation for these estimates. That is, do we estimate effective interaction coefficients that are reasonable? To do so, we analyzed an additional set of \"coarse\" measurements on duplicate one-and two-species closed ecosystems described in the Supplemental Material [26] , Sec. S4. In these experiments, ecosystems were sampled manually after gentle mixing every 7-10 days for 9 weeks and densities determined by haemocytometry (T. thermophila and C. reinhardtii) and plate counts (E. coli).\nThe level of sampling and replication of this coarse data set precludes separate identification of the two sources of noise, measurement error, and dynamical noise. A schematic comparison of the obtained effective interaction coefficients is shown in Fig. 4(b) . For most interactions, we obtain the same sign for both types of experiment, but the estimated effective interactions tend to be stronger in the coarse measurements. This could be a result of increased bias in the analysis of this small data set. For two of the interactions, the effects of both T. thermophila and C. reinhardtii on E. coli, the estimated sign differs between the two types of experiments. We do note, however, that a corresponding discrepancy can be seen between the effective interactions in the coarse one-and two-species experiments and a coarse three-species experiment conducted at the same time (see also the Supplemental Material [26] , Sec. S4 and Fig. S-3 ). This suggests that E. coli consistently achieves higher densities in the presence of both other species than expected from the effective interactions with either species alone, suggesting a possible three-species interaction term. We detail these observations in the Supplemental Material [26] , Sec. S4. It is noteworthy that the interactions obtained from fluctuations in a three-species system resemble those found in response to very strong perturbations (that is, the presence or absence of one or more species)."}, {"section_title": "Fluctuations in closed ecosystems", "text": "The availability of the joint posterior distribution of the model parameters allows us to ask more intricate questions, too. For example, one can determine the posterior probability distribution for each of the eigenvalues of A, \u03bb A . The posterior probability distribution of the real parts of the \u03bb A , sorted by size, is shown in Fig. 4(c) . From a biological point of view, these results are remarkable: The smallest eigenvalue of A is indistinguishable from 0 (suggesting random-walk dynamics along its corresponding eigenvector [1] ), even though the growth of each species, directly, is self-limiting (A ii > 0). That is, mutually \"stimulating\" interspecies interactions appear to largely cancel out intraspecies density dependence at the measured densities and time scales. We caution that the obtained interaction coefficients are effective ones and can reflect correlated changes in fitness during evolutionary change or spatial interactions as much as, e.g., predator-prey interactions or direct resource competition.\nWe further illustrate the utility of having the joint posterior distribution of model parameters by addressing how speciesspecies interactions structure the variation arising between replicate ecosystems. This question was raised by our previous work [1] , in which we studied the structure of variability in populations in replicate closed ecosystem experiments. To examine the variability across the set of replicate ecosystems (S), we estimated the logarithmic density correlation matrix C S as follows:\nThat is, this matrix describes how different realizations of replicate ecosystems at a particular time point are distributed in the space of species densities (log n 1 , log n 2 , . . .). We observed, first, that the eigenvectors and eigenvalues of C S were distinct and stabilized after about 20 days in a reproducible way [see also Fig. 4(d), open circles] . Because of these properties, we call these eigenvectors \"ecomodes.\"\nSecond, we observed that these ecomodes were similar to the eigenvectors of the \"species interaction matrix\" [1, 19] , which measures the structure of short-term (weekly) fluctuations in species densities within individual ecosystems, suggesting that species interactions determine the long-term structure of variation between replicates. We obtained this species interaction matrix by simple linear regression of measured deviations of the logarithmic densities from the replicate average 1 week apart.\nWithin the Gompertz model, one can examine the relationship between species interactions and ecomodes in more detail. Specifically, there are two sources of correlation between species densities in the model: the effective interaction coefficients A ij and the dynamical noise covariances S d ij . Since we have an analytical expression for the dynamics of the logarithmic density covariance matrix [Eq. (7) and more detail in the Supplemental Material [26] , Sec. S1], we can repeatedly sample the joint posterior distribution for A and S d and obtain a distribution of predicted ecomode dynamics (Fig. 4(d) , compared with estimates for the data obtained in Ref. [1] ). The ecomodes are labeled L (large), M (medium), and S (small) in order of their corresponding eigenvalues (L: \u223c 2, M: \u223c 0.7, and S: \u223c 0.3).\nWe compare the predicted ecomode dynamics (lines with 90% posterior confidence interval) with observations from Ref. [1] [ Fig. 4(d) , open circles]. To determine which source of species-species correlations dominates ecomode composition within our model, we display the eigenvectors of the density correlation matrix corresponding to S d alone as filled circles on the left y axis (t = 0), and the eigenvectors of A as filled circles on the right-hand y axis (t = 100 days). This display is motivated by the observation that dynamical noise exerts its effects instantaneously, while the A ij act over time. To establish the correspondence between eigenvectors of A and ecomodes, we use the labels L, M, and S, connecting the eigenvectors of A shown in Fig. 4(d) at t = 100 days to the eigenvalues of A [Fig. 4(c) ]. Even though the relation between A and C S is in general quite complex [19] , the ecomodes resemble the eigenvectors of A quite closely after a few weeks, despite the additional interspecies correlations present in the dynamical noise. In particular, the L ecomode is connected with the eigenvector of A with a nearly 0 eigenvalue.\nWe conclude that after a few weeks the structure of density covariation across systems is dominated by the effective species interactions and not by correlations within the dynamical noise. Indeed, we see that the largest density fluctuations occur along a collective dimension of the ecosystem which nearly coincides with the eigenvector of A with nearly zero eigenvalue. Moreover, this occurs despite negative density dependence for each individual species (the A ii > 0). This situation is reminiscent of the phenomenon of co-integration of macroeconomic time series [45] ."}, {"section_title": "E. Identifiability of model parameters", "text": "It may not be possible to estimate every parameter combination accurately from the data. In essence, this problem arises when different \u03b8 give rise to similar P (Y |\u03b8), with Y the general stochastic variable of which the data, y, are considered a realization. In such a case, the model is said to be not (or not completely) identifiable. In Fig. 5(c) we show the eigenvalue spectrum for the entire posterior correlation matrix (red dots). The larger the eigenvalue, \u03bb, the harder the parameter combination described by the corresponding eigenvector is to estimate. We show the composition of the eigenvectors with the largest eigenvalues in Fig. 5(d) . The dominant effect displayed by each eigenvector is a noise identifiability problem for each species. It is often hard to distinguish between dynamical noise and measurement error in models containing both [9] . For example, for a simple Gompertz model (in our notation K = 1, S = 1, \u03bc \u2192 \u221e), Knape [40] showed that for large A (strong \"density dependence\") it is hard to separate the relative contributions of 2 . An important consequence is that, if one assumes any of these three parameters to be zero, one introduces significant bias in the estimates of the other two parameters. There is significant additional structure in the eigenvectors shown in Fig. 5(d) . In particular, since the densities of C. reinhardtii and T. thermophila tend to covary in our data set, there is some difficulty telling the effects of the two species apart [that is, a larger estimate of A 11 implies a smaller estimate of A 13 and vice versa in v (a) , and likewise for A 31 How does one judge the statistical significance of these results? In principle, since a closed form expression for the likelihood function is available, one can calculate the posterior correlation matrix exactly and even derive its entire distribution for any set of model parameter values. We will use such an explicit calculation for the elements of the expected Hessian matrix for a simpler model when we examine the possibility of improvement of experimental designs in Sec. III G. For our data, statistical fluctuations are expected to be relatively small, since the number of observations is much larger than the number of entries in the posterior correlation matrix. For smaller data sets, we recommend study of the Hessian matrix instead in order to avoid numerical errors from matrix inversion.\nAt this point, we see room for further application of techniques from statistical physics in two directions. First, it seems reasonable that methods from random matrix theory [46] can be extended to posterior correlation matrices for complex models. That is, it should be possible to judge the significance of modes of the posterior correlation matrix by more general considerations of number of replicates, time points, and so on. Second, the posterior correlation matrix is closely related to matrices used to study system sensitivity to parameter perturbations in systems biology and other fields [47] . Recent statistical physics approaches to such matrices suggest such matrices may fall into certain universality classes [48] , based on their eigenvalue spectra.\nWe make three more observations. and even for their ratio (relative error: 19%). Finally, as we will show below, thoughtful experimental design can substantially alleviate identifiability issues."}, {"section_title": "F. Model selection", "text": "Once one has estimated model parameters, it is natural to ask how good the model really is. We will consider two ways of addressing this. First, we will compare the quality of one model relative to another, a task known as \"model selection.\" Second, we will look for a way to address how well an individual model fits the data. Our principle aim in this section is to stimulate a more critical attitude towards model selection criteria in ecology."}, {"section_title": "Model selection criteria", "text": "To judge the relative merits of models, we calculate Bayes factors [50] or, more precisely, their logarithms. For a model M and data y, Bayes's theorem yields P (M| y)P ( y) = P ( y|M)P (M), so one can compare the relative probabilities of two models, M 1 and M 2 , being the models generating the data, as follows:\nFor now, we will assume that models are a priori equally likely, although alternative assumptions can also be considered (and, as we will see, this choice can have nontrivial consequences). The ratio of P ( y|M 1 ) and P ( y|M 2 ) is known as the Bayes factor. Hence, we calculate for each model P ( y) = P ( y|M) as follows:\nwhere, for each model, \u03b8 = \u03b8 M ;\u03b8 is the optimal parameter vector and where H is the Hessian matrix at\u03b8 as in Eq. (15) . The approximation made here is that the likelihood function is essentially Gaussian (or the log-likelihood function parabolic) around\u03b8. Often, one can make this an excellent approximation by finding a suitable transformation \u03d1 = w (\u03b8) after\u03b8 has been found [35] , as described in Sec. II E. In our case, simply using log S m i and log S d ii proves adequate, leaving the other parameters untransformed (Supplemental Material [26] , Fig. S-4) .\nWe can compare our analysis to the Bayesian information criterion (BIC) [51] . The BIC is commonly used as a model selection criterion in ecology. The BIC in our case is as follows:\nFor comparison, our criterion [Eq. (21)] can be rewritten by taking logarithms [52] , \u22122 log P ( y) = \u22122 log P ( y|\u03b8) \u2212 2 log P (\u03b8) \u2212 p log(2\u03c0 ) + log |H| = \u22122 log P ( y|\u03b8) \u2212 2 log P (\u03b8) (23) + p log(KNS) + log |h|\nwhere we defined a normalized Hessian matrix, h, since the size of elements of H will grow asymptotically linearly with the number of data points, KNS (provided the model is identifiable). We observe two differences between Eqs. (23) and (22): The BIC neglects the prior information on model parameters, and the detailed structure of h, both of which do not scale with the number of data points. Indeed, the BIC, like other such criteria, TABLE III. Comparison of different models under two treatments of the trend prior (\u03bc = 25, top rows) and using a \"unit information prior\" (\u03bc UIP , bottom rows). Each model is described in the text. p is the number of parameters in each model. The other quantities refer to Eqs. (23) and (22) . Smallest values among alternative models are indicated as bold text.\nTrend prior, model p \u22122 log P ( y|\u03b8) \u22122 log P (\u03b8) \u22122 log P ( y) B I C was derived for the limit of a large number of data points. Unfortunately, ecology rarely operates in this limit. Posterior correlations between the model parameters (see above) further limit the range of validity of such asymptotic approximations. For completeness, we note that for transformed parameters \u03d1 = w (\u03b8), we obtain\nTo illustrate the use of Bayes factors, we examine a number of \"submodels.\" As a reminder, the full model is given by\u1e8b s = f (t) \u2212 Ax + \u03b7 and y kns = x ks (t n ) + \u03be kns , with \u03b7 \u223c N (0,S d dt) and \u03be kns \u223c N (0,S m k ). We considered leaving out each of the two sources of density correlations between species: The second row of Table III (\"diagonal S d \") shows the effects of setting the off-diagonal elements of the dynamical noise matrix S d to 0, while the third row (\"diagonal A\") shows the effect of setting the off-diagonal elements in the effective interaction matrix to 0. In the fourth row (\"uncoupled\"), the dynamics of each species are entirely independent (zero off-diagonal elements in both A and S d ). Finally, in the fifth row (\"random walk\"), we explore a simple random-walk description (A = 0), retaining the off-diagonal elements in S d . In each case, the full model fits the data the best at the optimal parameters [as measured by \u22122 log P ( y|\u03b8), to which we will return below]. However, both measured by our \"Bayes factor criterion,\" \u22122 log P ( y), and by the BIC, the randomwalk description is superior as an efficient description of the data, that is, once we average over the posterior distribution of the model parameters. This result is consistent with our previous work [1] . In that work, we showed that the randomwalk-like fluctuations of logarithmic density along the largest ecomode (see Sec. III D) dominate the density fluctuations of each of the species.\nEven though the Bayes factor and BIC agree in selecting the random-walk model as the best model, they do not agree on the ranking of the other models. Indeed, the full and uncoupled models do equally well, as measured by Bayes factors, but their BICs differ by >50, which constitutes a large difference in evidence [50] . Such a difference is comparable to the differences in BIC scores between the different models. This means that the formulation of the prior and the structure of the normalized Hessian cannot be ignored in model selection, even for our data set, which is large by any ecological standard.\n[We note that the ranking of the models by Bayes factors is robust to the choice of smoothing parameter (Table IV, bottom rows)].\nThe fact that both the \"diagonal S d \" and \"diagonal A\" models fit the data much better than the uncoupled model suggests that off-diagonal elements in S d and A contain partially redundant information about the correlations between species. This observation is related to the identifiability issues described in Sec. III E. Consistent with the potential for redundancy in the statistical description, we note that the estimated effective interaction matrix is fairly symmetric [ Fig. 4(b) ] so A ij and S d ij could readily absorb some of the effects of each other's omission."}, {"section_title": "Lindley paradox", "text": "There is something surprising about the performance of the random-walk model (A = 0): above (Sec. III D) we found that eight of nine elements of A differed significantly from 0, yet the random-walk model provides a seemingly better description of the data than the full model, judging by the Bayes factors. This inconsistency is known as Lindley's paradox [53] and occurs often in ecology [54] . It occurs if one assigns finite prior probability to a finite set of discrete parameter values. On the one hand, our prior probability density on the A ij assigns 0 probability to any precise value of A ij [e.g., lim \u21920 + \u2212 P (A ij )dA ij = 0]. On the other hand, in comparing the full model to the random-walk model using \u22122 log P ( y), we assigned the model with all A ij = 0 and the full model equal prior probability.\nThese choices together imply an overall prior distribution on A as illustrated in Fig. 6(a) for a single interaction coefficient. The question is whether it is natural to assign finite prior probability to the case of effectively noninteracting species. This is as much a biological consideration as a statistical one. If one wants to compare \"noninteracting species\" and \"interacting species\" as a priori equally plausible TABLE IV. Constants used in Eq. (25) to derive the expected distribution of the likelihood function. V is an auxiliary matrix used to simplify notation.\nalternative models, the random-walk model turns out to be the best for our data. One can, alternatively, take, for example, P ({|A ij | < 1/T for all i,j }) as a rough prior probability of the random-walk model. In other words, one can ask whether the interactions are effectively weak on the time scale of the experiment. The resulting implied overall prior distribution on A is illustrated in Fig. 6 (b) (again for a single interaction coefficient). This choice would increase \u22122 log P ( y) for the random-walk model by about +94, making the full model the better one. In other words, the answer provided by Bayes factors will-correctly-depend on which question one precisely asks. If data analysis is to provide any clarity, questions should be asked precisely and prior beliefs stated explicitly and consistently."}, {"section_title": "Absolute model quality", "text": "As a second, absolute criterion for model quality, we ask whether the data look like typical \"output\" of the model [55] . For example, the best model identified by a model selection criterion, as in Eq. (23), may still not fit the data very well. Alternatively, we could have overfitted the data, making the data unusually probable under the model. To judge this, we ask how the probability of the data compares with the probability of realizations of the model with the same measurement schedule. While we can ask this question for unique time series as well, it seems particularly well suited for a set of replicate time series.\nAs a starting point, we reinterpret the likelihood function, properly normalized, [Eq. (13) and Table II ] as a probability distribution over Y , the space of possible data sets. That is, P (Y |\u03b8) = l y (\u03b8 ; \u03bc). In general, a linear model with Gaussian dynamical and measurement error will produce a log-likelihood function of the type\nwhere N indicates a multivariate normal distribution. One readily obtains C, M, and h by rearranging terms in the likelihood function (see Table II ), yielding Table IV . We now compare the observed value of the log-likelihood function to the distribution of log-likelihood function values one would observe for data sets generated by the fitted model.\nwith KNS degrees of freedom for realizations Y of the state space model. For our data, we calculate the log-likelihood L y (\u03b8 ) at the estimated model parameters. Surprisingly, the observed data are quite typical for the model at\u03b8, meaning that the fit of the model to the data is as good as expected were the data actually generated by the model (Fig. 7) .\nWe note that this criterion for model quality has a structure similar to so-called \"goodness-of-fit\" quantities, like Pearson's \u03c7 2 test statistic, as well as the deviance information criterion [56] . An obvious concern is that\u03b8 is itself estimated from the data rather than the true \u03b8 , leading to an artificially good fit. Like for conventional asymptotic goodness-of-fit tests, one can (approximately) correct for this bias by adjusting the number of degrees of freedom of the \u03c7 2 distribution to KNS \u2212 p [this is based on a second-order Taylor expansion of L Y (\u03b8 ) around L Y (\u03b8) and taking expectation values]. The results for both the unadjusted and adjusted distribution of the log-likelihood are given in Fig. 7 . In either case, the observed data fall well within the main part of the distribution and are thus similar to typical output of the model itself [P (L < L obs ) = 0.11 (uncorrected) or 0.16 (corrected)]."}, {"section_title": "G. Optimal sampling", "text": "Can a judicious choice of sampling effort reduce parameter estimation and identification problems studied in Secs. III C-III E? Questions of optimal experimental design and optimal sampling have a long history in a variety of scientific fields [57, 58] . Perhaps most pertinent to ecology is recent work in the study of HIV disease dynamics, in which one needs to choose which factors to measure and at what schedule [59] , subject to cost and time constraints.\nIn our study of identifiability of model parameters above, we saw that difficulties in identifiability arise fundamentally from the presence of two sources of noise, error in the measurements and dynamical noise. We will illustrate the utility of ideas for optimal sampling by restricting ourselves to this elementary identification problem, the simultaneous estimation of measurement error and dynamical noise variances.\nCentral to most studies of optimal design is the so-called Fisher information matrix, I = E(H), that is, the expected value of the Hessian matrix [36] . By the Cram\u00e9r-Rao inequality, subject to some regularity conditions, I \u22121 places a bound on the best expected covariance matrix for unbiased estimators [36] and thus tells us how much one can learn at most from a particular experiment about each parameter or parameter combination.\nHere we will determine I for log S m and log S d rather than S m and S d , since expected standard deviations ( (I \u22121 ) ii ) can be interpreted as relative errors [as \u03c3 (log x) \u2248 \u03c3 (x)/x provided \u03c3 (x) x]. We then look at the smallest eigenvector of I, which acts as a bound on the precision (inverse variance) of the combination of log S m and log S d which is the hardest to estimate. To calculate I, we first observe that the Hessian matrix can be calculated analytically when an analytical expression is available for the likelihood function. As in Sec. III F, we then reinterpret the likelihood function as the probability distribution for data given the model parameters and, hence, calculate both the distribution of H under the model and its expectation value, I.\nFor simplicity, we examine the case of a single species (K = 1), in a single ecosystem (S = 1), for which both intraspecies interactions (A ii ) and the common trend are known to be zero (\u03c6 = 0). Since more measurements (N ) and longer experimental duration (T ) obviously improve estimation, we keep N and T constant. In this case, the likelihood function is given by the integrand of Eq. (12) . As A = 0, n = S d t n , B = 1, and C (0) = 0, the log-likelihood function simplifies to\nwhere we omitted parameter-and data-independent constants. \nwhere the \u03bb n are the eigenvalues ofQ. Calculation of I for many random measurement schedules (not shown) suggested that optimal measurement schedules are periodic: optimal measurement schedules appeared to consist of bunches of close-together measurements of various multiplicity, with the optimal multiplicity dependent on the value of \u03b3 . These \"repeated sampling\" schedules are reminiscent of the measurement approach proposed by Dennis et al. [60] , based on disaggregation of data in the North American Breeding Bird Survey. (Here we should note some confusing terminology in the ecological literature. Dennis et al. [60] refer to such repeated sampling of an individual ecosystem as \"replicated sampling,\" but this should not be confused with the use of replicate ecosystems, and we will instead refer to the former as repeated sampling.) Knape et al. [61] extended approximate maximum likelihood inference for such sampling schemes. Our formalism can handle repeated sampling without modification. Repeated sampling has been proposed in other scientific fields as well [58] . Since general optimization of measurement schedules is a highly nontrivial task, we restrict ourselves further to periodic schedules. Within these schedules, measurements occur in bunches of the same multiplicity, L, separated by small intervals \u03b5. For simplicity, we measure time in units of the average measurement interval (that is, t = 1) without loss of generality. We illustrate such measurement schedules in the diagram in Fig. 8(c) . Within each bunch, measurements are numbered 1, . . . , .\nWe illustrate the achievable gains in precision [according to Eq. (27) ] as a function of L and \u03b5 for N = 120 and \u03b3 = 0.1 [dotted lines, Fig. 8(a) ] and \u03b3 = 3 [ Fig. 8(b) ]. In each case, the reference is measurement at equally spaced time points. For both values of \u03b3 , substantial gains in precision relative to the equally spaced reference can be achieved by sampling repeatedly, although different multiplicities of the measurements are optimal for different values of \u03b3 . For comparison, single species estimates of \u03b3 for our data are, for the most densely sampled time series, about 1.1 for C. reinhardtii, 2.1 for E. coli, and 2.9 for T. thermophila.\nFigures 8(a) and 8(b) also shows that the optimal spacing within a bunch is often as large as possible (that is, it reduces to equal spacing) or as small as possible (\u03b5 * = 0). However, for larger values of L and \u03b3 , intermediate optimal \u03b5 are seen [ Fig. 8(c), thickened line segments] .\nFor measurement schedules with many time points, it may become inefficient to calculate the optimal schedule this way. Instead, one can also calculate I in the limit of long time series (T ,N \u2192 \u221e, while T /N constant). In this case, the periodicity of the measurement schedule can be exploited to easily calculate I. SinceQ is periodic, we can use a tool from condensed matter physics, Bloch's theorem [62] , to reduce the complexity of finding its eigenvectors and eigenvalues from an \n\u0394t n :\nt: NL \u00d7 NL problem to an L \u00d7 L problem (see the Supplemental Material [26] , Sec. S5 for details).\nAs the number N of measurements grows, we find that I = NI 0 , with I 0 the Fisher information matrix per measurement point as follows:\nThis is analogous to Eq. (27) . Here, \u03bb (\u03d5), with = 1, . . . ,L, denotes the eigenvalues of the L \u00d7 L matrixQ(\u03d5), which is an L \u00d7 L submatrix ofQ modified at its corner elements, as follows:\nwhere i Using our asymptotic results, we show in Fig. 8 (d) the gain in precision for different sampling multiplicities (in each case at their optimal \u03b5 = \u03b5 * ) as a function of \u03b3 . Obviously, one typically does not know \u03b3 precisely at the start of an experiment. Nevertheless, it is clear that low multiplicities (L = 2 \u2212 4) yield robust gains in precision over a large range of \u03b3 , mostly for \u03b5 * \u2248 0. Temporal autocorrelation in the measurement errors can make the optimal \u03b5 larger than 0 and decrease the achievable gain in precision.\nFinally, we note that, since the full likelihood function is available for multiple interacting species, replicate systems, and arbitrary common trend (Tables I and II) , one can derive and optimize the eigenvalues of the Fisher information, I, for more complex dynamics and measurement schedules. For example, while in the above case the Fisher information is simply additive over replicate systems, we expect this to be no longer the case if the common trend is unknown. As a consequence, it might be optimal, at constant total effort, to sample different systems in different ways. We also studied the case of single species dynamics with S d 11 > 0, A 11 > 0, and S m 1 = 0 in a single replicate with known average dynamics. In this case, our analysis suggested little room for improvement over equally spaced measurements, provided A 11 1/ t (results not shown)."}, {"section_title": "IV. DISCUSSION AND CONCLUSIONS", "text": "Study of the stochastic nature of any complex system requires accounting for possible idiosyncratic trends in the data. For ecological systems such trends are clearly pervasive. Replication of ecosystems allows the exciting possibility that one can actually study variability in ecological dynamics, but one also needs flexible but simple models capable of accommodating an idiosyncratic trend. Indeed, for our experimental data on a set of replicate closed ecosystems, we confirm this notion: Flexibility in the common trend described by the model is necessary to obtain good estimates of effective species interactions characterizing the variability in dynamics [ Fig. 4(a) ].\nSpecifically, we use a linear, Gaussian, continuous-time Gompertz model to illustrate the challenges one faces fitting models to replicate ecological time series. We emphasize that this is a phenomenological model and its parameters are effective ones. Changes in model structure, for example, in the functional form of density dependence or the time dependence of parameters, could lead to different estimates of all parameters. Without doubt, alternative model structures may be more appropriate for some other ecosystems. Conceivably, too, different approaches may be required, e.g., for strongly cyclical dynamics in which the main mode of variability might be random variation in the phase of the cycles or dynamical noise is intermittent.\nA central difficulty in fitting replicate time series is the description of the common trend. Here we chose a segmentby-segment description with time dependence in the trend variables f and a smoothing parameter \u03bc to limit the overall complexity of its description. There are several reasonable choices of the smoothing parameter, and we advise exploring inference over a range of \u03bc. As shown in Fig. 4(a) , the common choice, constant coefficients (\u03bc \u2192 \u221e), can lead to significant error, and we have proposed ways to make a better choice. We anticipate that more sophisticated choices of smoothing parameter, and perhaps a description of the common trend altogether, will be developed.\nWhile we believe that much can be learned from a simple, linear model, we briefly mention here a number of modifications and extensions of our work.\n(1) One can make alternative choices for prior distributions and still apply the methods here, provided the overall probability of the data can still be integrated over x and \u03c6.\n(2) We note that our analysis places no restrictions on measurement schedule. Different replicates can be sampled at different time points, and time intervals do not need to be identical. Indeed, the analysis of our data was based on a more general form of our algorithm than presented in the main text, accommodating arbitrary measurement schedules as explained in the Supplemental Material [26] , Sec. S3, and avoiding \"missing data\" problems.\n(3) One can extend our approach to the comparison of sets of replicates each with their own trend. We discuss briefly how to do this in the Supplemental Material [26] .\n(4) We have described our approach for linear stochastic differential equations since stochastic differential equations (rather than difference equations) have received little attention in the ecological literature and were suitable for our data. It is straightforward to apply our methods to linear difference equations instead. One simply replaces Eqs. (6) and (7) with the new dynamical model.\n(5) It is also straightforward to include delays (e.g., ARMA models, Refs. [10, 24] ), life cycle (stage) or age structure. Such models can, in principle, alleviate the assumption of a Markov property for the dynamics. Not surprisingly, however, such models suffer from significant identifiability problems and complicated, multimodal likelihood surfaces [63] , even for a single species.\n(6) It is trivial to include covariates with known time dependence into the analysis, as long as they are additive, or linear in the logarithmic densities (cf. Ref. [19] ).\n(7) One can separate dynamical noise into a \"global\" component affecting all replicate systems and per-system components. This would simply lead to cross-terms Q (s,s ) between systems but not affect the overall mathematical structure.\n(8) We conjecture that one can approximately accommodate some nonlinear models in the present framework. For example, formulated in terms of logarithmic densities, the Lotka-Volterra model contains a nonlinear term e x , which is quite readily linearized. Likewise, replacing log-normal measurement error with Gaussian measurement error simply means multiplication of the error terms by e \u2212x . One can also approximate alternative stochastic components using linear combinations of Gaussian distributions (\"mixtures\"). In any case, from a statistical perspective, linear Gaussian models provide a good starting point, in comparison to which nonlinear contributions can be tested for their significance.\n(9) It would be interesting to compare our methodology further to methods from econometrics based on vector autoregressive models.\nWe want to make a few closing remarks. First, rarely is one interested in a list of parameter values per se but rather in system properties like the robustness to perturbations, the sources, size and time scale of fluctuations, or prediction of extinction dynamics. As we have shown, inference of the full joint posterior distribution of the model parameters is essential to this end. We anticipate that future population dynamics experiments may well differ markedly from past practice. They may include an a priori or \"online\" (i.e., as measurements come in) analysis of the identifiability of the system properties of interest. This analysis can steer the choice of initial conditions, system perturbations, and measurement schedule [64] , enabling more efficient focus on the ecosystem properties or processes under study. More fundamentally, even \"simple\" laboratory ecosystems display a rich interplay between physical, metabolic, phenotypic, spatial, and population dynamics. This multitude of relevant variables and associated length and time scales raises the question whether differential equations, or, more generally, conventional population dynamics models, can at all be applied to data in a meaningful manner. Perhaps entirely different statistical and conceptual tools are necessary. At the same time, we believe that replicable model systems are necessary for ecology. Such model systems may not match the complexity present in natural ecosystems. They could, however, be our only hope of obtaining the conditions and data necessary for making fundamental progress."}]