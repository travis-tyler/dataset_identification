[{"section_title": "Abstract", "text": "Recently, Geometric Deep Learning (GDL) has been introduced as a novel and versatile framework for computer-aided disease classification. GDL uses patient meta-information such as age and gender to model patient cohort relations in a graph structure. Concepts from graph signal processing are leveraged to learn the optimal mapping of multi-modal features, e.g. from images to disease classes. Related studies so far have considered image features that are extracted in a pre-processing step. We hypothesize that such an approach prevents the network from optimizing feature representations towards achieving the best performance in the graph network. We propose a new network architecture that exploits an inductive end-to-end learning approach for disease classification, where filters from both the CNN and the graph are trained jointly. We validate this architecture against state-of-the-art inductive graph networks and demonstrate significantly improved classification scores on a modified MNIST toy dataset, as well as comparable classification results with higher stability on a chest X-ray image dataset. Additionally, we explain how the structural information of the graph affects both the image filters and the feature learning."}, {"section_title": "Introduction", "text": "In the past few years, the potential of data processing with Geometric Deep Learning (GDL) on non-Euclidian data structures has been demonstrated by a large body of work [1, 5, 6, 7, 8] . One uprising application, which is also the subject of this work, lies in the field of computer-aided disease classification (CAD), where the usage of patient meta-information is leveraged to build a graph system of meaningful patient inter-relations [8, 4] . These patient relations allow e.g. an improved classification of image data, which enables the prediction of a disease. This is achieved by using various forms of graph signal processing for the training of localized graph filters, where patients are modeled as vertices in the graph, and images as feature vectors. One family of approaches [8, 5, 6] are graph spectral methods, which utilize the normalized graph Laplacian L to perform a Fourier transform in order to find optimal filters in the frequency domain. A major drawback of spectral methods is the limitation of their learned representation to the graph they are trained on. Therefore, their transductive approach requires a retraining for every new graph system, making them difficult to use for a direct application on newly received patient data. We therefore focus on non-spectral methods, which overcome this limitation by working on local graph structures, mimicking the standard convolution operation on the spatial relations of a graph node. The concept relevant for this work are composition-based spatial methods that use multiple consecutive layers to update the vertex representation. Hamilton et al. presented GraphSage [2] , which samples a fixed number of neighbors of a vertex and aggregates them to receive an updated representation of the feature vector in every layer. This inductive approach allows the successive processing of every vertex of the graph. The system however did not define a preference of which neighboring feature representations are most relevant for the update. We thus focus on and adapt Graph Attention Networks (GAT) in this work. GAT was introduced by [10] and leverages an attention mechanism to learn this importance measure in order to optimize the representation learning. Regarding CAD systems, in [8] a GDL-approach for disease classification was proposed, modeling patient similarities through meta-information and performing patient classification in the ABIDE and ADNI datasets using Graph Convolutional Networks (GCN). In 2018, self-attention was used in [4] to optimize the usage of meta-information in the TADPOLE dataset. Both methodologies used pre-learned features in their approach. Since we are evaluating our method on chest X-ray images, we are also mentioning related works out of this field. In 2017, Wang et al. [11] proposed a new chest X-ray database, known as \"ChestX-ray8\", which contains 108,948 frontal view X-ray images of 32,717 unique patients for eight different disease classifications and performed multi-label disease classification and localisation using class activation mapping [12] . In [3] , disease classification was realized on three chest X-ray datasets using standard deep convolutional networks, localizing activations with occlusion mapping. CheXNet [9] , a DenseNet of 121-layers, was used for classification of all 14 diseases for the whole dataset, with an emphasis on pneumonia. All the works relied on standard CNN approaches and did not leverage any non-imaging information. Contributions: Although GDL approaches used for CAD showed promising performance, two major drawbacks are present in the methodologies developed so far. First, it is necessary to extract the meaningful features in a pre-processing step, which results in additional effort. Second, a potentially not optimized feature representation for the usage inside the graph system is learned. To address these limitations we propose CNNGAT, a novel method that yields an inductive end-to-end approach for learning an optimized feature representation and per- form the graph convolutions during training time. Additionally, the introduced concept leverages inter-class connections to specifically improve the performance on instances from classes which are more diffcult to distinguish. To the best of our knowledge this is the first work that combines the training of the CNN and graph network to obtain optimized representations. We evaluate our proposed method on the ChestX-ray 14 [9] dataset and a modified MNIST dataset."}, {"section_title": "Methodology", "text": ""}, {"section_title": "Explanation of the proposed model", "text": "General framework: Our proposed network CNNGAT performs the classification of images represented as 2D intensity arrays X using non-imaging metainformation in an inductive end-to-end approach. It tries to optimize the objec-\nis a graph with vertices V containing a feature representation of every image x i and binary edges E as connections between the vertices and Y as set of classes. The whole set of feature representations for every vertex v i of the graph is therefore defined as:\nThe edges E have been created based on non-imaging information belonging to every image x i . The CNN extracts a feature representation of image x i and distributes it to the corresponding vertex v i . Subsequently, the obtained representation is processed by two consecutive GAT layers. The resulting representation is concatenated with the initial representation of the CNN to perform the final prediction ( Fig. 1 ). Neighborhood concept: A GAT layer updates the feature representation v i based on the ones of neighboring vertices. Therefore, it requires that a neighborhood of images is processed together with x i . Since the general size of image datasets prohibits the use of all neighbors for a vertex v i \u2208 V, different from [10] , only a fixed sub-sample of size n of all vertices v j with e ij \u2208 E is considered as neighborhood N i of v i . If for a vertex v i , the size n of the neighborhood cannot be reached, a random selection of N i is used multiple times until the amount n of vertices is achieved. As described in [2] , this procedure has the advantage of setting the computational effort of the network to a fixed amount.\nGAT layer: To achieve a higher representation of v i \u2208 R F with new dimension F , a shared learnable linear transformation W \u2208 R F \u00d7F is applied to v i and its considered neighbors v j \u2208 N i . Then, a shared attention mechanism a that consists of a single-layer feed-forward network is used to obtain the attention coefficient \u03b1, representing how important v j is for the update of v i and computed as a(Wv i , Wv j ) = a T [Wv i ||Wv j ], with the concatenation (symbolized as [ || ]) of Wv i and Wv j and a \u2208 R 2F . After activating the calculated attention using the activation \u03c3 = LeakyReLU, the softmax function is applied for all v j \u2208 N i to obtain normalized and easily comparable attention coefficients \u03b1:\nEvery attention coefficient is multiplied with the feature representation Wv j and added up to obtain the new representation v i . To stabilize the representation, this procedure is repeated multiple times with individual W k , called heads, performing the same attention mechanism for a vertex v i . The representations v i are concatenated (represented as ), yielding the new feature representation:\nwhere \u03b1 k ij is the attention coefficient of head k for the vertices v i and v j , and K is the number of heads [10] . CNN/GAT hybrid: The initial representation v i is processed at the same time in a skip connection using a single-layer feed-forward network W skip . The output of the layer is activated using LeakyReLU and then concatenated with the output of the graph attention network v i to receive the hybrid representation v i = [v i ||v i ]. This strategy enables both the initial representation of the CNN and the altered representation after neighborhood interaction to be used for the prediction, leveraging both information. After a final activation, a last singlelayer feed-forward network is used to map the concatenated vector to the class output and apply a softmax function. The gradients are backpropagated through the whole network, updating not only the graph network but also the CNN, and therefore updating the feature extraction in every iteration."}, {"section_title": "Motivation of CNN/GAT hybrid approach", "text": "Two concepts motivate the final concatenation of the representation extracted from the CNN and the GAT. First, the skip connection allows a direct gradient propagation to the CNN, thus fortifying a proper filter learning. More importantly, the combination of both outputs enables a comparison of the pure filter extraction and the \"impure\" feature representation after its interaction with the neighborhood. The individual connectivity of instances from different classes to other subjects yields an additional unique contribution to the feature representation. Especially for classes usually difficult to distinguish, this individual contribution of feature representations from other instances significantly improves the classification performance on these classes. Therefore, the interesting and unintuitive observation is obtained that inter-class connections can be highly beneficiary in the used setup, which is also shown in the experiments."}, {"section_title": "Experiments", "text": ""}, {"section_title": "Datasets", "text": "First, a modified version of the MNIST dataset is used to prove the concept of the proposed method. MNIST consists of 70,000 handwritten digits from 0 to 9. Only the lower half of every image is used as actual image input, while the upper half is processed for the creation of the affinity graph structure. The objective is to show the improved classification of classes difficult to distinguish like 3 and 5 due to their identical lower shape. Following the inter-class setup explained in Sec. 2.2, we additionally take into account the digit 6, which shows a similarity to only the number 5 in the upper half. We therefore create a subset of 6,000 images of the numbers 3, 5 and 6 for training and 2,860 images for testing. Secondly, we adapt the approach to the task of disease classification on the NIH ChestX-ray14 dataset. The dataset consists of 112,120 labelled X-ray images, containing one or more of 14 different diseases, with substantial imbalance for some classes. 16,000 single-label images of the eight diseases suggested by [11] are taken into consideration to obtain a potentially clearer patient cohort system."}, {"section_title": "Experimental setup", "text": "Affinity graph construction: For the MNIST dataset, the construction of the affinity graph is based on the upper half of the image. As a metric, the l1-distance of the flattened image intensity vectors is used. If the distance between the two image vectors v 1 and v 2 is below a certain threshold \u03b8, the edge is established. Then, to analyze the potential of the proposed network and to prove that the obtained improvement is related to the previously described meaningful interclass connections, three additional settings are used: 1) random edges, 2) edges based on label information, and 3) edges based on labels including the helpful inter-class connection between 5 and 6. It has to be stated that the usage of Table 1 . Performance on MNIST dataset. Aff. shows which affinity mechanism was used: \u03b8= l1-distance, L=labels, CL=labels with connection between 5 and 6. P-val is reported against CNNGAT. Occ. shows average correct class probability of softmax function for occlusion shift. O. p-val shows p-value compared to CNNGAT."}, {"section_title": "Network", "text": "Aff. label information is just used here to prove the concept of the network. For the NIH chest xray dataset, the accessible meta-information is used to create the affinity graph. After performing an analysis of the statistics with respect to the patients' diseases, we connect subjects in our experiments if at least one of the following three conditions is fulfilled for two patients p 1 and p 2 :\n\u2022 patient id p1 = patient id p2 \u2022 gender p1 = gender p2 and |age p1 -age p2 | < 1y \u2022 gender p1 = gender p2 and age p1 = age p2\nNetwork setup: We create three baselines and one alternative method to analyze the different aspects of CNNGAT. To show the improved learning of feature representations we compare against the performance of a simple CNN, the normal GAT network on pre-learned features by the CNN, and GAT using a skip connection (SkipGAT). To validate the hybrid approach we compare against our end-to-end CNNGAT network without using skip connections (EndGAT).\nFeature extraction: For the MNIST dataset, the CNNGAT was trained with a simple CNN containing two convolutional layers. For the ChestX-ray14 dataset, AlexNet was used as CNN to easily prevent overfitting on the 16,000 images."}, {"section_title": "Modified MNIST dataset", "text": "The results on the above described MNIST toy dataset are shown in Tab. 1 indicate that the CNNGAT is indeed improving the classification by using the inter-class connections for numbers 5 and 6. Using pre-trained features in the proposed network approach (SkipGAT) diminishes the performance of the system, showing the value of adaptive feature learning. Also the approach without Skip-Connection (EndGAT) is significantly outperformed. To give further evidence that the features are learned in a more robust way, we perform a shifted occlusion for 1000 random images. A occluding window is slid across the image and after prediction is performed, the probability of the correct class in the softmax function is recorded for every position. One example is shown in Fig. 2 a-d) for an instance of the number 3. It is visible that the classification is significantly more stable compared to the other networks, also stated in Tab. 1. For the second setting of graph edges described in Sec. 3.2, the lower part of Tab. 1 clearly shows that the presence of meaningful inter-class connections is leading to top-level performance even outperforming a clean label graph."}, {"section_title": "NIH ChestX-ray 14 dataset", "text": "Tab. 2 shows the results on the ChestX-ray 14 dataset. The CNNGAT had a slightly better performance than the used CNN, but the improvement is not significant. The absence of the effects seen on the MNIST dataset are addressed in the discussion. The occlusion shift analysis however shows that the classification is stabilized by the graph (Fig. 2 right) . The probability of predicting the correct class under occlusion is significantly higher compared to the raw CNN (Tab. 2)."}, {"section_title": "Discussion and Conclusion", "text": "The results on the MNIST dataset follow the expectation of the network performance. Only when training the CNN and GAT end-to-end, optimized performance is reached. Especially the comparison to SkipGAT, which is identical to CNNGAT except its pre-learned features states the importance of the feature Additionally, the fact that the EndGAT setting is significantly outperformed fortifies the usage of the CNN/GAT hybrid approach. This behaviour was not clearly reproducible on the ChestX-ray 14 dataset. After performing a statistical analysis on the data distributions we hypothesize that the available meta-information was not relevant enough to build the required patient cohorts. Generating an artificial meaningful graph on the dataset showed the expected clear performance improvement. We have proposed a new methodology to train a CNN and GAT network end-toend and use their output in a hybrid approach to leverage both advanced feature learning and inter-class feature representations. The experiments clearly showed the superiority of the approach under the constraint that a meaningful graph can be created. In future work, the network architecture can be further optimized by e.g. including a learning mechanism for the adjacency system. With an automatized graph creation the necessity of finding meaningful meta-information is erased what makes the network applicable in a more general way."}]